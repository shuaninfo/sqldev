(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-502061ee"],{"45c9":function(t,e,a){"use strict";var o=a("c4ee"),s=a.n(o);s.a},"7bb6":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"work padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/work/list","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"工单状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.work_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand",width:"40"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{attrs:{"label-position":"left","label-width":"50px"}},[a("el-form-item",{attrs:{label:"SQL"}},[a("pre",{staticClass:"sql"},[t._v(t._s(e.row.sql))])])],1)]}}])}),a("el-table-column",{attrs:{label:"编号",prop:"id",width:"120"}}),a("el-table-column",{attrs:{label:"工单名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"类型",prop:"type",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{title:t.showWorkType(e.row.type)}},[t._v(t._s(t.showWorkType(e.row.type)))])]}}])}),a("el-table-column",{attrs:{label:"发起人",prop:"create_name"}}),a("el-table-column",{attrs:{label:"项目",prop:"project_name"}}),a("el-table-column",{attrs:{label:"工单状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showTagType(e.row.status)}},[t._v(t._s(t.showStatus(e.row.status)))])]}}])}),a("el-table-column",{attrs:{label:"发起时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"目标数据源",prop:"db_name"}}),a("el-table-column",{attrs:{label:"目标数据库",prop:"owner"}}),a("el-table-column",{attrs:{label:"是否备份"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.back_up?a("span",[t._v("是")]):a("span",[t._v("否")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v("详情 ")]),1==e.row.back_up&&6==e.row.status?a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkBackUp(e.row)}}},[t._v("备份 ")]):t._e()]}}])})],1)],2),a("dialog-detail",{ref:"detailDialog",on:{refresh:t.refresh}}),a("dialog-backup",{ref:"backupDialog"}),a("dialog-apply-info",{ref:"applyInfoDialog",on:{refresh:t.refresh}})],1)},s=[],r=(a("ac1f"),a("841c"),a("5530")),l=a("2f62"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(" "+t._s(t.formData.source_name)+"(权限组) ")]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[t._v(" "+t._s(t.formData.auditor_name)+" ")]),a("el-form-item",{attrs:{label:"审核抄送",prop:"copy_to"}},[t._v(" "+t._s(""==t.copyTo?"无":t.copyTo)+" ")]),a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t._v(" "+t._s(t.showStatus())+" ")]),1!=t.formData.status?a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):t._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!=t.formData.status,expression:"formData.status!=1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)],1)},i=[],u=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],o=0;o<t.copy_to.length;o++)a.push(t.copy_to[o].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this.formData;t.status=this.status}},mounted:function(){},components:{}}),c=u,p=a("2877"),f=Object(p["a"])(c,n,i,!1,null,null,null),m=f.exports,h=a("c58e"),d=a("d170"),_={computed:Object(r["a"])({},Object(l["b"])(["showWorkType"])),data:function(){return{search2:{db_type:null},search:{db_type:null,status:-1},work_states:[{k:-1,v:"全部"},{k:0,v:"待审核"},{k:1,v:"审核通过"},{k:2,v:"审核不通过"},{k:3,v:"人工终止流程"},{k:4,v:"定时执行"},{k:5,v:"执行中"},{k:68,v:"执行成功"},{k:7,v:"执行失败"}]}},props:{},watch:{},methods:{showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={status:-1}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogApplyInfo:m,DialogDetail:h["a"],DialogBackup:d["a"]},mounted:function(){}},b=_,w=(a("45c9"),Object(p["a"])(b,o,s,!1,null,null,null));e["default"]=w.exports},a15b:function(t,e,a){"use strict";var o=a("23e7"),s=a("44ad"),r=a("fc6a"),l=a("a640"),n=[].join,i=s!=Object,u=l("join",",");o({target:"Array",proto:!0,forced:i||!u},{join:function(t){return n.call(r(this),void 0===t?",":t)}})},c4ee:function(t,e,a){}}]);