(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0da1fefc"],{"14df":function(t,e,a){"use strict";var s=a("694c"),i=a.n(s);i.a},"1f82":function(t,e,a){"use strict";e["a"]={name:"ElCol",props:{span:{type:Number,default:24},tag:{type:String,default:"div"},offset:Number,pull:Number,push:Number,xs:[Number,Object],sm:[Number,Object],md:[Number,Object],lg:[Number,Object],xl:[Number,Object]},computed:{gutter(){let t=this.$parent;while(t&&"ElRow"!==t.$options.componentName)t=t.$parent;return t?t.gutter:0}},render(t){let e=[],a={};return this.gutter&&(a.paddingLeft=this.gutter/2+"px",a.paddingRight=a.paddingLeft),["span","offset","pull","push"].forEach(t=>{(this[t]||0===this[t])&&e.push("span"!==t?`el-col-${t}-${this[t]}`:"el-col-"+this[t])}),["xs","sm","md","lg","xl"].forEach(t=>{if("number"===typeof this[t])e.push(`el-col-${t}-${this[t]}`);else if("object"===typeof this[t]){let a=this[t];Object.keys(a).forEach(s=>{e.push("span"!==s?`el-col-${t}-${s}-${a[s]}`:`el-col-${t}-${a[s]}`)})}}),t(this.tag,{class:["el-col",e],style:a},this.$slots.default)}}},2848:function(t,e,a){},"2c61":function(t,e,a){},"2e0b":function(t,e,a){"use strict";e["a"]={name:"ElRow",componentName:"ElRow",props:{tag:{type:String,default:"div"},gutter:Number,type:String,justify:{type:String,default:"start"},align:{type:String,default:"top"}},computed:{style(){const t={};return this.gutter&&(t.marginLeft=`-${this.gutter/2}px`,t.marginRight=t.marginLeft),t}},render(t){return t(this.tag,{class:["el-row","start"!==this.justify?"is-justify-"+this.justify:"","top"!==this.align?"is-align-"+this.align:"",{"el-row--flex":"flex"===this.type}],style:this.style},this.$slots.default)}}},"32bd":function(t,e,a){"use strict";var s=a("39b4"),i=a.n(s);i.a},3835:function(t,e,a){"use strict";function s(t){if(Array.isArray(t))return t}a.d(e,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d28b"),a("d3b7"),a("3ca3"),a("ddb0");function i(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var a=[],s=!0,i=!1,l=void 0;try{for(var n,r=t[Symbol.iterator]();!(s=(n=r.next()).done);s=!0)if(a.push(n.value),e&&a.length===e)break}catch(o){i=!0,l=o}finally{try{s||null==r["return"]||r["return"]()}finally{if(i)throw l}}return a}}var l=a("06c5");function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){return s(t)||i(t,e)||Object(l["a"])(t,e)||n()}},"39b4":function(t,e,a){},4352:function(t,e,a){"use strict";var s=a("2848"),i=a.n(s);i.a},"5aad":function(t,e,a){},"687d":function(t,e,a){"use strict";var s=a("5aad"),i=a.n(s);i.a},6892:function(t,e,a){},"694c":function(t,e,a){},7162:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"log"},[a("k-search-table",{ref:"st",attrs:{url:"/api/sys/report/stat","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"操作类型:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.task_type,callback:function(e){t.$set(t.search,"task_type",e)},expression:"search.task_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onExport}},[t._v("导出")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"user_name",label:"用户名"}}),a("el-table-column",{attrs:{prop:"hits",label:"执行次数"}}),a("el-table-column",{attrs:{label:"数据行数",prop:"data_count"}})],1)],2)],1)},i=[],l=(a("ac1f"),a("841c"),a("5530")),n=a("2f62"),r=a("c1df"),o=a.n(r),c={data:function(){return{instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行次数排序"},{k:1,v:"按数据总量顺序"}],types:[{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:99,v:"其他"}],search:{ip:"",start:"",end:"",type:this.defaultType,owner:"",order_by:0,db_id:null,dateRange:[o()().startOf("d").toDate(),o()().endOf("d").toDate()]}}},computed:Object(l["a"])({searchAdvance:function(){var t=Object(l["a"])({},this.search);return t.dateRange&&(t.start=o()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=o()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(n["c"])(["user"])),props:{defaultType:{}},watch:{},methods:{onDownload:function(t){var e=window.localStorage.getItem("token");this.$api.download("/api/download/export/excel",{id:t,access_token:e})},onExport:function(){var t=this,e=Object(l["a"])({},this.search);e.dateRange&&(e.start=o()(e.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),e.end=o()(e.dateRange[1]).format("YYYY-MM-DD HH:mm:ss")),this.$api.post("/api/sys/report/stat/export",e).then((function(e){console.log("ret:",e),t.onDownload(e)}))},quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={start:"",end:"",task_type:0,type:this.defaultType,db_id:null,dateRange:[o()().startOf("d").toDate(),o()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e}))}},d=c,u=(a("14df"),a("2877")),f=Object(u["a"])(d,s,i,!1,null,null,null);e["a"]=f.exports},"7db0":function(t,e,a){"use strict";var s=a("23e7"),i=a("b727").find,l=a("44d2"),n=a("ae40"),r="find",o=!0,c=n(r);r in[]&&Array(1)[r]((function(){o=!1})),s({target:"Array",proto:!0,forced:o||!c},{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),l(r)},a12a:function(t,e,a){},b793:function(t,e,a){"use strict";var s=a("2c61"),i=a.n(s);i.a},bf7c4:function(t,e,a){"use strict";var s=a("6892"),i=a.n(s);i.a},d54f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"database padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/strategy/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"策略名称:",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"策略类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.c_type,callback:function(e){t.$set(t.search,"c_type",e)},expression:"search.c_type"}},t._l(t.c_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$refs.editDialog.show()}}},[t._v("新增策略")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"name",prop:"name",width:"350px"}}),a("el-table-column",{attrs:{label:"类型",prop:"c_type",width:"100px"}}),a("el-table-column",{attrs:{label:"策略模板",prop:"tid",width:"100px"}}),a("el-table-column",{attrs:{label:"数据源",prop:"db_name",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.db_name)+"/"+t._s(e.row.owner))]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"60px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"管理操作","min-width":"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.$refs.editDialog.show(e.row,!0)}}},[t._v("修改")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】数据源吗?"},on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除")])],1)]}}])})],1)],2),a("dialog-edit",{ref:"editDialog",on:{refresh:t.refresh}})],1)},i=[],l=(a("7db0"),a("a630"),a("d81d"),a("b0c0"),a("d3b7"),a("ac1f"),a("3ca3"),a("841c"),a("ddb0"),a("3835")),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"margin-top":"0"}},[t.isShow?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{"custom-class":"database-edit","close-on-click-modal":!1,title:t.id?"修改策略":"新增策略",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e},close:t.closeDialog}},[a("el-steps",{attrs:{active:t.step,"finish-status":"success"}},[a("el-step",{attrs:{title:"选择模板"}}),a("el-step",{attrs:{title:"选择目标"}}),a("el-step",{attrs:{title:"提交数据"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.step&&!t.id,expression:"step == 1 && !id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略类型"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dList",attrs:{data:t.dList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClickList(s)}}},[a("div",{staticClass:"left"},[a("span",[t._v(" "+t._s(s.name))])])])}}],null,!1,2334784127)})],1)],2)],1),a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略模板"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"typeList",attrs:{data:t.typeList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClickType(s)}}},[a("div",{staticClass:"left"},[a("span",[t._v(" "+t._s(s.name))])])])}}],null,!1,1697948677)})],1)],2)],1)],1),a("div",{staticClass:"dialog-footer ",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==t.step&&!t.id,expression:"step == 2 && !id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("db-list",{attrs:{headText:"数据源"},on:{db:t.onDb}})],1),a("el-col",{attrs:{span:8}},[a("owner-list",{ref:"ownerList",attrs:{headText:"数据库"},on:{owner:t.onOwner,refreshNext:t.refreshNext}})],1),a("el-col",{attrs:{span:8}},[a("table-list",{ref:"tabList",attrs:{db:t.selectDb,owner:t.selectOwner},on:{table:t.onTable}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"primary",disabled:t.has_disabled_step2()},on:{click:function(e){return t.goStep3()}}},[t._v("下一步")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3==t.step||t.id,expression:"step == 3 || id"}],staticClass:"role"},[a("k-card",{attrs:{head:"参数设定"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"100px"}},[a("div",{staticClass:"role-role-list"},[a("el-form-item",{attrs:{label:"策略名称"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{attrs:{label:"数据源"}},[a("el-tooltip",{attrs:{content:"数据源，* 代表所有数据源"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("db",t.tid)},model:{value:t.db_name,callback:function(e){t.db_name=e},expression:"db_name"}})],1)],1),a("el-form-item",{attrs:{label:"数据集"}},[a("el-tooltip",{attrs:{content:"数据集，* 代表所有数据集合"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("owner",t.tid)},model:{value:t.owner,callback:function(e){t.owner=e},expression:"owner"}})],1)],1),a("el-form-item",{attrs:{label:"数据表"}},[a("el-tooltip",{attrs:{placement:"top",content:"数据表，* 代表所有表，可以前后加*模糊匹配，只能设置1个表名"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("table",t.tid)},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}})],1)],1)],1),t._l(t.tplList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.name}},[a("el-tooltip",{attrs:{placement:"top",content:e.tip}},["number"==e.type?a("el-input-number",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):t._e(),"params_select"==e.type?a("div",[a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.mustParamsConfigList,"show-header":!1}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;e.$index;return[a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择字段"},model:{value:s["param"],callback:function(e){t.$set(s,"param",e)},expression:"row['param']"}},t._l(t.columnsList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.label}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.mustParamsConfigList)}}},[t._v(" 移除 ")]):t._e(),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addParamRow()}}},[t._v(" 添加 ")])]}}],null,!0)})],1)],1)],1):"mask_code"==e.type?a("div",[a("el-radio-group",{on:{change:function(e){return t.changeMaskType()}},model:{value:t.mask.type,callback:function(e){t.$set(t.mask,"type",e)},expression:"mask.type"}},[a("el-radio",{attrs:{label:1}},[t._v("隐藏")]),a("el-radio",{attrs:{label:2}},[t._v("打码")]),a("el-radio",{attrs:{label:3}},[t._v("替换")])],1),1==t.mask.type?[a("el-form-item",{attrs:{label:"显示文字"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏后显示文字，可修改。",placement:"top"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{maxlength:20},model:{value:t.mask.hide_str,callback:function(e){t.$set(t.mask,"hide_str",e)},expression:"mask.hide_str"}})],1)],1)]:t._e(),2==t.mask.type?[a("el-form-item",{attrs:{label:"打码方式"}},[a("el-radio-group",{model:{value:t.mask.opt_type,callback:function(e){t.$set(t.mask,"opt_type",e)},expression:"mask.opt_type"}},[a("el-radio",{attrs:{label:1}},[t._v("两边打码")]),a("el-radio",{attrs:{label:2}},[t._v("中间打码")])],1)],1),a("el-form-item",{attrs:{label:"替换字符"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"打码的替换字符,默认*",placement:"top"}},[a("el-input",{attrs:{maxlength:1},model:{value:t.mask.opt_str,callback:function(e){t.$set(t.mask,"opt_str",e)},expression:"mask.opt_str"}})],1)],1),1==t.mask.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"前几位打码",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"前几位打码"},model:{value:t.mask.front,callback:function(e){t.$set(t.mask,"front",e)},expression:"mask.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"后几位打码",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"后几位打码"},model:{value:t.mask.end,callback:function(e){t.$set(t.mask,"end",e)},expression:"mask.end"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.mask.ignore,callback:function(e){t.$set(t.mask,"ignore",e)},expression:"mask.ignore"}})],1)],1):t._e(),2==t.mask.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"中间替换几位",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"中间替换几位"},model:{value:t.mask.front,callback:function(e){t.$set(t.mask,"front",e)},expression:"mask.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.mask.ignore,callback:function(e){t.$set(t.mask,"ignore",e)},expression:"mask.ignore"}})],1)],1):t._e()]:t._e(),3==t.mask.type?[a("el-form-item",{attrs:{label:"替换规则"}},[a("el-select",{model:{value:t.mask.maskCode,callback:function(e){t.$set(t.mask,"maskCode",e)},expression:"mask.maskCode"}},t._l(t.replaceRules,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)]:t._e()],2):"mask_val"==e.type?a("el-autocomplete",{staticClass:"inline-input val_mask_rule",attrs:{"fetch-suggestions":t.contentQuerySearch,placeholder:"请输入表达式"},on:{select:t.contentHandleSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"label"},[t._v(t._s(e.item.label))])]}}],null,!0),model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}},[a("div",{attrs:{slot:"suffix"},slot:"suffix"},[a("i",{staticClass:"val_mask_rule_clear el-input__icon el-icon-circle-close pointer-active",staticStyle:{color:"red"},attrs:{title:"清空"},on:{click:function(a){t.formData[e.id]=""}}}),a("el-button",{staticStyle:{margin:"0 10px"},attrs:{title:"匹配测试",type:"danger",size:"mini",round:""},on:{click:function(e){return t.onSubmit("test")}}},[t._v("匹配测试")])],1)]):"radio"==e.type?a("el-radio-group",{model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}},t._l(e.radio,(function(e,s){return a("el-radio",{key:s,attrs:{label:e.value}},[t._v(t._s(e.text))])})),1):"checkbox"==e.type?a("el-checkbox",{model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):"textarea"==e.type?a("el-input",{attrs:{type:"textarea",rows:10,placeholder:e.placeholder},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):a("el-input",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}})],1)],1)}))],2)])],1)],2),a("div",{staticClass:"dialog-footer strategy-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"left"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.id,expression:"!id"}],on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"success"},on:{click:function(e){return t.onSubmit("submit")}}},[t._v("提交")])],1)])],1)],1):t._e(),a("diaolg-test",{ref:"testDialog"})],1)},r=[],o=(a("99af"),a("4de4"),a("c975"),a("a434"),a("2ef0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:t.headText}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dbList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,i=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClick(s,i)}}},[a("div",{staticClass:"left"},[a("span",[t._v(t._s(i.name))])])])}}])})],1)],2)}),c=[],d=a("5c96"),u={data:function(){return{db:null,db_name:"",filterText:"",dataList:[],treeProps:{label:"name"}}},props:{headText:{type:String,default:"数据库"}},watch:{filterText:function(t){this.$refs.dbList.filter(t)}},methods:{onEdit:function(t){var e=this;t&&t.name==t.tname||this.$api.role.upd(t).then((function(t){e.onSuccess("更改成功！")}),(function(e){d["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3}),t.name=t.tname}))},filterNode:function(t,e){return!t||(e.name==this.role_name||-1!==e.name.toLowerCase().indexOf(t.toLowerCase()))},refresh:function(){var t=this;this.$api.db.group_all().then((function(e){t.dataList=e}))},onClick:function(t,e){t.isLeaf&&(console.log("xxx；",t),this.db=e,this.db_name=e.name,this.$emit("db",e))}},components:{},mounted:function(){this.refresh()}},f=u,m=(a("4352"),a("2877")),p=Object(m["a"])(f,o,c,!1,null,"5865447a",null),h=p.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:t.headText}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-instance-list"},[a("el-tree",{ref:"instanceList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"",lazy:"","empty-text":t.db?"没有关联数据库":"请选择角色","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between",on:{click:function(e){return t.onClick(s)}}},[a("div",{staticClass:"left"},[t._v(" "+t._s(s.name)+" ")])])}}])})],1)],2)},v=[],g={data:function(){return{cur_name:"",filterText:"",dataList:[],owner:{},db:{},treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:{headText:{type:String,default:"数据集"}},watch:{filterText:function(t){this.$refs.instanceList.filter(t)}},methods:{doRefresh:function(t){this.db=t,this.refresh()},filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.$api.auto.tree(this.db.id,"",!0,!1,null).then((function(e){t.dataList=e}))},onClick:function(t,e){console.log("onClick data:",t,"   data:",t),this.cur_name=t.name,this.owner=t,this.$emit("owner",t)}}},k=g,y=(a("bf7c4"),Object(m["a"])(k,b,v,!1,null,"e4fe74c8",null)),w=y.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据表"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新 ")])],1),a("div",{staticClass:"role-table-list"},[a("el-tree",{ref:"tableList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据库","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between",on:{click:function(e){return t.onClick(s)}}},[a("div",{staticClass:"left flex-over"},[a("span",[t._v(t._s(s.name))])])])}}])})],1)],2)},$=[],C={data:function(){return{cur_name:"",filterText:"",loading:!1,dataList:[],treeProps:{id:"id",label:"name",isLeaf:"leaf"}}},props:{db:{},owner:{}},watch:{db:"refresh",owner:{deep:!0,handler:"refresh"},filterText:function(t){this.$refs.tableList.filter(t)}},methods:{filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.db.id&&this.owner.id?(this.dataList=[],this.loading=!0,this.$api.auto.tree(this.db.id,"".concat(this.owner.label,"."),!0,!1,null).then((function(e){t.dataList=e})).finally((function(){t.loading=!1}))):this.dataList=[]},onClick:function(t){this.cur_name=t.name,this.$emit("table",t)}}},L=C,S=(a("b793"),Object(m["a"])(L,x,$,!1,null,null,null)),D=S.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据字段"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新 ")])],1),a("div",{staticClass:"role-column-list"},[a("el-tree",{ref:"colList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据表","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var s=e.data;return a("div",{staticClass:"item hbox-between"},[a("div",{staticClass:"left flex-over"},[a("el-tooltip",{attrs:{content:s.label}},[a("i",{staticClass:"sn-font",class:{"text-success":1==s.rw,"text-primary":2==s.rw,"text-error":3==s.rw}},[t._v("")])]),a("span",{class:{"text-success":1==s.rw,"text-primary":2==s.rw,"text-error":3==s.rw}},[t._v(t._s(s.label))])],1),a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font",class:{"text-success":1==s.rw},on:{click:function(e){return t.onAuth(s,1)}}},[t._v("读")]),a("i",{staticClass:"sn-font",class:{"text-primary":2==s.rw},on:{click:function(e){2==t.table.rw&&t.onAuth(s,2)}}},[t._v("写")]),a("i",{staticClass:"sn-font",class:{"text-error":3==s.rw},on:{click:function(e){return t.onAuth(s,3)}}},[t._v("敏")])])])}}])})],1)],2)},O=[],N={data:function(){return{filterText:"",loading:!1,dataList:[],treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},computed:{},props:{role:{},owner:{},table:{}},watch:{role:"refresh",owner:"refresh",table:{deep:!0,handler:"refresh"},filterText:function(t){this.$refs.colList.filter(t)}},methods:{filterNode:function(t,e){return!t||(console.log("data.label:",e.label,"  value:",t),-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))},refresh:function(){var t=this;this.role.id&&this.owner.id&&this.table.id?(this.loading=!0,this.$api.permission.allColumn(this.role.id,this.owner.db.id,this.owner.label,this.table.label,this.table).then((function(e){t.dataList=e})).finally((function(){t.loading=!1}))):this.dataList=[]},onAuth:function(t,e){var a=this;(3!=this.owner.rw&&1!=this.table.rw||3==e)&&(1!=this.owner.rw&&1!=this.table.rw||2!=e)&&-1!=this.owner.rw&&(3!=e?this.$api.permission.addColumn(this.role.id,this.owner.db.id,this.owner.label,this.table.label,t.label,{},e).then((function(){t.rw=e;var s="操作成功";3==e?s="设置禁用成功":1==e?s="设置只读成功":2==e?s="设置读写成功":-1==e&&(s="取消设置成功"),a.onSuccess(s)})):this.$refs.maskDialog.show(this.dataList,t))}},components:{},mounted:function(){}},P=N,j=(a("e688"),Object(m["a"])(P,T,O,!1,null,null,null)),E=j.exports,z=a("2e0b"),R=a("1f82"),M=[{name:"查询策略",id:"SELECT",leaf:!0,c:[{name:"查询并发",id:"query_count",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"用户并发查询",id:"user_count",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"number"},{name:"全局并发查询",id:"global_count",leaf:!0,tip:"所有用户同时可进行几条查询,0或者空代表不限制。",type:"number"}]},{name:"查询条件",id:"query_where",target:{mode:"table",manual:!1},dataStep:"table",c:[{name:"查询必带参数",id:"must_param",leaf:!0,tip:"查询必带参数,可设置多个组合",type:"params_select"}]}]},{name:"脱敏策略",id:"MASK",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"字段脱敏",id:"field_mask",leaf:!0,target:{mode:"*",manual:!1},c:[{name:"脱敏字段名",id:"field_mask",leaf:!0,tip:"可用*模糊匹配,多个字段使用逗号分隔",type:"string"},{name:"忽略的字段名",id:"field_ignore",leaf:!0,tip:"可以排除掉的字段名称,不支持模糊匹配，多个字段使用逗号分隔",type:"string"},{name:"脱敏策略",id:"mask_code",leaf:!0,tip:"脱敏方式",type:"mask_code"}]},{name:"内容脱敏",id:"val_mask",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"匹配表达式",id:"val_regexp",leaf:!0,tip:"可选或自定义",type:"mask_val"},{name:"忽略大小写",id:"ignore_case",leaf:!0,tip:"忽略大小写",type:"checkbox"},{name:"多行匹配",id:"multi_line",leaf:!0,tip:"多行匹配",type:"checkbox"},{name:"替换规则",id:"mask_code",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"mask_code"}]}]}],A=(a("7162"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dialog-test"},[a("el-dialog",{attrs:{"custom-class":"dialog-test",title:"测试规则",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e},close:t.hide}},[t.data?a("el-autocomplete",{staticClass:"inline-input val_mask_rule_test",attrs:{"fetch-suggestions":t.$parent.contentQuerySearch,placeholder:"请输入表达式"},on:{select:t.$parent.contentHandleSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"label"},[t._v(t._s(e.item.label))])]}}],null,!1,3101381800),model:{value:t.data["val_regexp"],callback:function(e){t.$set(t.data,"val_regexp",e)},expression:"data['val_regexp']"}},[a("div",{attrs:{slot:"suffix"},slot:"suffix"},[a("i",{staticClass:"val_mask_rule_clear el-input__icon el-icon-circle-close pointer-active",staticStyle:{color:"red"},attrs:{title:"清空"},on:{click:function(e){t.data["val_regexp"]=""}}})])]):t._e(),t.data?a("div",{staticClass:"tags config padding-y-12 border-radius-4"},[a("el-checkbox",{model:{value:t.data.ignore_case,callback:function(e){t.$set(t.data,"ignore_case",e)},expression:"data.ignore_case"}},[t._v("忽略大小写")]),a("el-checkbox",{model:{value:t.data.multi_line,callback:function(e){t.$set(t.data,"multi_line",e)},expression:"data.multi_line"}},[t._v("多行匹配")])],1):t._e(),a("span",[t._v("文本：")]),a("el-input",{attrs:{type:"textarea",placeholder:"请输入测试文本",rows:10},model:{value:t.test_text,callback:function(e){t.test_text=e},expression:"test_text"}}),a("div",{staticClass:"action"},[a("el-button",{staticClass:"label-success",attrs:{size:"mini",round:""},on:{click:function(e){return t.onTest()}}},[t._v("测试")])],1),a("div",{staticClass:"result padding-y-12 padding-x-24 border-radius-4"},[a("pre",{domProps:{innerHTML:t._s(t.resultText)}})])],1)],1)}),Y=[],H={data:function(){return{test_text:"",tid:null,config:null,data:null,isShow:!1,result:[],resultText:"",ouput:""}},methods:{onTest:function(){this.strategyTest(this.tid,JSON.stringify(this.data),this.test_text)},show:function(t,e,a){this.isShow=!0,this.tid=t,this.config=a,this.data=e},hide:function(){this.isShow=!1,this.tid=null,this.config=null,this.data=null},strategyTest:function(t,e,a){var s=this;this.$api.strategy.test({tid:t,config:e,text:a}).then((function(t){s.resultText=t.ouput||t.output,console.log("返回结果：",s.resultText)}))}}},q=H,I=(a("32bd"),a("687d"),Object(m["a"])(q,A,Y,!1,null,"760ff42c",null)),J=I.exports,Q={data:function(){return{isEdit:!1,formData:{},match_type:"text",step:1,name:"",db_name:"*",owner:"*",tab:"*",db_id:"*",c_type:"",tid:"",rid:"",edit:!1,selectType:{},selectDb:{name:""},selectOwner:{},selectTable:{},selectTpl:{},isShow:!1,id:"",treeProps:{label:"name"},dList:M,mustParamsConfigList:[],typeList:[],tplList:[],dataList:[],columnsList:[],mask:{type:1,maskCode:"101",hide_str:"(敏感信息,屏蔽显示)",opt_type:1,opt_str:"*",front:"1",end:"1",ignore:"",unique:!1,global:!1,ignore_case:!1,multi_line:!1,global_key:""},replaceRules:[{k:"301",v:"身份证"},{k:"302",v:"手机"},{k:"303",v:"姓名"},{k:"304",v:"地址"},{k:"305",v:"银行卡"},{k:"307",v:"价格"},{k:"308",v:"邮箱"},{k:"309",v:"ip地址"}],rules:[{label:"包含身份证",value:"(^|(?<=\\D))[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]($|(?=\\D))"},{label:"身份证",value:"^(\\d{6})(\\d{4})(\\d{2})(\\d{2})(\\d{3})([0-9]|X)$"},{label:"包含手机号码",value:"(^|(?<=\\D))1[3456789]\\d{9}($|(?=\\D))"},{label:"手机号码",value:"^1[3456789]\\d{9}$"},{label:"邮编",value:"^[0-9]{6}$"},{label:"包含邮箱",value:"[A-Za-z0-9]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z]+)+"},{label:"包含ip地址",value:"(?<=\\D)((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}($|(?=\\D))"},{label:"标准网页链接",value:"((http|ftp|https):\\/\\/)?[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%&amp;/~\\+#])?"}]}},methods:{contentHandleSelect:function(t){console.log(t)},contentQuerySearch:function(t,e){var a=this.rules,s=t?a.filter(this.createFilter(t)):a;e(s)},createFilter:function(t){return function(e){return!!e.label&&0===e.label.toLowerCase().indexOf(t.toLowerCase())}},changeMaskType:function(){switch(this.mask.type){case 1:this.mask.maskCode="101";break;case 2:this.mask.maskCode="201";break;case 3:this.mask.maskCode="301";break}},has_disabled_step2:function(){return"field_mask"!=this.tid&&"val_mask"!=this.tid&&("query_count"!=this.tid&&("mask_val"==this.tid?!(this.selectDb&&this.selectDb.name):!(this.selectTable&&this.selectTable.name)))},has_display:function(t,e){if("db"==t){if("query_count"==e)return!0;if("field_mask"==e)return!0}else if("owner"==t){if("query_count"==e)return!0;if("field_mask"==e||"mask_val"==e)return!0}else if("table"==t){if("query_count"==e)return!1;if("field_mask"==e||"mask_val"==e)return!1}return!0},getName:function(){var t="";return this.selectDb&&this.selectDb.name?(t=this.selectDb.name,this.selectOwner&&this.selectOwner.name?(t=t+"/"+this.selectOwner.name,this.selectTable&&this.selectTable.name?(t=t+"/"+this.selectTable.name,this.selectType&&this.selectType.name&&(t=t+"("+this.selectType.name+")")):t=t+"("+this.selectType.name+")"):t=t+"("+this.selectType.name+")"):t="全局("+this.selectType.name+")",t},initMustParamsConfigList:function(){console.log("initMustParamsConfigList"),this.mustParamsConfigList=[],this.mustParamsConfigList.push({param:""})},onClickList:function(t){console.log("data: ",t),this.c_type=t.id,this.typeList=t.c?t.c:[]},onClickTpl:function(t){this.selectTpl=t,this.step++,this.tplList=t.c?t.c:[]},onClickType:function(t){console.log("onClickType:",t),this.step++,this.selectType=t,this.tid=t.id,this.tplList=t.c?t.c:[],this.formData={}},onNext:function(){},refreshNext:function(){this.$refs.tabList.refresh()},onDb:function(t){console.log("onDb......",t.name,t.id),this.selectDb=t,this.db_name=t.name,this.db_id=t.id,this.selectOwner={},this.selectTable={},this.rid="",this.tab="*",this.$refs.ownerList.doRefresh(t)},onOwner:function(t){this.selectOwner=t,this.owner=t.name,this.selectTable={},this.rid="",this.tab="*"},onTable:function(t){this.selectTable=t,this.rid=this.selectTable.id,this.tab=t.name,this.LoadParams(),this.name=this.getName()},goStep3:function(){this.step=this.step+1,this.name=this.getName()},LoadParams:function(t){var e=this;if(this.selectDb&&this.selectDb.id)t={id:this.selectDb.id},this.selectOwner&&this.selectOwner.name&&(t.keyword="".concat(this.selectOwner.name,".")),this.selectTable&&this.selectTable.name&&(t.keyword+=this.selectTable.name);else if(!t||!t.id||!t.keyword)return console.warn("[继续执行] LoadParams 参数警告：",t,this.selectDb,this.selectOwner,this.selectTable);if(-1==t.keyword.indexOf("."))return console.warn("[继续执行] LoadParams 参数警告：",t);console.info("LoadParams 查询字段列表，参数：",t),this.$api.auto.tree(t.id,t.keyword,!0,!1,null).then((function(t){e.columnsList=t})).finally((function(){e.loading=!1}))},show:function(t,e){this.initDialog(t,e),this.isShow=!0},initDialog:function(t,e){t&&e?(this.isEdit=!!e,this.id=t.id,this.db_id=t.db_id,this.db_name=t.db_name,this.c_type=t.c_type,this.tid=t.tid,this.rid=t.rid,this.name=t.name,this.owner=t.owner,this.tab=t.tab,this.formData={},this.loadStrategy()):(this.step=1,this.id="",this.formData={},this.initMustParamsConfigList())},closeDialog:function(){Object.assign(this.$data,this.$options.data())},hide:function(){this.isShow=!1},deleteRow:function(t,e){e.splice(t,1)},addParamRow:function(){this.mustParamsConfigList.push({param:""})},loadStrategy:function(){var t=this;this.$api.strategy.info(this.id).then((function(e){if(""!=e&&e.config){t.formData=JSON.parse(e.config),"SELECT"==e.c_type?t.formData.must_param&&t.formData.must_param.length>0?t.mustParamsConfigList=t.formData.must_param:t.initMustParamsConfigList():"MASK"==e.c_type&&t.formData.mask&&(t.mask=t.formData.mask);for(var a=!1,s=0;s<t.dList.length&&!a;s++){var i=t.dList[s];if(i.id==e.c_type&&i.c)for(var l=0;l<i.c.length&&!a;l++){var n=i.c[l];if(n.id==e.tid){t.tplList=n.c?n.c:[],a=!0;break}}}var r={id:"*"==e.db_id?null:e.db_id};"*"==e.owner?r.keyword=null:"*"!=e.tab?r.keyword="".concat(e.owner,".").concat(e.tab):r.keyword="".concat(e.owner,"."),t.LoadParams(r)}else t.$message({message:"加载失败，请刷新再试！",type:"warning"})}))},onSubmit:function(t){var e=this;if(this.id){if(!this.id)return this.$message({message:"策略id不能为空",type:"warning"}),!1}else{if(!this.c_type)return this.$message({message:"模板不能为空",type:"warning"}),!1;if(!this.owner)return this.$message({message:"数据集不能为空",type:"warning"}),!1;if(!this.tab)return this.$message({message:"表名不能为空",type:"warning"}),!1;if(!this.db_id)return this.$message({message:"关联数据源不能为空",type:"warning"}),!1;if(!this.tid)return this.$message({message:"策略模板不能为空",type:"warning"}),!1}if(!this.name)return this.$message({message:"名称不能为空",type:"warning"}),!1;var a=this.formData;if("query_count"==this.tid&&a.user_count&&a.global_count){if(a.user_count=~~a.user_count,a.global_count=~~a.global_count,a.user_count>a.global_count)return this.$message({message:"用户并发查询不能大于全局并发查询",type:"warning"}),!1}else if("query_where"==this.tid)this.mustParamsConfigList&&this.mustParamsConfigList.length>0&&(a.must_param=this.mustParamsConfigList);else if("field_mask"==this.tid){if(a.mask=this.mask,a.mask_code=this.mask.maskCode,!a.field_mask)return this.$message({message:"脱敏字段不能为空",type:"warning"}),!1}else if("val_mask"==this.tid&&(a.mask=this.mask,a.mask_code=this.mask.maskCode,!a.val_regexp))return this.$message({message:"匹配表达式不能为空",type:"warning"}),!1;var s=JSON.stringify(a);if("test"==t)return console.log("脱敏测试的信息 - test：",a,s),void this.$refs.testDialog.show(this.tid,a,s);console.log("脱敏提交的信息 - submit：",s),this.id?this.$api.strategy.update({id:this.id,config:s,tab:this.tab,name:this.name}).then((function(){e.onSuccess("更新成功"),e.hide(),e.$emit("refresh")})):this.$api.strategy.save({rid:this.rid,config:s,db_id:this.db_id,db_name:this.db_name,owner:this.owner,tab:this.tab,match_type:this.match_type,name:this.name,c_type:this.c_type,tid:this.tid}).then((function(){e.onSuccess("新增成功"),e.hide(),e.$emit("refresh")}))}},components:{ElCol:R["a"],ElRow:z["a"],DbList:h,OwnerList:w,ColumnList:E,TableList:D,diaolgTest:J},mounted:function(){}},Z=Q,F=(a("edfa"),Object(m["a"])(Z,n,r,!1,null,null,null)),K=F.exports,X=0,V={data:function(){return{dataList:[],values:[],cascaderProps:{checkStrictly:!0,label:"name",value:"id"},props:{checkStrictly:!0,lazy:!0,lazyLoad:this.lazyLoad},search:{c_type:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],c_types:[{k:"",v:"全部"},{k:"select",v:"查询"},{k:"update",v:"更新"}]}},computed:{},props:{},watch:{},methods:{lazyLoad:function(t,e){var a=this,s=t.level;console.log("level:",s,"node:",t),setTimeout((function(){if(s)if(1==s)t.children?(t.children.map((function(t){return t.value=t.data.id,t.label=t.data.name,t.level=s+1,t})),e(t.children)):e([]);else{var i=Array.from({length:s+1}).map((function(t){return{value:++X,label:"选项".concat(X),leaf:s>=2}}));e(i)}else{for(var l=0;l<a.dataList.length;l++)console.log("item:",a.dataList[l]);a.dataList.map((function(t){return t.level=s+1,t})),e(a.dataList)}}),1e3)},onSelect:function(t,e){if(e){this.isShow=!1;t.id,t.dbType;this.values=[]}},onChange:function(){var t=this.selectItems(),e=Object(l["a"])(t,3),a=(e[0],e[1]),s=e[2];this.onSelect(a,s)},onNext:function(t){if(console.log("onNext length:",t.length),!(t.length<2)&&2==t.length){console.dir(t);var e=Object(l["a"])(t,2),a=e[0],s=e[1];console.log("onNext dbTypeId:",a,"  dbId:",s);var i="",n=t[1];this.$api.auto.autoV3(n,i).then((function(t){}))}},selectItems:function(){var t=Object(l["a"])(this.values,3),e=t[0],a=t[1],s=t[2];if(!s)return[];var i=_.find(this.dataList,{id:e}),n=_.find(i&&i.children||[],{id:a}),r=_.find(n&&n.children||[],{id:s});return[i,n,r]},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},onDel:function(t){var e=this;this.$api.strategy.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogEdit:K},mounted:function(){var t=this;this.$api.db.group_all().then((function(e){t.dataList=e}))}},B=V,G=Object(m["a"])(B,s,i,!1,null,null,null);e["default"]=G.exports},e688:function(t,e,a){"use strict";var s=a("f1d7"),i=a.n(s);i.a},edfa:function(t,e,a){"use strict";var s=a("a12a"),i=a.n(s);i.a},f1d7:function(t,e,a){}}]);