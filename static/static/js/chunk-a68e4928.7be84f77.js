(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a68e4928"],{"7ac2":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"employee padding-x-24"},[s("k-search-table",{ref:"st",attrs:{data:e.dataList,url:"/api/user/page","search-data":e.search},on:{reset:e.resetSearch}},[s("template",{slot:"searchs"},[s("el-form-item",{attrs:{label:"登录名",prop:"name"}},[s("el-input",{model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}})],1),s("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[s("el-input",{model:{value:e.search.user_name,callback:function(t){e.$set(e.search,"user_name",t)},expression:"search.user_name"}})],1),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{model:{value:e.search.email,callback:function(t){e.$set(e.search,"email",t)},expression:"search.email"}})],1),s("el-form-item",{attrs:{prop:"source",label:"来源"}},[s("el-select",{attrs:{clearable:!0},model:{value:e.search.source,callback:function(t){e.$set(e.search,"source",t)},expression:"search.source"}},e._l(e.sources,(function(e){return s("el-option",{key:e.k,attrs:{label:e.v,value:e.k}})})),1)],1),1==e.user.role?s("el-form-item",{attrs:{prop:"role",label:"角色"}},[s("el-select",{attrs:{clearable:!0},model:{value:e.search.role,callback:function(t){e.$set(e.search,"role",t)},expression:"search.role"}},e._l(e.sys_roles,(function(e){return s("el-option",{key:e.k,attrs:{label:e.v,value:e.k}})})),1)],1):e._e(),s("el-form-item",{attrs:{label:"项目:"}},[s("el-select",{attrs:{multiple:"",clearable:!0},model:{value:e.search.projects,callback:function(t){e.$set(e.search,"projects",t)},expression:"search.projects"}},e._l(e.projects,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),s("template",{slot:"buttons"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onNew}},[e._v("新增用户")]),e.cp&&"focus"==e.cp?s("el-button",{attrs:{size:"mini",type:"success"},on:{click:e.onFocusSync}},[e._v("全量同步")]):e._e()],1),s("template",{slot:"columns"},[s("el-table-column",{attrs:{label:"id",prop:"id",width:"90px"}}),s("el-table-column",{attrs:{label:"登录名",prop:"name",width:"100px"}}),s("el-table-column",{attrs:{label:"姓名",prop:"user_name",width:"100px"}}),s("el-table-column",{attrs:{label:"邮箱",prop:"email",width:"120px"}}),s("el-table-column",{attrs:{label:"项目",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.showRoleNames(t.row.project_names))+" ")]}}])}),s("el-table-column",{attrs:{label:"注册时间",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("dateTime")(t.row.createdAt)))]}}])}),s("el-table-column",{attrs:{label:"登录IP/时间",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.last_ip?s("span",[e._v(e._s(t.row.last_ip)+" / "+e._s(e._f("dateTime")(t.row.last_time)))]):s("span",[e._v("尚未登录")])]}}])}),s("el-table-column",{attrs:{label:"有效时间",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[-1==t.row.expire?s("span",{staticClass:"text-success"},[e._v("永久")]):s("span",{staticClass:"text-error"},[e._v(e._s(e.showTime(t.row.expire)))])]}}])}),s("el-table-column",{attrs:{label:"状态",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.state?s("span",{staticClass:"text-success"},[e._v("正常")]):0==t.row.state?s("span",{staticClass:"text-error"},[e._v("冻结")]):e._e()]}}])}),s("el-table-column",{attrs:{label:"MFA状态",width:"100px",title:"开启双因子认证"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.tfa_state?s("span",{staticClass:"text-info"},[e._v(" 开启 "),1==t.row.tfa_state?s("el-button",{attrs:{size:"mini",type:"text",disabled:e.user.id==t.row.id},on:{click:function(s){return e.dialogOpenHandler(t.row)}}},[e._v("[关闭]")]):e._e()],1):s("span",[e._v(" 关闭 ")])]}}])}),s("el-table-column",{attrs:{label:"来源",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return["focus"==t.row.source?s("span",{staticClass:"text-success"},[e._v("focus")]):s("span",{staticClass:"text-info"},[e._v("add")])]}}])}),s("el-table-column",{attrs:{label:"角色",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("userRole")(t.row.role))+" ")]}}])}),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"primary",disabled:e.user.id==t.row.id},on:{click:function(s){return e.onEdit(t.row)}}},[e._v("修改 ")]),1==t.row.state?s("el-button",{attrs:{size:"mini",type:"danger",disabled:e.user.id==t.row.id},on:{click:function(s){return e.onState(t.row,0)}}},[e._v("冻结 ")]):s("el-button",{attrs:{size:"mini",type:"success",disabled:e.user.id==t.row.id},on:{click:function(s){return e.onState(t.row,1)}}},[e._v("恢复 ")]),s("k-btn-tip",{attrs:{tip:"确定要删除【"+t.row.name+"】用户吗?"},on:{click:function(s){return e.onDel(t.row)}}},[s("el-button",{attrs:{size:"mini",type:"danger",disabled:e.user.id==t.row.id}},[e._v("删除 ")])],1),s("el-button",{attrs:{size:"mini",disabled:e.user.id==t.row.id||"focus"==t.row.source},on:{click:function(s){return e.onReset(t.row)}}},[e._v("重置密码 ")])]}}])})],1)],2),s("dialog-edit",{ref:"dialogEdit",on:{refresh:e.refresh}}),s("dialog-auth",{ref:"dialogAuth"}),s("el-dialog",{attrs:{title:"是否关闭双因子认证？",visible:e.MFACloseVisible,width:"60%","before-close":e.dialogCloseHandler},on:{"update:visible":function(t){e.MFACloseVisible=t}}},[s("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRule,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"MFA",prop:"mark"}},[s("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入关闭原因"},model:{value:e.formData.mark,callback:function(t){e.$set(e.formData,"mark",t)},expression:"formData.mark"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.dialogCloseHandler}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.onCloseAuthState}},[e._v("确 定")])],1)],1)],1)},r=[],o=(s("a15b"),s("d3b7"),s("ac1f"),s("841c"),s("5530")),l=s("2f62"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.formData.id?"修改用户":"新增用户",visible:e.isShow,width:"400px"},on:{"update:visible":function(t){e.isShow=t}}},[s("el-form",{ref:"form",attrs:{model:e.formData,"label-suffix":":","label-width":"80px"}},[s("el-form-item",{attrs:{label:"登录名"}},[s("el-input",{attrs:{disabled:!!e.formData.id,placeholder:"登录名（必填）"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),s("el-form-item",{attrs:{label:"姓名"}},[s("el-input",{attrs:{placeholder:"姓名（必填）"},model:{value:e.formData.user_name,callback:function(t){e.$set(e.formData,"user_name",t)},expression:"formData.user_name"}})],1),s("el-form-item",{attrs:{label:"性别",prop:"sex"}},[s("el-radio-group",{model:{value:e.formData.sex,callback:function(t){e.$set(e.formData,"sex",t)},expression:"formData.sex"}},[s("el-radio",{attrs:{label:1}},[e._v("男")]),s("el-radio",{attrs:{label:2}},[e._v("女")])],1)],1),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{attrs:{type:"email",placeholder:"邮箱地址"},model:{value:e.formData.email,callback:function(t){e.$set(e.formData,"email",t)},expression:"formData.email"}})],1),s("el-form-item",{attrs:{label:"手机号"}},[s("el-input",{attrs:{type:"number",maxlength:"11",placeholder:"手机号码"},model:{value:e.formData.telno,callback:function(t){e.$set(e.formData,"telno",t)},expression:"formData.telno"}})],1),e.formData.id?e._e():s("el-form-item",{attrs:{label:"密码"}},[s("el-input",{attrs:{type:"password",placeholder:"密码（必填）"},model:{value:e.formData.pwd,callback:function(t){e.$set(e.formData,"pwd",t)},expression:"formData.pwd"}})],1),s("el-form-item",{attrs:{label:"系统角色"}},[s("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.formData.role,callback:function(t){e.$set(e.formData,"role",t)},expression:"formData.role"}},[1==e.user.role?s("el-option",{attrs:{label:"管理员",value:2}}):e._e(),s("el-option",{attrs:{label:"普通用户",value:4}})],1)],1),s("el-form-item",{attrs:{label:"有效期"}},[s("el-checkbox",{model:{value:e.expire_flag,callback:function(t){e.expire_flag=t},expression:"expire_flag"}},[e._v("永久")])],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.expire_flag,expression:"!expire_flag"}],attrs:{label:"到期时间"}},[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择到期时间"},model:{value:e.expire_time,callback:function(t){e.expire_time=t},expression:"expire_time"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.hide}},[e._v("取消")]),s("el-button",{attrs:{type:"success"},on:{click:e.onSubmit}},[e._v("保存")])],1)],1)],1)},n=[],c=(s("2ef0"),s("c1df")),u=s.n(c),f=s("5c96"),d={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,formData:{roles:[]},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["c"])(["user"])),methods:{showTime:function(e){return u()(new Date(e)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],roles_str:""}},show:function(e){var t=this;this.id=e?e.id:null,this.id?this.$api.user.info(e.id).then((function(e){e.roles||(e.roles=[]),t.formData=e,-1==e.expire?t.expire_flag=!0:(t.expire_flag=!1,t.expire_time=t.showTime(e.expire)),t.isShow=!0})):(this.formData=this.reset(),this.isShow=!0)},hide:function(e){this.isShow=!1},onSubmit:function(){var e=this;if(this.formData.roles_str=this.formData.roles.join(","),this.expire_flag)this.formData.expire=-1;else{if(!this.expire_time)return void f["Message"].error({title:"提示",message:"请输入失效时间。",type:"error",duration:2e3});this.formData.expire=this.expire_time.getTime()}if(!this.formData.telno||11==this.formData.telno.length&&/^(13|14|15|16|17|18|19)\d{9}$/g.test(this.formData.telno)){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;!this.formData.email||t.test(this.formData.email)?this.$api.user.edit(this.formData).then((function(){e.onSuccess("提交成功"),e.hide(),e.$emit("refresh")}),(function(e){f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})})):f["Message"].error({title:"提示",message:"邮箱地址格式不正确。",type:"error",duration:2e3})}else f["Message"].error({title:"提示",message:"手机号码格式不正确。",type:"error",duration:2e3})}},mounted:function(){},components:{}},p=d,m=s("2877"),h=Object(m["a"])(p,i,n,!1,null,null,null),_=h.exports,b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:e.doc.name+"("+e.doc.user_name+")【权限预览】",visible:e.isShow,width:"800px",center:""},on:{"update:visible":function(t){e.isShow=t}}},[s("span",{staticStyle:{padding:"20px"}},[e._v(" 权限组:"),e._l(e.role_names,(function(t){return s("el-tag",{key:t,staticStyle:{margin:"5px"},attrs:{type:"success"}},[e._v(e._s(t))])}))],2),s("div",{staticStyle:{padding:"20px"}},[e._v(" 图标: "),s("i",{staticClass:"sn-font text-success"},[e._v("")]),e._v(" 异步查询 "),s("i",{staticClass:"sn-font text-success"},[e._v("")]),e._v("异步导出/导出文件 "),s("i",{staticClass:"sn-font text-success"},[e._v("")]),e._v("导出Sql ")]),s("el-tree",{ref:"tree2",attrs:{data:e.list,"node-key":"id",props:e.defaultProps,indent:26,isLeaf:function(e){return"col"==e.node_type},"highlight-current":"",lazy:"","default-expanded-keys":e.expKeys,load:e.onNextLoad},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return s("span",{staticClass:"custom-tree-node"},[s("span",["db"==r.node_type?s("span",[e._v("["+e._s(r.db_type)+"]"+e._s(a.label)+" ")]):"owner"==r.node_type?s("span",[e._v("[实例]"+e._s(a.label)+" ")]):"table"==r.node_type?s("span",[e._v("[表]"+e._s(a.label)+" ")]):s("span",[e._v("[字段]"+e._s(a.label))]),1==r.rw?s("i",{staticClass:"sn-font text-success"},[e._v("读")]):e._e(),2==r.rw?s("i",{staticClass:"sn-font text-primary"},[e._v("写")]):e._e(),3==r.rw&&"col"!=r.node_type?s("i",{staticClass:"sn-font text-error"},[e._v("禁")]):e._e(),"col"!=r.node_type?s("span",[1==r.asyn_query?s("i",{staticClass:"sn-font text-success"},[e._v("")]):e._e(),1==r.asyn_export?s("i",{staticClass:"sn-font text-success"},[e._v("")]):e._e(),1==r.asyn_sql?s("i",{staticClass:"sn-font text-success"},[e._v("")]):e._e()]):e._e(),3==r.rw&&"col"==r.node_type?s("i",{staticClass:"sn-font text-error"},[e._v("敏")]):e._e()])])}}])})],1)],1)},v=[],x=(s("b0c0"),{data:function(){return{defaultProps:{children:"children",label:"name"},role_names:[],isShow:!1,doc:{},list:[],expKeys:[]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["c"])(["user"])),methods:{reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(e,t){var s=e.data;s&&s.length>0&&t(s),s&&"col"==s.node_type&&t([]),s&&s.children?t(s.children):s&&s.id&&s.name?(s.uid=this.doc.id,this.$api.user.permissionChildren(s).then((function(e){e?(s.children=e,t(e)):t([])}))):t([])},show:function(e){var t=this;this.$api.user.info(e.id).then((function(e){t.doc=e,t.role_names=e.role_names})),this.$api.user.permissionAll(e.id).then((function(e){if(t.isShow=!0,t.list=e,e&&e.length)for(var s=0;s<e.length;s++)t.expKeys.push(e[s].id)}))},hide:function(e){this.isShow=!1}},mounted:function(){},components:{}}),w=x,g=Object(m["a"])(w,b,v,!1,null,null,null),y=g.exports,k={data:function(){return{MFACloseVisible:!1,currentMFAItem:null,formData:{mark:""},formRule:{mark:[{required:!0,message:"请输入关闭原因"}]},cp:"南京树安信息技术有限公司",no_role:!1,search:{},dataList:[],roles:[],projects:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},computed:Object(o["a"])({},Object(l["c"])(["user"])),methods:{showRoleNames:function(e){return e&&e.length>0&&""!=e[0]?e.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(e){return u()(new Date(e)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(e){var t=this;this.$api.post("/api/user/reset",{id:e.id}).then((function(e){console.log("重置密码：",e),t.onSuccess(e,"重置后的密码：",0),t.refresh("操作成功")}),(function(e){f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onFocusSync:function(){var e=this,t=f["Loading"].service({fullscreen:!1,text:"正在同步中..."});this.$api.user.focusSync().then((function(s){t.close(),e.onSuccess("新增同步 "+s.count+" 条用户信息"),e.refresh()}),(function(e){t.close(),f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})}))},onNew:function(){this.$refs.dialogEdit.show()},onShowAuth:function(e){this.$refs.dialogAuth.show(e)},onEdit:function(e){this.$refs.dialogEdit.show(e)},dialogOpenHandler:function(e){this.MFACloseVisible=!0,this.currentMFAItem=e},dialogCloseHandler:function(){this.MFACloseVisible=!1,this.currentMFAItem=null},onCloseAuthState:function(){var e=this;this.$refs.formRef.validate((function(t){if(!t)return!1;e.$api.user.closeAuthState(e.currentMFAItem.id,e.formData.mark).then((function(){e.onSuccess("操作成功"),e.refresh()}),(function(e){f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})})).finally((function(){e.dialogCloseHandler()}))}))},onState:function(e,t){var s=this;this.$api.user.state(e.id,t).then((function(){s.onSuccess("操作成功"),s.refresh()}),(function(e){f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})}))},onDel:function(e){var t=this;this.$api.user.delete(e.id).then((function(){t.onSuccess("操作成功"),t.refresh()}),(function(e){f["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3})}))}},components:{DialogEdit:_,DialogAuth:y},mounted:function(){var e=this;this.$api.post("/api/project/all").then((function(t){e.projects=t}))}},D=k,S=(s("9252"),Object(m["a"])(D,a,r,!1,null,null,null));t["default"]=S.exports},9252:function(e,t,s){"use strict";var a=s("cf16"),r=s.n(a);r.a},a15b:function(e,t,s){"use strict";var a=s("23e7"),r=s("44ad"),o=s("fc6a"),l=s("a640"),i=[].join,n=r!=Object,c=l("join",",");a({target:"Array",proto:!0,forced:n||!c},{join:function(e){return i.call(o(this),void 0===e?",":e)}})},cf16:function(e,t,s){}}]);