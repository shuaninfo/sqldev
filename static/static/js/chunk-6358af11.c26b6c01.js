(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6358af11"],{"154f":function(t,e,s){"use strict";s.r(e);var a,i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"work padding-x-24"},[s("k-search-table",{ref:"st",attrs:{url:"/api/sddp/list","search-data":t.search},on:{reset:t.resetSearch}},[s("template",{slot:"searchs"},[s("el-form-item",{attrs:{label:"名称",prop:"name",size:"mini"}},[s("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),s("el-form-item",{attrs:{label:"工单状态:"}},[s("el-select",{attrs:{clearable:!0},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.work_states,(function(t){return s("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),s("template",{slot:"buttons"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.addTask()}}},[t._v("新建扫描")])],1),s("template",{slot:"columns"},[s("el-table-column",{attrs:{label:"数据源",prop:"db_name"}}),s("el-table-column",{attrs:{label:"数据源类型",prop:"db_type",width:"120"}}),s("el-form-item",{attrs:{label:"自动扫描:"}}),s("el-table-column",{attrs:{label:"扫描状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tag",{attrs:{type:t.showTagType(e.row.status)}},[t._v(t._s(t.showStatus(e.row.status)))])]}}])}),s("el-table-column",{attrs:{label:"下次扫描时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),s("el-table-column",{attrs:{label:"完成时间",prop:"db_name"}}),s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(s){return t.goWorkDetail(e.row)}}},[t._v("扫描 ")])]}}])})],1)],2),s("dialog-task",{ref:"taskDialog",on:{refresh:t.refresh}})],1)},n=[],o=(s("ac1f"),s("841c"),s("5530")),l=s("2f62"),r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-dialog",{attrs:{"custom-class":"database-edit",title:t.id?"修改工单":"新增工单",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[s("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"数据源:"}},[s("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),s("el-form-item",{attrs:{label:"数据采集数"}},[s("el-tooltip",{attrs:{placement:"top",content:"数据采集数"}},[s("el-input-number",{model:{value:t.formData.fetch_size,callback:function(e){t.$set(t.formData,"fetch_size",e)},expression:"formData.fetch_size"}})],1)],1),t.showOtherSetting(t.formData.db_type)?s("el-form-item",{attrs:{label:"查询最大笔数"}},[s("el-input-number",{model:{value:t.formData.max_row,callback:function(e){t.$set(t.formData,"max_row",e)},expression:"formData.max_row"}})],1):t._e(),"es5"==t.formData.db_type?s("el-form-item",{attrs:{label:"详细设定"}},[t.formData.config?s("el-row",{attrs:{gutter:4}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.esConfigList}},[s("el-table-column",{attrs:{label:"Index name"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return[s("el-input",{attrs:{placeholder:"索引名称,不带后缀,示例 logstash  *代表全局配置",disabled:0==i},model:{value:a["index_name"],callback:function(e){t.$set(a,"index_name",e)},expression:"row['index_name']"}})]}}],null,!1,2141746515)}),s("el-table-column",{attrs:{prop:"tfn",label:"Time field name"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[s("el-input",{attrs:{placeholder:"Time field name,默认@timestamp"},model:{value:a["time_field"],callback:function(e){t.$set(a,"time_field",e)},expression:"row['time_field']"}})]}}],null,!1,1664101124)}),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?s("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(s){return s.preventDefault(),t.deleteRow(e.$index,t.esConfigList)}}},[t._v("移除 ")]):t._e()]}}],null,!1,3801071846)})],1),s("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addEsRow()}}},[t._v("添加")])],1):t._e()],1):t._e(),s("el-form-item",{attrs:{label:"描述"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.formData.db_desc,callback:function(e){t.$set(t.formData,"db_desc",e)},expression:"formData.db_desc"}})],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:t.hide}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},c=[],u=(s("a434"),s("b0c0"),s("ade3")),f=s("2ef0"),d=s("2e0b"),p=s("1f82"),h={data:function(){return{pw_show:!1,account_show:!1,headerList:[],esConfigList:[],isShow:!1,id:null,oper_types:[{l:"只读",v:1},{l:"读写",v:0}],treeProps:{label:"name"},dataList:[],formData:this.reset()}},computed:{},props:{},watch:{"formData.type":"initEsConfigList",isShow:function(t){t&&(this.pw_show=!1,this.account_show=!1)}},methods:(a={changePass:function(t){console.log(t)},showOtherSetting:function(t){return!!t},addHeaderRow:function(){this.headerList.push({name:"",value:""})},addEsRow:function(){this.esConfigList.push({index_name:"",time_field:""})},deleteRow:function(t,e){e.splice(t,1)},initEsConfigList:function(){console.log("initEsConfigList"),0==this.esConfigList.length&&this.esConfigList.push({index_name:"*",time_field:"@timestamp"})},reset:function(){return{headerList:[{name:"test",value:"234"}],config:{auth:"",method:"get"},id:"",name:"",user:"",pass:"",ip:"",port:"",db:"",url:"",db_type:"",con_type:"base",oper_type:1,db_desc:"",pool_min:1,pool_max:5,max_row:1e4,asyn_query:0,asyn_export:0,asyn_sql:0}}},Object(u["a"])(a,"changePass",(function(){})),Object(u["a"])(a,"show",(function(t){var e=this;if(this.id=t,!this.id)return this.isShow=!0,void(this.formData=this.reset());this.$api.db.info(this.id).then((function(t){t.config=JSON.parse(t.config||"{}"),t.config.headers&&f["isArray"](t.config.headers)&&(e.headerList=t.config.headers),t.config.eslist&&f["isArray"](t.config.eslist)&&(e.esConfigList=t.config.eslist),"es5"==t.type&&e.initEsConfigList(),t.con_type||(t.con_type="base"),e.formData=t,e.isShow=!0}))})),Object(u["a"])(a,"hide",(function(){this.isShow=!1})),Object(u["a"])(a,"onSubmit",(function(){var t=this,e=f["cloneDeep"](this.formData);return e.config.headers=this.headerList,e.config.eslist=this.esConfigList,e.config=e.config?JSON.stringify(e.config):"",e.name?e.db_type?"tns"==e.con_type||e.ip?"tns"==e.con_type||e.port?(console.log("config:",e.config),void this.$api.db.save(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var s="参数错误！";"301"!=e.result&&(s=e.data),t.onError(s)}))):(this.$message({message:"端口不能为空",type:"warning"}),!1):(this.$message({message:"ip不能为空",type:"warning"}),!1):(this.$message({message:"数据源类型不能为空",type:"warning"}),!1):(this.$message({message:"名称不能为空",type:"warning"}),!1)})),a),components:{ElCol:p["a"],ElRow:d["a"]},mounted:function(){}},m=h,b=(s("c142"),s("0c7c")),g=Object(b["a"])(m,r,c,!1,null,"177304e2",null),_=g.exports,w={computed:Object(o["a"])({},Object(l["b"])(["showWorkType"])),data:function(){return{search2:{db_type:null},search:{db_type:null,status:-1},work_states:[{k:-1,v:"全部"},{k:0,v:"待审核"},{k:1,v:"审核通过"},{k:2,v:"审核不通过"},{k:3,v:"人工终止流程"},{k:4,v:"定时执行"},{k:5,v:"执行中"},{k:68,v:"执行成功"},{k:7,v:"执行失败"}]}},props:{},watch:{},methods:{showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={status:-1}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},addTask:function(t){this.$refs.taskDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogTask:_},mounted:function(){}},y=w,v=(s("615b"),Object(b["a"])(y,i,n,!1,null,null,null));e["default"]=v.exports},"1f82":function(t,e,s){"use strict";e["a"]={name:"ElCol",props:{span:{type:Number,default:24},tag:{type:String,default:"div"},offset:Number,pull:Number,push:Number,xs:[Number,Object],sm:[Number,Object],md:[Number,Object],lg:[Number,Object],xl:[Number,Object]},computed:{gutter(){let t=this.$parent;while(t&&"ElRow"!==t.$options.componentName)t=t.$parent;return t?t.gutter:0}},render(t){let e=[],s={};return this.gutter&&(s.paddingLeft=this.gutter/2+"px",s.paddingRight=s.paddingLeft),["span","offset","pull","push"].forEach(t=>{(this[t]||0===this[t])&&e.push("span"!==t?`el-col-${t}-${this[t]}`:"el-col-"+this[t])}),["xs","sm","md","lg","xl"].forEach(t=>{if("number"===typeof this[t])e.push(`el-col-${t}-${this[t]}`);else if("object"===typeof this[t]){let s=this[t];Object.keys(s).forEach(a=>{e.push("span"!==a?`el-col-${t}-${a}-${s[a]}`:`el-col-${t}-${s[a]}`)})}}),t(this.tag,{class:["el-col",e],style:s},this.$slots.default)}}},"2bae":function(t,e,s){},"2e0b":function(t,e,s){"use strict";e["a"]={name:"ElRow",componentName:"ElRow",props:{tag:{type:String,default:"div"},gutter:Number,type:String,justify:{type:String,default:"start"},align:{type:String,default:"top"}},computed:{style(){const t={};return this.gutter&&(t.marginLeft=`-${this.gutter/2}px`,t.marginRight=t.marginLeft),t}},render(t){return t(this.tag,{class:["el-row","start"!==this.justify?"is-justify-"+this.justify:"","top"!==this.align?"is-align-"+this.align:"",{"el-row--flex":"flex"===this.type}],style:this.style},this.$slots.default)}}},4629:function(t,e,s){},"615b":function(t,e,s){"use strict";var a=s("2bae"),i=s.n(a);i.a},c142:function(t,e,s){"use strict";var a=s("4629"),i=s.n(a);i.a}}]);