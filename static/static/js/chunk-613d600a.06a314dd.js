(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-613d600a"],{"01e0":function(t,e,o){},"0fe5":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"project padding-x-24"},[o("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"项目列表",name:"list"}}),o("el-tab-pane",{attrs:{label:"回收站",name:"trash"}})],1),o("k-search-table",{ref:"st",attrs:{data:t.dataList,url:"/api/project/page","search-data":t.search},on:{reset:t.resetSearch}},["list"==t.activeName?o("template",{slot:"searchs"},[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1):t._e(),o("template",{slot:"buttons"},["list"==t.activeName?o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("新建项目")]):t._e()],1),o("template",{slot:"columns"},[o("el-table-column",{attrs:{label:"名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),e.row.is_expire?o("el-tag",{attrs:{type:"danger"}},[t._v("已过期")]):t._e()]}}])}),o("el-table-column",{attrs:{label:"是否启用",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?o("span",{staticClass:"text-info"},[t._v(" 是 "),1==e.row.state?o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(o){return t.onState(e.row,2)}}},[t._v("[停用]")]):t._e()],1):o("span",{staticClass:"text-warn"},[t._v(" 否 "),o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(o){return t.onState(e.row,1)}}},[t._v("[启用]")])],1)]}}])}),o("el-table-column",{attrs:{label:"是否公开"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.public_state?o("el-tag",{attrs:{type:"success"}},[t._v("是")]):o("el-tag",{attrs:{type:"info"}},[t._v("否")])]}}])}),o("el-table-column",{attrs:{label:"成员",prop:"user_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除用户"},on:{click:function(o){return o.stopPropagation(),t.$refs.userDialog.show(e.row)}}},[o("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.user_count)+") ")])]}}])}),o("el-table-column",{attrs:{label:"数据源",prop:"db_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除数据库"},on:{click:function(o){return o.stopPropagation(),t.$refs.dbDialog.show(e.row)}}},[o("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.db_count)+") ")])]}}])}),o("el-table-column",{attrs:{label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.createdAt)))]}}])}),"list"==t.activeName?o("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{title:"工单流程",size:"mini",type:"primary"},on:{click:function(o){return t.onWorkFlow(e.row)}}},[t._v("流程 ")]),o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.onRole(e.row)}}},[t._v(" 角色 ")]),o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.onShowInception(e.row)}}},[t._v(" 审计 ")]),o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.onWorkConfig(e.row)}}},[t._v(" 工单 ")]),o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.onEdit(e.row)}}},[t._v(" 修改 ")]),o("k-btn-tip",{attrs:{tip:"确定要将【"+e.row.name+"】项目删除吗?"},on:{click:function(o){return t.onDel(e.row,2)}}},[o("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除 ")])],1)]}}],null,!1,3562366640)}):t._e(),"trash"==t.activeName?o("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(o){return t.onDel(e.row,1)}}},[t._v("恢复项目 ")]),o("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】项目吗,删除后不可在恢复?"},on:{click:function(o){return t.onDel(e.row,3)}}},[o("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("彻底删除 ")])],1)]}}],null,!1,2024109581)}):t._e()],1)],2),o("dialog-edit",{ref:"dialogEdit",on:{refresh:t.refresh}}),o("dialog-auth",{ref:"dialogAuth"}),o("dialog-user",{ref:"userDialog",on:{refresh:t.refresh}}),o("dialog-db",{ref:"dbDialog",on:{refresh:t.refresh}}),o("dialog-role",{ref:"roleDialog"}),o("dialog-work-setting",{ref:"dialogWorkSetting",on:{refresh:t.refresh}}),o("dialog-inception",{ref:"dialogInceptionSetting"}),o("dialog-work",{ref:"dialogWork"})],1)},i=[],n=(o("a15b"),o("b0c0"),o("ac1f"),o("841c"),o("5530")),r=o("2f62"),a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.formData.id?"修改项目":"新建项目",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[o("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"200px"}},[o("el-form-item",{attrs:{label:"名称"}},[o("el-input",{attrs:{maxlength:"16",min:"3",placeholder:"请输入项目名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),o("el-form-item",{attrs:{label:"是否公开"}},[o("el-tooltip",{attrs:{placement:"top",content:"公开项目，未加入的用户可以申请加入"}},[o("el-switch",{attrs:{size:"mini","active-value":2,"inactive-value":1},model:{value:t.formData.public_state,callback:function(e){t.$set(t.formData,"public_state",e)},expression:"formData.public_state"}})],1)],1),o("el-form-item",{attrs:{label:"webhook"}},[o("el-col",{attrs:{span:6}},[o("el-select",{attrs:{placeholder:"类型"},model:{value:t.formData.web_hook_type,callback:function(e){t.$set(t.formData,"web_hook_type",e)},expression:"formData.web_hook_type"}},t._l(t.types,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),o("el-col",{attrs:{span:18}},[o("el-input",{attrs:{placeholder:"地址"},model:{value:t.formData.web_hook,callback:function(e){t.$set(t.formData,"web_hook",e)},expression:"formData.web_hook"}})],1)],1),o("el-form-item",{attrs:{label:"有效期"}},[o("el-checkbox",{model:{value:t.expire_flag,callback:function(e){t.expire_flag=e},expression:"expire_flag"}},[t._v("永久")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.expire_flag,expression:"!expire_flag"}],attrs:{label:"到期时间"}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择到期时间"},model:{value:t.expire_time,callback:function(e){t.expire_time=e},expression:"expire_time"}})],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("取消")]),o("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},l=[],c=(o("2ef0"),o("c1df")),u=o.n(c),f=o("5c96"),h={data:function(){return{types:[{value:"wx",label:"企业微信"},{value:"dd",label:"钉钉"}],isShow:!1,expire_flag:!0,expire_time:null,projects:[],formData:{roles:[],public_state:2,sql_audit_auth:"",info:"",web_hook_type:"wx"},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{showTime:function(t){return u()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],public_state:2,roles_str:"",web_hook_type:"wx"}},show:function(t){var e=this;this.id=t?t.id:null,this.id?(this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,e.formData.web_hook_type||(e.formData.web_hook_type="wx"),-1==t.expire?e.expire_flag=!0:(e.expire_flag=!1,e.expire_time=e.showTime(t.expire)),e.isShow=!0})),this.$api.project.all().then((function(t){e.formData=e.reset(),e.projects=t}))):this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;if(this.formData.roles_str=this.formData.roles.join(","),!this.formData.name)return this.$message({message:"项目名称不能为空",type:"warning"}),!1;if(this.expire_flag)this.formData.expire=-1;else{if(!this.expire_time)return void f["Message"].error({title:"提示",message:"请输入失效时间。",type:"error",duration:2e3});this.formData.expire=this.expire_time.getTime()}this.$api.project.edit(this.formData).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}}},p=h,d=o("2877"),m=Object(d["a"])(p,a,l,!1,null,null,null),_=m.exports,b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{attrs:{title:t.doc.name+"("+t.doc.user_name+")【权限预览】",visible:t.isShow,width:"800px",center:""},on:{"update:visible":function(e){t.isShow=e}}},[o("span",{staticStyle:{padding:"20px"}},[t._v(" 权限组:"),t._l(t.role_names,(function(e){return o("el-tag",{key:e,staticStyle:{margin:"5px"},attrs:{type:"success"}},[t._v(t._s(e))])}))],2),o("div",{staticStyle:{padding:"20px"}},[t._v(" 图标: "),o("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v(" 异步查询 "),o("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("异步导出/导出文件 "),o("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("导出Sql ")]),o("el-tree",{ref:"tree2",attrs:{data:t.list,"node-key":"id",props:t.defaultProps,indent:26,isLeaf:function(t){return"col"==t.node_type},"highlight-current":"",lazy:"","default-expanded-keys":t.expKeys,load:t.onNextLoad},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,i=e.data;return o("span",{staticClass:"custom-tree-node"},[o("span",["db"==i.node_type?o("span",[t._v("["+t._s(i.db_type)+"]"+t._s(s.label)+" ")]):"owner"==i.node_type?o("span",[t._v("[实例]"+t._s(s.label)+" ")]):"table"==i.node_type?o("span",[t._v("[表]"+t._s(s.label)+" ")]):o("span",[t._v("[字段]"+t._s(s.label))]),1==i.rw?o("i",{staticClass:"sn-font text-success"},[t._v("读")]):t._e(),2==i.rw?o("i",{staticClass:"sn-font text-primary"},[t._v("写")]):t._e(),3==i.rw&&"col"!=i.node_type?o("i",{staticClass:"sn-font text-error"},[t._v("禁")]):t._e(),"col"!=i.node_type?o("span",[1==i.asyn_query?o("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==i.asyn_export?o("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==i.asyn_sql?o("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e()]):t._e(),3==i.rw&&"col"==i.node_type?o("i",{staticClass:"sn-font text-error"},[t._v("敏")]):t._e()])])}}])})],1)],1)},v=[],w={data:function(){return{defaultProps:{children:"children",label:"name"},role_names:[],isShow:!1,doc:{},list:[],expKeys:[]}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(t,e){var o=t.data;o&&o.length>0&&e(o),o&&"col"==o.node_type&&e([]),o&&o.children?e(o.children):o&&o.id&&o.name?(o.uid=this.doc.id,this.$api.user.permissionChildren(o).then((function(t){t?(o.children=t,e(t)):e([])}))):e([])},show:function(t){var e=this;this.$api.user.info(t.id).then((function(t){e.doc=t,e.role_names=t.role_names})),this.$api.user.permissionAll(t.id).then((function(t){if(e.isShow=!0,e.list=t,t&&t.length)for(var o=0;o<t.length;o++)e.expKeys.push(t[o].id)}))},hide:function(t){this.isShow=!1}},mounted:function(){},components:{}},g=w,k=Object(d["a"])(g,b,v,!1,null,null,null),y=k.exports,S=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"工单流程设置",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[o("el-alert",{staticStyle:{"margin-bottom":"30px"},attrs:{title:"设置说明",type:"info",description:"默认为当前组审核，选择多个权限组审批流程为多级审核，权限组内有管理权限的用户都可审核"}}),o("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"120px"}},[o("el-form-item",{attrs:{label:"项目"}},[t._v(" "+t._s(t.formData.name)+" ")]),o("el-form-item",{attrs:{label:"当前流程"}},[t._v(" "+t._s(t.formData.sql_audit_auth_str)+" ")]),o("el-form-item",{attrs:{label:"变更流程"}},[o("k-select",{attrs:{multiple:"",url:"/api/project/all"},model:{value:t.checks,callback:function(e){t.checks=e},expression:"checks"}})],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("取消")]),o("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},x=[],j={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,projects:[],checks:[],checks2:[],formData:{name:"",roles:[],public_state:2,sql_audit_auth:""},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{showTime:function(t){return u()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],checks:[],checks2:[],public_state:2,roles_str:""}},show:function(t){var e=this;this.id=t?t.id:null,this.checks=[],this.checks2=[],this.id?(this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,t.sql_audit_auth,e.isShow=!0})),this.$api.project.all().then((function(t){e.projects=t}))):(this.formData=this.reset(),this.isShow=!0)},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;this.checks&&this.checks.length>0?this.formData.sql_audit_auth=this.checks.join(","):this.formData.sql_audit_auth="",this.$api.project.updWorkSetting(this.formData).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){},components:{}},D=j,$=Object(d["a"])(D,S,x,!1,null,null,null),F=$.exports,C=o("e11e"),z=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{staticClass:"dialog-project-user",attrs:{title:t.project.name+"-[用户管理]",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[o("k-search-table",{ref:"st",attrs:{select:!1,url:"/api/project/user/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[o("template",{slot:"searchs"},[o("el-form-item",{attrs:{label:"用户名",prop:"name",size:"mini"}},[o("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),o("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[o("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),o("el-form-item",{attrs:{label:"关联状态"}},[o("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return o("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),o("template",{slot:"columns"},[o("el-table-column",{attrs:{label:"id",prop:"id",width:"80"}}),o("el-table-column",{attrs:{label:"用户名",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),1==e.row.is_create?o("el-tag",{attrs:{type:"warning"}},[t._v("创建人")]):t._e()]}}])}),o("el-table-column",{attrs:{label:"姓名",prop:"user_name"}}),o("el-table-column",{attrs:{label:"开启项目管理权限"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[o("el-switch",{attrs:{title:t.getOpenProjectRoleTitle(s),value:s.project_role,disabled:t.disabledSwitch(s),"active-value":1,"inactive-value":2,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(e){return t.onChangeProjectRoleSwitch(e,s)}}})]}}])}),o("el-table-column",{attrs:{label:"项目角色",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?o("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.row._rid_,callback:function(o){t.$set(e.row,"_rid_",o)},expression:"r.row._rid_"}},t._l(t.roleList,(function(t){return o("el-option",{key:t.id,staticStyle:{width:"100%"},attrs:{label:t.name,value:t.id}})})),1):e.row.role_name?o("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.row.role_name))]):t._e()]}}])}),o("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?o("el-button",{attrs:{type:"warning",size:"mini",plain:"",disabled:2==t.user.role&&t.user.role>=e.row.role&&t.user.id!=e.row.id},on:{click:function(o){return t.onAdd(e.row.id,e.row._rid_||0)}}},[t._v("添加 ")]):t._e(),0!=e.row.project?o("el-button",{attrs:{type:"danger",size:"mini",plain:"",disabled:1==e.row.is_create},on:{click:function(o){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},O=[],R=(o("d3b7"),{data:function(){return{ids:"",project:{},roleList:{},isShow:!1,search:{},rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}]}},props:{},watch:{},computed:Object(n["a"])(Object(n["a"])({},Object(r["c"])(["user"])),{},{disabledSwitch:function(){return function(t){return 1==t.is_create||0==t.project_role}},getOpenProjectRoleTitle:function(){return function(t){return 0==t.project_role?"用户未加入当前项目，请点击“添加”按钮":1==t.project_role?"点击去除项目权限":"点击添加项目权限"}}}),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],o=0;o<t.length;o++)e.push(t[o].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},onRoleChange:function(t,e){e._rid_=t||0},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.id=this.project.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.project=t,this.search.id=t.id,this.isShow=!0,this.roleList=[],this.getAllRoles(t.id).then((function(){e.$nextTick((function(){e.refresh()}))}))},getAllRoles:function(t){var e=this;return new Promise((function(o,s){e.$api.role.all(1,t).then((function(t){return e.roleList=t,o()})).catch((function(t){return s(t)}))}))},hide:function(t){this.isShow=!1,this.roleList=[]},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onChangeProjectRoleSwitch:function(t,e){this.onProjectRole(e.id,t)},onProjectRole:function(t,e){var o=this;this.$api.project.user_upd(this.project,t,e).then((function(){o.onSuccess(1==e?"开启成功":"关闭成功"),o.refresh()}))},onAdd:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.$api.project.relation(this.project,t,o||0).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.project.kick(this.project.id,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}}),L=R,M=(o("3a30"),Object(d["a"])(L,z,O,!1,null,null,null)),N=M.exports,A=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{staticClass:"dialog-project-db",attrs:{title:t.pro.name+"/数据源管理",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[o("k-search-table",{ref:"st",attrs:{select:!1,url:"/api/project/db/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[o("template",{slot:"searchs"},[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),o("el-form-item",{attrs:{label:"数据源类型:"}},[o("el-select",{attrs:{clearable:!0},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),o("el-form-item",{attrs:{label:"关联状态"}},[o("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return o("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),o("template",{slot:"columns"},[o("el-table-column",{attrs:{label:"数据源",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.row;return[t._v(" [ "+t._s(o.db_type)+" ] "+t._s(o.name)+" ")]}}])}),o("el-table-column",{attrs:{label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?o("el-select",{attrs:{multiple:!0,clearable:"",placeholder:"请选择"},model:{value:e.row._rids_,callback:function(o){t.$set(e.row,"_rids_",o)},expression:"r.row._rids_"}},t._l(t.roleList,(function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._l(e.row.role_names,(function(e,s){return o("el-tag",{key:s,staticStyle:{"margin-right":"5px"},attrs:{type:"success"}},[t._v(" "+t._s(e)+" ")])}))]}}])}),o("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?o("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(o){return t.onAdd(e.row.id,e.row._rids_||[])}}},[t._v("添加 ")]):t._e(),0!=e.row.project?o("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(o){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},q=[],Y=(o("99af"),o("2909")),E=(o("365c"),{data:function(){return{db:"all",pro:{},roleList:[],ids:"",isShow:!1,search:{db_types:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],db_types:[{label:"全部",value:""}].concat(Object(Y["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379}]))}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],o=0;o<t.length;o++)e.push(t[o].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.project=this.pro.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.pro=t,this.search.project=t.id,this.isShow=!0,this.roleList=[],this.getAllRoles(t.id).then((function(){e.$nextTick((function(){e.refresh()}))}))},getAllRoles:function(t){var e=this;return new Promise((function(o,s){e.$api.role.all(1,t).then((function(t){return e.roleList=t,o()})).catch((function(t){return s(t)}))}))},hide:function(t){this.isShow=!1,this.roleList=[]},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.$api.project.relationDB(this.pro,t,o.join(",")).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.project.kickDB(this.pro,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}}),P=E,T=(o("6ee0"),Object(d["a"])(P,A,q,!1,null,null,null)),W=T.exports,H=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.pro.name+"/审计管理",visible:t.isShow,fullscreen:"",width:"100%"},on:{"update:visible":function(e){t.isShow=e}}},[o("setting-inception",{attrs:{db_id:"*",project:t.id,project_name:t.pro.name}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},B=[],I=o("f381"),J={data:function(){return{setting:{},inter:null,run_str:"",size:"small",activeName:"inception",db:"all",pro:{},id:"",isShow:!1,search:{db_types:null}}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{reset:function(){this.setting={},this.activeName="inception",this.id=""},show:function(t){this.pro=t,this.id=t.id;var e=this;e.isShow=!0},hide:function(t){this.isShow=!1}},mounted:function(){},components:{SettingInception:I["a"]}},K=J,Q=Object(d["a"])(K,H,B,!1,null,null,null),U=Q.exports,G=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"工单设置",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[o("el-card",{staticClass:"box-card"},[o("el-form",{attrs:{model:t.configForm,"label-width":"280px",size:"mini"}},[o("el-form-item",{attrs:{label:"支持手动提交工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"开启后,支持手动提交工单"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.hand_work,callback:function(e){t.$set(t.configForm,"hand_work",e)},expression:"configForm.hand_work"}})],1)],1),o("el-form-item",{attrs:{label:"开启强制工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"开启后,可强制启用工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.work_must,callback:function(e){t.$set(t.configForm,"work_must",e)},expression:"configForm.work_must"}})],1)],1),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DQL)查询数据走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"查询数据必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.query_must,callback:function(e){t.$set(t.configForm,"query_must",e)},expression:"configForm.query_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DQL)文件导出走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"文件导出必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.export_must,callback:function(e){t.$set(t.configForm,"export_must",e)},expression:"configForm.export_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DQL)异步查询走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"异步查询必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.async_must,callback:function(e){t.$set(t.configForm,"async_must",e)},expression:"configForm.async_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DML)删除数据走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"删除数据必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.delete_must,callback:function(e){t.$set(t.configForm,"delete_must",e)},expression:"configForm.delete_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DML)更新数据走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"更新数据必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.update_must,callback:function(e){t.$set(t.configForm,"update_must",e)},expression:"configForm.update_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DML)写入数据走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"写入数据必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.insert_must,callback:function(e){t.$set(t.configForm,"insert_must",e)},expression:"configForm.insert_must"}})],1)],1):t._e(),t.configForm.work_must?o("el-form-item",{attrs:{label:"(DDL)结构变更走工单"}},[o("el-tooltip",{attrs:{placement:"top",content:"DDL操作必须走工单流程"}},[o("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.ddl_must,callback:function(e){t.$set(t.configForm,"ddl_must",e)},expression:"configForm.ddl_must"}})],1)],1):t._e()],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.hide}},[t._v("取消")]),o("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},V=[],X={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,projects:[],checks:[],checks2:[],configForm:{},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(n["a"])({},Object(r["c"])(["user"])),methods:{showTime:function(t){return u()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],checks:[],checks2:[],public_state:2,roles_str:""}},show:function(t){var e=this;this.id=t?t.id:null,this.checks=[],this.checks2=[],this.id?this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,""==t.other_config?e.configForm=t.other_config_po:e.configForm=JSON.parse(t.other_config),e.isShow=!0})):(this.formData=this.reset(),this.isShow=!0)},hide:function(t){this.formData={},this.configForm={},this.isShow=!1},onSubmit:function(){var t=this,e={id:this.id};e.other_config=JSON.stringify(this.configForm),this.$api.project.updOtherConfig(e).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){},components:{}},Z=X,tt=Object(d["a"])(Z,G,V,!1,null,null,null),et=tt.exports,ot={data:function(){return{cp:"南京树安信息技术有限公司",activeName:"list",no_role:!1,search:{has_del:1},dataList:[],roles:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},computed:Object(n["a"])({},Object(r["c"])(["user"])),props:{},watch:{},methods:{handleClick:function(t,e){console.log(t,e),"trash"==t.name?this.search.has_del=2:this.search.has_del=1,this.refresh()},onUserList:function(){},showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return u()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){e.onSuccess(t),e.refresh("操作成功")}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onWorkConfig:function(t){this.$refs.dialogWork.show(t)},onNew:function(){this.$refs.dialogEdit.show()},onRole:function(t){this.$refs.roleDialog.show(t,!0)},onWorkFlow:function(t){this.$refs.dialogWorkSetting.show(t)},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onShowInception:function(t){this.$refs.dialogInceptionSetting.show(t)},onEdit:function(t){this.$refs.dialogEdit.show(t)},onState:function(t,e){var o=this;this.$api.project.state(t.id,e).then((function(){o.onSuccess("操作成功"),o.refresh()}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t,e){var o=this;this.$api.project.delete(t.id,e).then((function(t){o.onSuccess(t),o.refresh()}),(function(t){f["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},components:{DialogEdit:_,DialogAuth:y,DialogUser:N,DialogDb:W,DialogRole:C["default"],DialogWork:et,DialogWorkSetting:F,DialogInception:U},mounted:function(){}},st=ot,it=(o("7eaf"),Object(d["a"])(st,s,i,!1,null,"1e524bfa",null));e["default"]=it.exports},"3a30":function(t,e,o){"use strict";var s=o("f632"),i=o.n(s);i.a},"6d29":function(t,e,o){},"6ee0":function(t,e,o){"use strict";var s=o("6d29"),i=o.n(s);i.a},"7eaf":function(t,e,o){"use strict";var s=o("01e0"),i=o.n(s);i.a},f632:function(t,e,o){}}]);