(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["index"],{0:function(t,e,a){t.exports=a("56d7")},"0003":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page",attrs:{type:"ghost"}},[a("div",{staticClass:"database padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/instance/page",select:!0,"search-data":t.search},on:{select:t.onSelected,reset:t.resetSearch,total:t.onTotal}},[a("div",{staticStyle:{display:"inline"},attrs:{slot:"searchs"},slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"IP",prop:"ip"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.search.ip,callback:function(e){t.$set(t.search,"ip",e)},expression:"search.ip"}})],1),a("el-form-item",{attrs:{label:"数据源类型:"}},[a("el-select",{attrs:{clearable:!0,size:"mini"},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"项目:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.projects,callback:function(e){t.$set(t.search,"projects",e)},expression:"search.projects"}},t._l(t.projects,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"启用状态:"}},[a("el-select",{attrs:{clearable:!0,size:"mini"},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.use_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"连接状态:"}},[a("el-select",{attrs:{clearable:!0,size:"mini"},model:{value:t.search.con_state,callback:function(e){t.$set(t.search,"con_state",e)},expression:"search.con_state"}},t._l(t.con_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"定时同步:"}},[a("el-select",{attrs:{clearable:!0,size:"mini"},model:{value:t.search.cron_state,callback:function(e){t.$set(t.search,"cron_state",e)},expression:"search.cron_state"}},t._l(t.cron_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{staticClass:"margin-right-12",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$refs.editDialog.show()}}},[t._v(" 新增数据源 ")]),a("el-dropdown",{attrs:{"split-button":"",type:"primary",size:"mini"},on:{command:t.batchAct}},[a("span",[t._v(" 批量操作 ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{icon:"el-icon-plus",command:"1"}},[t._v("启用数据源")]),a("el-dropdown-item",{attrs:{icon:"el-icon-minus",command:"2"}},[t._v("停用数据源")]),a("el-dropdown-item",{attrs:{icon:"el-icon-time",command:"3"}},[t._v("启动定时同步")]),a("el-dropdown-item",{attrs:{icon:"el-icon-circle-close",command:"4"}},[t._v("关闭定时同步")]),a("el-dropdown-item",{attrs:{icon:"el-icon-download",command:"5"}},[t._v("手工同步")])],1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"名称",prop:"name",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.db_desc||"没有描述",placement:"top",effect:"light"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onClick(e.row)}}},[t._v(t._s(e.row.name))])],1)]}}])}),a("el-table-column",{attrs:{label:"实例",prop:"db",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.db))]}}])}),a("el-table-column",{attrs:{label:"类型",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return["oracle"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"mysql"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"mycat"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"mssql"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"postgres"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"mongodb"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):"doris"==e.row.db_type?a("i",{staticClass:"sn-font"},[t._v("")]):a("i",{staticClass:"sn-font"},[t._v("")])]}}])}),a("el-table-column",{attrs:{label:"是否启用",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 "),1==e.row.state?a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,0)}}},[t._v("[停用]")]):t._e()],1):a("span",{staticClass:"text-warn"},[t._v(" 否 "),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,1)}}},[t._v("[启用]")])],1)]}}])}),a("el-table-column",{attrs:{label:"定时同步",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.cron_state?a("span",[a("el-tooltip",{attrs:{content:t.parserCron(e.row.cron_config),placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-info"},[t._v("开")])])],1):a("span",[t._v("关")]),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.editCronConfig(e.row)}}},[t._v("[设置]")])]}}])}),a("el-table-column",{attrs:{label:"连接状态",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("div",[3==e.row.con_state?a("el-tooltip",{attrs:{content:e.row.err_msg,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("连接失败")])]):2==e.row.con_state?a("span",{staticClass:"text-success"},[t._v("已连接")]):1==e.row.con_state?a("span",{staticClass:"text-info"},[t._v("连接中")]):a("span",{staticClass:"text-info"},[t._v("未连接")])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"权限",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.oper_type?a("span",[t._v("只读")]):2==e.row.oper_type?a("span",[t._v("读写")]):4==e.row.oper_type?a("span",[t._v("管理")]):a("span",{staticClass:"text-error"},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"同步时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.sync_time)))]}}])}),a("el-table-column",{attrs:{label:"维护操作",fixed:"right","min-width":"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("k-btn-tip",{attrs:{tip:"确定要重置该数据源吗?"},on:{click:function(a){return t.onReset(e.row)}}},[a("el-button",{attrs:{size:"mini",type:"success"}},[t._v("重置连接池")])],1),a("k-btn-tip",{attrs:{tip:"确定要同步该数据源吗?"},on:{click:function(a){return t.onSync(e.row)}}},[a("el-button",{attrs:{size:"mini",disabled:2!=e.row.con_state,type:"success"}},[t._v("同步")])],1)]}}])}),a("el-table-column",{attrs:{label:"管理操作",fixed:"right","min-width":"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.$refs.editDialog.show(e.row.id)}}},[t._v("修改")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】数据源吗?"},on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除")])],1)]}}])})],1)],2),a("dialog-edit",{ref:"editDialog",attrs:{projects:t.projects},on:{refresh:t.refresh}}),a("dialog-cron",{ref:"cronDialog",on:{reload:t.reload}}),a("dialog-monitor",{ref:"monitorDialog",on:{refresh:t.refresh}}),a("dialog-sddp-task",{ref:"sddpTaskDialog"}),a("instance-info-drawer",{ref:"instanceInfoDrawer"})],1)])},n=[],o=a("b85c"),i=a("2909"),r=(a("99af"),a("d3b7"),a("25f0"),a("a15b"),a("3ca3"),a("ddb0"),a("b0c0"),a("ac1f"),a("841c"),a("f928")),l=a("e7a8"),c=a("6fb5"),u=a("960e"),d=a("8c1b"),p={components:{DialogSddpTask:r["default"],DialogEdit:l["default"],DialogCron:c["default"],DialogMonitor:u["default"],InstanceInfoDrawer:d["default"]},data:function(){return{drawerVisiable:!1,drawerData:this.getDefaultDrawerData(),total:0,projects:[],chk_dbs:[],db:[],orderbys:[{k:0,v:"按添加时间倒序(默认)"},{k:1,v:"按添加时间顺序"},{k:2,v:"按修改时间倒序"},{k:3,v:"按同步时间倒序"},{k:4,v:"按同步时间顺序"},{k:5,v:"按名称排序"}],search:{db_type:"",state:"",con_state:"",cron_state:"",order_by:0,name:"",ip:""},use_states:[{k:"",v:"全部"},{k:"1",v:"启用"},{k:"0",v:"未启用"}],cron_states:[{k:"",v:"全部"},{k:"2",v:"启用"},{k:"1",v:"未启用"}],con_states:[{k:"",v:"全部"},{k:"0",v:"未连接"},{k:"2",v:"已连接"},{k:"1",v:"连接中"},{k:"3",v:"连接失败"}],db_types:[{label:"全部",value:""}].concat(Object(i["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]))}},methods:{onClick:function(t){this.$refs.instanceInfoDrawer.show(t)},getDefaultDrawerData:function(){return{instanceInfo:{},dbList:[],selectedDb:"",tableList:[],selectedTable:"",tableInfo:{}}},getProjectAll:function(){var t=this;this.$api.project.all().then((function(e){t.projects=e}))},parserCron:function(t){if(!t)return"";var e=a("7aa9");return e.toString(t,{locale:"zh_CN"})},batchAct:function(t){var e=this;if(console.log("batchAct flag:",t),this.chk_dbs&&0!=this.chk_dbs.length){var a,s=[],n=[],i=Object(o["a"])(this.chk_dbs);try{for(i.s();!(a=i.n()).done;){var r=a.value;s.push(r.id),n.push(r.name)}}catch(f){i.e(f)}finally{i.f()}var l=s.join(",");if(1==t||2==t)this.$api.db.state(l,t).then((function(t){e.onSuccess(t),e.reload()}));else if(3==t)this.$refs.cronDialog.show(this.chk_dbs);else if(4==t)this.$api.db.cron_state(l,1).then((function(t){e.onSuccess(t),e.reload()}));else if(5==t){var c,u=[],d=Object(o["a"])(this.chk_dbs);try{for(d.s();!(c=d.n()).done;){var p=c.value;u.push(this.doSync(p))}}catch(f){d.e(f)}finally{d.f()}Promise.all(u).then((function(t){e.onSuccess(t),e.reload()})).catch((function(t){e.onError(t)}))}}else this.onError("请至少选择一行数据。")},doSync:function(t){var e=this;return new Promise((function(a,s){if(2==t.con_state)return e.$api.db.refresh(t.id).then((function(t){a(t)}));s(new Error("请修复连接【"+t.name||!1))}))},onTotal:function(t){this.total=t},onSelected:function(t){console.log("onSelected:",t),t&&t.length>0?this.chk_dbs=t:this.chk_dbs=[]},refresh:function(){this.chk_dbs=[],this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},showSDDPTask:function(t){this.$refs.sddpTaskDialog.show(t)},editMonitorConfig:function(t){this.$refs.monitorDialog.show(t)},editCronConfig:function(t){this.$refs.cronDialog.show([t])},onCronState:function(t,e){var a=this;this.$api.db.cron_state(t.id,e).then((function(t){a.onSuccess(t),a.reload()}))},onState:function(t,e){var a=this;this.$api.db.state(t.id,e).then((function(t){a.onSuccess(t),a.reload()}))},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},mounted:function(){this.getProjectAll()}},f=p,m=a("2877"),h=Object(m["a"])(f,s,n,!1,null,null,null);e["default"]=h.exports},"000e":function(t,e,a){},"0056":function(t,e,a){},"0060":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-mysql-resource"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/mysql/status","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:60},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"连接池资源"}},[a("el-table-column",{attrs:{label:"最大连接数",prop:"max_connections"}}),a("el-table-column",{attrs:{label:"连接线程数",prop:"threads_connected"}}),a("el-table-column",{attrs:{label:"最大连接错误数",prop:"max_connect_errors"}})],1),a("el-table-column",{attrs:{label:"文件资源"}},[a("el-table-column",{attrs:{label:"最大打开文件数",prop:"open_files_limit"}}),a("el-table-column",{attrs:{label:"已打开文件数",prop:"open_files"}})],1),a("el-table-column",{attrs:{label:"表资源"}},[a("el-table-column",{attrs:{label:"表缓存数",prop:"table_open_cache"}}),a("el-table-column",{attrs:{label:"已打开表",prop:"open_tables"}})],1)],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{}}},computed:{},props:{},watch:{},methods:{onData:function(t){t&&t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("af4a"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"0139":function(t,e,a){},"01d2":function(t,e,a){},"0241":function(t,e,a){},"0284":function(t,e,a){"use strict";a.r(e);a("ac1f"),a("5319");e["default"]={beforeRouteEnter:function(t,e,a){e.meta["__stamp-".concat(e.path)]=Date.now(),a((function(t){return t.$router.replace({path:e.fullPath,meta:e.meta})}))},render:function(t){return t()}}},"02ae":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"database",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/strategy/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"策略名称:",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"策略类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.c_type,callback:function(e){t.$set(t.search,"c_type",e)},expression:"search.c_type"}},t._l(t.c_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.$refs.editDialog.show()}}},[t._v("新增策略")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"name",prop:"name",width:"350px"}}),a("el-table-column",{attrs:{label:"类型",prop:"c_type",width:"100px"}}),a("el-table-column",{attrs:{label:"策略模板",prop:"tid",width:"100px"}}),a("el-table-column",{attrs:{label:"数据源",prop:"db_name",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.db_name)+"/"+t._s(e.row.owner))]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"60px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"管理操作","min-width":"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.$refs.editDialog.show(e.row,!0)}}},[t._v("修改")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】数据源吗?"},on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除")])],1)]}}])})],1)],2),a("dialog-edit",{ref:"editDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("3835"),i=(a("d81d"),a("b0c0"),a("a630"),a("3ca3"),a("d3b7"),a("ddb0"),a("ac1f"),a("841c"),a("2ef0")),r=a("2a76"),l=0,c={data:function(){return{dataList:[],values:[],cascaderProps:{checkStrictly:!0,label:"name",value:"id"},props:{checkStrictly:!0,lazy:!0,lazyLoad:this.lazyLoad},search:{c_type:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],c_types:[{k:"",v:"全部"},{k:"select",v:"查询"},{k:"update",v:"更新"}]}},computed:{},props:{},watch:{},methods:{lazyLoad:function(t,e){var a=this,s=t.level;console.log("level:",s,"node:",t),setTimeout((function(){if(s)if(1==s)t.children?(t.children.map((function(t){return t.value=t.data.id,t.label=t.data.name,t.level=s+1,t})),e(t.children)):e([]);else{var n=Array.from({length:s+1}).map((function(t){return{value:++l,label:"选项".concat(l),leaf:s>=2}}));e(n)}else{for(var o=0;o<a.dataList.length;o++)console.log("item:",a.dataList[o]);a.dataList.map((function(t){return t.level=s+1,t})),e(a.dataList)}}),1e3)},onSelect:function(t,e){e&&(this.isShow=!1,this.values=[])},onChange:function(){var t=this.selectItems(),e=Object(o["a"])(t,2),a=e[0],s=e[1];this.onSelect(a,s)},onNext:function(t){if(console.log("onNext length:",t.length),!(t.length<2)&&2==t.length){console.dir(t);var e=Object(o["a"])(t,2),a=e[0],s=e[1];console.log("onNext dbTypeId:",a,"  dbId:",s);var n="",i=t[1];this.$api.auto.autoV3(i,n).then((function(t){}))}},selectItems:function(){var t=Object(o["a"])(this.values,3),e=t[0],a=t[1],s=t[2];if(!s)return[];var n=i["find"](this.dataList,{id:e}),r=i["find"](n&&n.children||[],{id:a}),l=i["find"](r&&r.children||[],{id:s});return[n,r,l]},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},onDel:function(t){var e=this;this.$api.strategy.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogEdit:r["default"]},mounted:function(){var t=this;this.$api.db.group_all().then((function(e){t.dataList=e}))}},u=c,d=a("2877"),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"0325":function(t,e,a){"use strict";a("ff34")},"033c":function(t,e,a){"use strict";a("36d7")},"034e":function(t,e,a){"use strict";a.r(e),a.d(e,"reomveRightKeys",(function(){return n}));var s=a("2909");a("a434");window.menus=a("7e32").MenuRegistry._menuItems;var n=function(){Object(s["a"])(window.menus)}},"0395":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",[a("setting-inception")],1)},n=[],o=(a("b0c0"),a("5cbd")),i=a("c1df"),r=a.n(i),l={data:function(){return{id:0,setting:{},inter:null,run_str:"",size:"small",activeName:"inception",form:{sql_mode:!0,license:""}}},methods:{showTime:function(t){return console.log("expire:",t),r()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},diffTime:function(){var t="NaN";if(this.form.start_time){var e=r()().diff(r()(1e3*this.form.start_time));console.log("ms:",e);var a=r.a.duration(e),s=Math.floor(a.asHours()),n=r.a.utc(e).format("mm"),o=r.a.utc(e).format("ss");t="",a>0&&(t=a+"天"),s>0&&(t+=s+"小时"),t+=n+"分钟",t+=o+"秒",console.log("d:",a,"  h:",s," m:",n," s:",o)}this.run_str=t},checkLicense:function(){var t=this;this.$api.setting.updateLicense(this.form).then((function(){t.onSuccess("更新成功"),t.getSetting()}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},handleClick:function(t,e){console.log("handleClick:",t,e),this.getSetting(t.name)},onReboot:function(){var t=this;this.$api.setting.reboot().then((function(){t.onSuccess("请求成功，正在重启中")})).catch((function(){t.onError("操作势必啊")}))},onSubmit:function(){var t=this;this.$api.setting.updateSetting(this.form).then((function(){t.onSuccess("提交成功")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},getSetting:function(t){var e=this;"inception"==t?this.$api.setting.getInception().then((function(t){e.form2=t})):this.$api.setting.get().then((function(t){e.setting=t,e.form=t}))},round:function(t){return Math.round(100*t)/100},init:function(){}},components:{SettingInception:o["default"]},mounted:function(){var t=this;this.$nextTick((function(){t.getSetting(),t.init()}))},destroyed:function(){clearTimeout(this.inter)}},c=l,u=(a("be29"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"03a4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"log-page",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"数据库"}},[a("el-input",{attrs:{placeholder:"数据库名称",clearable:""},model:{value:t.search.owner,callback:function(e){t.$set(t.search,"owner",e)},expression:"search.owner"}})],1),a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{prop:"ip",label:"ip"}},[a("el-input",{attrs:{placeholder:"请输入ip",clearable:""},model:{value:t.search.ip,callback:function(e){t.$set(t.search,"ip",e)},expression:"search.ip"}})],1),a("el-form-item",{attrs:{prop:"script",label:"脚本"}},[a("el-input",{attrs:{placeholder:"请输入脚本",clearable:""},model:{value:t.search.script,callback:function(e){t.$set(t.search,"script",e)},expression:"search.script"}})],1),a("el-form-item",{attrs:{label:"项目:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.projects,callback:function(e){t.$set(t.search,"projects",e)},expression:"search.projects"}},t._l(t.projects,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"开始时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.start_time)))])]),a("el-form-item",{attrs:{label:"结束时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.end_time)))])]),a("el-form-item",{staticClass:"row",attrs:{label:"数据库"}},[a("span",[t._v(t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】")])]),a("el-form-item",{attrs:{label:"IP"}},[a("span",[t._v(t._s(e.row.ip))])]),a("el-form-item",{attrs:{label:"行数"}},[a("span",[t._v(t._s(e.row.data_count))])])],1),a("el-form",{staticClass:"demo-sql-expand",attrs:{"label-position":"left"}},[a("el-form-item",{attrs:{label:"SQL"}},[a("pre",[t._v(t._s(e.row.script))])])],1)]}}])}),a("el-table-column",{attrs:{prop:"user_name",label:"操作人",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{placement:"top",content:e.row.user_name}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.quickSearch("user_name",e.row.user_name)}}},[t._v(" "+t._s(e.row.user_name)+"("+t._s(e.row.real_name)+") ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"db_type",label:"库类型",width:"80"}}),a("el-table-column",{attrs:{prop:"db_name",label:"数据库",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】 ")]}}])}),a("el-table-column",{attrs:{prop:"start_time",label:"开始时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.start_time))+" ")]}}])}),a("el-table-column",{attrs:{prop:"end_time",label:"结束时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.end_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"耗时(ms)",prop:"exec_time",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("showTime")(e.row.exec_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"项目",prop:"project_name",width:"100"}}),a("el-table-column",{attrs:{prop:"ip",label:"ip",width:"100"}}),a("el-table-column",{attrs:{label:"状态",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v("成功")]):0==e.row.state?a("span",{staticClass:"text-info"},[t._v("查询中")]):a("el-tooltip",{attrs:{content:e.row.result,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("失败")])])]}}])}),a("el-table-column",{attrs:{label:"行数",width:"80",prop:"data_count"}}),a("el-table-column",{attrs:{label:"类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.toType(e.row.type))+" ")]}}])}),a("el-table-column",{attrs:{label:"脚本","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"nowrap-sricpt",attrs:{title:e.row.script}},[t._v(t._s(e.row.script))])]}}])})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{projects:[],instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行时间倒序(默认)"},{k:1,v:"按执行时间顺序"},{k:2,v:"按耗时由高到低"},{k:3,v:"按行数由多到少"}],types:[{k:0,v:"全部"},{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:15,v:"管理"},{k:99,v:"其他"}],search:{projects:[],ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),props:{},watch:{},methods:{quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={projects:[],ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":15==t?"管理":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e})),this.$api.post("/api/project/all").then((function(e){t.projects=e}))}},u=c,d=(a("f3b6"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"03ad":function(t,e,a){},"0423":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"notice-page h-full flex"},[a("div",{staticClass:"tabs"},[a("el-tabs",{staticClass:"h-full",attrs:{value:t.tabActiveName,"tab-position":"left"},on:{"tab-click":t.onTabClick}},t._l(t.tabs,(function(t,e){return a("el-tab-pane",{key:e,attrs:{label:t.label,name:t.path,lazy:!0}})})),1)],1),a("div",{staticClass:"flex-1 relative"},[a("router-view")],1)])},n=[],o=(a("b0c0"),{name:"personal-notice-index",data:function(){return{tabActiveName:"/personal/notice",tabs:[{label:"系统消息",msgType:1,path:"/personal/notice"},{label:"私信",msgType:2,path:"/personal/notice/personal"}]}},watch:{$route:{handler:function(t){this.tabActiveName=this.$route.path}}},methods:{goto:function(t){this.$router.push(t)},onTabClick:function(t){var e=t.name;this.tabActiveName=e,this.$router.push(e)}},mounted:function(){this.tabActiveName=this.$route.path}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"04231":function(t){t.exports=JSON.parse('{"_element":"ja","_name":"日本語","page":{"demo":{"playground":{"locales":{"text":"D2Adminは、最新のフロントエンドテクノロジースタックを使用した、完全にオープンソースの無料エンタープライズバックエンド製品フロントエンド統合ソリューションであり、プロジェクトのほとんどの準備を整えており、システムのアジャイル開発の管理に役立つ多くのサンプルコードを備えています。"}}}}}')},"0445":function(t,e,a){"use strict";a("5248")},"0470":function(t,e){t.exports={keywords:["A","ABORT","ABS","ABSENT","ABSOLUTE","ACCESS","ACCORDING","ACTION","ADA","ADD","ADMIN","AFTER","AGGREGATE","ALL","ALLOCATE","ALSO","ALTER","ALWAYS","ANALYSE","ANALYZE","AND","ANY","ARE","ARRAY","ARRAY_AGG","ARRAY_MAX_CARDINALITY","AS","ASC","ASENSITIVE","ASSERTION","ASSIGNMENT","ASYMMETRIC","AT","ATOMIC","ATTRIBUTE","ATTRIBUTES","AUTHORIZATION","AVG","BACKWARD","BASE64","BEFORE","BEGIN","BEGIN_FRAME","BEGIN_PARTITION","BERNOULLI","BETWEEN","BIGINT","BINARY","BIT","BIT_LENGTH","BLOB","BLOCKED","BOM","BOOLEAN","BOTH","BREADTH","BY","C","CACHE","CALL","CALLED","CARDINALITY","CASCADE","CASCADED","CASE","CAST","CATALOG","CATALOG_NAME","CEIL","CEILING","CHAIN","CHAR","CHARACTER","CHARACTERISTICS","CHARACTERS","CHARACTER_LENGTH","CHARACTER_SET_CATALOG","CHARACTER_SET_NAME","CHARACTER_SET_SCHEMA","CHAR_LENGTH","CHECK","CHECKPOINT","CLASS","CLASS_ORIGIN","CLOB","CLOSE","CLUSTER","COALESCE","COBOL","COLLATE","COLLATION","COLLATION_CATALOG","COLLATION_NAME","COLLATION_SCHEMA","COLLECT","COLUMN","COLUMNS","COLUMN_NAME","COMMAND_FUNCTION","COMMAND_FUNCTION_CODE","COMMENT","COMMENTS","COMMIT","COMMITTED","CONCURRENTLY","CONDITION","CONDITION_NUMBER","CONFIGURATION","CONFLICT","CONNECT","CONNECTION","CONNECTION_NAME","CONSTRAINT","CONSTRAINTS","CONSTRAINT_CATALOG","CONSTRAINT_NAME","CONSTRAINT_SCHEMA","CONSTRUCTOR","CONTAINS","CONTENT","CONTINUE","CONTROL","CONVERSION","CONVERT","COPY","CORR","CORRESPONDING","COST","COUNT","COVAR_POP","COVAR_SAMP","CREATE","CROSS","CSV","CUBE","CUME_DIST","CURRENT","CURRENT_CATALOG","CURRENT_DATE","CURRENT_DEFAULT_TRANSFORM_GROUP","CURRENT_PATH","CURRENT_ROLE","CURRENT_ROW","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_TRANSFORM_GROUP_FOR_TYPE","CURRENT_USER","CURSOR","CURSOR_NAME","CYCLE","DATA","DATABASE","DATALINK","DATE","DATETIME_INTERVAL_CODE","DATETIME_INTERVAL_PRECISION","DAY","DB","DEALLOCATE","DEC","DECIMAL","DECLARE","DEFAULT","DEFAULTS","DEFERRABLE","DEFERRED","DEFINED","DEFINER","DEGREE","DELETE","DELIMITER","DELIMITERS","DENSE_RANK","DEPENDS","DEPTH","DEREF","DERIVED","DESC","DESCRIBE","DESCRIPTOR","DETERMINISTIC","DIAGNOSTICS","DICTIONARY","DISABLE","DISCARD","DISCONNECT","DISPATCH","DISTINCT","DLNEWCOPY","DLPREVIOUSCOPY","DLURLCOMPLETE","DLURLCOMPLETEONLY","DLURLCOMPLETEWRITE","DLURLPATH","DLURLPATHONLY","DLURLPATHWRITE","DLURLSCHEME","DLURLSERVER","DLVALUE","DO","DOCUMENT","DOMAIN","DOUBLE","DROP","DYNAMIC","DYNAMIC_FUNCTION","DYNAMIC_FUNCTION_CODE","EACH","ELEMENT","ELSE","EMPTY","ENABLE","ENCODING","ENCRYPTED","END","END-EXEC","END_FRAME","END_PARTITION","ENFORCED","ENUM","EQUALS","ESCAPE","EVENT","EVERY","EXCEPT","EXCEPTION","EXCLUDE","EXCLUDING","EXCLUSIVE","EXEC","EXECUTE","EXISTS","EXP","EXPLAIN","EXPRESSION","EXTENSION","EXTERNAL","EXTRACT","FALSE","FAMILY","FETCH","FILE","FILTER","FINAL","FIRST","FIRST_VALUE","FLAG","FLOAT","FLOOR","FOLLOWING","FOR","FORCE","FOREIGN","FORTRAN","FORWARD","FOUND","FRAME_ROW","FREE","FREEZE","FROM","FS","FULL","FUNCTION","FUNCTIONS","FUSION","G","GENERAL","GENERATED","GET","GLOBAL","GO","GOTO","GRANT","GRANTED","GREATEST","GROUP","GROUPING","GROUPS","HANDLER","HAVING","HEADER","HEX","HIERARCHY","HOLD","HOUR","ID","IDENTITY","IF","IGNORE","ILIKE","IMMEDIATE","IMMEDIATELY","IMMUTABLE","IMPLEMENTATION","IMPLICIT","IMPORT","IN","INCLUDING","INCREMENT","INDENT","INDEX","INDEXES","INDICATOR","INHERIT","INHERITS","INITIALLY","INLINE","INNER","INOUT","INPUT","INSENSITIVE","INSERT","INSTANCE","INSTANTIABLE","INSTEAD","INT","INTEGER","INTEGRITY","INTERSECT","INTERSECTION","INTERVAL","INTO","INVOKER","IS","ISNULL","ISOLATION","JOIN","K","KEY","KEY_MEMBER","KEY_TYPE","LABEL","LAG","LANGUAGE","LARGE","LAST","LAST_VALUE","LATERAL","LEAD","LEADING","LEAKPROOF","LEAST","LEFT","LENGTH","LEVEL","LIBRARY","LIKE","LIKE_REGEX","LIMIT","LINK","LISTEN","LN","LOAD","LOCAL","LOCALTIME","LOCALTIMESTAMP","LOCATION","LOCATOR","LOCK","LOCKED","LOGGED","LOWER","M","MAP","MAPPING","MATCH","MATCHED","MATERIALIZED","MAX","MAXVALUE","MAX_CARDINALITY","MEMBER","MERGE","MESSAGE_LENGTH","MESSAGE_OCTET_LENGTH","MESSAGE_TEXT","METHOD","MIN","MINUTE","MINVALUE","MOD","MODE","MODIFIES","MODULE","MONTH","MORE","MOVE","MULTISET","MUMPS","NAME","NAMES","NAMESPACE","NATIONAL","NATURAL","NCHAR","NCLOB","NESTING","NEW","NEXT","NFC","NFD","NFKC","NFKD","NIL","NO","NONE","NORMALIZE","NORMALIZED","NOT","NOTHING","NOTIFY","NOTNULL","NOWAIT","NTH_VALUE","NTILE","NULL","NULLABLE","NULLIF","NULLS","NUMBER","NUMERIC","OBJECT","OCCURRENCES_REGEX","OCTETS","OCTET_LENGTH","OF","OFF","OFFSET","OIDS","OLD","ON","ONLY","OPEN","OPERATOR","OPTION","OPTIONS","OR","ORDER","ORDERING","ORDINALITY","OTHERS","OUT","OUTER","OUTPUT","OVER","OVERLAPS","OVERLAY","OVERRIDING","OWNED","OWNER","P","PAD","PARALLEL","PARAMETER","PARAMETER_MODE","PARAMETER_NAME","PARAMETER_ORDINAL_POSITION","PARAMETER_SPECIFIC_CATALOG","PARAMETER_SPECIFIC_NAME","PARAMETER_SPECIFIC_SCHEMA","PARSER","PARTIAL","PARTITION","PASCAL","PASSING","PASSTHROUGH","PASSWORD","PATH","PERCENT","PERCENTILE_CONT","PERCENTILE_DISC","PERCENT_RANK","PERIOD","PERMISSION","PLACING","PLANS","PLI","POLICY","PORTION","POSITION","POSITION_REGEX","POWER","PRECEDES","PRECEDING","PRECISION","PREPARE","PREPARED","PRESERVE","PRIMARY","PRIOR","PRIVILEGES","PROCEDURAL","PROCEDURE","PROGRAM","PUBLIC","QUOTE","RANGE","RANK","READ","READS","REAL","REASSIGN","RECHECK","RECOVERY","RECURSIVE","REF","REFERENCES","REFERENCING","REFRESH","REGR_AVGX","REGR_AVGY","REGR_COUNT","REGR_INTERCEPT","REGR_R2","REGR_SLOPE","REGR_SXX","REGR_SXY","REGR_SYY","REINDEX","RELATIVE","RELEASE","RENAME","REPEATABLE","REPLACE","REPLICA","REQUIRING","RESET","RESPECT","RESTART","RESTORE","RESTRICT","RESULT","RETURN","RETURNED_CARDINALITY","RETURNED_LENGTH","RETURNED_OCTET_LENGTH","RETURNED_SQLSTATE","RETURNING","RETURNS","REVOKE","RIGHT","ROLE","ROLLBACK","ROLLUP","ROUTINE","ROUTINE_CATALOG","ROUTINE_NAME","ROUTINE_SCHEMA","ROW","ROWS","ROW_COUNT","ROW_NUMBER","RULE","SAVEPOINT","SCALE","SCHEMA","SCHEMA_NAME","SCOPE","SCOPE_CATALOG","SCOPE_NAME","SCOPE_SCHEMA","SCROLL","SEARCH","SECOND","SECTION","SECURITY","SELECT","SELECTIVE","SELF","SENSITIVE","SEQUENCE","SEQUENCES","SERIALIZABLE","SERVER","SERVER_NAME","SESSION","SESSION_USER","SET","SETOF","SETS","SHARE","SHOW","SIMILAR","SIMPLE","SIZE","SKIP","SMALLINT","SNAPSHOT","SOME","SOURCE","SPACE","SPECIFIC","SPECIFICTYPE","SPECIFIC_NAME","SQL","SQLCODE","SQLERROR","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQRT","STABLE","STANDALONE","START","STATE","STATEMENT","STATIC","STATISTICS","STDDEV_POP","STDDEV_SAMP","STDIN","STDOUT","STORAGE","STRICT","STRIP","STRUCTURE","STYLE","SUBCLASS_ORIGIN","SUBMULTISET","SUBSTRING","SUBSTRING_REGEX","SUCCEEDS","SUM","SYMMETRIC","SYSID","SYSTEM","SYSTEM_TIME","SYSTEM_USER","T","TABLE","TABLES","TABLESAMPLE","TABLESPACE","TABLE_NAME","TEMP","TEMPLATE","TEMPORARY","TEXT","THEN","TIES","TIME","TIMESTAMP","TIMEZONE_HOUR","TIMEZONE_MINUTE","TO","TOKEN","TOP_LEVEL_COUNT","TRAILING","TRANSACTION","TRANSACTIONS_COMMITTED","TRANSACTIONS_ROLLED_BACK","TRANSACTION_ACTIVE","TRANSFORM","TRANSFORMS","TRANSLATE","TRANSLATE_REGEX","TRANSLATION","TREAT","TRIGGER","TRIGGER_CATALOG","TRIGGER_NAME","TRIGGER_SCHEMA","TRIM","TRIM_ARRAY","TRUE","TRUNCATE","TRUSTED","TYPE","TYPES","UESCAPE","UNBOUNDED","UNCOMMITTED","UNDER","UNENCRYPTED","UNION","UNIQUE","UNKNOWN","UNLINK","UNLISTEN","UNLOGGED","UNNAMED","UNNEST","UNTIL","UNTYPED","UPDATE","UPPER","URI","USAGE","USER","USER_DEFINED_TYPE_CATALOG","USER_DEFINED_TYPE_CODE","USER_DEFINED_TYPE_NAME","USER_DEFINED_TYPE_SCHEMA","USING","VACUUM","VALID","VALIDATE","VALIDATOR","VALUE","VALUES","VALUE_OF","VARBINARY","VARCHAR","VARIADIC","VARYING","VAR_POP","VAR_SAMP","VERBOSE","VERSION","VERSIONING","VIEW","VIEWS","VOLATILE","WHEN","WHENEVER","WHERE","WHITESPACE","WIDTH_BUCKET","WINDOW","WITH","WITHIN","WITHOUT","WORK","WRAPPER","WRITE","XML","XMLAGG","XMLATTRIBUTES","XMLBINARY","XMLCAST","XMLCOMMENT","XMLCONCAT","XMLDECLARATION","XMLDOCUMENT","XMLELEMENT","XMLEXISTS","XMLFOREST","XMLITERATE","XMLNAMESPACES","XMLPARSE","XMLPI","XMLQUERY","XMLROOT","XMLSCHEMA","XMLSERIALIZE","XMLTABLE","XMLTEXT","XMLVALIDATE","YEAR","YES","ZONE"],operators:["AND","BETWEEN","IN","LIKE","NOT","OR","IS","NULL","INTERSECT","UNION","INNER","JOIN","LEFT","OUTER","RIGHT"],functions:["abbrev","abs","acos","acosd","age","any","area","array_agg","array_append","array_cat","array_dims","array_fill","array_length","array_lower","array_ndims","array_position","array_positions","array_prepend","array_remove","array_replace","array_to_json","array_to_string","array_to_tsvector","array_upper","ascii","asin","asind","atan","atan2","atan2d","atand","avg","bit","bit_and","bit_length","bit_or","bool_and","bool_or","bound_box","box","brin_summarize_new_values","broadcast","btrim","cardinality","cbrt","ceil","ceiling","center","char_length","character_length","chr","circle","clock_timestamp","coalesce","col_description","concat","concat_ws","convert","convert_from","convert_to","corr","cos","cosd","cot","cotd","count","covar_pop","covar_samp","cume_dist","current_catalog","current_database","current_date","current_query","current_role","current_schema","current_schemas","current_setting","current_time","current_timestamp","current_user","currval","cursor_to_xml","date_part","date_trunc","decode","degrees","dense_rank","diameter","div","encode","enum_first","enum_last","enum_range","every","exp","extract","family","first_value","floor","format","format_type","generate_series","generate_subscripts","get_bit","get_byte","get_current_ts_config","gin_clean_pending_list","greatest","grouping","has_any_column_privilege","has_column_privilege","has_database_privilege","has_foreign_data_wrapper_privilege","has_function_privilege","has_language_privilege","has_schema_privilege","has_sequence_privilege","has_server_privilege","has_table_privilege","has_tablespace_privilege","has_type_privilege","height","host","hostmask","inet_client_addr","inet_client_port","inet_merge","inet_same_family","inet_server_addr","inet_server_port","initcap","isclosed","isempty","isfinite","isopen","json_agg","json_object","json_object_agg","json_populate_record","json_populate_recordset","json_to_record","json_to_recordset","jsonb_agg","jsonb_object_agg","justify_days","justify_hours","justify_interval","lag","last_value","lastval","lead","least","left","length","line","ln","localtime","localtimestamp","log","lower","lower_inc","lower_inf","lpad","lseg","ltrim","make_date","make_interval","make_time","make_timestamp","make_timestamptz","masklen","max","md5","min","mod","mode","netmask","network","nextval","now","npoints","nth_value","ntile","nullif","num_nonnulls","num_nulls","numnode","obj_description","octet_length","overlay","parse_ident","path","pclose","percent_rank","percentile_cont","percentile_disc","pg_advisory_lock","pg_advisory_lock_shared","pg_advisory_unlock","pg_advisory_unlock_all","pg_advisory_unlock_shared","pg_advisory_xact_lock","pg_advisory_xact_lock_shared","pg_backend_pid","pg_backup_start_time","pg_blocking_pids","pg_cancel_backend","pg_client_encoding","pg_collation_is_visible","pg_column_size","pg_conf_load_time","pg_control_checkpoint","pg_control_init","pg_control_recovery","pg_control_system","pg_conversion_is_visible","pg_create_logical_replication_slot","pg_create_physical_replication_slot","pg_create_restore_point","pg_current_xlog_flush_location","pg_current_xlog_insert_location","pg_current_xlog_location","pg_database_size","pg_describe_object","pg_drop_replication_slot","pg_export_snapshot","pg_filenode_relation","pg_function_is_visible","pg_get_constraintdef","pg_get_expr","pg_get_function_arguments","pg_get_function_identity_arguments","pg_get_function_result","pg_get_functiondef","pg_get_indexdef","pg_get_keywords","pg_get_object_address","pg_get_owned_sequence","pg_get_ruledef","pg_get_serial_sequence","pg_get_triggerdef","pg_get_userbyid","pg_get_viewdef","pg_has_role","pg_identify_object","pg_identify_object_as_address","pg_index_column_has_property","pg_index_has_property","pg_indexam_has_property","pg_indexes_size","pg_is_in_backup","pg_is_in_recovery","pg_is_other_temp_schema","pg_is_xlog_replay_paused","pg_last_committed_xact","pg_last_xact_replay_timestamp","pg_last_xlog_receive_location","pg_last_xlog_replay_location","pg_listening_channels","pg_logical_emit_message","pg_logical_slot_get_binary_changes","pg_logical_slot_get_changes","pg_logical_slot_peek_binary_changes","pg_logical_slot_peek_changes","pg_ls_dir","pg_my_temp_schema","pg_notification_queue_usage","pg_opclass_is_visible","pg_operator_is_visible","pg_opfamily_is_visible","pg_options_to_table","pg_postmaster_start_time","pg_read_binary_file","pg_read_file","pg_relation_filenode","pg_relation_filepath","pg_relation_size","pg_reload_conf","pg_replication_origin_create","pg_replication_origin_drop","pg_replication_origin_oid","pg_replication_origin_progress","pg_replication_origin_session_is_setup","pg_replication_origin_session_progress","pg_replication_origin_session_reset","pg_replication_origin_session_setup","pg_replication_origin_xact_reset","pg_replication_origin_xact_setup","pg_rotate_logfile","pg_size_bytes","pg_size_pretty","pg_sleep","pg_sleep_for","pg_sleep_until","pg_start_backup","pg_stat_file","pg_stop_backup","pg_switch_xlog","pg_table_is_visible","pg_table_size","pg_tablespace_databases","pg_tablespace_location","pg_tablespace_size","pg_terminate_backend","pg_total_relation_size","pg_trigger_depth","pg_try_advisory_lock","pg_try_advisory_lock_shared","pg_try_advisory_xact_lock","pg_try_advisory_xact_lock_shared","pg_ts_config_is_visible","pg_ts_dict_is_visible","pg_ts_parser_is_visible","pg_ts_template_is_visible","pg_type_is_visible","pg_typeof","pg_xact_commit_timestamp","pg_xlog_location_diff","pg_xlog_replay_pause","pg_xlog_replay_resume","pg_xlogfile_name","pg_xlogfile_name_offset","phraseto_tsquery","pi","plainto_tsquery","point","polygon","popen","position","power","pqserverversion","query_to_xml","querytree","quote_ident","quote_literal","quote_nullable","radians","radius","random","range_merge","rank","regexp_matches","regexp_replace","regexp_split_to_array","regexp_split_to_table","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","repeat","replace","reverse","right","round","row_number","row_security_active","row_to_json","rpad","rtrim","scale","session_user","set_bit","set_byte","set_config","set_masklen","setseed","setval","setweight","shobj_description","sign","sin","sind","split_part","sprintf","sqrt","statement_timestamp","stddev","stddev_pop","stddev_samp","string_agg","string_to_array","strip","strpos","substr","substring","sum","table_to_xml","table_to_xml_and_xmlschema","tan","tand","text","timeofday","timezone","to_ascii","to_char","to_date","to_hex","to_json","to_number","to_regclass","to_regnamespace","to_regoper","to_regoperator","to_regproc","to_regprocedure","to_regrole","to_regtype","to_timestamp","to_tsquery","to_tsvector","transaction_timestamp","translate","trim","trunc","ts_debug","ts_delete","ts_filter","ts_headline","ts_lexize","ts_parse","ts_rank","ts_rank_cd","ts_rewrite","ts_stat","ts_token_type","tsquery_phrase","tsvector_to_array","tsvector_update_trigger","tsvector_update_trigger_column","txid_current","txid_current_snapshot","txid_snapshot_xip","txid_snapshot_xmax","txid_snapshot_xmin","txid_visible_in_snapshot","unnest","upper","upper_inc","upper_inf","user","var_pop","var_samp","variance","version","width","width_bucket","xml_is_well_formed","xml_is_well_formed_content","xml_is_well_formed_document","xmlagg","xmlcomment","xmlconcat","xmlelement","xmlexists","xmlforest","xmlparse","xmlpi","xmlroot","xmlserialize","xpath","xpath_exists"]}},"0487":function(t,e,a){},"0582":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a("4de4"),a("b0c0");var s=a("2b0e"),n=a("4360"),o=a("d708"),i=function(t){if("string"===typeof t){var e=o["b"].filter((function(e){return e.name===t}));if(0==e.length)return void console.error("[theme.js]#changeTheme() 参数错误",t,o["b"]);t=e[0]}n["a"].dispatch("d2admin/theme/set",t),s["default"].bus.emit("change-wm-color",t),s["default"].bus.emit("change-theme",t)}},"0778":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"project-home",attrs:{type:"ghost"}},[a("div",[a("section",{staticClass:"section-header shadow"},[t.formData.post&&t.formData.post.length>0?a("div",{staticClass:"post"},[a("div",{staticClass:"label"},[t._v("公告"),t.formData.is_manager&&t.formData.isHtml?a("span",{staticClass:"is-html"},[t._v("（请使用纯文本公告）")]):t._e(),t._v("：")]),a("marquee",{attrs:{delay:.5,speed:100,content:[""]}},[a("div",[t._v(t._s(t.formData.post))])])],1):t._e(),a("div",{staticClass:"row"},[a("div",{staticClass:"account"},[a("div",{staticClass:"avatar"},[a("i",{staticClass:"sn-font text-primary"},[t._v("")])]),a("div",{staticClass:"project-info"},[a("span",{staticClass:"title   flex items-center"},[t._v(" 项目:"),a("project-card-2",{attrs:{prefix:"dashboard_"}})],1),t.formData.is_manager?a("div",{staticClass:"info"},[a("div",{staticClass:"tag"},[a("div",{staticClass:"label"},[t._v("总访问量")]),a("div",{staticClass:"value"},[t._v(t._s(t.stat.exec_count))])]),a("div",{directives:[{name:"business",rawName:"v-business"}],staticClass:"tag"},[a("div",{staticClass:"label"},[t._v("工单")]),a("div",{staticClass:"value"},[t._v(t._s(t.stat.work_count))])]),a("div",{staticClass:"tag"},[a("div",{staticClass:"label"},[t._v("数据源")]),a("div",{staticClass:"value"},[t._v(t._s(t.stat.db_count))])]),a("div",{staticClass:"tag"},[a("div",{staticClass:"label"},[t._v("成员")]),a("div",{staticClass:"value"},[t._v(t._s(t.stat.user_count))])])]):t._e()])]),a("div",{staticClass:"extra"},[a("div",{staticClass:"head-info split-right"},[a("label",[t._v("访问量")]),a("span",[t._v(t._s(t.my_stat.exec_count))])]),a("div",{directives:[{name:"business",rawName:"v-business"}],staticClass:"head-info split-right"},[a("label",[t._v("工单")]),a("span",[t._v(t._s(t.my_stat.work_count))])]),a("div",{staticClass:"head-info split-right"},[a("label",[t._v("项目角色")]),t.formData.is_manager?a("a",[t._v("管理员 ")]):a("a",[t._v("普通成员")])]),a("div",{staticClass:"head-info split-right"},[a("label",{attrs:{title:"我的数据权限"}},[t._v("我的数据权限")]),""!=t.formData.data_role?a("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.showAuth()}}},[t._v(t._s(t.formData.data_role))]):a("a",[t._v("无")])],1)])])]),a("section",{staticClass:"section-content"},[a("section",{staticClass:"project-and-panel"},[a("div",{staticClass:"data-type shadow"},[a("el-row",[a("el-col",{staticClass:"chart",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 数据源类型 ")])]),a("div",[a("ve-ring",t._b({attrs:{data:t.dbTypeStat,title:t.dbTypeTitle}},"ve-ring",t.pubSetting1,!1))],1)])],1)],1)],1),a("div",{staticClass:"panel shadow"},[a("el-row",{attrs:{gutter:0}},[a("el-col",{staticClass:"chart",attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 访问量 "),a("el-date-picker",{staticStyle:{float:"right","margin-bottom":"5px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.$constant.pickOptions},on:{change:t.queryStat},model:{value:t.query.logTimeRange,callback:function(e){t.$set(t.query,"logTimeRange",e)},expression:"query.logTimeRange"}})],1)]),a("div",[a("ve-line",t._b({attrs:{data:t.logTimeStat,toolbox:t.toolbox,title:t.logTimeTitle}},"ve-line",t.pubSetting1,!1))],1)])],1)],1)],1)]),a("section",{staticClass:"logs shadow"},[a("div",{staticClass:"title"},[a("span",[t._v("日志")])]),t.logList&&0!=t.logList.length?t._e():a("div",{staticClass:"empty"},[a("i",{staticClass:"sn-font text-disable"},[t._v("")])]),a("div",{staticClass:"log-list"},t._l(t.logList,(function(e,s){return a("div",{key:s,staticClass:"shadow-hover"},[a("div",{staticClass:"log-item"},[1==e.state?a("span",{staticClass:"success"},[t._v("成功")]):a("span",{staticClass:"error"},[t._v("失败")]),a("span",[t._v(t._s(e.owner))]),a("span",{staticClass:"exec"},[t._v(t._s(e.exec_time)+"ms")]),a("br"),1==e.state?a("span",{staticClass:"sql ignore",attrs:{title:e.script}},[t._v(" "+t._s(e.script)+" ")]):a("span",{staticClass:"result",attrs:{title:e.result}},[t._v(t._s(e.result))])])])})),0)])]),a("div",{staticStyle:{height:"100px"}})]),a("dialog-role-auth",{ref:"role_auth"}),a("dialog-role",{ref:"roleDialog"}),a("dialog-post",{ref:"postDialog"})],1)},n=[],o=a("b85c"),i=a("5530"),r=(a("b0c0"),a("ac1f"),a("5319"),a("fb6a"),a("4de4"),a("5743")),l=a("72ca"),c=a("c116"),u=a("9ef2"),d=a("2819"),p=a("2f62"),f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"wrap",staticClass:"wrap"},[a("div",{ref:"content",staticClass:"content",class:t.animationClass,style:t.contentStyle,on:{animationend:t.onAnimationEnd,webkitAnimationEnd:t.onAnimationEnd}},[t._t("default")],2)])},m=[],h=(a("a9e3"),{props:{content:{default:""},delay:{type:Number,default:.5},speed:{type:Number,default:100}},mounted:function(){},data:function(){return{wrapWidth:0,firstRound:!0,duration:0,offsetWidth:0,animationClass:""}},computed:{contentStyle:function(){return{paddingLeft:(this.firstRound?0:this.wrapWidth)+"px",animationDelay:(this.firstRound?this.delay:0)+"s",animationDuration:this.duration+"s"}}},watch:{content:{handler:function(){var t=this;this.$nextTick((function(){var e=t.$refs,a=e.wrap,s=e.content,n=a.getBoundingClientRect().width,o=s.getBoundingClientRect().width;t.wrapWidth=n,t.offsetWidth=o,t.duration=o/t.speed,t.animationClass="animate"}))}}},methods:{onAnimationEnd:function(){this.firstRound=!1,this.duration=(this.offsetWidth+this.wrapWidth)/this.speed,this.animationClass="animate-infinite"}}}),b=h,_=(a("df50"),a("2877")),g=Object(_["a"])(b,f,m,!1,null,"0be75c1e",null),v=g.exports,y={name:"project-dashboard",components:{DialogRoleAuth:l["default"],DialogRole:c["default"],DialogPost:u["default"],VeLine:d["VeLine"],VeRing:d["VeRing"],Marquee:v},computed:Object(i["a"])(Object(i["a"])({},Object(p["e"])(["user","dashboard_project","myProjectList"])),Object(p["e"])("d2admin",{keepAlive:function(t){return t.page.keepAlive}})),watch:{$route:function(t){"project-dashboard"===t.name&&this.init()}},data:function(){this.toolbox={feature:{magicType:{type:["line","bar"]}}};var t=r["a"].timeRange("now-7d to now");return{query:{start:"",end:"",todayRange:[],logTimeRange:[],dbUseRange:[]},logTimeStat:{columns:["时间","访问量"],rows:[]},dbTypeStat:{columns:["类型","数量"],rows:[]},pubSetting1:{height:"350px",width:"100%"},dbTypeTitle:{text:""},logTimeTitle:{text:""},logParams:{project:this.$route.params.id,ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,start:r["a"].utc2date(t[0]),end:r["a"].utc2date(t[1]),page_no:0,page_size:20},logList:[],postCount:0,id:this.$route.params.id,projectList:[],formData:{name:""},userList:[],stat:{db_count:0,work_count:0,user_count:0,exec_count:0},my_stat:{work_count:0,exec_count:0}}},methods:{getText:function(t){return console.log("你好。。。。"),t.replace(/<[^<>]+>/g,"").replace(/&nbsp;/gi,"")},queryStat:function(t){var e=this;if(this.query.logTimeRange&&this.query.logTimeRange.length>1){var a=r["a"].utc2date(this.query.logTimeRange[0]),s=r["a"].utc2date(this.query.logTimeRange[1]);this.$api.post("/api/user/stat",{type:"log_time_stat",start:a,end:s}).then((function(t){var a,s=[],n=Object(o["a"])(t);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"时间":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}e.logTimeStat.rows=s})),this.$api.post("/api/project/stat",{id:this.id,type:"log_time_stat",start:a,end:s}).then((function(t){var a,s=[],n=Object(o["a"])(t);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"时间":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}e.logTimeStat.rows=s}))}},initPanel:function(){var t=this;this.queryStat(),this.$api.post("/api/project/stat",{id:this.id,type:"db_type_stat",start:this.query.start,end:this.query.end}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"类型":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.dbTypeStat.rows=s}))},onPost:function(){this.$refs.postDialog.show(this.formData,!1)},onRole:function(){this.$refs.roleDialog.show(this.formData,!1)},onDropCommand:function(t){var e="/project_home/?id="+t.id;this.$router.push({path:e})},getProjectList:function(){var t=this;this.$api.my.myProjectList().then((function(e){t.projectList=e}))},showAuth:function(){this.$refs.role_auth.show(this.formData)},getUserList:function(t){var e=12;if(this.userList.length<e)return this.userList;for(var a=[],s=0;s<this.userList.length;s++){var n=this.userList[s];n.project_role==t&&a.push(n)}return a.length>e?(a=a.slice(0,e-1),a.push({id:-9999,name:"..."}),a):a},queryAllUser:function(){var t=this;this.$api.project.userPageList(this.id,-1,-1).then((function(e){t.userList=e.data}))},queryLogs:function(){var t=this;this.formData.is_manager||(this.logParams.user_name=this.user.name),this.$api.post("/api/project/log/page",this.logParams).then((function(e){t.logList=e.list}))},queryBase:function(){var t=this;this.$api.post("/api/project/stat",{id:this.id,type:"base_stat",start:-1,end:-1}).then((function(e){t.stat.db_count=e.db_count,t.stat.user_count=e.user_count,t.stat.work_count=e.work_count,t.stat.exec_count=e.exec_count}))},queryMyBase:function(){var t=this;this.$api.post("/api/project/stat",{id:this.id,type:"my_base_stat",start:-1,end:-1}).then((function(e){t.my_stat.work_count=e.work_count,t.my_stat.exec_count=e.exec_count}))},init:function(){var t=this;this.$api.project.info(this.id,1).then((function(e){e.post&&0==e.post.indexOf("<!")&&(e.post=t.getText(e.post),e.isHtml=!0),t.formData=e,t.$nextTick((function(){t.queryLogs(),t.initPanel()})),t.queryAllUser()})),this.queryBase(),this.queryMyBase(),this.getProjectList()}},mounted:function(){console.log("[dashboard.vue]#mounted(): ",this.id),this.init();var t=r["a"].timeRange("now/d to now/d");this.query.todayRange=t,t&&t.length>1&&(this.query.start=r["a"].utc2date(t[0]),this.query.end=r["a"].utc2date(t[1])),this.query.logTimeRange=r["a"].timeRange("now-7d to now")},created:function(){var t=this;if(this.id||(this.id=this.$route.params.id),!this.dashboard_project||this.id!=this.dashboard_project.id){var e=this.myProjectList.filter((function(e){return e.id==t.id})),a=e.length>0?e[0]:this.myProjectList[0];this.$store.commit("dashboard_project",a),this.$router.push("/project")}}},w=y,S=(a("bbba"),a("410a"),Object(_["a"])(w,s,n,!1,null,"6146fe14",null));e["default"]=S.exports},"0798":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[t._v(" :id "+t._s(t.$route.params.id)+" 公告设置 ")])},n=[],o=a("2877"),i={},r=Object(o["a"])(i,s,n,!1,null,null,null);e["default"]=r.exports},"07ec":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("ProjectList")],1)},n=[],o=a("74b8"),i={components:{ProjectList:o["default"]}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"082f":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"act_log padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{title:"操作日志列表",url:"/api/act/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.opt_type,callback:function(e){t.$set(t.search,"opt_type",e)},expression:"search.opt_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{prop:"opt_desc",label:"详情"}},[a("el-input",{attrs:{placeholder:"操作详情，支持模糊查询",clearable:""},model:{value:t.search.opt_desc,callback:function(e){t.$set(t.search,"opt_desc",e)},expression:"search.opt_desc"}})],1),a("el-form-item",{attrs:{prop:"opt_ip",label:"ip"}},[a("el-input",{attrs:{placeholder:"请输入ip",clearable:""},model:{value:t.search.opt_ip,callback:function(e){t.$set(t.search,"opt_ip",e)},expression:"search.opt_ip"}})],1),1==t.user.role?a("el-form-item",{attrs:{prop:"role",label:"用户角色"}},[a("el-select",{model:{value:t.search.role,callback:function(e){t.$set(t.search,"role",e)},expression:"search.role"}},t._l(t.roles,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1):t._e()],1),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"opt_desc",type:"expand",label:"展开"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.opt_desc)+" ")]}}])}),a("el-table-column",{attrs:{label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.createdAt))+" ")]}}])}),a("el-table-column",{attrs:{prop:"user_name",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opt_ip",label:"操作人ip"}}),a("el-table-column",{attrs:{prop:"opt_type",label:"操作类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.toType(e.row.opt_type))+" ")]}}])}),a("el-table-column",{attrs:{prop:"opt_desc",width:"400","show-overflow-tooltip":!0,label:"详细描述"}}),a("el-table-column",{attrs:{prop:"result",label:"结果"}})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("99af"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{search:{role:0,opt_type:0,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]},types:[{k:0,v:"全部"},{k:1,v:"登录"},{k:2,v:"登出"},{k:3,v:"下载"},{k:4,v:"管理"},{k:5,v:"自动作业"}],roles:[{k:0,v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:4,v:"普通用户"}]}},props:{},watch:{},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),methods:{resetSearch:function(){this.search={role:0,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},toType:function(t){return 1==t?"登录账户":2==t?"登出账户":3==t?"下载导出":4==t?"管理操作":5==t?"自动作业":"其他"},refresh:function(){this.$refs.st.search()},onDel:function(t){var e=this;this.$api.post("/act/log/delete",{ids:[].concat(t)}).then((function(){e.refresh()}))},onDels:function(){var t=this.$refs.st.selectValues;t&&t.length>0&&this.onDel(t)}},mounted:function(){},components:{}},u=c,d=(a("48ae"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"092b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.table_name+" 表定义",visible:t.isShow,width:"1024px"},on:{"update:visible":function(e){t.isShow=e},close:t.onClose,opened:t.onOpened}},[a("table-info",{ref:"tableInfoRef"}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")])],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("2f62")),r=a("3eff"),l={components:{tableInfo:r["default"]},data:function(){return{type:"",db_type:"",isShow:!1,cur_name:"struct",table_name:"",data:{constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}}},computed:Object(o["a"])({},Object(i["e"])(["runList","runActive"])),methods:{show:function(t,e,a){this.type=a,this.db_type=e,this.table_name=t,this.isShow=!0},onOpened:function(){var t=this.runList[this.runActive],e={iid:t.id,dbName:t.name,dbType:this.db_type,tableName:this.table_name,tableType:this.type,cur_name:this.cur_name};this.$refs.tableInfoRef.init(e)},onClose:function(){this.type="",this.hide()},hide:function(t){this.isShow=!1,this.$refs.tableInfoRef.hide(),this.data={constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}},onSubmit:function(){}}},c=l,u=(a("8015"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"daee226c",null);e["default"]=d.exports},"096f":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide,"append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.backupData,border:!0,height:"400"}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.back_up_sql))])]}}])}),a("el-table-column",{attrs:{label:"执行语句",prop:"sql"}}),a("el-table-column",{attrs:{prop:"back_up_sql",label:"回滚语句"}})],1),a("el-form",[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitRollback()}}},[t._v("提交回滚")]),a("el-button",{on:{click:function(e){return t.downloadRollback("ruleForm")}}},[t._v("下载回滚SQL")])],1)],1)],1)])},n=[],o=(a("b0c0"),a("6ace")),i={data:function(){return{id:"",work:{name:"",sql:""},title:"",is_admin:!1,isShow:!1,backupData:[]}},props:{logData:Array},methods:{submitRollback:function(){for(var t=this,e="",a=0;a<this.backupData.length;a++)e=e+this.backupData[a].back_up_sql+"\n";var s=this.work.project;s&&this.$api.my.myProjectList().then((function(e){if(e&&e.length>0)for(var a=0;a<e.length;a++)if(e[a].id==s){t.$store.commit("project",e[a]);break}})),this.$store.commit("addRun",{id:this.work.db_id,db:this.work.db_name,name:this.work.owner,auto_audit:!0,dbType:this.work.db_type,script:e,rw:2,owner:this.work.owner,hasAsynExport:!1,hasAsynQuery:!1,hasAsynSql:!1,hasRw:!0}),this.hide(),this.$router.push({path:"/query",params:{sql:e}})},downloadRollback:function(){var t=window.localStorage.getItem("token");this.$api.download("/api/work/backup/download",{id:this.id,access_token:t})},show:function(t,e){this.id=t,this.init(),this.isShow=!0,this.is_admin=e},showStatus:function(t){return this.$api.work.showStatus(t)},onChangeExecTime:function(){this.$refs.editExecTimeDialog.show(this.formData)},showExecTime:function(t){return 1==t.exec_flag?"不限":2==t.exec_flag?o["a"].formatTime(t.exec_start)+" 至 "+o["a"].formatTime(t.exec_end):"未知"},init:function(t){var e=this;this.id?this.$api.work.info(this.id).then((function(t){e.work=t,console.log("this.work:",JSON.stringify(e.work)),e.title="工单【"+t.name+"】备份信息",e.$api.work.backupList(e.id).then((function(t){e.backupData=t}))})):this.onError("出错了，没有获取到工单编号")},hide:function(){this.isShow=!1,this.is_admin=!1,this.id="",this.backupData=[],this.work={name:""},this.is_admin||this.$emit("hide")}},mounted:function(){},components:{}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"09ec":function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("d708"));e["default"]={namespaced:!0,state:{active:n["a"].transition.active},actions:{set:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,s.active=e,a.next=4,n("d2admin/db/set",{dbName:"sys",path:"transition.active",value:s.active,user:!0},{root:!0});case 4:case"end":return a.stop()}}),a)})))()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,e.next=3,s("d2admin/db/get",{dbName:"sys",path:"transition.active",defaultValue:n["a"].transition.active,user:!0},{root:!0});case 3:a.active=e.sent;case 4:case"end":return e.stop()}}),e)})))()}}}},"0a70":function(t,e,a){},"0aad":function(t,e,a){"use strict";a("f09c")},"0c52":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"select-database"},[a("el-select",{ref:"select",staticClass:"select-database-select",attrs:{disabled:t.disabled2,readonly:"",filterable:"","popper-class":t.selectedValue?"select-database-select2 select-database-select-1":"select-database-select2 select-database-select-0",placeholder:t.dataBaseList&&t.dataBaseList.length>0?"请选择数据库实例":"无数据",title:t.selectedValue},model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}},[t._l(t.dataBaseList,(function(e){return a("el-option-group",{key:e.id,attrs:{label:e.name,name:e.name}},[t._l(e.children,(function(e){return t._l(e.children,(function(s){return a("el-option",{key:s.id,attrs:{label:s.label,value:s,disabled:!!s.err_msg},nativeOn:{click:function(a){!s.err_msg&&t.onSelectInstance(e,s)}}},[s.err_msg?[a("span",{staticStyle:{float:"left"},attrs:{title:s.err_msg}},[a("el-tag",{staticClass:"auth-tag tags-3"},[t._v(" 错误 ")])],1),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","padding-left":"10px"},attrs:{title:s.err_msg}},[t._v(t._s(e.name))])]:[a("span",{staticStyle:{float:"left"},attrs:{title:"数据库实例"}},[a("el-tag",{staticClass:"auth-tag",class:"tags-"+s.rw,attrs:{title:t.rws[s.rw]+"权限"}},[t._v(" "+t._s(t.rws[s.rw]||"空")+" ")]),a("span",{staticStyle:{"margin-left":"5px"},attrs:{title:"数据库："+s.label}},[t._v(" "+t._s(s.label)+" ")])],1),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","padding-left":"10px"},attrs:{title:"数据源"}},[t._v(t._s(e.name))])]],2)}))}))],2)})),a("div",{staticClass:"select-end"},[t._v("- 结束 -")])],2)],1)},n=[],o=(a("99af"),{name:"select-database",props:{dataBaseList:{},disabled:{type:Boolean,default:function(){return!1}}},data:function(){return{selecedDB:{},disabled2:!1,rws:{1:"读",2:"读写",3:"禁",4:"管理"},isShow:!1,selectedInstance:null,selectedValue:"",selectedSource:null}},methods:{init:function(t){var e=this;if(this.selecedDB=t.selecedDB,console.log("instance.label ====================================",this.selecedDB.instance.label),this.disabled2=!1,t&&t.db_id&&t.owner)this.setInstance(t,!0);else{var a=this.selecedDB;null===a?(this.selectedSource=null,this.selectedInstance=null,this.selectedValue=""):(this.selectedSource=a.source,this.selectedInstance=a.instance,this.selectedValue="[".concat(a.instance.db_type,"] ").concat(a.source.label,"/").concat(a.instance.label))}console.log("instance.label selectedValue222: ",this.selectedValue),this.$nextTick((function(){e.disabled2=e.disabled}))},setInstance:function(t,e){var a=t.db_id,s=t.owner;if(this.dataBaseList&&this.dataBaseList.length>0)for(var n in this.dataBaseList){var o=this.dataBaseList[n];for(var i in o.children){var r=o.children[i];if(r&&r.db_id==a)for(var l in r.children){var c=r.children[l];if(c&&c.label==s)return this.onSelectInstance(r,c,e),!1}}}},onSelectInstance:function(t,e,a){this.selectedSource=t,this.selectedInstance=e,this.selectedValue="[".concat(e.db_type,"] ").concat(t.label,"/").concat(e.label),a||this.$emit("select-change",{source:t,instance:e})}}}),i=o,r=(a("af13"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"0e40":function(t,e,a){"use strict";a("b758")},"0ed8":function(t,e,a){},"0f37":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("el-form-item",{attrs:{label:"邮件通知"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"多人用,分割"},model:{value:t.db.monitor_config.email,callback:function(e){t.$set(t.db.monitor_config,"email",e)},expression:"db.monitor_config.email"}})],1),a("el-form-item",{attrs:{label:"连接线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.monitor_config.alarm_connect_size,callback:function(e){t.$set(t.db.monitor_config,"alarm_connect_size",e)},expression:"db.monitor_config.alarm_connect_size"}})],1),a("el-form-item",{attrs:{label:"活动线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.monitor_config.alarm_active_size,callback:function(e){t.$set(t.db.monitor_config,"alarm_active_size",e)},expression:"db.monitor_config.alarm_active_size"}})],1),a("el-form-item",{attrs:{label:"等待线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.monitor_config.alarm_wait_size,callback:function(e){t.$set(t.db.monitor_config,"alarm_wait_size",e)},expression:"db.monitor_config.alarm_wait_size"}})],1),a("el-form-item",{attrs:{label:"死锁"}},[a("el-switch",{attrs:{"active-value":2,"inactive-value":1},model:{value:t.db.monitor_config.alarm_dead_lock,callback:function(e){t.$set(t.db.monitor_config,"alarm_dead_lock",e)},expression:"db.monitor_config.alarm_dead_lock"}},[t._v(">")])],1),a("el-form-item",{attrs:{label:"慢查询"}},[a("el-switch",{attrs:{"active-value":2,"inactive-value":1},model:{value:t.db.monitor_config.alarm_slow_query,callback:function(e){t.$set(t.db.monitor_config,"alarm_slow_query",e)},expression:"db.monitor_config.alarm_slow_query"}},[t._v(">")])],1)],1)},n=[],o={data:function(){return{}},computed:{},props:{db:{default:{}}},watch:{},methods:{},components:{},mounted:function(){}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"0f4d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container shadow"},[t._m(0),a("div",{staticClass:"body"},[a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"请输入注册码"}},[a("el-input",{model:{value:t.formData.license,callback:function(e){t.$set(t.formData,"license",e)},expression:"formData.license"}})],1),a("el-form-item",[a("div",{staticClass:"identifybox"},[a("div",{on:{click:t.getCaptcha}},[a("img",{staticStyle:{width:"100px",height:"50px",border:"1px"},attrs:{src:t.formData.captcha}})]),a("el-button",{staticClass:"textbtn",attrs:{type:"text"},on:{click:t.getCaptcha}},[t._v("看不清，换一张")])],1)]),a("el-form-item",[a("el-button",{staticClass:"btn-login",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交注册")])],1)],1)],1)])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ali-center"},[a("img",{staticClass:"logo",attrs:{src:"/static/image/sqldev.png"}}),a("h4",[t._v("企业数据库安全访问系统")])])}],o=a("5530"),i=a("2f62"),r={data:function(){var t=this.$route.query;return{msg:t.msg||"",formData:{license:"",captcha:"",captcha_id:"",code:""}}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getCaptcha:function(){var t=this;this.$api.get("/api/captcha").then((function(e){var a=e.id,s=e.img;t.formData.captcha=s,t.formData.captcha_id=a}))},goCasLogin:function(){this.url&&(window.location.href=this.url)},onSubmit:function(){}},mounted:function(){this.getCaptcha()}},l=r,c=(a("65bc"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},1:function(t,e){},"101e":function(t,e,a){"use strict";a("eb03")},1046:function(t,e,a){"use strict";a("dfa3")},1151:function(t,e,a){},"11f0":function(t,e,a){},"123e":function(t,e,a){},"12a3":function(t,e,a){},"138a":function(t,e,a){},1485:function(t,e,a){"use strict";a("3d13")},"15b2":function(t,e,a){},1607:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"mask-edit-dialog",attrs:{title:t.id?"编辑脱敏":"新增脱敏",visible:t.isShow,width:"840px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formDataRules,"label-width":"200px"}},[a("el-form-item",{attrs:{prop:"name",label:"规则名称"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{prop:"rule_level",label:"敏感等级"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.rule_level,callback:function(e){t.$set(t.formData,"rule_level",e)},expression:"formData.rule_level"}},t._l(t.rule_levels,(function(t){return a("el-option",{key:t.v,attrs:{label:t.l,value:t.v}})})),1)],1),a("el-form-item",{attrs:{prop:"rule_type",label:"规则分类"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.rule_type,callback:function(e){t.$set(t.formData,"rule_type",e)},expression:"formData.rule_type"}},t._l(t.rule_types,(function(t){return a("el-option",{key:t.v,attrs:{label:t.l,value:t.v}})})),1)],1),a("el-form-item",{attrs:{prop:"match_method",label:"方法"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.match_method,callback:function(e){t.$set(t.formData,"match_method",e)},expression:"formData.match_method"}},t._l(t.match_mathods,(function(t){return a("el-option",{key:t.v,attrs:{label:t.l,value:t.v}})})),1)],1),a("el-form-item",{attrs:{prop:"math_text",label:"关键字/正则匹配内容"}},[a("el-input",{attrs:{placeholder:"关键字/正则匹配内容"},model:{value:t.formData.match_text,callback:function(e){t.$set(t.formData,"match_text",e)},expression:"formData.match_text"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3==t.formData.match_method,expression:"formData.match_method==3"}],attrs:{label:"正则表达式规则"}},[a("el-checkbox",{model:{value:t.formData.ignore_case,callback:function(e){t.$set(t.formData,"ignore_case",e)},expression:"formData.ignore_case"}},[t._v("忽略大小写")]),a("el-checkbox",{model:{value:t.formData.multi_line,callback:function(e){t.$set(t.formData,"multi_line",e)},expression:"formData.multi_line"}},[t._v("多行匹配")])],1),a("el-form-item",{attrs:{prop:"info",label:"规则描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"",clearable:""},model:{value:t.formData.info,callback:function(e){t.$set(t.formData,"info",e)},expression:"formData.info"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onHide}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定 ")])],1)],1)},n=[],o={data:function(){return{id:"",isShow:!1,formData:this.reset(),rule_levels:[{l:"N/A:公开",v:1},{l:"S1:内部",v:2},{l:"S2:保密",v:3},{l:"S3:机密",v:4}],rule_types:[{l:"个人敏感信息",v:1},{l:"设备敏感信息",v:2},{l:"密钥敏感信息",v:3},{l:"企业敏感信息",v:4},{l:"通用敏感信息",v:5},{l:"其他敏感信息",v:99}],match_mathods:[{l:"不包含",v:1},{l:"包含",v:2},{l:"正则匹配",v:3}],formDataRules:{name:[{required:!0,message:"请输入规则名称"}],rule_level:[{required:!0,message:"请选择等级"}],rule_type:[{required:!0,message:"请选择分类"}],match_method:[{required:!0,message:"请选择方法"}],match_text:[{required:!0,message:"请输入关键字/正则匹配内容"}]}}},props:{},watch:{},computed:{},methods:{reset:function(){return{id:"",name:"",rule_level:1,rule_type:1,rule_state:1,match_method:1,match_text:"",info:"",multi_line:!1,ignore_case:!1}},show:function(t){var e=this;this.formData=this.reset(),t?this.$api.rule.get(t).then((function(a){e.id=t,e.formData=a,e.isShow=!0})):(this.id="",this.isShow=!0)},hide:function(){this.isShow=!1},onHide:function(){this.isShow=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&t.$api.rule.edit(t.formData).then((function(e){t.isShow=!1,t.onSuccess("提交成功"),t.$emit("success")}))}))}},mounted:function(){},components:{}},i=o,r=(a("3a2b"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"163b":function(t,e,a){"use strict";a("d3b7"),a("498a"),a("ac1f"),a("5319"),a("caad"),a("2532");e["a"]={sleep:function(t){return new Promise((function(e){setTimeout(e,t)}))},isBlank:function(t){return t=this.trim(t),""===t},trim:function(t){return(t||"").replace(/^\s+|\s+$/gm,"")},contains:function(t,e){if(!t)return!1;var a=!0;for(var s in e)if(!Object.prototype.hasOwnProperty.call(t,e[s]))return a=!1,!1;return a},has:function(t,e){if(!t)return!1;var a=!1;for(var s in e)if(Object.prototype.hasOwnProperty.call(t,e[s]))return a=!0,!0;return a},includes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return 0==t.length&&0==e.length||0!=t.length&&(0==e.length||e.every((function(e){return t.includes(e)})))}}},"16d6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"apps",attrs:{type:"ghost"}},[a("el-tabs",{staticClass:"sysTabs",attrs:{"tab-position":"left"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"用户统计",name:"first"}},[a("report-user",{attrs:{form:t.form,"default-type":"export_user_stat"}})],1),a("el-tab-pane",{attrs:{label:"数据源统计",name:"second"}},[a("report-db",{attrs:{form:t.form,"default-type":"report_db_stat"}})],1),a("el-tab-pane",{attrs:{label:"用户/库统计",name:"three"}},[a("report-stat",{attrs:{form:t.form,"default-type":"export_report_stat"}})],1)],1)],1)},n=[],o=a("20a4"),i=a("5298"),r=a("c029"),l={data:function(){return{instances:[],setting:{},inter:null,run_str:"",size:"small",activeName:"first",form:{sql_mode:!0,license:""},handleClick:function(t,e){console.log("handleClick:",t,e)}}},methods:{},components:{ReportStat:o["default"],ReportDb:i["default"],ReportUser:r["default"]},mounted:function(){this.$nextTick((function(){}))}},c=l,u=(a("7150"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"2d430cf8",null);e["default"]=d.exports},"175d":function(t,e,a){},"17c5":function(t,e,a){"use strict";a("7957")},"18b0":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"msg-list-component flex flex-col"},[a("div",{staticClass:"flex-1 flex flex-col"},[t.msgData.list&&0!=t.msgData.list.length?t._l(t.msgData.list,(function(e,s){return a("div",{key:s,staticClass:"group py-3 px-5 ",class:{"hover:bg-gray-100":"header"!==t.config.mod,"border-b":t.msgData.list.length-1>s}},[a("div",{staticClass:"mb-2 flex justify-between"},[a("div",{staticClass:"flex justify-between truncate ..."},[a("div",{staticClass:"font-medium truncate ..."},[2==e.msg_type?a("div",{class:{"cursor-pointer":"record"!==t.config.mod},on:{click:function(a){return t.onClickMsg(e)}}},["record"==t.config.mod?[t.user.id==e.from_user?a("span",{staticClass:"msg-record-from"},[t._v(" 我 ")]):a("span",{staticClass:"msg-record-to flex items-center"},[t.config.avatar?a("el-avatar",{staticClass:"border border-gray-50 mr-2",staticStyle:{height:"30px",width:"30px","line-height":"30px"},attrs:{src:e.to_user_avatar}},[t._v(" "+t._s(e.to_nick_name.charAt(0))+" ")]):t._e(),t._v(" "+t._s(e.to_nick_name)+" ")],1)]:[t.user.id==e.from_user?a("span",{staticClass:"msg-normal-from"},[t._v(" 我 ")]):a("div",{staticClass:"msg-normal-to flex items-center",staticStyle:{"font-size":"15px"}},[t.config.avatar?a("el-avatar",{staticClass:"border border-gray-50 mr-2",staticStyle:{height:"30px",width:"30px","line-height":"30px"},attrs:{src:e.from_user_avatar}},[t._v(" "+t._s(e.from_name.charAt(0))+" ")]):t._e(),t._v(" "+t._s(e.from_name)+" ")],1)]],2):t._e(),a("div",{staticClass:"msg-content-or-title opacity-70  truncate ...",class:{"hover:text-blue-600 text-gray-800":"header"!==t.config.mod,"cursor-pointer":"record"!==t.config.mod},attrs:{title:t.getContent(e).content},on:{click:function(a){return t.onClickMsg(e)}}},[t._v(" "+t._s(t.getContent(e).content)+" ")]),3==e.msg_type||4==e.msg_type?a("div",{staticClass:"msg-mark text-gray-400"},[t._v(" "+t._s(t.getContent(e).mark)+" ")]):t._e()]),"record"!=t.config.mod&&1==e.read_state?a("k-icon",{staticClass:"text-red-600 text-xl",attrs:{name:"icon-weidu"}}):t._e()],1),"header"!==t.config.mod?a("div",{staticClass:"action flex justify-end",staticStyle:{width:"50px","font-size":"12px"}},[a("el-dropdown",{on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("el-button",{staticClass:"btn-border-0",attrs:{icon:"el-icon-more",circle:"",size:"mini"}})],1),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[3==e.msg_type?a("el-dropdown-item",{attrs:{command:{type:"exec",item:e},icon:"el-icon-s-check"}},[t._v(" 审批 ")]):t._e(),"record"!=t.config.mod?a("el-dropdown-item",{attrs:{command:{type:"read",item:e},icon:"el-icon-check"}},[t._v(" 标记已读 ")]):t._e(),a("el-dropdown-item",{attrs:{command:{type:"delete",item:e},icon:"el-icon-delete",divided:""}},[t._v(" 直接删除 ")])],1)],1)],1):t._e()]),a("div",{staticClass:"msg-info flex"},[a("div",{staticClass:"mr-5",class:{"text-gray-500":"header"!==t.config.mod}},[t._v(" "+t._s(t._f("relative")(e.createdAt))+" ")]),"header"!=t.config.mod||2!=e.msg_type?a("el-tag",{staticClass:"ignore",staticStyle:{"font-size":"0.75rem"},attrs:{size:"mini",type:t.getMsgColor(e.msg_type)}},[t._v(" "+t._s(t._f("msgType")(e.msg_type))+" ")]):t._e()],1)])})):[a("div",{staticClass:"flex-1 flex justify-center items-center"},[t._v(" 暂无消息 ")])]],2),t.config&&!1===t.config.open_page?t._e():a("el-pagination",{attrs:{"page-size":10,"current-page":t.currentPage,layout:"total, prev, pager, next",total:t.msgData.count},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"current-change":t.onCurrentChange}}),a("DialogApplyProject",{ref:"dialogApplyProject"})],1)},n=[],o=a("5530"),i=(a("99af"),a("d3b7"),a("a15b"),a("159b"),a("2f62")),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialog-drag",rawName:"v-dialog-drag"}],staticClass:"dialog-apply-project",attrs:{title:"项目审批","append-to-body":!0,visible:t.dialogVisible,width:"600px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人"}},[a("el-input",{attrs:{disabled:"",value:t.config.user_name}})],1),a("el-form-item",{attrs:{label:"申请理由"}},[a("el-input",{attrs:{disabled:"",value:t.config.mark}})],1),a("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[a("el-radio-group",{model:{value:t.formData.exec_state,callback:function(e){t.$set(t.formData,"exec_state",e)},expression:"formData.exec_state"}},[a("el-radio",{attrs:{label:2}},[t._v("通过")]),a("el-radio",{attrs:{label:3}},[t._v("不通过")])],1)],1),a("el-form-item",{attrs:{label:"审核说明",prop:"mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入审核说明"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)},l=[],c={data:function(){return{config:{},formData:{exec_state:2,mark:null,id:null},dialogVisible:!1}},methods:{show:function(t,e){this.config=e,this.formData.id=t,this.dialogVisible=!0},onSubmit:function(){var t=this;this.$api.my.myMsgExec(this.formData).then((function(e){t.$message.success("处理完成")})).finally((function(){t.dialogVisible=!1}))},handleClose:function(t){this.config={},this.formData.id=null,t()}}},u=c,d=(a("ff42"),a("2877")),p=Object(d["a"])(u,r,l,!1,null,"26441dc4",null),f=p.exports,m={1:"系统消息",2:"私信",3:"项目审批",4:"工单审批"},h={1:"info",2:"success",3:"",4:"warning"},b={components:{DialogApplyProject:f},props:{config:{type:Object,default:function(){return{page_no:0,page_size:10,open_page:!0,lazy:!1,mod:"normal"}}}},filters:{msgType:function(t){return m[t]||"未知"}},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["projectAllList","user"])),{},{getContent:function(){return function(t){if(3==t.msg_type)try{var e=JSON.parse(t.content);return{content:"“".concat(e.user_name,"”申请加入项目：").concat(e.project_name),mark:e.mark}}catch(s){return{content:t.content}}else if(4==t.msg_type)try{var a=JSON.parse(t.content);return{content:"“".concat(a.user_name,"”在项目”").concat(a.project_name,"”发起工单“").concat(a.work_name,"”"),mark:a.mark}}catch(s){return{content:t.content}}return{content:t.content}}},getMsgColor:function(){return function(t){return void 0==h[t]?"danger":h[t]}}}),watch:{config:function(t){this.reset(t)}},data:function(){return{currentPage:1,applyProjectMsg:null,loading:!1,msgData:{list:[],count:0,page_no:0,page_size:10}}},methods:{onApplyProjectSuccess:function(){var t=this;this.readedMsg(this.applyProjectMsg.id).then((function(){t.applyProjectMsg.read_state=2}))},onClickMsg:function(t){if("record"!=this.config.mod)if(this.readedMsg(t.id).then((function(){t.read_state=2})),2==t.msg_type)this.$router.push("/personal/notice/personal/".concat(t.from_user));else if(3==t.msg_type){var e=JSON.parse(t.content),a={user_name:e.user_name,mark:e.mark};this.$refs.dialogApplyProject.show(t.id,a),this.applyProjectMsg=t}else if(4==t.msg_type){var s=JSON.parse(t.content);this.$bus.emit("work-detail-show",s.work_id,!0)}},handleCommand:function(t){var e=this;"read"==t.type?this.readedMsg(t.item.id).then((function(){t.item.read_state=2})):"delete"==t.type?this.$api.my.myMsgDelete([t.item.id]).then((function(t){e.$bus.emit("header-notice-refresh"),e.getMsgPage()})):"exec"==t.type&&this.onClickMsg(t.item)},readedMsg:function(t){return this.readedMsgs([t])},readedMsgs:function(t){var e=this;return new Promise((function(a,s){e.$api.my.myMsgRead(t.join(",")).then((function(t){return e.$bus.emit("header-notice-refresh"),a()}))}))},reset:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.msgData.list=[],this.refresh(t)},refresh:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&t.init&&(this.msgData.page_no=0,this.currentPage=1),t=Object(o["a"])(Object(o["a"])({},this.config),{},{page_no:this.msgData.page_no}),this.getMsgPage(t)},readAll:function(){var t=[];return this.msgData.list.forEach((function(e){1==e.read_state&&t.push(e.id)})),t.length?this.readedMsgs(t):Promise.resolve()},onCurrentChange:function(t){var e=Object(o["a"])(Object(o["a"])({},this.config),{},{page_size:this.msgData.page_size,page_no:t-1});this.getMsgPage(e)},getMsgPage:function(t){var e=this;t||(t=this.config),this.loading=!0,"record"==this.config.mod?this.$api.my.myListRecord(t).then((function(t){e.msgData=Object(o["a"])(Object(o["a"])({},e.msgData),{},{count:t.count,list:t.list,page_no:t.page_no})})).finally((function(){e.loading=!1,e.$nextTick((function(){e.$emit("paged",!0)}))})):this.$api.my.myMsgList(t).then((function(t){e.msgData=Object(o["a"])(Object(o["a"])({},e.msgData),{},{count:t.count,list:t.list,page_no:t.page_no})})).finally((function(){e.loading=!1,e.$nextTick((function(){e.$emit("paged",!0)}))}))}},mounted:function(){this.config.mod||(this.config.mod="normal"),this.config.lazy||this.getMsgPage()}},_=b,g=Object(d["a"])(_,s,n,!1,null,null,null);e["a"]=g.exports},"18c4":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-like",use:"d2-like-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-like"><path d="M192 938.7H87.9c-48.4 0-87.9-39.5-87.9-88V386.6c0-48.5 39.5-87.9 87.9-87.9h125.4c11.6 0 22.7 4.7 30.8 13.1 8 8.4 12.3 19.6 11.9 31.2l-21.3 554.7c-0.9 22.8-19.8 41-42.7 41zM87.9 384c-1.4 0-2.6 1.2-2.6 2.6v464.1c0 1.4 1.2 2.6 2.6 2.6h63L169 384H87.9z" fill="#5F6379" /><path d="M810.4 938.7H275.7l24.6-640H418l72-201.8C510.7 38.9 566 0 627.5 0c42.4 0 82.6 18.4 110.3 50.4S778 124.8 772 166.7l-18.9 132h142.6c70.7 0 128.2 57.5 128.2 128.2l-1 9.3-84.4 379.4c-2.6 68.3-59.1 123.1-128.1 123.1z m-446.1-85.4h446.1c23.6 0 42.9-19.2 42.9-42.9l1-9.3L938.5 423c-2-21.8-20.4-39-42.7-39h-241l32.8-229.4c2.5-17.7-2.5-34.8-14.2-48.3s-28-20.9-45.9-20.9c-25.6 0-48.5 16.2-57.1 40.3L478.1 384h-95.7l-18.1 469.3z" fill="#3688FF" /></symbol>'});i.a.add(r);e["default"]=r},"18df":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"权限组["+t.role.name+"]的申请记录",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/list","search-data":t.search,manual:!0},on:{reset:t.resetSearch}},[a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"}}),a("el-table-column",{attrs:{label:"申请理由",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核人",prop:"user_name"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过,原因:"+t._s(e.row.auditor_mark)+" ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{ids:"",role:{},isShow:!1,search:{},rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}]}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search()},show:function(t){var e=this;this.role=t,this.search.role_id=t.id,this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onAdd:function(t){var e=this;this.$api.role.relation(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kick(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"18f5":function(t,e){},"194a":function(t,e,a){},"1a61":function(t,e,a){},"1ae3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dialog-test"},[a("el-dialog",{attrs:{"custom-class":"dialog-test",title:"测试规则",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e},close:t.hide}},[t.data?a("el-autocomplete",{staticClass:"inline-input val_mask_rule_test",attrs:{"fetch-suggestions":t.$parent.contentQuerySearch,placeholder:"请输入表达式"},on:{select:t.$parent.contentHandleSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"label"},[t._v(t._s(e.item.label))])]}}],null,!1,3101381800),model:{value:t.data["val_regexp"],callback:function(e){t.$set(t.data,"val_regexp",e)},expression:"data['val_regexp']"}},[a("div",{attrs:{slot:"suffix"},slot:"suffix"},[a("i",{staticClass:"val_mask_rule_clear el-input__icon el-icon-circle-close pointer-active",staticStyle:{color:"red"},attrs:{title:"清空"},on:{click:function(e){t.data["val_regexp"]=""}}})])]):t._e(),t.data?a("div",{staticClass:"tags config padding-y-12 border-radius-4"},[a("el-checkbox",{model:{value:t.data.ignore_case,callback:function(e){t.$set(t.data,"ignore_case",e)},expression:"data.ignore_case"}},[t._v("忽略大小写")]),a("el-checkbox",{model:{value:t.data.multi_line,callback:function(e){t.$set(t.data,"multi_line",e)},expression:"data.multi_line"}},[t._v("多行匹配")])],1):t._e(),a("span",[t._v("文本：")]),a("el-input",{attrs:{type:"textarea",placeholder:"请输入测试文本",rows:10},model:{value:t.test_text,callback:function(e){t.test_text=e},expression:"test_text"}}),a("div",{staticClass:"action"},[a("el-button",{staticClass:"label-success",attrs:{size:"mini",round:""},on:{click:function(e){return t.onTest()}}},[t._v("测试")])],1),a("div",{staticClass:"result padding-y-12 padding-x-24 border-radius-4"},[a("pre",{domProps:{innerHTML:t._s(t.resultText)}})])],1)],1)},n=[],o={data:function(){return{test_text:"",tid:null,config:null,data:null,isShow:!1,result:[],resultText:"",ouput:""}},methods:{onTest:function(){this.strategyTest(this.tid,JSON.stringify(this.data),this.test_text)},show:function(t,e,a){this.isShow=!0,this.tid=t,this.config=a,this.data=e},hide:function(){this.isShow=!1,this.tid=null,this.config=null,this.data=null},strategyTest:function(t,e,a){var s=this;this.$api.strategy.test({tid:t,config:e,text:a}).then((function(t){s.resultText=t.ouput||t.output,console.log("返回结果：",s.resultText)}))}}},i=o,r=(a("3e2c"),a("0445"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"3a15994f",null);e["default"]=l.exports},"1b9c":function(t,e,a){},"1bbd":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"工单设置",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-card",{staticClass:"box-card"},[a("el-form",{attrs:{model:t.configForm,"label-width":"280px",size:"mini"}},[a("el-form-item",{attrs:{label:"支持手动提交工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后,支持手动提交工单"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.hand_work,callback:function(e){t.$set(t.configForm,"hand_work",e)},expression:"configForm.hand_work"}})],1)],1),a("el-form-item",{attrs:{label:"开启强制工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后,可强制启用工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.work_must,callback:function(e){t.$set(t.configForm,"work_must",e)},expression:"configForm.work_must"}})],1)],1),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DQL)查询数据走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"查询数据必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.query_must,callback:function(e){t.$set(t.configForm,"query_must",e)},expression:"configForm.query_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DQL)文件导出走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"文件导出必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.export_must,callback:function(e){t.$set(t.configForm,"export_must",e)},expression:"configForm.export_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DQL)异步查询走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"异步查询必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.async_must,callback:function(e){t.$set(t.configForm,"async_must",e)},expression:"configForm.async_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DML)删除数据走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"删除数据必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.delete_must,callback:function(e){t.$set(t.configForm,"delete_must",e)},expression:"configForm.delete_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DML)更新数据走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"更新数据必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.update_must,callback:function(e){t.$set(t.configForm,"update_must",e)},expression:"configForm.update_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DML)写入数据走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"写入数据必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.insert_must,callback:function(e){t.$set(t.configForm,"insert_must",e)},expression:"configForm.insert_must"}})],1)],1):t._e(),t.configForm.work_must?a("el-form-item",{attrs:{label:"(DDL)结构变更走工单"}},[a("el-tooltip",{attrs:{placement:"top",content:"DDL操作必须走工单流程"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.ddl_must,callback:function(e){t.$set(t.configForm,"ddl_must",e)},expression:"configForm.ddl_must"}})],1)],1):t._e()],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o=a("5530"),i=a("c1df"),r=a.n(i),l=a("2f62"),c=a("5c96"),u={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,projects:[],checks:[],checks2:[],configForm:{},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["e"])(["user"])),methods:{showTime:function(t){return r()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],checks:[],checks2:[],public_state:2,roles_str:""}},show:function(t){var e=this;this.id=t?t.id:null,this.checks=[],this.checks2=[],this.id?this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,""==t.other_config?e.configForm=t.other_config_po:e.configForm=JSON.parse(t.other_config),e.isShow=!0})):(this.formData=this.reset(),this.isShow=!0)},hide:function(t){this.formData={},this.configForm={},this.isShow=!1},onSubmit:function(){var t=this,e={id:this.id};e.other_config=JSON.stringify(this.configForm),this.$api.project.updOtherConfig(e).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){},components:{}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},"1c01":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.service.head.length>0,expression:"service.head.length > 0"}],staticClass:"tool-column"},[a("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[a("div",{staticClass:"col_lists"},[a("el-checkbox",{on:{change:t.checkAll},model:{value:t.chk_all,callback:function(e){t.chk_all=e},expression:"chk_all"}},[a("span",[t._v("全部")])]),t._l(t.headList,(function(e){return a("div",{key:e.k.label,staticClass:"col_list"},[a("el-checkbox",{on:{change:function(e){return t.onCheckItemChange()}},model:{value:e.v,callback:function(a){t.$set(e,"v",a)},expression:"v.v"}},[a("span",[t._v(t._s(e.k.label))])])],1)}))],2),a("i",{staticClass:"sn-font text-primary",attrs:{slot:"reference"},slot:"reference"},[t._v("")])])],1)},n=[],o=(a("caad"),a("d81d"),a("4de4"),a("159b"),["pre","next"]),i={data:function(){return{chk_all:!0,headList:[]}},inject:["service"],watch:{"service.head":function(t){console.log("[tool.column.vue watch service.head]",t,this.headList&&this.headList.length,this.service.runType,!o.includes(this.service.runType)),o.includes(this.service.runType)||(this.chk_all=!0,this.headList=t.map((function(t){return{k:t,v:!0}})))}},methods:{onCheckItemChange:function(){this.service.filterHead=this.headList.filter((function(t){return t.v})).map((function(t){return t.k}))},checkAll:function(t){this.headList.forEach((function(e){console.log("v:",e.v," k:",e.k),e.v=t})),this.onCheckItemChange()}}},r=i,l=(a("348e"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"319a71a5",null);e["default"]=c.exports},"1c4e":function(t,e,a){"use strict";a("1d95")},"1d95":function(t,e,a){},"1e1e":function(t,e,a){},"1e99":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.doc.name+"("+t.doc.user_name+")【权限预览】",visible:t.isShow,width:"800px",center:""},on:{"update:visible":function(e){t.isShow=e}}},[a("span",{staticStyle:{padding:"20px"}},[t._v(" 权限组:"),t._l(t.role_names,(function(e){return a("el-tag",{key:e,staticStyle:{margin:"5px"},attrs:{type:"success"}},[t._v(t._s(e))])}))],2),a("div",{staticStyle:{padding:"20px"}},[t._v(" 图标: "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v(" 异步查询 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("异步导出/导出文件 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("导出Sql ")]),a("el-tree",{ref:"tree2",attrs:{data:t.list,"node-key":"id",props:t.defaultProps,indent:26,isLeaf:function(t){return"col"==t.node_type},"highlight-current":"",lazy:"","default-expanded-keys":t.expKeys,load:t.onNextLoad},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",["db"==n.node_type?a("span",[t._v("["+t._s(n.db_type)+"]"+t._s(s.label)+" ")]):"owner"==n.node_type?a("span",[t._v("[实例]"+t._s(s.label)+" ")]):"table"==n.node_type?a("span",[t._v("[表]"+t._s(s.label)+" ")]):a("span",[t._v("[字段]"+t._s(s.label))]),1==n.rw?a("i",{staticClass:"sn-font text-success"},[t._v("读")]):t._e(),2==n.rw?a("i",{staticClass:"sn-font text-primary"},[t._v("写")]):t._e(),3==n.rw&&"col"!=n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("禁")]):t._e(),"col"!=n.node_type?a("span",[1==n.asyn_query?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_export?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_sql?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e()]):t._e(),3==n.rw&&"col"==n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("敏")]):t._e()])])}}])})],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("2f62")),r={data:function(){return{defaultProps:{children:"children",label:"name"},role_names:[],isShow:!1,doc:{},list:[],expKeys:[]}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(t,e){var a=t.data;a&&a.length>0&&e(a),a&&"col"==a.node_type&&e([]),a&&a.children?e(a.children):a&&a.id&&a.name?(a.uid=this.doc.id,this.$api.user.permissionChildren(a).then((function(t){t?(a.children=t,e(t)):e([])}))):e([])},show:function(t){var e=this;this.$api.user.info(t.id).then((function(t){e.doc=t,e.role_names=t.role_names})),this.$api.user.permissionAll(t.id).then((function(t){if(e.isShow=!0,e.list=t,t&&t.length)for(var a=0;a<t.length;a++)e.expKeys.push(t[a].id)}))},hide:function(t){this.isShow=!1}}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"1eec":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:t.id?"修改策略":"新增策略",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-steps",{attrs:{active:t.step,"finish-status":"success"}},[a("el-step",{attrs:{title:"选择模板"}}),a("el-step",{attrs:{title:"选择目标"}}),a("el-step",{attrs:{title:"提交数据"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.step&&!t.id,expression:"step==1&&!id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略类型"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dList",attrs:{data:t.dList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center"},[a("div",{staticClass:"left",on:{click:function(e){return t.onClickList(s)}}},[a("span",[t._v(" "+t._s(s.name))])])])}}])})],1)],2)],1),a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略模板"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"typeList",attrs:{data:t.typeList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center"},[a("div",{staticClass:"left",on:{click:function(e){return t.onClickType(s)}}},[a("span",[t._v(" "+t._s(s.name))])])])}}])})],1)],2)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==t.step&&!t.id,expression:"step==2&&!id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("db-list",{on:{db:t.onDb}})],1),a("el-col",{attrs:{span:8}},[a("owner-list",{ref:"ownerList",on:{owner:t.onOwner,refreshNext:t.refreshNext}})],1),a("el-col",{attrs:{span:8}},[a("table-list",{ref:"tabList",attrs:{db:t.selectDb,owner:t.selectOwner},on:{table:t.onTable}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"primary",disabled:!(t.selectTable&&t.selectTable.name)},on:{click:function(e){t.step=t.step+1}}},[t._v("下一步")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3==t.step||t.id,expression:"step==3||id"}],staticClass:"role"},[a("k-card",{attrs:{head:"参数设定"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"150px"}},[a("div",[a("el-form-item",{attrs:{label:"策略名称"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),a("el-form-item",{attrs:{label:"数据表"}},[a("el-tooltip",{attrs:{placement:"top",content:"数据表，* 代表所有表，可以前后加*模糊匹配"}},[a("el-input",{attrs:{size:"mini",disabled:"query_count"!=t.tid},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}})],1)],1),t._l(t.tplList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.name}},[a("el-tooltip",{attrs:{placement:"top",content:e.tip}},["number"==e.type?a("el-input-number",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):t._e(),"params_select"==e.type?a("div",[a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.mustParamsConfigList,"show-header":!1}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择"},model:{value:s["param"],callback:function(e){t.$set(s,"param",e)},expression:"row['param']"}},t._l(t.paramsList,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.mustParamsConfigList)}}},[t._v(" 移除 ")]):t._e(),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addParamRow()}}},[t._v(" 添加 ")])]}}],null,!0)})],1)],1)],1):a("el-input",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}})],1)],1)}))],2)])],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.id,expression:"!id"}],on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)],1)],1)},n=[],o=(a("b0c0"),a("a434"),a("7e57")),i=a("660b"),r=a("2971"),l=a("2e0b"),c=a("1f82"),u={data:function(){return{formData:{},match_type:"text",step:1,name:"",owner:"",tab:"",db_id:"",c_type:"",tid:"",rid:"",edit:!1,selectType:{},selectDb:{},selectOwner:{},selectTable:{},selectTpl:{},isShow:!1,id:"",treeProps:{label:"name"},dList:[{name:"查询策略",id:"SELECT",leaf:!0,c:[{name:"查询并发",id:"query_count",leaf:!0,c:[{name:"用户并发查询",id:"user_count",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"number"},{name:"全局并发查询",id:"global_count",leaf:!0,tip:"所有用户同时可进行几条查询,0或者空代表不限制。",type:"number"}]},{name:"查询条件",id:"query_where",leaf:!0,c:[{name:"查询必带参数",id:"must_param",leaf:!0,tip:"查询必带参数,可设置多个组合",type:"params_select"}]}]}],mustParamsConfigList:[],typeList:[],tplList:[],dataList:[],paramsList:[]}},computed:{},props:{},watch:{},methods:{getName:function(){var t="";return this.selectDb&&this.selectDb.name&&(t=this.selectDb.name,this.selectOwner&&this.selectOwner.name&&(t=t+"/"+this.selectOwner.name,this.selectTable&&this.selectTable.name&&(t=t+"/"+this.selectTable.name,this.selectType&&this.selectType.name&&(t=t+"("+this.selectType.name+")")))),t},initMustParamsConfigList:function(){console.log("initMustParamsConfigList"),this.mustParamsConfigList=[],this.mustParamsConfigList.push({param:""})},onClickList:function(t){this.c_type=t.id,this.typeList=t.c?t.c:[]},onClickTpl:function(t){this.selectTpl=t,this.step++,this.tplList=t.c?t.c:[]},onClickType:function(t){console.log("onClickType:",t),this.step++,this.selectType=t,this.tid=t.id,this.tplList=t.c?t.c:[],this.formData={}},onNext:function(){},refreshNext:function(){this.$refs.tabList.refresh()},onDb:function(t){console.log("onDb......",t.name,t.id),this.selectDb=t,this.db_id=t.id,this.selectOwner={},this.selectTable={},this.rid="",this.tab="",this.$refs.ownerList.doRefresh(t)},onOwner:function(t){this.selectOwner=t,this.owner=t.name,this.selectTable={},this.rid="",this.tab=""},onTable:function(t){this.selectTable=t,this.rid=this.selectTable.id,this.tab=t.name,this.LoadParams(this.rid),this.name=this.getName()},LoadParams:function(t){var e=this;this.$api.auto.autoV3(t).then((function(t){var a=[];if(t)for(var s=0;s<t.length;s++)a.push(t[s].name);e.loading=!1,e.paramsList=a}))},show:function(t,e){t&&e?(this.id=t.id,this.db_id=t.db_id,this.c_type=t.c_type,this.tid=t.tid,this.rid=t.rid,this.name=t.name,this.owner=t.owner,this.tab=t.tab,this.formData={},this.loadStrategy()):(this.step=1,this.id="",this.formData={},this.initMustParamsConfigList()),this.isShow=!0},hide:function(){this.isShow=!1},deleteRow:function(t,e){e.splice(t,1)},addParamRow:function(){this.mustParamsConfigList.push({param:""})},loadStrategy:function(){var t=this;this.$api.strategy.info(this.id).then((function(e){if(""!=e&&e.config){t.formData=JSON.parse(e.config),t.formData.must_param&&t.formData.must_param.length>0?t.mustParamsConfigList=t.formData.must_param:t.initMustParamsConfigList();for(var a=!1,s=0;s<t.dList.length&&!a;s++){var n=t.dList[s];if(n.id==e.c_type&&n.c)for(var o=0;o<n.c.length&&!a;o++){var i=n.c[o];if(i.id==e.tid){t.tplList=i.c?i.c:[],a=!0;break}}}t.LoadParams(t.rid)}else t.$message({message:"加载失败，请刷新再试！",type:"warning"})}))},onSubmit:function(){var t=this;if(this.id){if(!this.id)return this.$message({message:"策略id不能为空",type:"warning"}),!1}else{if(!this.c_type)return this.$message({message:"模板不能为空",type:"warning"}),!1;if(!this.owner)return this.$message({message:"数据集不能为空",type:"warning"}),!1;if(!this.tab)return this.$message({message:"表名不能为空",type:"warning"}),!1;if(!this.db_id)return this.$message({message:"关联数据源不能为空",type:"warning"}),!1;if(!this.tid)return this.$message({message:"策略模板不能为空",type:"warning"}),!1}if(!this.name)return this.$message({message:"名称不能为空",type:"warning"}),!1;var e=this.formData;if("query_count"==this.tid&&e.user_count&&e.global_count){if(e.user_count=~~e.user_count,e.global_count=~~e.global_count,e.user_count>e.global_count)return this.$message({message:"用户并发查询不能大于全局并发查询",type:"warning"}),!1}else"query_where"==this.tid&&this.mustParamsConfigList&&this.mustParamsConfigList.length>0&&(e.must_param=this.mustParamsConfigList);var a=JSON.stringify(e);this.id?this.$api.strategy.update({id:this.id,config:a,tab:this.tab,name:this.name}).then((function(){t.onSuccess("更新成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})):this.$api.strategy.save({rid:this.rid,config:a,db_id:this.db_id,owner:this.owner,tab:this.tab,match_type:this.match_type,name:this.name,c_type:this.c_type,tid:this.tid}).then((function(){t.onSuccess("新增成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}},components:{ElCol:c["a"],ElRow:l["a"],DbList:o["default"],OwnerList:i["default"],TableList:r["default"]}},d=u,p=(a("8858"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,"132a359a",null);e["default"]=f.exports},"1eed":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-form",{ref:"form",staticClass:"userInfo",staticStyle:{width:"600px"},attrs:{model:t.form,"label-width":"120px",rules:t.rules}},[a("el-form-item",{attrs:{label:"用户名"}},[t._v(" "+t._s(t.form.name)+" ")]),a("el-form-item",{attrs:{label:"旧密码",prop:"old_password"}},[a("el-input",{attrs:{"show-password":!0,type:t.pw_show?"text":"password"},model:{value:t.form.old_password,callback:function(e){t.$set(t.form,"old_password",e)},expression:"form.old_password"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[a("el-tooltip",{attrs:{placement:"top",content:"密码长度8到32位,包含字母和数字,不支持简单口令"}},[a("el-input",{attrs:{"show-password":!0,type:t.pw_show1?"text":"password"},model:{value:t.form.new_password,callback:function(e){t.$set(t.form,"new_password",e)},expression:"form.new_password"}})],1)],1),a("el-form-item",{attrs:{label:"重复新密码",prop:"new_password2"}},[a("el-input",{attrs:{"show-password":!0,type:t.pw_show2?"text":"password"},model:{value:t.form.new_password2,callback:function(e){t.$set(t.form,"new_password2",e)},expression:"form.new_password2"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o=a("5530"),i=a("2f62"),r=a("2ef0"),l={data:function(){var t=this;return{pw_show:!1,pw_show1:!1,pw_show2:!1,form:this.reset(),rules:{old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,max:32,message:"长度在 8 到 32 个字符"},{validator:function(e,a,s){console.log("value:",a),a&&a.length>8?t.$api.post("/api/pwdScore",{pwd:a}).then((function(t){t.score<2?s(new Error("密码过于简单!")):s()}),(function(t){s(new Error(t&&t.data?t.data:t))})):s()},trigger:"blur"}],new_password2:[{required:!0,message:"请重复输入新密码",trigger:"blur"},{min:8,max:32,message:"长度在 8 到 32 个字符"},{validator:function(e,a,s){console.log("+======+"),console.dir(t.form),t.form.new_password!=a?s(new Error("新密码两次输入不一致!")):s()},trigger:"blur"}]}}},computed:Object(o["a"])({},Object(i["e"])(["user"])),components:{},methods:{showFail:function(t){this.$message({showClose:!0,duration:2e3,type:"warning",message:t||"调用失败!"})},showOk:function(t){this.$message({showClose:!0,duration:2e3,type:"success",message:t})},reset:function(){return{name:"",old_password:"",new_password:"",new_password2:""}},onSubmit:function(){var t=this;console.log("submit!"),this.$refs.form.validate((function(e){if(console.log("valid:"+e),!e)return!1;t.$api.post("/api/my/pwd/change",t.form).then((function(e){t.form={},t.$store.commit("setForcePwd",0),t.onSuccess("更新成功!")}))}))}},mounted:function(){this.form=Object(r["cloneDeep"])(this.user)}},c=l,u=(a("d562"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"5ff53fe1",null);e["default"]=d.exports},"1f8a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-mysql-health"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/mysql/status","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:60},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"基本信息"}},[a("el-table-column",{attrs:{label:"连接",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.connect?a("div",{staticClass:"text-error"},[t._v("失败")]):a("div",{staticClass:"text-success"},[t._v("成功")]),0==e.row.connect?a("div",[t._v("("+t._s(e.row.error)+")")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"运行时间",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s((e.row.uptime/60/60/24).toFixed(0))+" 天")]}}])})],1),a("el-table-column",{attrs:{label:"线程"}},[a("el-table-column",{attrs:{label:"连接线程数",prop:"threads_connected"}}),a("el-table-column",{attrs:{label:"活动线程数",prop:"threads_running"}}),a("el-table-column",{attrs:{label:"等待线程数",prop:"threads_waits"}})],1),a("el-table-column",{attrs:{label:"网络"}},[a("el-table-column",{attrs:{label:"接受",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.bytes_received_persecond)+"KB")]}}])}),a("el-table-column",{attrs:{label:"发送",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.bytes_sent_persecond)+"KB")]}}])})],1),a("el-table-column",{attrs:{label:"查询"}},[a("el-table-column",{attrs:{label:"每秒查询",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.queries_persecond)+"次")]}}])}),a("el-table-column",{attrs:{label:"每秒事务",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.transaction_persecond)+"次")]}}])})],1)],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{dateRange:[]}}},computed:{},props:{},watch:{},methods:{onData:function(t){t&&t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("ed41"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"20a4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"log"},[a("k-search-table",{ref:"st",attrs:{url:"/api/sys/report/stat","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"操作类型:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.task_type,callback:function(e){t.$set(t.search,"task_type",e)},expression:"search.task_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onExport}},[t._v("导出")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"user_name",label:"操作人"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.user_name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"db_name",label:"数据库"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.db_name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"db_type",label:"库类型"}}),a("el-table-column",{attrs:{prop:"hits",label:"执行次数"}}),a("el-table-column",{attrs:{label:"数据行数",prop:"data_count"}})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行次数排序"},{k:1,v:"按数据总量顺序"}],types:[{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:99,v:"其他"}],search:{ip:"",start:"",end:"",type:this.defaultType,owner:"",order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),props:{defaultType:{}},watch:{},methods:{onDownload:function(t){var e=window.localStorage.getItem("token");this.$api.download("/api/download/export/excel",{id:t,access_token:e})},onExport:function(){var t=this,e=Object(o["a"])({},this.search);e.dateRange&&(e.start=l()(e.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),e.end=l()(e.dateRange[1]).format("YYYY-MM-DD HH:mm:ss")),this.$api.post("/api/sys/report/stat/export",e).then((function(e){console.log("ret:",e),t.onDownload(e)}))},quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={start:"",end:"",type:this.defaultType,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e}))}},u=c,d=(a("453c"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},2109:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-input",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"textarea",rows:4,placeholder:t.getPlaceholder},model:{value:t.msgContent,callback:function(e){t.msgContent=e},expression:"msgContent"}}),a("el-button",{staticClass:"mt-3",attrs:{type:"success",icon:"el-icon-edit",disabled:!t.msgContent.length},on:{click:t.onSend}},[t._v("发送")])],1)},n=[],o=(a("a9e3"),a("d3b7"),{props:{userId:{type:Number|String,require:!0},userInfo:{type:Object}},computed:{getPlaceholder:function(){return this.userInfo?"向“".concat(this.userInfo.user_name,"”发送消息，请文明发言，真诚提问"):"文明发言，真诚提问，请输入要发的内容"}},data:function(){return{loading:!1,msgContent:"",user_id:this.$route.params.id}},methods:{onSend:function(){var t=this;this.loading=!0,this.$api.my.myMsgSend(this.userId,this.msgContent).then((function(e){t.$emit("success")})).finally((function(){t.msgContent="",t.loading=!1}))}}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},2111:function(t,e,a){},2194:function(t,e,a){"use strict";a("9c25")},"21b9":function(t,e,a){},"22dc":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-love",use:"d2-love-usage",viewBox:"0 0 1025 1024",content:'<symbol class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" id="d2-love"><path fill="#333333" d="M512.8 977.4c-26.1 0-50.1-7.3-71.5-21.7C323.5 897 0 675.3 0 400.5 0 212 153.4 58.6 341.9 58.6c60.5 0 119 15.8 170.9 45.9 51.9-30.1 110.5-45.9 170.9-45.9 188.5 0 341.9 153.4 341.9 341.9 0 274.8-323.5 496.6-441.3 555.2-21.4 14.4-45.4 21.7-71.5 21.7zM341.9 144.1c-141.4 0-256.4 115-256.4 256.4 0 117.2 80.6 225.2 148.2 295.1 86.1 89 187.5 155.2 248.1 184.8l6.1 3.7c15.1 10.8 34.6 10.8 49.7 0l6.1-3.7C604.4 850.7 705.8 784.6 791.8 695.6c67.6-69.9 148.2-177.8 148.2-295.1 0-141.4-115-256.4-256.4-256.4-52.6 0-103.2 16-146.5 46.1L512.8 207.3l-24.5-17.1c-43.2-30.2-93.9-46.1-146.4-46.1z" /></symbol>'});i.a.add(r);e["default"]=r},"232e":function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return p}));var s=a("d4ec"),n=a("ade3"),o=a("2909"),i=a("1da1"),r=(a("96cf"),a("99af"),a("d81d"),{template1:[{}],template2:{},sql:null,mysql:null,postgres:null,oracle:null,mongodb:null}),l=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,s,n,i,l,c,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("databaseLanguage: ",e),!r[e]){t.next=3;break}return t.abrupt("return");case 3:if(a=languagesmore.getLanguage(e,!0),a){t.next=6;break}return t.abrupt("return",[]);case 6:return t.next=8,a.loader();case 8:s=t.sent,n=s.language,i=u(n.keywords,"Keyword","关键字"),l=u(n.operators,"Operator","分隔符"),c=u(n.builtinFunctions,"Function","方法"),d=[].concat(Object(o["a"])(i),Object(o["a"])(l),Object(o["a"])(c)),r[e]=d;case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c={Keyword:" ",Function:"()",Operator:""},u=function(t,e,a){return a=a||"",t.map((function(t){var s=null;return s="Function"==e&&languagesmore.functionExt[t]?"".concat(t).concat(languagesmore.functionExt[t]):t+c[e],{label:t,insertText:s,kind:monaco.languages.CompletionItemKind[e],detail:a,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet}}))},d=function(t){return l(t),r[t]},p=function t(e){if(Object(s["a"])(this,t),Object(n["a"])(this,"databaseLanguage",void 0),Object(n["a"])(this,"suggs",void 0),Object(n["a"])(this,"get",Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l(this.databaseLanguage);case 2:return e=r[this.databaseLanguage],console.log("[service.auto.db.dbsuggest] get: ",this.databaseLanguage,r),t.abrupt("return",e||[]);case 5:case"end":return t.stop()}}),t,this)})))),!e)throw console.error("databaseLanguage必填：",e),new Error("databaseLanguage undefined");console.log("dbsuggest constructor :",e),this.databaseLanguage=e,this.suggs=d(e)}},"23b2":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"ref-result",staticClass:"result-result"},[a("div",{staticClass:"tools hbox-center"},[a("span",{staticClass:"vr"}),a("div",{staticClass:"edit-tools",class:{"disabled-all":!t.isTableAllowEdit||!t.isAllowEdit}},[a("k-icon",{staticClass:"pointer-active",class:{disabled:!t.isEffectData},attrs:{title:"提交",type:"image",icon:"accept@2x"},nativeOn:{click:function(e){return t.onSubmit.apply(null,arguments)}}}),a("k-icon",{staticClass:"pointer-active",class:{disabled:!t.isEffectData},attrs:{title:"关闭/还原",type:"image",icon:"cancel@2x"},nativeOn:{click:function(e){return t.onCancel.apply(null,arguments)}}}),a("k-icon",{staticClass:"pointer-active",class:{disabled:!t.isAllowAdd},attrs:{title:"添加行",type:"image",icon:"row_add@2x"},nativeOn:{click:function(e){return t.addRow(!1)}}}),a("k-icon",{staticClass:"pointer-active",class:{"disabled-all":0==t.selectItems.length||!t.isAllowAdd},attrs:{title:"复制行",type:"image",icon:"row_copy@2x"},nativeOn:{click:function(e){return t.addRow(!0)}}}),a("k-icon",{staticClass:"pointer-active",class:{"disabled-all":!t.isAllowDelete},attrs:{title:"删除行",type:"image",icon:"row_delete@2x"},nativeOn:{click:function(e){return t.deleteRow.apply(null,arguments)}}})],1),a("span",{staticClass:"vr"}),a("span",{staticClass:"tool"},[t._v(" 第 "),a("span",{staticClass:"text-primary"},[t._v(t._s(t.service.page+1))]),t._v(" 页 ")]),a("span",{staticClass:"vr mr-2"}),a("tool",{attrs:{icon:"&#xe7ea;",text:"第一页",disabled:t.disable||t.notHasPrev},on:{click:function(e){return t.service.onFirst()}}}),a("tool",{attrs:{icon:"&#xe7ec;",text:"前一页",disabled:t.disable||t.notHasPrev},on:{click:function(e){return t.onPre()}}}),a("tool",{attrs:{icon:"&#xe7eb;",text:"后一页",disabled:t.disable||t.notHasNext},on:{click:function(e){return t.onNext()}}}),a("tool",{attrs:{icon:"&#xe7ed;",text:"累加",disabled:t.disable||t.notHasNext},on:{click:function(e){return t.onNext(!0)}}}),a("span",{staticClass:"vr ml-2"}),a("el-select",{staticClass:"tool size",staticStyle:{"min-width":"120px"},attrs:{size:"mini",value:t.pageSize},on:{change:t.pageSizeChangeHandle}},t._l(t.sizes,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1),a("span",{staticClass:"vr ml-1 mr-3"}),a("tool",{staticClass:"text-primary",attrs:{icon:"&#xe65b;",text:"字体变大"},on:{click:function(e){return t.onChangeFontSize(!0)}}}),a("tool",{staticClass:"text-primary",attrs:{icon:"&#xe65a;",text:"字体变小"},on:{click:function(e){return t.onChangeFontSize()}}}),a("span",{staticClass:"vr  mx-2"}),a("tool",{class:{"text-primary":t.showLine,"text-disable":!t.showLine},attrs:{icon:"&#xe61c;",text:t.showLine?"取消行号":"显示行号"},on:{click:function(e){return t.onShowLine()}}}),a("span",{staticClass:"vr  mx-2"}),a("tool",{class:{"text-primary":t.showCheck,"text-disable":!t.showCheck},attrs:{icon:"&#xe939;",text:t.showCheck?"取消多选":"多选"},on:{click:function(e){return t.onShowCheck()}}}),a("tool",{staticClass:"text-primary",class:{"text-primary":t.selectItems.length>1,"text-disable":!(t.selectItems.length>1)},attrs:{text:"比较数据",title:"开启行号，选择多条记录进行比较",icon:"&#xe624;",disabled:t.selectItems.length<1},on:{click:function(e){return t.$refs.dialogDiff.show(t.selectItems)}}}),a("span",{staticClass:"vr mx-2"}),a("span",{staticClass:"tool",class:{"text-success":t.service.result,"text-error":!t.service.result},staticStyle:{cursor:"default"}},[t._v(t._s(t.service.resultText)+" "),""!=t.service.resultText&&t.worTypeText?a("span",[t._v(" ("+t._s(t.worTypeText)+") ")]):t._e()]),a("div",{staticClass:"empty"}),t.xgridData.length>0?a("tool",{staticClass:"text-primary",attrs:{text:"异步导出",icon:"&#xe62f;"},on:{click:t.onExport}}):t._e(),t.xgridData.length>0?a("tool",{staticClass:"text-primary",attrs:{text:"全屏",title:"全屏",icon:"&#xe6f7;"},on:{click:t.maximizeHandle}}):t._e(),a("tool-column")],1),t.xgridData.length>=0||t.service.loading?a("div",{staticClass:"table-scrollbar",style:{height:t.tabHeight}},[a("vxe-grid",{ref:"xGrid",attrs:{border:"",resizable:"",height:"auto",width:"auto","highlight-hover-row":"",stripe:"","auto-resize":"","show-header-overflow":"title","show-overflow":"title","edit-config":t.editConfig,"checkbox-config":{trigger:"cell",highlight:!0,range:!0},data:t.xgridData,"header-cell-style":{"font-size":t.fontSize+"px"},"cell-style":{"font-size":t.fontSize+"px"},"seq-config":{startIndex:t.startIndex},loading:t.service.loading},on:{"checkbox-change":t.onCheckSelected,"checkbox-all":t.onCheckSelectedAll,"cell-click":t.onCellClick,"cell-dblclick":t.onCellDbClick,"edit-actived":t.onCellActived,"edit-closed":t.onCellClosed}},[t.showCheck?a("vxe-table-column",{attrs:{type:"checkbox",field:"vxe__checkbox",width:"40px",fixed:"left"}}):t._e(),t.showLine?a("vxe-table-column",{attrs:{type:"seq",field:"vxe__no",width:"60px",title:"No.",fixed:"left"}}):t._e(),t._l(t.filterHead,(function(e,s){return a("vxe-table-column",{key:e.label+"-"+s,attrs:{field:e.label,title:e.label,width:t.getWidth(e.label),"edit-render":{name:"input"}},scopedSlots:t._u([{key:"edit",fn:function(e){var s=e.row,n=e.column;return a("div",{staticClass:"table-edit-render"},[a("input",{directives:[{name:"model",rawName:"v-model",value:s[n.title],expression:"row[column.title]"}],staticClass:"vxe-custom-input",attrs:{type:"text"},domProps:{value:s[n.title]},on:{focus:function(e){return t.onEditRenderFocusOrBlur(e,s,n)},blur:function(e){return t.onEditRenderFocusOrBlur(e,s,n)},input:function(e){e.target.composing||t.$set(s,n.title,e.target.value)}}})])}},{key:"default",fn:function(s){var n=s.row,o=s.column;return[t.service.explain&&t.service.data&&"oracle"==t.service.data.dbType?a("pre",{staticClass:"vxe-cell--label vxe-cell-value data-xxxxxxxxxx",class:[n._XID_TYPE,n["_XID_TYPE_"+o.title]]},[t._v(t._s(n[e.label]))]):a("div",{staticClass:"vxe-cell--label vxe-cell-value data-xxxxxxxxxx",class:[n._XID_TYPE,n["_XID_TYPE_"+o.title]],domProps:{innerHTML:t._s(t.getCellValue(n[e.label]))}})]}}],null,!0)})}))],2)],1):a("div",{staticClass:"empty"},[t._v("查询结果")]),a("dialog-long-text",{ref:"dialogLongTextRef",on:{action:t.onLongTextAction}}),a("dialog-diff",{ref:"dialogDiff"}),a("dialog-effect",{ref:"dialogEffectRef",on:{action:t.onEffectAction}}),a("dialog-error",{ref:"dialogErrorRef",on:{action:t.onErrorAction}}),a("dialog-new-work",{ref:"dialogNewWorkRef",on:{action:t.onNewWorkAction}}),a("dialog-exec",{ref:"dialogExecRef",on:{runExec:t.onDialogExec,action:t.onEexecAction}}),a("dialog-export",{ref:"dialogExport"})],1)},n=[],o=a("b85c"),i=a("5530"),r=(a("a9e3"),a("4de4"),a("caad"),a("b64b"),a("07ac"),a("a434"),a("99af"),a("2ca0"),a("a15b"),a("2532"),a("ac1f"),a("1276"),a("d3b7"),a("2ef0")),l=a("2f62"),c=a("ec26"),u=a("96fa"),d=a("e31c"),p=a("a414"),f=a("1c01"),m=a("270c"),h=a("4ea6"),b=a("d7dc"),_=a("f9b1"),g=a("d0e2"),v=a("4706"),y=a("43f9"),w="_XID",S="row-type-update",E="column-type-update",k="row-type-insert",x="row-type-delete",T="<nil>",C=[2,4],O=["mysql","oracle","postgres"],D={name:"result-result",components:{DialogExport:y["default"],Tool:p["default"],ToolColumn:f["default"],DialogLongText:m["default"],DialogDiff:_["default"],DialogEffect:h["default"],DialogError:b["default"],DialogNewWork:g["default"],DialogExec:v["default"]},inject:["service"],props:{runTabId:{type:Number|String,default:function(){return null}}},computed:Object(i["a"])(Object(i["a"])({},Object(l["e"])(["sys","runList","selecedDB","dataBaseList","project","pageSize"])),{},{getCellValue:function(){return function(t){return Object(r["isString"])(t)?t.replaceAll(" ","&nbsp;"):t}},currentRun:function(){var t=this,e=this.runList.filter((function(e){return e.tabId==t.runTabId&&null!==t.runTabId&&"undefined"!=t.runTabId}));return e.length>0?e[0]:{}},hasExport:function(){return this.sys.asyn_export&&this.currentRun.hasAsynExport},isTableAllowEdit:function(){var t=this.service.execResult,e=this.service.auditResult,a=!t.work&&11==t.sql_type&&"table"==this.service.runParams.item_type&&t.table_name&&C.includes(t.table_rw)&&O.includes(e.db_type);return console.log("[computed] isTableAllowEdit: ",a),a},editConfig:function(){return this.isTableAllowEdit?{trigger:"dblclick",mode:"cell",autoClear:!1,showIcon:!0,showStatus:!0}:{autoClear:!1,showIcon:!1}},isAllowAdd:function(){return this.isTableAllowEdit&&!this.insertOrDeleteRowData.data&&!this.isEffectData},isAllowDelete:function(){return this.isTableAllowEdit&&!this.insertOrDeleteRowData.data&&!this.isEffectData&&this.selectItems.length>0},isEffectData:function(){var t=this.isTableAllowEdit&&this.effectData.rows&&Object.keys(this.effectData.rows).length>0;return t},disable:function(){return this.service.loading},notHasPrev:function(){return this.service.page<=0},notHasNext:function(){return!this.service.hasNext},worTypeText:function(){return!(!this.service.mode||!this.service.mode.mode)&&this.service.mode.mode},getWidth:function(){var t=this;return function(e){var a=t.service.colsWidth[e],s=a*t.fontSize/1.5;return s=Math.ceil(s)+10,"Mac"==window.os&&(s+=16),s}},filterHead:function(){var t=this.service.filterHead;return t}}),data:function(){return{submitLoading:!1,xgridData:[],currentSoftRoute:"",isAllowEdit:!0,longTextVisiable:!1,insertOrDeleteRowData:{},handleCancelEditReander:!1,multiRowOpend:!1,isEffect:!1,effectDataDefault:{type:"update",wheres:{},rows:{},oldRows:{}},tableInfo:{wheres:[],pks:[],columns:[]},activeEffect:{},effectData:{type:"update",wheres:{},rows:{},oldRows:{}},workTypes:{work:"工单查询",async:"异步查询",normal:""},startIndex:0,tableLoading:!1,tableToolbar:{perfect:!0,refresh:!0,zoom:!0,custom:!0,slots:{buttons:"toolbar_buttons"}},treeConfig:{toggleMethod:this.toggle},sizes:[10,20,50,100,500,1e3,2e3],showLine:!1,showCheck:!1,fontSize:13,selectItems:[],selectInfos:[],tabHeight:"200px",colMaxWidth:200,colMinWidth:50,cols:{}}},watch:{submitLoading:function(t){this.$bus.emit("workpace-loading",t)},"service.body":{handler:function(){var t=this,e=this.service.body,a=Object.values(e);this.$nextTick((function(){try{t.startIndex=t.service.cli_page*t.service.size}catch(e){t.startIndex=0}t.resize()})),this.clearEffectDataAndIsEffect(),this.clearOrCheck();var s=this.service.auditResult;O.includes(s.db_type)&&this.setEffectDataWhere(!0),this.reSetSoftRoute(),0!=this.service.affected_rows&&a?this.xgridData=a:this.xgridData=[]}}},mounted:function(){this.resize()},methods:{onExport:function(){var t=this,e=this.service.runSql,a=this.service.auditResult,s={dbType:a.db_type,owner:a.owner,iid:a.iid,single_script:e};this.$refs.dialogExport.show((function(e){t.service.onRunAsync(Object(i["a"])(Object(i["a"])({},e),s)).then((function(e){e&&e.error?t.$message.error({title:"请求失败",message:e.error,type:"error",duration:4e3}):t.$bus.emit("runExport")})).catch((function(e){t.$message.error({title:"请求失败",message:e?e.error:e,type:"error",duration:4e3})}))}),{sql:e})},reSetSoftRoute:function(){this.service.runSql&&(this.currentSoftRoute=d["a"].getSoftRoute(this.service.runSql))},onSubmit:function(){this.submitLoading=!0,console.log(this.effectData,this.activeEffect),console.log("表信息：",this.tableInfo),this.submitInsertOrDeleteEffectData()},onCancel:function(t){this.submitLoading=!1,"insert"==this.effectData.type?this.xgridData.splice(this.insertOrDeleteRowData.index+1,1):"update"==this.effectData.type&&this.cancelRestoreEffectData(),this.clearEffectDataAndIsEffect(),this.clearOrCheck()},clearOrCheck:function(t){var e=this.$refs.xGrid;e.clearCheckboxRow(),e.clearCheckboxReserve(),this.selectItems=[],this.selectInfos=[],t&&t.row&&(console.log("选中：",t),e.setCheckboxRow(t.row,!0),this.selectItems=[t.row],this.selectInfos=[{columnIndex:t.columnIndex,rowIndex:t.rowIndex}])},addRow:function(t){this.isEffectData&&(console.log("[result.result.vue] #addRow() 还原数据"),this.onCancel());var e=0,a=null;if(this.selectInfos.length>0){if(e=this.selectInfos[this.selectInfos.length-1].rowIndex,console.log(this.selectInfos[this.selectInfos.length-1].rowIndex),a=JSON.parse(JSON.stringify(this.xgridData[e])),delete a._XID,delete a._XID_VUE_UUID_,t)this.activeEffect={row:a,column:{}};else for(var s in a)a[s]=T;a._XID_VUE_UUID_=Object(c["a"])(),a._XID_TYPE=k,a._XID_IS_INSERT=!0,this.insertOrDeleteRowData={type:"insert",index:e,data:a},console.log("row 插入数据：",a),this.effectData.type="insert",this.effectData.oldRows[a._XID_VUE_UUID_]={},this.$set(this.effectData.rows,a._XID_VUE_UUID_,a),this.xgridData.splice(this.insertOrDeleteRowData.index+1,0,this.insertOrDeleteRowData.data)}else{for(var n in console.log(this.filterHead),a={},a._XID_VUE_UUID_=Object(c["a"])(),a._XID_TYPE=k,a._XID_IS_INSERT=!0,this.filterHead){var o=this.filterHead[n];a[o.label]=T}this.insertOrDeleteRowData={type:"insert",index:-1,data:a},this.effectData.type="insert",this.effectData.oldRows[a._XID_VUE_UUID_]={},this.$set(this.effectData.rows,a._XID_VUE_UUID_,a),this.xgridData.splice(this.insertOrDeleteRowData.index+1,0,this.insertOrDeleteRowData.data)}this.clearOrCheck({row:a,columnIndex:0,rowIndex:e+1})},deleteRow:function(){this.isEffectData&&this.onCancel();var t=0;if(this.selectInfos.length>0){t=this.selectInfos[this.selectInfos.length-1].rowIndex;var e=this.xgridData[t];if(e._XID_TYPE==k)return void this.xgridData.splice(t,1);this.$set(this.xgridData[t],"_XID_TYPE",x),this.insertOrDeleteRowData={type:"delete",index:t,data:e},this.activeEffect={row:e,column:{}},console.log("[deleteRow] this.activeEffect: ",this.activeEffect,this.selectInfos.length),this.effectData.type="delete",this.effectData.oldRows[e._XID_VUE_UUID_]=e,this.$set(this.effectData.rows,e._XID_VUE_UUID_,e)}else this.$message.error("请选择行后再删除！")},onCellClick:function(t){t.$event.stopPropagation();var e=this.$refs.xGrid;e.isCheckedByCheckboxRow(t.row)||(e.clearCheckboxRow(),e.clearCheckboxReserve(),e.setCheckboxRow(t.row,!0),this.selectItems=[t.row],this.selectInfos=[{columnIndex:t.columnIndex,rowIndex:t.rowIndex}])},onCheckSelected:function(t){t.$event.stopPropagation(),console.log("[#onCheckSelected()]选中的数据: ",t);var e=t.selection;this.selectItems=e,t.checked?this.selectInfos.push({rowIndex:t.rowIndex,columnIndex:t.columnIndex}):this.selectInfos=this.selectInfos.filter((function(e){return e.rowIndex!=t.rowIndex})),console.log("选中的数据: 2",this.selectItems)},onCheckSelectedAll:function(t){console.log("选中全部.: ",t);var e=t.selection;this.selectItems=e},onNext:function(t){this.service.onNext(!!t)},onPre:function(){this.service.onPre()},pageSizeChangeHandle:function(t){this.service.setSize(t)},clean:function(){this.service.clean()},maximizeHandle:function(){this.$message({message:"Esc键退出全屏",type:"success"}),this.$refs.xGrid.maximize()},calculateWidth:function(t){return t.length/1.2*this.fontSize},onLongTextAction:function(t){if("submit-effect"==t.type){if(t.data!=t.row[t.key]){var e=this.effectData.rows,a=e[t.row._XID_VUE_UUID_]||{};this.$set(e,t.row._XID_VUE_UUID_,Object(i["a"])({},a)),e[t.row._XID_VUE_UUID_][t.key]=t.data;var s=this.xgridData.filter((function(e){return e._XID_VUE_UUID_==t.row._XID_VUE_UUID_}));this.$set(s[0],t.key,t.data)}this.$refs.xGrid.clearActived()}else"visiable"==t.type&&(this.longTextVisiable=t.data)},onErrorAction:function(t){console.log("错误关闭：",t)},onNewWorkAction:function(t){"submit"==t?this.onCancel():this.submitLoading=!1},onEexecAction:function(t){"close"==t.type&&0==t.submit&&(this.submitLoading=!1)},onEffectAction:function(t){this.effectData=JSON.parse(JSON.stringify(this.effectDataDefault)),this.$bus.emit("index-result-run",{runTabId:this.runTabId,sql:t})},onCellActived:function(t){var e=t.row,a=t.column,s=this.activeEffect.row;console.log("编辑验证: ",s&&s._XID,e._XID,this.insertOrDeleteRowData),console.log("编辑数据：",e,a),this.insertOrDeleteRowData&&"delete"==this.insertOrDeleteRowData.type&&this.insertOrDeleteRowData.data._XID==e._XID||"insert"!=this.effectData.type&&s&&s._XID!=e._XID?this.onCancel():!this.insertOrDeleteRowData||"insert"!=this.insertOrDeleteRowData.type&&"delete"!=this.insertOrDeleteRowData.type||this.insertOrDeleteRowData.data._XID==e._XID||this.onCancel(),this.handleCancelEditReander=!1,e._XID_TYPE&&e._XID_TYPE!=S||(e._XID_TYPE=S,e["_XID_TYPE_"+a.title]=E),this.effectData.oldRows[e._XID_VUE_UUID_]||(this.effectData.oldRows[e._XID_VUE_UUID_]=Object(i["a"])({},e)),this.activeEffect={row:e,column:a},this.isEffect=!0},onCellClosed:function(t){var e=t.row,a=t.column;if(this.handleCancelEditReander)this.handleCancelEditReander=!1;else{var s=this.effectData.oldRows,n=this.effectData.oldRows[e._XID_VUE_UUID_],r=n[a.title],l=e[a.title];console.log("原值&修改后的值: 原值：".concat(r,", 修改后：").concat(l));var c=this.effectData.rows;if(l==r)delete e["_XID_TYPE_"+a.title],c[e._XID_VUE_UUID_]&&Object.keys(c[e._XID_VUE_UUID_]).length>0&&delete c[e._XID_VUE_UUID_][a.title],c[e._XID_VUE_UUID_]&&0!=Object.keys(c[e._XID_VUE_UUID_]).length||delete s[e._XID_VUE_UUID_];else if(r!=l){var u=c[e._XID_VUE_UUID_]||{};this.$set(c,e._XID_VUE_UUID_,Object(i["a"])({},u)),c[e._XID_VUE_UUID_][a.title]=l;var d=this.tableInfo.wheres,p=this.effectData.wheres[e._XID_VUE_UUID_];if(!p){p={};var f,m=Object(o["a"])(d);try{for(m.s();!(f=m.n()).done;){var h=f.value;p[h]=n[h]}}catch(b){m.e(b)}finally{m.f()}this.effectData.wheres[e._XID_VUE_UUID_]=p}}this.isEffect=this.calculateHasEffect()}},calculateHasEffect:function(){return!!(this.effectData.rows&&Object.keys(this.effectData.rows).length>0)&&(this.isEffect=!0,!0)},clearEffectDataAndIsEffect:function(t){if(t){if("delete"==this.effectData.type){this.xgridData.splice(this.insertOrDeleteRowData.index,1),this.selectItems=[],this.selectInfos=[];var e=this.$refs.xGrid;e.clearCheckboxRow(),e.clearCheckboxReserve()}for(var a in this.activeEffect.row)a.startsWith("_XID_TYPE_")&&delete this.activeEffect.row[a];return this.activeEffect.row._XID_TYPE="",this.activeEffect={},this.insertOrDeleteRowData={},this.effectData=JSON.parse(JSON.stringify(this.effectDataDefault)),this.isEffect=!1,!0}if(this.activeEffect&&this.activeEffect.row&&this.activeEffect.row._XID_TYPE)this.activeEffect.row._XID_TYPE="";else{var s=this.selectInfos[this.selectInfos.length-1]&&this.selectInfos[this.selectInfos.length-1].rowIndex,n=this.xgridData[s];n&&(n._XID_TYPE="")}this.insertOrDeleteRowData={},this.effectData=JSON.parse(JSON.stringify(this.effectDataDefault)),this.isEffect=!1},cancelRestoreEffectData:function(){this.submitLoading=!1;var t=this.service.body,e=this.effectData.oldRows,a=this.effectData.rows;if("insert"==this.effectData.type)return console.log("[cancelRestoreEffectData] 还原insert"),!0;if("delete"==this.effectData.type)return console.log("[cancelRestoreEffectData] 还原delete"),!0;if(Object.keys(a).length>0)for(var s in a){var n=e[s],o=a[s],i=t[s];for(var r in o)i[r]=n[r],i._XID_TYPE="",i["_XID_TYPE_"+r]=""}},onEditRenderFocusOrBlur:function(t,e,a){this.longTextVisiable||"blur"!=t.type||this.$refs.xGrid.clearActived()},submitInsertOrDeleteEffectData:function(){var t=this.activeEffect.row;if(!t||!t._XID_TYPE)return this.submitLoading=!1,"insert"==this.effectData.type?(this.$message.error("请完善插入行信息"),!1):(console.error("[submitInsertOrDeleteEffectData] 参数错误：",this.activeEffect,this.effectData),this.$message.error("参数错误"),!1);t._XID_TYPE==k||t._XID_TYPE==x||t._XID_TYPE==S?this.confirmEffectData():(console.error("[submitInsertOrDeleteEffectData] 参数错误：",this.activeEffect,this.effectData),this.$message.error("未知错误"))},confirmEffectData:function(){var t=this.activeEffect.row;if(t._XID_TYPE!=k){var e=null,a=this.tableInfo.pks,s=this.effectData.oldRows[t._XID_VUE_UUID_],n=[];if(t._XID_TYPE!=k&&0==a.length)e="当前表未设置主键，是否继续操作？";else{var i,r=Object(o["a"])(a);try{for(r.s();!(i=r.n()).done;){var l=i.value;t._XID_TYPE==k||Object.prototype.hasOwnProperty.call(s,l)||n.push(l)}}catch(p){r.e(p)}finally{r.f()}n.length>0&&(e="当前结果集缺失主键: ".concat(n.join(","),"，是否继续操作？"))}if(null!==e){var c=[],u=this.tableInfo.allColumns;for(var d in s)u.includes(d)&&c.push(d);this.submitEffectData(c,e)}else this.submitEffectData(this.tableInfo.pks)}else this.submitEffectData()},submitEffectData:function(t,e){var a=this,s=this.activeEffect,n=s.row,r=s.column,l="update";l=n._XID_TYPE&&n._XID_TYPE.split("-")[2];var c=this.effectData.oldRows[n._XID_VUE_UUID_];if(n._XID_TYPE!=k&&n._XID_TYPE!=x||(c=this.effectData.rows[n._XID_VUE_UUID_]),c[r.title]==n[r.title]&&n._XID_TYPE==S)return this.$message.warning("没有更改数据!"),this.isEffect=!1,void(this.submitLoading=!1);var u={};if(u[n._XID_VUE_UUID_]={},n._XID_TYPE==k)for(var p in c)p.startsWith(w)||(u[n._XID_VUE_UUID_][p]=c[p]);else n._XID_TYPE==x||n._XID_TYPE==S&&(u[n._XID_VUE_UUID_]=Object(i["a"])({},this.effectData.rows[n._XID_VUE_UUID_]));console.log("rowsParams:",u,Object.keys(c));var f=t||this.tableInfo.wheres,m={},h={};console.log("wheres: ",f);var b,_=Object(o["a"])(f);try{for(_.s();!(b=_.n()).done;){var g=b.value;m[g]=c[g]}}catch(E){_.e(E)}finally{_.f()}h[n._XID_VUE_UUID_]=m;var v=[];v=d["a"].generateEffects(this.service.execResult.table_name,u,h,l),console.log("sqls: ",v);var y=v.join("\n");this.auditSql(y).then((function(t){var s=t.spend,n=t.data;n.error?a.$refs.dialogErrorRef.show({title:"SQL审计错误",sql:y,error:n.error,spend:s}):n.audit_work?a.$confirm("此操作必须通过工单执行，是否继续?","提示",{confirmButtonText:"提交工单",cancelButtonText:"取消",type:"warning"}).then((function(){a.onWork(Object(i["a"])(Object(i["a"])({},a.service.data),{},{script:y}),n)})):a.$refs.dialogExecRef.show(Object(i["a"])(Object(i["a"])(Object(i["a"])({},a.service.data),n),{},{script:"",sql:y}),n,{sql:y},e)})).finally((function(){a.submitLoading=!1}))},auditSql:function(t){var e=this.service.auditResult,a={iid:e.db_id,sql:t,project:this.project.id,encrypt_flag:!1,owner:e.owner,db_type:e.db_type,dbType:e.db_type,token:null};return Object(u["a"])(a)},onDialogExec:function(t){var e=this,a=t.au,s=t.params;this.execSql(Object(i["a"])(Object(i["a"])({},a),{},{sql:s.sql})).then((function(t){t.error?e.$refs.dialogErrorRef.show({title:"SQL执行错误",sql:s.sql,error:t.error,spend:t.spend}):(e.$message.success("数据编辑成功！"),e.clearEffectDataAndIsEffect(!0),e.onCancel())}))},execSql:function(t){var e=this.service.auditResult,a={item_type:this.service.itemType,atk:t.atk,iid:e.db_id,project:this.project.id,sql:t.sql,encrypt_flag:!1,owner:e.owner,db_type:e.db_type,token:t.token};return Object(u["b"])(a)},onWork:function(t){var e={data:t,project:this.project,dataBaseList:this.dataBaseList,selecedDB:this.selecedDB};this.$refs.dialogNewWorkRef.show(e)},setEffectDataWhere:function(t){var e=this;console.log("setEffectDataWhere");var a=this.service.runParams;if(0==Object.keys(a).length)return!1;this.tableInfo.wheres=[],this.tableInfo.pks=[],this.tableInfo.columns=[],this.tableInfo.allColumns=[];var s=this.service.auditResult,n=this.service.execResult;console.log("表结构： params",Object.keys(a).length,s),this.$api.table.info({id:s.db_id,dbType:s.db_type},s.owner,n.table_name,"struct",a.item_type).then((function(t){if(t&&Array.isArray(t)&&t.length>0){var a,n=[],i=[],r=[],l=Object(o["a"])(t);try{for(l.s();!(a=l.n()).done;){var c=a.value;if("mysql"==s.db_type)"PRI"==c["索引"]?n.push(c["名字"]):i.push(c["名字"]),r.push(c["名字"]);else if("oracle"==s.db_type)"PK"==c.KEY?n.push(c.FIELD):i.push(c.FIELD),r.push(c.FIELD);else{if("postgres"!=s.db_type)return e.$message.error("".concat(s.db_type,"类型数据库未支持修改结果集")),!1;console.log("postgres: ",c),"YES"==c.pk?n.push(c.field):i.push(c.field),r.push(c.field)}}}catch(d){l.e(d)}finally{l.f()}var u=n&&n.length>0?n:i;window.$log.dev("表索引：",n,u),e.tableInfo.wheres=u,e.tableInfo.pks=n,e.tableInfo.columns=i,e.tableInfo.allColumns=r}})).finally((function(){}))},onCellDbClick:function(t){var e=t.row,a=t.column,s=this.filterHead.filter((function(t){return t.label==a.title}))[0],n=e[a.title];if(n){var o=n.length,r=n.includes("\\")||n.includes("\n")||n.includes("\t")||n.includes("\b")||n.includes("Z")||n.includes("\r");(o>=20||r)&&this.$refs.dialogLongTextRef.show(Object(i["a"])({},e),a.title,s.type)}},resize:function(){var t=this.$refs["ref-result"];if(t){var e=t.offsetHeight;this.tabHeight=e-38+"px"}},indexMethod:function(t){return 0==t?"#":t+this.service.cli_page*this.service.size},onShowLine:function(){this.showLine=!this.showLine},onShowCheck:function(){this.showCheck=!this.showCheck},onChangeFontSize:function(t){t?this.fontSize=this.fontSize+1:this.fontSize>3&&(this.fontSize=this.fontSize-1),console.log("改变字体大小：",this.fontSize)}}},A=D,L=(a("7662"),a("9d75"),a("2877")),R=Object(L["a"])(A,s,n,!1,null,"da4787e6",null);e["default"]=R.exports},"23f3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"role-permission-list"},[a("k-card",{attrs:{head:t.head}},[a("k-search-table",{ref:"st",attrs:{manual:!0,data:t.dataList,page:!1}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"primary",size:"small",disabled:t.isDis},on:{click:function(e){return t.$refs.tableDialog.show()}}},[t._v("新增权限")]),a("el-button",{attrs:{type:"success",size:"small",disabled:t.isDis},on:{click:function(e){return t.$refs.columDialog.show()}}},[t._v("新增脱敏")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"授权表",prop:"tname"}}),a("el-table-column",{attrs:{label:"脱敏字段",prop:"tcol"}}),a("el-table-column",{attrs:{label:"内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.tcol?a("div"):a("div",[1==e.row.rw?a("span",{staticClass:"auth-read"},[t._v("只读")]):2==e.row.rw?a("span",{staticClass:"auth-write"},[t._v("读写")]):4==e.row.rw?a("span",{staticClass:"auth-manage"},[t._v("管理")]):a("span",{staticClass:"auth-disable"},[t._v("禁止")])])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.onEdit(e.row)}}},[t._v("编辑")]),a("k-btn-tip",{on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{attrs:{type:"danger",size:"mini"}},[t._v("删除")])],1)]}}])})],1)],2)],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("a15b"),a("ac1f"),a("841c"),{data:function(){return{search:{},dataList:[]}},computed:{isDis:function(){return!this.role.id||!this.db.id},head:function(){var t=[];return this.role&&t.push(this.role.name),this.db&&t.push(this.db.name),t.push("权限列表"),t.join(" - ")}},props:{role:{},db:{}},watch:{role:"refresh",db:"refresh"},methods:{refresh:function(){var t=this;this.role.id&&this.db.id&&(this.search.roleId=this.role.id,this.search.dbId=this.db.id,this.$api.permission.allTable(this.search).then((function(e){t.dataList=e})))},onDel:function(t){var e=this;this.$api.post("/api/role/permission/remove",{id:t.id}).then((function(){e.onSuccess("删除成功"),e.refresh()}))},onEdit:function(t){this.$refs.editDialog.show(Object(o["a"])({},t))}}}),r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"24da":function(t,e,a){},2506:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"log-page",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"数据库"}},[a("el-input",{attrs:{placeholder:"数据库名称",clearable:""},model:{value:t.search.owner,callback:function(e){t.$set(t.search,"owner",e)},expression:"search.owner"}})],1),a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{prop:"ip",label:"ip"}},[a("el-input",{attrs:{placeholder:"请输入ip",clearable:""},model:{value:t.search.ip,callback:function(e){t.$set(t.search,"ip",e)},expression:"search.ip"}})],1),a("el-form-item",{attrs:{prop:"script",label:"脚本"}},[a("el-input",{attrs:{placeholder:"请输入脚本",clearable:""},model:{value:t.search.script,callback:function(e){t.$set(t.search,"script",e)},expression:"search.script"}})],1),a("el-form-item",{attrs:{label:"项目:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.projects,callback:function(e){t.$set(t.search,"projects",e)},expression:"search.projects"}},t._l(t.projects,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"开始时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.start_time)))])]),a("el-form-item",{attrs:{label:"结束时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.end_time)))])]),a("el-form-item",{staticClass:"row",attrs:{label:"数据库"}},[a("span",[t._v(t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】")])]),a("el-form-item",{attrs:{label:"IP"}},[a("span",[t._v(t._s(e.row.ip))])]),a("el-form-item",{attrs:{label:"行数"}},[a("span",[t._v(t._s(e.row.data_count))])])],1),a("el-form",{staticClass:"demo-sql-expand",attrs:{"label-position":"left"}},[a("el-form-item",{attrs:{label:"SQL"}},[a("pre",[t._v(t._s(e.row.script))])])],1)]}}])}),a("el-table-column",{attrs:{prop:"user_name",label:"操作人",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{placement:"top",content:e.row.user_name}},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.quickSearch("user_name",e.row.user_name)}}},[t._v(" "+t._s(e.row.user_name)+"("+t._s(e.row.real_name)+") ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"db_type",label:"库类型",width:"80"}}),a("el-table-column",{attrs:{prop:"db_name",label:"数据库",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】 ")]}}])}),a("el-table-column",{attrs:{prop:"start_time",label:"开始时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.start_time))+" ")]}}])}),a("el-table-column",{attrs:{prop:"end_time",label:"结束时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.end_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"耗时(ms)",prop:"exec_time",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("showTime")(e.row.exec_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"项目",prop:"project_name",width:"100"}}),a("el-table-column",{attrs:{prop:"ip",label:"ip",width:"100"}}),a("el-table-column",{attrs:{label:"状态",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v("成功")]):0==e.row.state?a("span",{staticClass:"text-info"},[t._v("查询中")]):a("el-tooltip",{attrs:{content:e.row.result,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("失败")])])]}}])}),a("el-table-column",{attrs:{label:"行数",width:"80",prop:"data_count"}}),a("el-table-column",{attrs:{label:"类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.toType(e.row.type))+" ")]}}])}),a("el-table-column",{attrs:{label:"脚本","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"nowrap-sricpt",attrs:{title:e.row.script}},[t._v(t._s(e.row.script))])]}}])})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{projects:[],instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行时间倒序(默认)"},{k:1,v:"按执行时间顺序"},{k:2,v:"按耗时由高到低"},{k:3,v:"按行数由多到少"}],types:[{k:0,v:"全部"},{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:15,v:"管理"},{k:99,v:"其他"}],search:{projects:[],ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),props:{},watch:{},methods:{quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={projects:[],ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":15==t?"管理":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e})),this.$api.post("/api/project/all").then((function(e){t.projects=e}))}},u=c,d=(a("1485"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},2517:function(t,e,a){"use strict";a("8a3b")},"25a0":function(t,e,a){},"25ce":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-log",use:"d2-log-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-log"><path d="M128 640v-256H64v256h64zM192 256H0v64h192V256zM128 64h704v278.4c22.4 6.4 44.8 19.2 64 28.8V0H64v192h64V64z m608 416h-64v256h192v-64h-128v-192z m-32-96c-176 0-320 144-320 320s144 320 320 320 320-144 320-320-144-320-320-320z m0 576c-140.8 0-256-115.2-256-256s115.2-256 256-256 256 115.2 256 256-115.2 256-256 256zM128 960v-128H64v192h428.8c-28.8-19.2-51.2-38.4-73.6-64H128z m64-256H0v64h192v-64z" fill="" p-id="24460" /></symbol>'});i.a.add(r);e["default"]=r},"264c":function(t,e,a){"use strict";a("0241")},"26dd":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"database padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/project/db/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"数据源类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源",prop:"name"}}),a("el-table-column",{attrs:{label:"类型",prop:"db_type"}}),a("el-table-column",{attrs:{label:"启用"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 ")]):a("span",{staticClass:"text-warn"},[t._v(" 否 ")])]}}])}),a("el-table-column",{attrs:{label:"连接状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("div",[3==e.row.con_state?a("el-tooltip",{attrs:{content:e.row.err_msg,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("连接失败")])]):2==e.row.con_state?a("span",{staticClass:"text-success"},[t._v("已连接")]):1==e.row.con_state?a("span",{staticClass:"text-info"},[t._v("连接中")]):a("span",{staticClass:"text-info"},[t._v("未连接")])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"读写"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.oper_type?a("span",{staticClass:"text-success"},[t._v("只读")]):a("span",{staticClass:"text-error"},[t._v("读写")])]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])})],1)],2)],1)},n=[],o=a("5530"),i=a("2909"),r=(a("99af"),a("a15b"),a("ac1f"),a("841c"),a("2f62")),l={data:function(){return{ids:"",id:this.$route.params.id,search:{project:this.$route.params.id,rel_type:1},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],db_types:[{label:"全部",value:""}].concat(Object(i["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]))}},computed:Object(o["a"])({},Object(r["e"])(["user","project_home"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={rel_type:1},this.search.project=this.id},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},openWork:function(t){this.$refs.workDialog.show(t)},onSyncDB:function(t){var e=this;this.$api.project.syncDB(this.id,t.id).then((function(t){e.onSuccess(t),e.refresh()}))}}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},2705:function(t,e,a){"use strict";a("8d9d")},2708:function(t,e,a){"use strict";a("b0c0"),a("99af");e["a"]={methods:{dispatch:function(t,e){var a=this.$parent||this.$root,s=a.$options.name;while(a&&(!s||s!==t))a=a.$parent,a&&(s=a.$options.name);if(a){for(var n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];a.$emit.apply(a,[e].concat(o))}}}}},"270c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"dialog-longtext",attrs:{title:"编辑",visible:t.isShow,width:"85%"},on:{"update:visible":function(e){t.isShow=e},open:function(e){return t.onVisiable(!0)},opened:t.onOpened,close:function(e){return t.onVisiable(!1)}}},["blob"==t.type?a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"text"}},[a("pre",{staticStyle:{height:"400px","overflow-y":"scroll","word-break":"break-all",border:"1px solid #72767b","font-size":"12px",padding:"5px",width:"100%","word-wrap":"normal"},attrs:{id:"longtext"}},[t._v("    "+t._s(t.b2s(t.text))+"\n        ")])]),a("el-tab-pane",{attrs:{label:"image"}},[a("img",{staticStyle:{width:"100%"},attrs:{src:"data:image/png;base64,"+t.text,alt:"Red dot"}})]),a("el-tab-pane",{attrs:{label:"hex"}},[a("pre",{staticStyle:{height:"400px","overflow-y":"scroll","word-break":"break-all",border:"1px solid #72767b","font-size":"12px",padding:"5px",width:"100%","word-wrap":"normal"},attrs:{id:"longtext",contenteditable:"true"}},[t._v("        "+t._s(t.s2b(t.text))+"\n      ")])])],1):a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],ref:"focusRef",staticStyle:{color:"black","font-weight":"700",height:"400px","overflow-y":"scroll","word-break":"break-all",border:"1px solid #72767b","font-size":"12px",padding:"5px",width:"100%","word-wrap":"normal"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:t.submit}},[t._v("确定")])],1)],1)},n=[],o=a("812c"),i=o["a"],r=(a("de77"),a("edc8"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"5e45e75a",null);e["default"]=l.exports},2711:function(t,e,a){"use strict";a("2dc6")},2766:function(t,e,a){"use strict";a("c6fd")},2858:function(t,e,a){},"28a1":function(t,e,a){},"28c3":function(t,e,a){"use strict";a("588f")},2971:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据表"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新 ")])],1),a("div",{staticClass:"role-table-list"},[a("el-tree",{ref:"tableList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据库","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between",on:{click:function(e){return t.onClick(s)}}},[a("div",{staticClass:"left flex-over"},[a("span",[t._v(t._s(s.name))])])])}}])})],1)],2)},n=[],o=(a("4de4"),a("b0c0"),a("d3b7"),{data:function(){return{cur_name:"",filterText:"",loading:!1,dataList:[],treeProps:{id:"id",label:"name",isLeaf:"leaf"}}},props:{db:{},owner:{}},watch:{db:"refresh",owner:{deep:!0,handler:"refresh"},filterText:function(t){this.$refs.tableList.filter(t)}},methods:{filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.db.id&&this.owner.id?(this.dataList=[],this.loading=!0,this.$api.auto.tree(this.db.id,"".concat(this.owner.label,"."),!0,!1,null).then((function(e){t.dataList=e})).finally((function(){t.loading=!1}))):this.dataList=[]},onClick:function(t){this.cur_name=t.name,this.$emit("table",t)}}}),i=o,r=(a("374f"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"29bf":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-mysql-edit"},[a("div",{staticStyle:{padding:"4px 8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onAddField()}}},[t._v("新增索引")])],1),a("el-table",{attrs:{size:"mini",data:t.dataList}},[t._l(t.head,(function(e,s,n){return[-1==t.ignreColumns.indexOf(s)?a("el-table-column",{key:n,attrs:{label:s,prop:s},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.add&&t.tableEdit[s]?a("div",["input"==t.tableEdit[s].type?a("el-input",{attrs:{size:"mini"},model:{value:n[s],callback:function(e){t.$set(n,s,e)},expression:"row[k]"}}):"select"==t.tableEdit[s].type?a("el-select",{attrs:{size:"mini"},model:{value:n[s],callback:function(e){t.$set(n,s,e)},expression:"row[k]"}},[t._l(t.tableEdit[s].item,(function(e){return[e.values?a("el-option-group",{key:e.group,attrs:{label:e.group}},t._l(e.values,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1):a("el-option",{key:e,attrs:{label:e,value:e}})]}))],2):"field"==t.tableEdit[s].type?a("el-select",{attrs:{size:"mini",multiple:t.tableEdit[s].multi},model:{value:n[s],callback:function(e){t.$set(n,s,e)},expression:"row[k]"}},t._l(t.columns,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1):t._e()],1):a("span",[t._v(t._s(n[s]))])]}}],null,!0)}):t._e()]})),a("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.add?[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onSubmitField(e.row,e.$index)}}},[t._v("提交")]),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.onCancelField(e.row,e.$index)}}},[t._v("取消")])]:a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.onDropField(e.row,e.$index)}}},[t._v("删除")])]}}])})],2)],1)},n=[],o=a("5530"),i=(a("a434"),a("f17c")),r={data:function(){return{ignreColumns:["add"],dataList:[]}},inject:["db","owner"],computed:{head:function(){return this.dataList[0]||{}},tableEdit:function(){return i["default"][this.db.dbType].index},tableEditSchema:function(){return i["default"][this.db.dbType]}},props:{table:{type:String,default:""},type:{type:String,default:""}},watch:{table:function(){this.dataList=[],this.refresh()}},methods:{refresh:function(){var t=this;this.$api.table.info(this.db,this.owner.id,this.table,"indexs",this.type).then((function(e){t.dataList=e})),this.$api.auto.column(this.db.id,this.owner.id,this.table).then((function(e){t.columns=e}))},onSubmitField:function(t){this.$emit("submit",this.tableEditSchema.addIndex(this.table,t),this.refresh)},onAddField:function(){var t=Object(o["a"])({},this.dataList[0]||{});for(var e in t)t[e]=null;t.add=!0,this.dataList.push(t)},onCancelField:function(t,e){this.dataList.splice(e,1)},onDropField:function(t,e){this.$emit("submit",this.tableEditSchema.dropIndex(this.table,t),this.refresh)}},components:{},mounted:function(){this.refresh()}},l=r,c=(a("e3b9"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"2a1d":function(t,e,a){},"2a32":function(t,e,a){"use strict";a("64b2")},"2a76":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"margin-top":"0"}},[t.isShow?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{"custom-class":"database-edit","close-on-click-modal":!1,title:t.id?"修改策略":"新增策略",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e},close:t.closeDialog}},[a("el-steps",{attrs:{active:t.step,"finish-status":"success"}},[a("el-step",{attrs:{title:"选择模板"}}),a("el-step",{attrs:{title:"选择目标"}}),a("el-step",{attrs:{title:"提交数据"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.step&&!t.id,expression:"step == 1 && !id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略类型"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dList",attrs:{data:t.dList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClickList(s)}}},[a("div",{staticClass:"left"},[a("span",[t._v(" "+t._s(s.name))])])])}}],null,!1,2334784127)})],1)],2)],1),a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略模板"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"typeList",attrs:{data:t.typeList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClickType(s)}}},[a("div",{staticClass:"left"},[a("span",[t._v(" "+t._s(s.name))])])])}}],null,!1,1697948677)})],1)],2)],1)],1),a("div",{staticClass:"dialog-footer ",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==t.step&&!t.id,expression:"step == 2 && !id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("db-list",{attrs:{headText:"数据源"},on:{db:t.onDb}})],1),a("el-col",{attrs:{span:8}},[a("owner-list",{ref:"ownerList",attrs:{headText:"数据库"},on:{owner:t.onOwner,refreshNext:t.refreshNext}})],1),a("el-col",{attrs:{span:8}},[a("table-list",{ref:"tabList",attrs:{db:t.selectDb,owner:t.selectOwner},on:{table:t.onTable}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"primary",disabled:t.has_disabled_step2()},on:{click:function(e){return t.goStep3()}}},[t._v("下一步")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3==t.step||t.id,expression:"step == 3 || id"}],staticClass:"role"},[a("k-card",{attrs:{head:"参数设定"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"100px"}},[a("div",{staticClass:"role-role-list"},[a("el-form-item",{attrs:{label:"策略名称"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{attrs:{label:"数据源"}},[a("el-tooltip",{attrs:{content:"数据源，* 代表所有数据源"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("db",t.tid)},model:{value:t.db_name,callback:function(e){t.db_name=e},expression:"db_name"}})],1)],1),a("el-form-item",{attrs:{label:"数据集"}},[a("el-tooltip",{attrs:{content:"数据集，* 代表所有数据集合"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("owner",t.tid)},model:{value:t.owner,callback:function(e){t.owner=e},expression:"owner"}})],1)],1),a("el-form-item",{attrs:{label:"数据表"}},[a("el-tooltip",{attrs:{placement:"top",content:"数据表，* 代表所有表，可以前后加*模糊匹配，只能设置1个表名"}},[a("el-input",{attrs:{size:"mini",disabled:t.has_display("table",t.tid)},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}})],1)],1)],1),t._l(t.tplList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.name}},[a("el-tooltip",{attrs:{placement:"top",content:e.tip}},["number"==e.type?a("el-input-number",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):t._e(),"params_select"==e.type?a("div",[a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.mustParamsConfigList,"show-header":!1}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择字段"},model:{value:s["param"],callback:function(e){t.$set(s,"param",e)},expression:"row['param']"}},t._l(t.columnsList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.label}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.mustParamsConfigList)}}},[t._v(" 移除 ")]):t._e(),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addParamRow()}}},[t._v(" 添加 ")])]}}],null,!0)})],1)],1)],1):"mask_code"==e.type?a("div",[a("el-radio-group",{on:{change:function(e){return t.changeMaskType()}},model:{value:t.mask.type,callback:function(e){t.$set(t.mask,"type",e)},expression:"mask.type"}},[a("el-radio",{attrs:{label:1}},[t._v("隐藏")]),a("el-radio",{attrs:{label:2}},[t._v("打码")]),a("el-radio",{attrs:{label:3}},[t._v("替换")])],1),1==t.mask.type?[a("el-form-item",{attrs:{label:"显示文字"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏后显示文字，可修改。",placement:"top"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{maxlength:20},model:{value:t.mask.hide_str,callback:function(e){t.$set(t.mask,"hide_str",e)},expression:"mask.hide_str"}})],1)],1)]:t._e(),2==t.mask.type?[a("el-form-item",{attrs:{label:"打码方式"}},[a("el-radio-group",{model:{value:t.mask.opt_type,callback:function(e){t.$set(t.mask,"opt_type",e)},expression:"mask.opt_type"}},[a("el-radio",{attrs:{label:1}},[t._v("两边打码")]),a("el-radio",{attrs:{label:2}},[t._v("中间打码")])],1)],1),a("el-form-item",{attrs:{label:"替换字符"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"打码的替换字符,默认*",placement:"top"}},[a("el-input",{attrs:{maxlength:1},model:{value:t.mask.opt_str,callback:function(e){t.$set(t.mask,"opt_str",e)},expression:"mask.opt_str"}})],1)],1),1==t.mask.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"前几位打码",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"前几位打码"},model:{value:t.mask.front,callback:function(e){t.$set(t.mask,"front",e)},expression:"mask.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"后几位打码",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"后几位打码"},model:{value:t.mask.end,callback:function(e){t.$set(t.mask,"end",e)},expression:"mask.end"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.mask.ignore,callback:function(e){t.$set(t.mask,"ignore",e)},expression:"mask.ignore"}})],1)],1):t._e(),2==t.mask.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"中间替换几位",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"中间替换几位"},model:{value:t.mask.front,callback:function(e){t.$set(t.mask,"front",e)},expression:"mask.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.mask.ignore,callback:function(e){t.$set(t.mask,"ignore",e)},expression:"mask.ignore"}})],1)],1):t._e()]:t._e(),3==t.mask.type?[a("el-form-item",{attrs:{label:"替换规则"}},[a("el-select",{model:{value:t.mask.maskCode,callback:function(e){t.$set(t.mask,"maskCode",e)},expression:"mask.maskCode"}},t._l(t.replaceRules,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)]:t._e()],2):"mask_val"==e.type?a("el-autocomplete",{staticClass:"inline-input val_mask_rule",attrs:{"fetch-suggestions":t.contentQuerySearch,placeholder:"请输入表达式"},on:{select:t.contentHandleSelect},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"label"},[t._v(t._s(e.item.label))])]}}],null,!0),model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}},[a("div",{attrs:{slot:"suffix"},slot:"suffix"},[a("i",{staticClass:"val_mask_rule_clear el-input__icon el-icon-circle-close pointer-active",staticStyle:{color:"red"},attrs:{title:"清空"},on:{click:function(a){t.formData[e.id]=""}}}),a("el-button",{staticStyle:{margin:"0 10px"},attrs:{title:"匹配测试",type:"danger",size:"mini",round:""},on:{click:function(e){return t.onSubmit("test")}}},[t._v("匹配测试")])],1)]):"radio"==e.type?a("el-radio-group",{model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}},t._l(e.radio,(function(e,s){return a("el-radio",{key:s,attrs:{label:e.value}},[t._v(t._s(e.text))])})),1):"checkbox"==e.type?a("el-checkbox",{model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):"textarea"==e.type?a("el-input",{attrs:{type:"textarea",rows:10,placeholder:e.placeholder},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):a("el-input",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}})],1)],1)}))],2)])],1)],2),a("div",{staticClass:"dialog-footer strategy-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"left"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.id,expression:"!id"}],on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"success"},on:{click:function(e){return t.onSubmit("submit")}}},[t._v("提交")])],1)])],1)],1):t._e(),a("diaolg-test",{ref:"testDialog"})],1)},n=[],o=(a("4de4"),a("b0c0"),a("d3b7"),a("a434"),a("99af"),a("7e57")),i=a("660b"),r=a("2971"),l=a("2e0b"),c=a("1f82"),u=a("782c"),d=a("1ae3"),p={data:function(){return{isEdit:!1,formData:{},match_type:"text",step:1,name:"",db_name:"*",owner:"*",tab:"*",db_id:"*",c_type:"",tid:"",rid:"",edit:!1,selectType:{},selectDb:{name:""},selectOwner:{},selectTable:{},selectTpl:{},isShow:!1,id:"",treeProps:{label:"name"},dList:u["default"],mustParamsConfigList:[],typeList:[],tplList:[],dataList:[],columnsList:[],mask:{type:1,maskCode:"101",hide_str:"(敏感信息,屏蔽显示)",opt_type:1,opt_str:"*",front:"1",end:"1",ignore:"",unique:!1,global:!1,ignore_case:!1,multi_line:!1,global_key:""},replaceRules:[{k:"301",v:"身份证"},{k:"302",v:"手机"},{k:"303",v:"姓名"},{k:"304",v:"地址"},{k:"305",v:"银行卡"},{k:"307",v:"价格"},{k:"308",v:"邮箱"},{k:"309",v:"ip地址"}],rules:[{label:"包含身份证",value:"(^|(?<=\\D))[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]($|(?=\\D))"},{label:"身份证",value:"^(\\d{6})(\\d{4})(\\d{2})(\\d{2})(\\d{3})([0-9]|X)$"},{label:"包含手机号码",value:"(^|(?<=\\D))1[3456789]\\d{9}($|(?=\\D))"},{label:"手机号码",value:"^1[3456789]\\d{9}$"},{label:"邮编",value:"^[0-9]{6}$"},{label:"包含邮箱",value:"[A-Za-z0-9]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z]+)+"},{label:"包含ip地址",value:"(?<=\\D)((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}($|(?=\\D))"},{label:"标准网页链接",value:"((http|ftp|https):\\/\\/)?[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%&amp;/~\\+#])?"}]}},methods:{contentHandleSelect:function(t){console.log(t)},contentQuerySearch:function(t,e){var a=this.rules,s=t?a.filter(this.createFilter(t)):a;e(s)},createFilter:function(t){return function(e){return!!e.label&&0===e.label.toLowerCase().indexOf(t.toLowerCase())}},changeMaskType:function(){switch(this.mask.type){case 1:this.mask.maskCode="101";break;case 2:this.mask.maskCode="201";break;case 3:this.mask.maskCode="301";break}},has_disabled_step2:function(){return"field_mask"!=this.tid&&"val_mask"!=this.tid&&("query_count"!=this.tid&&("mask_val"==this.tid?!(this.selectDb&&this.selectDb.name):!(this.selectTable&&this.selectTable.name)))},has_display:function(t,e){if("db"==t){if("query_count"==e)return!0;if("field_mask"==e)return!0}else if("owner"==t){if("query_count"==e)return!0;if("field_mask"==e||"mask_val"==e)return!0}else if("table"==t){if("query_count"==e)return!1;if("field_mask"==e||"mask_val"==e)return!1}return!0},getName:function(){var t="";return this.selectDb&&this.selectDb.name?(t=this.selectDb.name,this.selectOwner&&this.selectOwner.name?(t=t+"/"+this.selectOwner.name,this.selectTable&&this.selectTable.name?(t=t+"/"+this.selectTable.name,this.selectType&&this.selectType.name&&(t=t+"("+this.selectType.name+")")):t=t+"("+this.selectType.name+")"):t=t+"("+this.selectType.name+")"):t="全局("+this.selectType.name+")",t},initMustParamsConfigList:function(){console.log("initMustParamsConfigList"),this.mustParamsConfigList=[],this.mustParamsConfigList.push({param:""})},onClickList:function(t){console.log("data: ",t),this.c_type=t.id,this.typeList=t.c?t.c:[]},onClickTpl:function(t){this.selectTpl=t,this.step++,this.tplList=t.c?t.c:[]},onClickType:function(t){console.log("onClickType:",t),this.step++,this.selectType=t,this.tid=t.id,this.tplList=t.c?t.c:[],this.formData={}},onNext:function(){},refreshNext:function(){this.$refs.tabList.refresh()},onDb:function(t){console.log("onDb......",t.name,t.id),this.selectDb=t,this.db_name=t.name,this.db_id=t.id,this.selectOwner={},this.selectTable={},this.rid="",this.tab="*",this.$refs.ownerList.doRefresh(t)},onOwner:function(t){this.selectOwner=t,this.owner=t.name,this.selectTable={},this.rid="",this.tab="*"},onTable:function(t){this.selectTable=t,this.rid=this.selectTable.id,this.tab=t.name,this.LoadParams(),this.name=this.getName()},goStep3:function(){this.step=this.step+1,this.name=this.getName()},LoadParams:function(t){var e=this;if(this.selectDb&&this.selectDb.id)t={id:this.selectDb.id},this.selectOwner&&this.selectOwner.name&&(t.keyword="".concat(this.selectOwner.name,".")),this.selectTable&&this.selectTable.name&&(t.keyword+=this.selectTable.name);else if(!t||!t.id||!t.keyword)return console.warn("[继续执行] LoadParams 参数警告：",t,this.selectDb,this.selectOwner,this.selectTable);if(-1==t.keyword.indexOf("."))return console.warn("[继续执行] LoadParams 参数警告：",t);console.info("LoadParams 查询字段列表，参数：",t),this.$api.auto.tree(t.id,t.keyword,!0,!1,null).then((function(t){e.columnsList=t})).finally((function(){e.loading=!1}))},show:function(t,e){this.initDialog(t,e),this.isShow=!0},initDialog:function(t,e){t&&e?(this.isEdit=!!e,this.id=t.id,this.db_id=t.db_id,this.db_name=t.db_name,this.c_type=t.c_type,this.tid=t.tid,this.rid=t.rid,this.name=t.name,this.owner=t.owner,this.tab=t.tab,this.formData={},this.loadStrategy()):(this.step=1,this.id="",this.formData={},this.initMustParamsConfigList())},closeDialog:function(){Object.assign(this.$data,this.$options.data())},hide:function(){this.isShow=!1},deleteRow:function(t,e){e.splice(t,1)},addParamRow:function(){this.mustParamsConfigList.push({param:""})},loadStrategy:function(){var t=this;this.$api.strategy.info(this.id).then((function(e){if(""!=e&&e.config){t.formData=JSON.parse(e.config),"SELECT"==e.c_type?t.formData.must_param&&t.formData.must_param.length>0?t.mustParamsConfigList=t.formData.must_param:t.initMustParamsConfigList():"MASK"==e.c_type&&t.formData.mask&&(t.mask=t.formData.mask);for(var a=!1,s=0;s<t.dList.length&&!a;s++){var n=t.dList[s];if(n.id==e.c_type&&n.c)for(var o=0;o<n.c.length&&!a;o++){var i=n.c[o];if(i.id==e.tid){t.tplList=i.c?i.c:[],a=!0;break}}}var r={id:"*"==e.db_id?null:e.db_id};"*"==e.owner?r.keyword=null:"*"!=e.tab?r.keyword="".concat(e.owner,".").concat(e.tab):r.keyword="".concat(e.owner,"."),t.LoadParams(r)}else t.$message({message:"加载失败，请刷新再试！",type:"warning"})}))},onSubmit:function(t){var e=this;if(this.id){if(!this.id)return this.$message({message:"策略id不能为空",type:"warning"}),!1}else{if(!this.c_type)return this.$message({message:"模板不能为空",type:"warning"}),!1;if(!this.owner)return this.$message({message:"数据集不能为空",type:"warning"}),!1;if(!this.tab)return this.$message({message:"表名不能为空",type:"warning"}),!1;if(!this.db_id)return this.$message({message:"关联数据源不能为空",type:"warning"}),!1;if(!this.tid)return this.$message({message:"策略模板不能为空",type:"warning"}),!1}if(!this.name)return this.$message({message:"名称不能为空",type:"warning"}),!1;var a=this.formData;if("query_count"==this.tid&&a.user_count&&a.global_count){if(a.user_count=~~a.user_count,a.global_count=~~a.global_count,a.user_count>a.global_count)return this.$message({message:"用户并发查询不能大于全局并发查询",type:"warning"}),!1}else if("query_where"==this.tid)this.mustParamsConfigList&&this.mustParamsConfigList.length>0&&(a.must_param=this.mustParamsConfigList);else if("field_mask"==this.tid){if(a.mask=this.mask,a.mask_code=this.mask.maskCode,!a.field_mask)return this.$message({message:"脱敏字段不能为空",type:"warning"}),!1}else if("val_mask"==this.tid&&(a.mask=this.mask,a.mask_code=this.mask.maskCode,!a.val_regexp))return this.$message({message:"匹配表达式不能为空",type:"warning"}),!1;var s=JSON.stringify(a);if("test"==t)return console.log("脱敏测试的信息 - test：",a,s),void this.$refs.testDialog.show(this.tid,a,s);console.log("脱敏提交的信息 - submit：",s),this.id?this.$api.strategy.update({id:this.id,config:s,tab:this.tab,name:this.name}).then((function(){e.onSuccess("更新成功"),e.hide(),e.$emit("refresh")})):this.$api.strategy.save({rid:this.rid,config:s,db_id:this.db_id,db_name:this.db_name,owner:this.owner,tab:this.tab,match_type:this.match_type,name:this.name,c_type:this.c_type,tid:this.tid}).then((function(){e.onSuccess("新增成功"),e.hide(),e.$emit("refresh")}))}},components:{ElCol:c["a"],ElRow:l["a"],DbList:o["default"],OwnerList:i["default"],TableList:r["default"],diaolgTest:d["default"]}},f=p,m=(a("d814"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,null,null);e["default"]=h.exports},"2a77":function(t,e,a){},"2ab5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("告警设置")])]),a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"180px",size:"mini"}},[a("el-form-item",{attrs:{label:"脚本执行错误告警"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.waringForm.sql_exec,callback:function(e){t.$set(t.waringForm,"sql_exec",e)},expression:"waringForm.sql_exec"}})],1),a("el-form-item",{attrs:{label:"脚本执行权限告警"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.waringForm.sql_validate,callback:function(e){t.$set(t.waringForm,"sql_validate",e)},expression:"waringForm.sql_validate"}})],1),a("el-form-item",{attrs:{label:"调用未授权功能告警"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.waringForm.fun_validate,callback:function(e){t.$set(t.waringForm,"fun_validate",e)},expression:"waringForm.fun_validate"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)],1)])],1)},n=[],o={data:function(){return{filterText:"",waringForm:{}}},computed:{},props:{form:{}},watch:{form:"initFrom"},methods:{onSubmit:function(){var t=this;this.$api.setting.updateWaringSetting(this.waringForm).then((function(){t.onSuccess("保存成功"),t.$emit("refresh")}))},reset:function(){this.waringForm={sql_exec:!0,sql_validate:!0,fun_validate:!0}},initFrom:function(t){t.warning_conf?this.waringForm=t.warning_conf:this.reset()}},components:{},mounted:function(){}},i=o,r=(a("d91e"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"2ab6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:"onSelect",url:"/api/ssh/user/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"用户名",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"danger",size:"mini",disabled:""==t.ids},on:{click:t.onBatchRemove}},[t._v("批量移除")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id",width:"80"}}),a("el-table-column",{attrs:{label:"用户名",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),1==e.row.is_create?a("el-tag",{attrs:{type:"warning"}},[t._v("创建人")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"姓名",prop:"user_name"}}),a("el-table-column",{attrs:{label:"SSH策略"},scopedSlots:t._u([{key:"default",fn:function(e){return[""!=e.row.filter_name?a("div",[t._v(" "+t._s(e.row.filter_name)+" ")]):a("div",[a("el-select",{model:{value:e.row.filter_id,callback:function(a){t.$set(e.row,"filter_id",a)},expression:"r.row.filter_id"}},t._l(t.filterList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.machine_id?a("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(a){return t.onAdd(e.row.id,e.row.filter_id)}}},[t._v("添加 ")]):t._e(),0!=e.row.machine_id?a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("b0c0"),a("2f62")),r={data:function(){return{ids:"",title:"主机授权管理",m:{},isShow:!1,search:{},filterList:[],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}]}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getFilterList:function(){var t=this;this.$api.ssh.filterPage({page_no:-1,page_size:-1}).then((function(e){t.filterList=e.list}))},onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.id=this.role.id},refresh:function(){this.getFilterList(),this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.m=t,this.title="主机-".concat(t.name,"授权管理"),this.search.id=t.id,this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.m={},this.isShow=!1},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onProjectRole:function(t,e){var a=this;this.$api.project.user_upd(this.m,t,e).then((function(){a.onSuccess("设置成功"),a.refresh()}))},onAdd:function(t,e){var a=this;this.$api.ssh.addUser(this.m.id,t,e).then((function(){a.onSuccess("添加成功"),a.refresh()}))},onRemove:function(t){var e=this;this.$api.ssh.delUsers(this.m.id,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"2ac3":function(t,e,a){"use strict";a("8b37")},"2ad2":function(t,e,a){"use strict";a("6b7e")},"2ad4":function(t,e,a){},"2bba":function(t,e,a){var s={"./af-ZA":"b070","./af-ZA.js":"b070","./ar":"2395","./ar.js":"2395","./bg":"6c08","./bg.js":"6c08","./ca":"7402","./ca.js":"7402","./cs-CZ":"74d7","./cs-CZ.js":"74d7","./da":"69be","./da.js":"69be","./de":"22f4","./de.js":"22f4","./ee":"b7a3","./ee.js":"b7a3","./el":"7be2","./el.js":"7be2","./en":"b2d6","./en.js":"b2d6","./eo":"e4c6","./eo.js":"e4c6","./es":"3ed6","./es.js":"3ed6","./eu":"31e8","./eu.js":"31e8","./fa":"bf26","./fa.js":"bf26","./fi":"66c5","./fi.js":"66c5","./fr":"8f86","./fr.js":"8f86","./he":"70ec","./he.js":"70ec","./hr":"2cb7","./hr.js":"2cb7","./hu":"4abf","./hu.js":"4abf","./hy-AM":"90c2","./hy-AM.js":"90c2","./id":"4f7a","./id.js":"4f7a","./it":"956c","./it.js":"956c","./ja":"c3ff","./ja.js":"c3ff","./kg":"e6de","./kg.js":"e6de","./km":"20c7","./km.js":"20c7","./ko":"fcff","./ko.js":"fcff","./ku":"74c6","./ku.js":"74c6","./kz":"6ecd","./kz.js":"6ecd","./lt":"8fb8","./lt.js":"8fb8","./lv":"7f42","./lv.js":"7f42","./mn":"dab8","./mn.js":"dab8","./nb-NO":"9716","./nb-NO.js":"9716","./nl":"f9ea","./nl.js":"f9ea","./pl":"25e3","./pl.js":"25e3","./pt":"da67","./pt-br":"05af","./pt-br.js":"05af","./pt.js":"da67","./ro":"ac14","./ro.js":"ac14","./ru-RU":"dccd","./ru-RU.js":"dccd","./sk":"61f4","./sk.js":"61f4","./sl":"bace","./sl.js":"bace","./sr":"f5e8","./sr.js":"f5e8","./sv-SE":"5f98","./sv-SE.js":"5f98","./ta":"78ff","./ta.js":"78ff","./th":"ab94","./th.js":"ab94","./tk":"cc15b","./tk.js":"cc15b","./tr-TR":"b1fe","./tr-TR.js":"b1fe","./ua":"6039","./ua.js":"6039","./ug-CN":"8bb1","./ug-CN.js":"8bb1","./uz-UZ":"9de0","./uz-UZ.js":"9de0","./vi":"4b0a","./vi.js":"4b0a","./zh-CN":"f0d9","./zh-CN.js":"f0d9","./zh-TW":"c87b","./zh-TW.js":"c87b"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="2bba"},"2c11":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]})},n=[],o=a("5530"),i=(a("ac1f"),a("5319"),a("2f62")),r={data:function(){var t=this.$route.params;return{loading:!0,ticket:t.ticket}},computed:Object(o["a"])({},Object(i["e"])(["user"])),mounted:function(){var t=this;console.log("this.$route.params; ",this.$route.params.ticket),this.ticket?this.$api.post("/api/login/cas",{ticket:this.ticket}).then((function(e){t.$store.commit("user",e),window.localStorage.setItem("token",e.token),window.localStorage.setItem("user",JSON.stringify(e)),t.onSuccess("登录成功");var a=window.localStorage.getItem("beforeUrl");console.log("beforeUrl",a),t.$router.push("/"),t.loading=!1})).catch((function(e){console.log("cas login:",e),t.$message({showClose:!0,duration:2e3,type:"warning",message:e.data}),setTimeout((function(){t.loading=!1,t.$router.replace("/login")}),3e3)})):this.$router.replace("/login")}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"2c28":function(t,e,a){"use strict";a("b8a6")},"2c62":function(t,e,a){},"2c7d":function(t,e,a){},"2ca1":function(t,e){t.exports={keywords:["oracle","ACCESS","ELSE","MODIFY","START","ADD","EXCLUSIVE","NOAUDIT","SELECT","ALL","EXISTS","NOCOMPRESS","SESSION","ALTER","FILE","NOT","SET","AND","FLOAT","NOTFOUND","SHARE","ANY","FOR","NOWAIT","SIZE","ARRAYLEN","FROM","NULL","SMALLINT","AS","GRANT","NUMBER","SQLBUF","ASC","GROUP","OF","SUCCESSFUL","AUDIT","HAVING","OFFLINE","SYNONYM","BETWEEN","IDENTIFIED","ON","SYSDATE","BY","IMMEDIATE","ONLINE","TABLE","CHAR","IN","OPTION","THEN","CHECK","INCREMENT","OR","TO","CLUSTER","INDEX","ORDER","TRIGGER","COLUMN","INITIAL","PCTFREE","UID","COMMENT","INSERT","PRIOR","UNION","COMPRESS","INTEGER","PRIVILEGES","UNIQUE","CONNECT","INTERSECT","PUBLIC","UPDATE","CREATE","INTO","RAW","USER","CURRENT","IS","RENAME","VALIDATE","DATE","LEVEL","RESOURCE","VALUES","DECIMAL","LIKE","REVOKE","VARCHAR","DEFAULT","LOCK","ROW","VARCHAR2","DELETE","LONG","ROWID","VIEW","DESC","MAXEXTENTS","ROWLABEL","WHENEVER","DISTINCT","MINUS","ROWNUM","WHERE","DROP","MODE","ROWS","WITH"],operators:["ALL","AND","ANY","BETWEEN","EXISTS","IN","LIKE","NOT","OR","SOME","EXCEPT","INTERSECT","UNION","APPLY","CROSS","FULL","INNER","JOIN","LEFT","OUTER","RIGHT","CONTAINS","FREETEXT","IS","NULL","PIVOT","UNPIVOT","MATCHED"],functions:["ABS","ACOS","ADD_MONTHS","ASCII","ASCIISTR","ASIN","ATAN","ATAN2","AVG","BFILENAME","BIN_TO_NUM","BITAND","CARDINALITY","CASE","CAST","CEIL","CHARTOROWID","CHR","COALESCE","COMPOSE","CONCAT","CONVERT","CORR","COS","COSH","COUNT","COVAR_POP","COVAR_SAMP","CUME_DIST","CURRENT_DATE","CURRENT_TIMESTAMP","DBTIMEZONE","DECODE","DECOMPOSE","DENSE_RANK","DUMP","EMPTY_BLOB","EMPTY_CLOB","EXP","EXTRACT","FIRST_VALUE","FLOOR","FROM_TZ","GREATEST","GROUP_ID","HEXTORAW","INITCAP","INSTR","INSTR2","INSTR4","INSTRB","INSTRC","LAG","LAST_DAY","LAST_VALUE","LEAD","LEAST","LENGTH","LENGTH2","LENGTH4","LENGTHB","LENGTHC","LISTAGG","LN","LNNVL","LOCALTIMESTAMP","LOG","LOWER","LPAD","LTRIM","MAX","MEDIAN","MIN","MOD","MONTHS_BETWEEN","NANVL","NCHR","NEW_TIME","NEXT_DAY","NTH_VALUE","NULLIF","NUMTODSINTERVAL","NUMTOYMINTERVAL","NVL","NVL2","POWER","RANK","RAWTOHEX","REGEXP_COUNT","REGEXP_INSTR","REGEXP_REPLACE","REGEXP_SUBSTR","REMAINDER","REPLACE","ROUND","ROWNUM","RPAD","RTRIM","SESSIONTIMEZONE","SIGN","SIN","SINH","SOUNDEX","SQRT","STDDEV","SUBSTR","SUM","SYS_CONTEXT","SYSDATE","SYSTIMESTAMP","TAN","TANH","TO_CHAR","TO_CLOB","TO_DATE","TO_DSINTERVAL","TO_LOB","TO_MULTI_BYTE","TO_NCLOB","TO_NUMBER","TO_SINGLE_BYTE","TO_TIMESTAMP","TO_TIMESTAMP_TZ","TO_YMINTERVAL","TRANSLATE","TRIM","TRUNC","TZ_OFFSET","UID","UPPER","USER","USERENV","VAR_POP","VAR_SAMP","VARIANCE","VSIZE"]}},"2cc9":function(t,e,a){},"2dc6":function(t,e,a){},"2e32":function(t){t.exports=JSON.parse('{"_element":"zh-CN","_name":"简体中文","page":{"demo":{"playground":{"locales":{"text":"D2Admin 是一个完全 开源免费 的企业中后台产品前端集成方案，使用最新的前端技术栈，已经做好大部分项目前期准备工作，并且带有大量示例代码，助力管理系统敏捷开发。"}}}}}')},3e3:function(t,e,a){},3004:function(t,e,a){},"304a":function(t,e,a){},"317b":function(t,e,a){"use strict";a("6547a")},3206:function(t,e,a){"use strict";a("a901")},3282:function(t,e,a){},3345:function(t,e,a){"use strict";a("28a1")},3372:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.table_name+" 表定义",visible:t.isShow,width:"1024px"},on:{"update:visible":function(e){t.isShow=e},close:t.onClose,opened:t.onOpened}},[a("table-info",{ref:"tableInfoRef"}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")])],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("2f62")),r=a("eaf8"),l={components:{tableInfo:r["default"]},data:function(){return{type:"",db_type:"",isShow:!1,cur_name:"struct",table_name:"",data:{constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}}},computed:Object(o["a"])({},Object(i["e"])(["runList","runActive"])),methods:{show:function(t,e,a){this.type=a,this.db_type=e,this.table_name=t,this.isShow=!0},onOpened:function(){var t=this.runList[this.runActive],e={iid:t.id,dbName:t.name,dbType:this.db_type,tableName:this.table_name,tableType:this.type,cur_name:this.cur_name};this.$refs.tableInfoRef.init(e)},onClose:function(){this.type="",this.hide()},hide:function(t){this.isShow=!1,this.$refs.tableInfoRef.hide(),this.data={constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}},onSubmit:function(){}}},c=l,u=(a("ea3a"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"39f0f568",null);e["default"]=d.exports},3392:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",staticClass:"userInfo",attrs:{model:t.form,"label-width":"120px",rules:t.rules}},[a("div",{staticClass:"flex flex-col items-center "},[a("div",{staticClass:"flex relative group",staticStyle:{width:"100px",height:"100px"}},[a("el-avatar",{attrs:{size:100,fit:"fill",src:t.form.user_avatar}},[a("img",{attrs:{src:"/image/no-image.png"}})]),a("div",{staticClass:"absolute invisible opacity-75 group-hover:visible active:bg-gray-400 cursor-pointer  rounded-full bg-gray-300 flex justify-center items-center",staticStyle:{width:"100px",height:"100px"},on:{click:t.toggleShow}},[a("k-icon",{staticClass:"text-5xl text-gray-700",attrs:{name:"icon-xiugaitouxiang1"}})],1)],1)]),a("my-upload",{attrs:{width:100,height:100,"img-format":"png"},on:{"crop-success":t.cropSuccess},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}}),a("el-form-item",{attrs:{label:"用户名"}},[t._v(t._s(t.user.name))]),a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{model:{value:t.form.user_name,callback:function(e){t.$set(t.form,"user_name",e)},expression:"form.user_name"}})],1),a("el-form-item",{attrs:{label:"性别",prop:"sex"}},[a("el-radio-group",{model:{value:t.form.sex,callback:function(e){t.$set(t.form,"sex",e)},expression:"form.sex"}},[a("el-radio",{attrs:{label:1}},[t._v("男")]),a("el-radio",{attrs:{label:2}},[t._v("女")])],1)],1),a("el-form-item",{attrs:{label:"邮箱地址",prop:"email"}},[a("el-input",{model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"手机号码",prop:"telno"}},[a("el-input",{model:{value:t.form.telno,callback:function(e){t.$set(t.form,"telno",e)},expression:"form.telno"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)},n=[],o=a("5530"),i=a("2f62"),r=a("0b4d"),l={name:"infoPage",components:{"my-upload":r["a"]},data:function(){return{show:!1,form:this.reset(),rules:{user_name:[{required:!0,message:"姓名不能为空!",trigger:"blur"}],email:[this.validateEmail()],telno:[this.validatePhone()]}}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{toggleShow:function(){this.show=!this.show},cropSuccess:function(t,e){this.form.user_avatar=t},reset:function(){return Object(o["a"])({},this.user)},onSubmit:function(){var t=this;this.isValidate().then((function(){var e={user_name:t.form.user_name,email:t.form.email,telno:t.form.telno,sex:t.form.sex,user_avatar:t.form.user_avatar};t.$api.post("/api/my/user/update",e).then((function(e){t.onSuccess("更新成功!"),t.$store.commit("user",e.user),window.localStorage.setItem("user",JSON.stringify(e.user))}))}))}},created:function(){var t=this;this.$api.my.info().then((function(e){t.$store.commit("user",e),window.localStorage.setItem("user",JSON.stringify(e)),t.form=e||t.reset()}))}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"33e4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"权限申请",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"申请目标"}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:t.formData.source_type,callback:function(e){t.$set(t.formData,"source_type",e)},expression:"formData.source_type"}},[a("el-option",{attrs:{label:"权限组",value:"role"}}),a("el-option",{attrs:{label:"其他",value:"none"}})],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"role"==t.formData.source_type,expression:"formData.source_type=='role'"}],attrs:{label:"权限组"}},[a("el-select",{attrs:{placeholder:"请选择权限组"},model:{value:t.formData.role_id,callback:function(e){t.$set(t.formData,"role_id",e)},expression:"formData.role_id"}},t._l(t.roleList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.name))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.info))])])})),1)],1),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.opt_mark,callback:function(e){t.$set(t.formData,"opt_mark",e)},expression:"formData.opt_mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success",disabled:t.disabled},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{disabled:!1,role:{},isShow:!1,formData:{source_type:"none",source_id:"none"},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}],auditor:[{required:!0,message:"请选择审批人"}]},roleList:[]}},props:{},watch:{},computed:{},methods:{show:function(){this.isShow=!0},hide:function(t){this.isShow=!1},loadApplyRoleList:function(){var t=this;this.$api.my.myApplyRoleList().then((function(e){t.roleList=e}))},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.disabled=!0;var a=t.formData;"role"==a.source_type&&(a.source_id=a.role_id),t.$api.apply.applyAdd(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh"),t.disabled=!1}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a),t.disabled=!1}))}}))}},mounted:function(){this.loadApplyRoleList()},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"344a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:"定时执行SQL",visible:t.isShow,"append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"执行时间"}},[a("el-date-picker",{model:{value:t.execTime,callback:function(e){t.execTime=e},expression:"execTime"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定提交")])],1)],1)],1)},n=[],o=a("2ef0"),i=a("c1df"),r=a.n(i),l={data:function(){return{esConfigList:[],isShow:!1,execTime:"",formData:this.reset()}},computed:{},props:{},watch:{},methods:{reset:function(){return{exec_flag:1}},show:function(t){this.isShow=!0,this.formData=t},hide:function(){this.isShow=!1},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);this.execTimes.length<2?this.onError("执行时间范围不能为空"):(console.log(this.execTimes),e.exec_start=r()(this.execTimes[0]).format("YYYY-MM-DD HH:mm:ss"),e.exec_end=r()(this.execTimes[1]).format("YYYY-MM-DD HH:mm:ss"),this.$api.work.changeTime(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})))}},components:{},mounted:function(){}},c=l,u=(a("35c8"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"5da7b243",null);e["default"]=d.exports},"348e":function(t,e,a){"use strict";a("d7f3")},"34bb":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"权限组["+t.role.name+"]的申请记录",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/list","search-data":t.search,manual:!0},on:{reset:t.resetSearch}},[a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"}}),a("el-table-column",{attrs:{label:"申请理由",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核人",prop:"user_name"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过,原因:"+t._s(e.row.auditor_mark)+" ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{ids:"",role:{},isShow:!1,search:{source_type:"role"}}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search()},show:function(t){var e=this;this.role=t,this.search.source_id=t.id,this.search.source_type="role",this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onAdd:function(t){var e=this;this.$api.role.relation(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kick(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"351c":function(t,e,a){},3551:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("功能设置")])]),a("el-form",{ref:"form",staticClass:"el-row",attrs:{model:t.form,"label-width":"160px",size:"mini"}},[a("el-form-item",{staticClass:"el-col-12",attrs:{label:"开启页面水印"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.water_mark,callback:function(e){t.$set(t.form,"water_mark",e)},expression:"form.water_mark"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"使用异步查询功能"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.asyn_query,callback:function(e){t.$set(t.form,"asyn_query",e)},expression:"form.asyn_query"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"使用导出Sql功能"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.asyn_sql,callback:function(e){t.$set(t.form,"asyn_sql",e)},expression:"form.asyn_sql"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"使用异步导出功能"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.asyn_export,callback:function(e){t.$set(t.form,"asyn_export",e)},expression:"form.asyn_export"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"使用加密方式传输Sql"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.encrypt_sql,callback:function(e){t.$set(t.form,"encrypt_sql",e)},expression:"form.encrypt_sql"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"上报解析失败SQL"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后，解析失败的SQL会发给厂商定位错误"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.report_sql,callback:function(e){t.$set(t.form,"report_sql",e)},expression:"form.report_sql"}})],1)],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"强制开启二次校验"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后,所有账户登录都使用双因子校验"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.form.force_tfa,callback:function(e){t.$set(t.form,"force_tfa",e)},expression:"form.force_tfa"}})],1)],1),a("el-form-item",{staticClass:"el-col-24"},[a("el-button",{staticClass:"el-button--default",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存 ")])],1)],1)],1)],1)])],1)],1)},n=[],o=(a("b0c0"),a("c1df")),i=a.n(o),r={data:function(){return{setting:{},inter:null,run_str:"",size:"small",activeName:"first",form:{sql_mode:!0,license:""},form2:{}}},methods:{showTime:function(t){return console.log("expire:",t),i()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},diffTime:function(){var t="NaN";if(this.form.start_time){var e=i()().diff(i()(1e3*this.form.start_time));console.log("ms:",e);var a=i.a.duration(e),s=Math.floor(a.asHours()),n=i.a.utc(e).format("mm"),o=i.a.utc(e).format("ss");t="",a>0&&(t=a+"天"),s>0&&(t+=s+"小时"),t+=n+"分钟",t+=o+"秒",console.log("d:",a,"  h:",s," m:",n," s:",o)}this.run_str=t},checkLicense:function(){var t=this;this.$api.setting.updateLicense(this.form).then((function(){t.onSuccess("更新成功"),t.getSetting()}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},handleClick:function(t,e){console.log("handleClick:",t,e),this.getSetting(t.name)},onReboot:function(){var t=this;this.$api.setting.reboot().then((function(){t.onSuccess("请求成功，正在重启中")})).catch((function(){t.onError("操作势必啊")}))},onSubmit:function(){var t=this;this.$api.setting.updateSetting(this.form).then((function(){t.onSuccess("提交成功"),t.refreshSys()}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},getSetting:function(t){var e=this;"inception"==t?this.$api.setting.getInception().then((function(t){console.log('name == "inception" data:',t),e.form2=t})):this.$api.setting.get().then((function(t){console.log('name !== "inception" data:',t),e.setting=t,e.form=t}))},refreshSys:function(){var t=this;this.$api.sys.config().then((function(e){t.$store.commit("sys",e)}))},round:function(t){return Math.round(100*t)/100},init:function(){}},mounted:function(){var t=this;this.$nextTick((function(){t.getSetting(),t.init()}))},destroyed:function(){clearTimeout(this.inter)}},l=r,c=(a("6c4f"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"355c":function(t,e,a){"use strict";a("891d")},"356b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sql-query-item"},[a("split-pane",{staticClass:"editor-container",attrs:{"min-percent":20,"default-percent":43,"max-percent":80,split:"horizontal"},on:{resize:t.onResize}},[a("template",{slot:"paneL"},[a("pre",{staticClass:"editor"})]),a("template",{slot:"paneR"},[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.resultJumpLoading,expression:"resultJumpLoading"}],staticClass:"results",attrs:{type:"border-card"},on:{"tab-click":t.onResultClick},model:{value:t.tabsValue,callback:function(e){t.tabsValue=e},expression:"tabsValue"}},[a("el-tab-pane",{attrs:{name:"result"}},[a("span",{staticClass:"no-user-select",attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-s-grid"}),t._v(" 结果 ")]),a("result-result",{ref:"tab-result",attrs:{"run-tab-id":t.runTabId}})],1),a("el-tab-pane",{attrs:{name:"info",disabled:t.infoDisable}},[a("span",{staticClass:"no-user-select",class:{"not-allowed":!!t.infoDisable},attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-info"}),t._v(" 信息 ")]),a("result-info",{ref:"tab-info"})],1),a("el-tab-pane",{attrs:{name:"export"}},[a("span",{staticClass:"no-user-select",attrs:{slot:"label",title:"点击标签刷新"},slot:"label"},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  导出及异步  ")]),a("result-export",{ref:"tab-export",attrs:{"run-tab-id":t.runTabId}})],1),a("el-tab-pane",{attrs:{name:"history"}},[a("span",{staticClass:"no-user-select",attrs:{slot:"label",title:"点击标签刷新"},slot:"label"},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  历史操作 ")]),a("result-history",{ref:"tab-history",attrs:{"run-tab-id":t.runTabId}})],1),a("el-tab-pane",{attrs:{name:"work"}},[a("span",{staticClass:"no-user-select",attrs:{slot:"label"},slot:"label"},[0==t.workTotal?[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  我的工单 ")]:[a("el-badge",{staticClass:"item",attrs:{value:t.workTotal}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  我的工单 ")])]],2),a("result-work",{ref:"tab-work",attrs:{"run-tab-id":t.runTabId},on:{total:t.onTotalHandler}})],1)],1)],1)],2),a("dialog-async",{ref:"dialogAsync"}),a("dialog-export",{ref:"dialogExport"}),a("dialog-favorite",{ref:"dialogFavorite"})],1)},n=[],o=a("53ca"),i=a("5530"),r=(a("99af"),a("b0c0"),a("2f62")),l=a("dcb4"),c=a("43f9"),u=a("5de3"),d=a("19ab"),p=a.n(d),f=a("5c96"),m=a("23b2"),h=a("adc8"),b=a("4826"),_=a("736a"),g=a("a887"),v={inject:["data","service"],provide:function(){return{data:this.data}},data:function(){return{isCommunity:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMMUNITY,tabsValue:"result",workTotal:0}},computed:Object(i["a"])(Object(i["a"])({},Object(r["e"])(["user","runner","project","exportCount","selecedDB","resultJumpLoading"])),{},{infoDisable:function(){return this.service.loading},db:function(){return this.service&&this.service.data?{id:this.service.data.id}:{}},owner:function(){return this.service&&this.service.data?{id:this.service.data.owner}:{}},queryKeymap:function(t){return{}},count:function(){var t="_default";Boolean(this.db)&&Boolean(this.owner)&&(t="".concat(this.db.id,"_").concat(this.owner.id));var e=this.exportCount[t];return void 0===e?"0":e}}),props:{runTabId:{}},watch:{tabsValue:function(t,e){var a=this;console.log("tabsValue: ",t,e),this.$nextTick((function(){a.onResize()}))}},methods:{onTotalHandler:function(t){},triggerTab:function(t){this.tabsValue!=t&&(this.tabsValue=t)},onFavorite:function(){var t=Object(i["a"])({},this.data);this.$refs.dialogFavorite.show(t)},onAsync:function(t,e){var a=this,s=this.service.getSQL();this.$refs.dialogAsync.show((function(s){a.service.onRunAsync(Object(i["a"])(Object(i["a"])(Object(i["a"])({},s),t),{},{au:e})).then((function(t){t&&t.error?f["Message"].error({title:"请求失败",message:t.error,type:"error",duration:4e3}):a.$bus.emit("runExport")})).catch((function(t){f["Message"].error({title:"请求失败",message:t?t.error:t,type:"error",duration:4e3})}))}),{sql:s})},onExport:function(t){var e=this,a=this.service.getSQL();this.$refs.dialogExport.show((function(a){e.service.onRunAsync(Object(i["a"])(Object(i["a"])({},a),t)).then((function(t){t&&t.error?f["Message"].error({title:"请求失败",message:t.error,type:"error",duration:4e3}):e.$bus.emit("runExport")})).catch((function(t){f["Message"].error({title:"请求失败",message:t?t.error:t,type:"error",duration:4e3})}))}),{sql:a})},onResize:function(t){console.log("[ritht.vue methods] onResize()");var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!0),window.dispatchEvent(e),this.$refs["tab-result"].resize(),this.$refs["tab-info"].resize(),this.$refs["tab-export"].resize(),this.$refs["tab-history"].resize(),this.$refs["tab-work"].resize()},resetAsyncList:function(t){"export"==t&&this.$refs["tab-export"].onAsync()},loadWorkList:function(t){"work"==t&&this.$refs["tab-work"].load()},resetHistoryList:function(t){"history"==t&&this.$refs["tab-history"].refresh()},onResultClick:function(t){var e=this,a=t.name;console.log("延迟设置高度，并获取列表...",a),setTimeout((function(){a?(e.$refs["tab-".concat(a)].resize(),e.resetAsyncList(a),e.resetHistoryList(a),!e.isCommunity&&e.loadWorkList(a)):e.onResize()}),600)}},components:{DialogAsync:l["default"],DialogExport:c["default"],DialogFavorite:u["default"],SplitPane:p.a,"result-result":m["default"],"result-info":h["default"],"result-export":b["default"],"result-history":_["default"],"result-work":g["default"]},mounted:function(){var t=this.$el.getElementsByTagName("pre")[0];this.service.init(t,this.data,this.project),this.service.onAsync=this.onAsync,this.service.onExport=this.onExport},created:function(){var t=this,e=this;this.$bus.on("index-result-change-tab_".concat(this.runTabId),(function(a){t.$store.commit("resultJumpLoading",!1),e.tabsValue=a,console.log("[tab right index.vue] on index-result-change-tab_".concat(t.runTabId,":"),a)})),this.$bus.on("current-tab_".concat(this.runTabId,"-exec"),(function(a){if(a&&"object"==Object(o["a"])(a)&&a.type)switch(a.type){case"change-tab":e.tabsValue=a.value;break;case"exec-cleanInfo":e.cleanInfo();break}else console.warn("current-tab_".concat(t.runTabId,"-exec"),"参数错误：",a)}))},beforeDestroy:function(){this.$bus.off("index-result-change-tab_".concat(this.runTabId)),this.$bus.off("current-tab_".concat(this.runTabId,"-exec"))}},y=v,w=(a("a4a1"),a("8218"),a("2877")),S=Object(w["a"])(y,s,n,!1,null,null,null);e["default"]=S.exports},3583:function(t,e,a){"use strict";a("8367")},"35bd":function(t,e,a){"use strict";a("1a61")},"35c8":function(t,e,a){"use strict";a("d096")},"35ef":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-member",use:"d2-member-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-member"><path d="M668.544896 503.514285a153.587603 153.587603 0 0 0 66.335217-126.234383C734.880113 290.100653 660.646105 219.450356 569.005502 219.450356s-165.801475 70.650298-165.801475 157.829546a153.587603 153.587603 0 0 0 66.26208 126.234383c-80.889471 37.299847-132.377887 115.190702-132.597297 200.760938a27.792042 27.792042 0 0 0 28.523412 27.13381 27.792042 27.792042 0 0 0 28.523412-27.13381c5.704682-88.934536 83.156717-158.268368 176.698881-158.268368 93.615301 0 171.067335 69.333832 176.772017 158.268368a27.792042 27.792042 0 0 0 28.523412 27.13381 27.792042 27.792042 0 0 0 28.523412-27.13381c-0.73137-86.301606-53.755661-164.411872-135.961597-200.760938zM460.250851 377.279902c0.73137-56.681139 49.513718-102.099188 108.974062-101.660366 59.606617 0.511959 107.511322 46.661377 107.291911 103.342516-0.292548 56.681139-48.562937 102.391736-108.096418 102.464873-59.752891 0-108.169555-46.076281-108.169555-102.903694v-1.243329zM173.773403 371.57522H28.523412A27.792042 27.792042 0 0 1 0 344.514547a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.13381 27.792042 27.792042 0 0 1-28.523412 27.13381z m0 131.939065H28.523412A27.792042 27.792042 0 0 1 0 476.380475a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.060673 27.792042 27.792042 0 0 1-28.523412 27.206947z m0 131.939065H28.523412A27.792042 27.792042 0 0 1 0 608.31954a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.060673 27.792042 27.792042 0 0 1-28.523412 27.206947z" p-id="16302" /><path d="M926.352659 1023.956849H170.701651a91.274919 91.274919 0 0 1-67.72482-27.13381 103.48879 103.48879 0 0 1-29.839877-70.211476V822.830226a29.986151 29.986151 0 0 1 8.630161-20.624621 26.40244 26.40244 0 0 1 19.966388-7.825654c15.212486-0.365685 27.938316 12.287008 28.523412 28.523412v103.781337a42.931392 42.931392 0 0 0 12.433282 29.108508 37.811805 37.811805 0 0 0 28.011454 11.263091h755.651008c10.385447 0.292548 20.478347-3.729985 28.08459-11.263091a42.931392 42.931392 0 0 0 12.287008-29.108508V97.311643a42.931392 42.931392 0 0 0-12.287008-29.108508 37.811805 37.811805 0 0 0-28.08459-11.263091H170.701651a37.811805 37.811805 0 0 0-28.084591 11.263091 42.931392 42.931392 0 0 0-12.287008 29.108508v103.854474c-0.73137 16.163267-13.384063 28.81596-28.596549 28.450275a26.40244 26.40244 0 0 1-19.966388-7.825654A29.986151 29.986151 0 0 1 73.136954 201.166117V97.311643c0.804506-26.694988 11.555639-51.927237 29.839877-70.138339 18.284238-18.284238 42.638844-27.938316 67.72482-27.060673h755.651008c25.085975-0.877643 49.440581 8.776434 67.724819 27.060673s29.035371 43.443351 29.839877 70.211476V926.6847c-0.804506 26.694988-11.555639 51.927237-29.839877 70.138339-18.284238 18.284238-42.638844 27.938316-67.724819 27.060673z" p-id="16303" /></symbol>'});i.a.add(r);e["default"]=r},"365c":function(t,e,a){"use strict";a.r(e);var s=a("5530"),n=a("4ad9"),o=(a("159b"),a("d81d"),a("b64b"),{asyncList:function(t,e,a){return n["a"].post("/api/sql/task/all",{db_id:t,type:e,owner:a}).then((function(t){var e=!0;return t.forEach((function(t){0==t.state&&(e=!1)})),{dataList:t.map((function(t){return t})),isComplete:e}}))},asyncRemove:function(t){return n["a"].post("/api/sql/task/remove",{id:t.id}).then((function(){}))},data:function(t){return n["a"].post("/api/sql/task/data",t).then((function(e){var a=e&&e.length>0?Object.keys(e[0]):[];return{ok:!0,head:a,data:e,params:t}})).catch((function(e){return{ok:!1,params:t,data:e}}))}}),i=o,r=a("2909"),l=(a("99af"),a("d3b7"),a("4de4"),a("b0c0"),a("5c96")),c={cache:{},column:function(t,e,a){return c.columns(t,"".concat(e,".").concat(a))},columns:function(t,e,a,s,o,i,l,u,d,p){if(e=e||"",c.cache[t+a]&&c.cache[t+a][e])return Promise.resolve(c.cache[t+a][e]);var f="/api/sql/auto/v4";return a&&(f="/api/sql/auth/auto/v4"),n["a"].post(f,{id:t,keyword:e,type:s,project:o,name:i||"*",page_no:l||0,page_size:u||500,f:d||!1}).then((function(a){if(console.log("ret: ",a),!a||!a.list)return p?{list:[],cursor:0,total:0}:[];a.list=a.list.filter((function(t){return Boolean(t)}));var s=a.list?a.list:[];return c.cache[t]=c.cache[t]||{},c.cache[t][e]=s,p?{list:s,cursor:a.cursor,total:a.total}:Object(r["a"])(s)}))},filter:function(t,e,a){return a=a.toLowerCase(),c.columns(t,e).then((function(t){return t.filter((function(t){return-1!=t.toLowerCase().indexOf(a)}))}))},tree:function(t,e,a,s,n){return console.log("tree   id:",t,"  keyword:",e,"  isLeft:",a,"  hasAuth:",s,"  type:",n),c.columns(t,e,s,n).then((function(t){return t?t.filter((function(t){return Boolean(t)})).map((function(t){return{id:Math.random(),label:t,name:t,leaf:a}})):{}}))},new_tree:function(t,e,a,s,n){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,d=arguments.length>10?arguments[10]:void 0;if(!o)try{delete c.cache[t+"v2"][a]}catch(p){}return c.new_columns(t,a,n,e,i,r,l,u,d).then((function(t){var e=t.cursor,a=t.list,n=t.total;if(a){var o=a.filter((function(t){return Boolean(t)})).map((function(t){return{id:t.id,label:t.name,rw:t.rw,hasSql:1==t.asyn_sql,hasRw:Boolean(2==t.rw||4==t.rw),leaf:s}}));return{list:o,cursor:e,total:n}}return{}}))},new_columns:function(t,e,a,s,o,i,r,l,u){if(e=e||"",c.cache[t+"v2"]&&c.cache[t+"v2"][e])return Promise.resolve(c.cache[t+"v2"][e]);var d="/api/sql/auth/auto/v2";return n["a"].post(d,{id:t,type:s,keyword:e,project:o,name:i||"*",page_no:r||0,page_size:l||300,f:u||!1}).then((function(a){var s=[];return a&&a.list?(s=a.list.filter((function(t){return t&&3!=t.rw})),c.cache[t+"v2"]=c.cache[t+"v2"]||{},c.cache[t+"v2"][e]=s,{cursor:a.cursor||0,total:a.total||0,list:s}):{cursor:0,total:0,list:s}}))},meta:function(t,e,a){return c.columns(t,e).then((function(t){return console.log("查询字段，未处理：",t),t.map((function(t){return{id:t,name:t,value:t,meta:a,score:100}}))}))},autoV3:function(t){Object(l["Notification"])({title:"autoV3",message:"使用了过时的方法，请联系管理员！",type:"error",duration:5e3,position:"top-right",offset:100})}},u=c,d={all:function(t,e){return n["a"].post("/api/sql/favorite/all",{instance:t,owner:e})},add:function(t){return n["a"].post("/api/sql/favorite/add",t)},upd:function(t){return n["a"].post("/api/sql/favorite/upd",t)},del:function(t){return n["a"].post("/api/sql/favorite/remove",{id:t})}},p=d,f=a("1da1"),m=(a("96cf"),a("ddb0"),{base_group:function(t,e){return n["a"].post("/api/db/group",{id:t,parent:e,auth:!0})},base_sub_nodes:function(t){return n["a"].post("/api/db/sub_nodes",Object(s["a"])(Object(s["a"])({},t),{},{auth:!0}))},node_info:function(t){return n["a"].post("/api/db/node/info",t)},dataBaseList:function(t){return n["a"].post("/api/instance/sub_nodes",{id:t,node_type:"owner",object_type:"owner",path:"".concat(t,"/")})},tableList:function(t,e){return n["a"].post("/api/instance/sub_nodes",{id:t,node_type:"table",object_type:"table",path:"".concat(t,"/").concat(e)})},dbAll:function(t){var e=arguments;return Object(f["a"])(regeneratorRuntime.mark((function a(){var o,i,r,l,c,u,d,p,f;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=e.length>1&&void 0!==e[1]&&e[1],i=e.length>2&&void 0!==e[2]&&e[2],a.next=4,n["a"].post("/api/db/all",{project:t,f:o});case 4:r=a.sent,console.log("dataGroup: ",r),l=[],a.t0=regeneratorRuntime.keys(r);case 8:if((a.t1=a.t0()).done){a.next=18;break}for(c=a.t1.value,u={id:c,name:c.toUpperCase(),children:[]},d=function(t,e){var a=Object(s["a"])({},e);if(a.dbType=c,a.label=e.name,a.children=[],e.err_msg&&!e.subs){var n={name:"",err_msg:e.err_msg,rw:-3,perm:{}};e.subs=[n]}e.subs&&e.subs.forEach((function(t){if(t.label=t.name,t.perm&&Object.keys(t.perm).length>0&&(t.id=t.perm.id,t.rw=t.perm.rw,t.audit_work=t.perm.audit_work,t.asyn_query=t.perm.asyn_query,t.asyn_export=t.perm.asyn_export,t.asyn_sql=t.perm.asyn_sql),!i&&(3==t.rw||!t.perm))return!0;1==t.rw?t.name="[读] "+t.name:2==t.rw?t.name="[读写] "+t.name:3==t.rw?t.name="[禁] "+t.name:4==t.rw&&(t.name="[管] "+t.name),a.children.push(t)})),u.children.push(a)},p=0;f=r[c][p];p++)d(p,f);if(0!=u.children){a.next=15;break}return a.abrupt("continue",8);case 15:l.push(u),a.next=8;break;case 18:return a.abrupt("return",l);case 19:case"end":return a.stop()}}),a)})))()},schema:{group:function(t){return new Promise((function(e,a){m.base_group(t.id,"owner").then((function(a){return a&&a.forEach((function(e){e._params=Object(s["a"])(Object(s["a"])({},t),{},{parent:"owner"}),e._uniKey="".concat(t.id,"_").concat(e.node_type,"_").concat(e.name)})),e(a)})).catch((function(t){return a(t)}))}))},schemaSubNode:function(t){return new Promise((function(e,a){var n=Object(s["a"])(Object(s["a"])({},t),{},{id:t.id,project:t.project,object_type:t.object_type,node_type:t.node_type,path:"".concat(t.id,"/").concat(t.owner)});m.base_sub_nodes(n).then((function(a){return a&&a.List&&a.List.forEach((function(e){e._params=Object(s["a"])(Object(s["a"])({},t),{},{path:n.path}),e._uniKey="".concat(t.project,"_").concat(t.id,"_").concat(t.owner,"_").concat(e.node_type,"_").concat(e.name)})),e(a)})).catch((function(t){return a(t)}))}))}},table:{group:function(t){return new Promise((function(e,a){m.base_group(t.id,t.parent).then((function(a){return a&&a.forEach((function(e){e._params=Object(s["a"])(Object(s["a"])({},t),{},{name:e.name,node_type:e.node_type,path:"".concat(t.id,"/").concat(t.owner,"/").concat(t.table),parent:"table"}),e._uniKey="".concat(t.id,"_").concat(t.owner,"_").concat(t.table,"_").concat(e.node_type,"_").concat(e.name)})),e(a)})).catch((function(t){return a(t)}))}))},tableSubNode:function(t){return new Promise((function(e,a){var n={id:t.id,project:t.project,object_type:t.object_type,node_type:t.node_type,path:"".concat(t.id,"/").concat(t.owner,"/").concat(t.table)};m.base_sub_nodes(n).then((function(a){return a&&a.List&&a.List.forEach((function(e){e._params=Object(s["a"])(Object(s["a"])({},t),{},{path:n.path}),e._uniKey="".concat(t.project,"_").concat(t.id,"_").concat(t.owner,"_").concat(t.table,"_").concat(e.node_type,"_").concat(e.name)})),e(a)})).catch((function(t){return a(t)}))}))}},groupOwnerAll:function(t){return Object(f["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.columns(t.id,"",!1);case 2:return a=e.sent,console.log(a),e.abrupt("return",a.map((function(e){return{id:e,name:e,db:t.id,dbName:t.name}})));case 5:case"end":return e.stop()}}),e)})))()},groupOwner:function(t){return Object(f["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u.columns(t.id,"",!0);case 2:return a=e.sent,console.log(a),e.abrupt("return",a.map((function(e){return{id:e,name:e,db:t.id,dbName:t.name}})));case 5:case"end":return e.stop()}}),e)})))()},group_noauth:function(t){return Object(f["a"])(regeneratorRuntime.mark((function e(){var a,s,o,i,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n["a"].post("/api/sql/instance/v2",{project:t});case 2:a=e.sent,s=[],e.t0=regeneratorRuntime.keys(a);case 5:if((e.t1=e.t0()).done){e.next=14;break}for(o=e.t1.value,i={id:o,name:o.toUpperCase(),children:[]},r=0;l=a[o][r];r++)l.dbType=o,l.label=l.name,l.children.forEach((function(t){t.label=t.name,1==t.rw?t.name="[读] "+t.name:2==t.rw&&(t.name="[读写] "+t.name)})),i.children.push(l);if(0!=i.children){e.next=11;break}return e.abrupt("continue",5);case 11:s.push(i),e.next=5;break;case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})))()},group_new:function(t){return Object(f["a"])(regeneratorRuntime.mark((function e(){var a,s,o,i,r,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n["a"].post("/api/sql/auth/instance/v2",{project:t});case 2:a=e.sent,s=[],e.t0=regeneratorRuntime.keys(a);case 5:if((e.t1=e.t0()).done){e.next=14;break}for(o=e.t1.value,i={id:o,name:o.toUpperCase(),children:[]},r=0;l=a[o][r];r++)l.dbType=o,l.label=l.name,l.children.forEach((function(t){t.label=t.name,1==t.rw?t.name="[读] "+t.name:2==t.rw&&(t.name="[读写] "+t.name)})),i.children.push(l);if(0!=i.children){e.next=11;break}return e.abrupt("continue",5);case 11:s.push(i),e.next=5;break;case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})))()},group_all:function(){return Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,s,o,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n["a"].get("/api/sql/instance/all");case 2:for(s in e=t.sent,a=[],e){for(o={id:s,name:s.toUpperCase(),children:[]},i=0;r=e[s][i];i++)r.children=[],o.children.push(r);a.push(o)}return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))()},group:function(){return Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,s,o,i,r,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n["a"].get("/api/sql/instance");case 2:e=t.sent,a=[],s=!1,t.t0=regeneratorRuntime.keys(e);case 6:if((t.t1=t.t0()).done){t.next=31;break}o=t.t1.value,i={id:o,name:o.toUpperCase(),children:[]},r=0;case 10:if(!(l=e[o][r])){t.next=26;break}if(s){t.next=17;break}return t.next=14,m.groupOwner(l);case 14:t.t2=t.sent,t.next=18;break;case 17:t.t2=[];case 18:c=t.t2,s=!0,l.dbType=o,l.children=c,i.children.push(l);case 23:r++,t.next=10;break;case 26:if(0!=i.children){t.next=28;break}return t.abrupt("continue",6);case 28:a.push(i),t.next=6;break;case 31:return t.abrupt("return",a);case 32:case"end":return t.stop()}}),t)})))()},all:function(){return n["a"].post("/api/instance/all",{}).then((function(t){return t.map((function(t){return t.label=t.name,t.children=[],t}))}))},info:function(t){return n["a"].post("/api/instance/info",{id:t}).then((function(t){return t}))},save:function(t){return n["a"].post(t.id?"/api/instance/upd":"/api/instance/add",t)},test:function(t){return n["a"].post("/api/instance/test",t)},startSDDP:function(t){return n["a"].post("/api/instance/sddp/start",t)},cron_state:function(t,e,a){return n["a"].post("/api/instance/cron/state",{id:t,state:e,config:a})},monitor_state:function(t,e,a){return n["a"].post("/api/instance/monitor/state",{id:t,state:e,config:a?JSON.stringify(a):"{}"})},state:function(t,e){return n["a"].post("/api/instance/state",{id:t,state:e})},refresh:function(t){return n["a"].post("/api/instance/sync",{id:t})},reset:function(t){return n["a"].post("/api/instance/reset",{id:t})},delete:function(t){return n["a"].post("/api/instance/remove",{id:t})},sampleInfo:function(t){return n["a"].post("/api/db/info",{id:t})}}),h=m,b={info:function(t){return n["a"].post("/api/user/info",{id:t})},permissionAll:function(t){return n["a"].post("/api/user/perm/all",{id:t})},permissionChildren:function(t){return n["a"].post("/api/user/perm/children",t)},closeAuthState:function(t,e){return n["a"].post("/api/user/close/auth/state",{id:t,mark:e})},closeTfa:function(t,e){return n["a"].post("/api/user/close/tfa ",{id:t,mark:e})},delete:function(t){return n["a"].post("/api/user/remove",{id:t})},state:function(t,e){return n["a"].post("/api/user/state",{id:t,state:e})},focusSync:function(){return n["a"].post("/api/plugin/focus/sync",{})},edit:function(t){return n["a"].post(t.id?"/api/user/upd":"/api/user/add",t)}},_=b,g={all:function(t,e){return n["a"].post("/api/role/all",{flag:t,project:e})},upd:function(t){return n["a"].post("/api/role/upd",t)},save:function(t){return t.id?n["a"].post("/api/role/upd",t):n["a"].post("/api/role/add",t)},remove:function(t){return n["a"].post("/api/role/remove",{id:t})},kick:function(t,e){return n["a"].post("/api/role/kick",{role_id:t.id,user_id:e})},kickDB:function(t,e){return n["a"].post("/api/role/kick/db",{role_id:t.id,db_id:e})},kickStrategy:function(t,e){return n["a"].post("/api/role/kick/strategy",{role_id:t.id,sid:e})},relation_all:function(t,e){return n["a"].post("/api/role/relation/all",{role_id:t.id,user_id:e})},relation:function(t,e){return n["a"].post("/api/role/relation",{role_id:t.id,user_id:e})},relationDB:function(t,e){return n["a"].post("/api/role/relation/db",{role_id:t.id,db_id:e,project:t.project})},relationStrategy:function(t,e){return n["a"].post("/api/role/relation/strategy",{role_id:t.id,sid:e,project:t.project})}},v=g,y=(a("3ca3"),a("2ef0")),w={permissionDB:function(t){return n["a"].post("/api/role/permission/by/role",{roleId:t,towner:"*",tname:"*",tcol:"*"}).then((function(t){return t.map((function(t){var e={id:t.dbId,label:t.db_name,leaf:!1,permission:t,operType:t.oper_type,db_type:t.db_type,chk:0,rw:t.rw,ae:t.asyn_export,aq:t.asyn_query,as:t.asyn_sql,aw:t.audit_work,hasAuditWork:1,hasAsynExport:1==t.db_asyn_export,hasAsynQuery:1==t.db_asyn_query,hasAsynSql:1==t.db_asyn_sql,hasRW:2==t.oper_type||4==t.oper_type,hasMN:4==t.oper_type};return e}))}))},allDB:function(t){return Promise.all([n["a"].post("/api/instance/all",{}),n["a"].post("/api/role/permission/all",{roleId:t,towner:"*",tname:"*",tcol:"*"})]).then((function(t){var e=t[0]||[],a=t[1]||[];return e.map((function(t){var e=Object(y["find"])(a,{dbId:t.id}),s=e?e.rw:"",n=e?e.asyn_export:t.asyn_export,o=e?e.asyn_query:t.asyn_query,i=e?e.asyn_sql:t.asyn_sql,r=e?e.audit_work:t.audit_work;""!=s&&3!=s&&-1!=s||(n=0,o=0,i=0,r=0);var l={id:t.id,label:t.name,leaf:!1,db_id:t.id,permission:e,operType:t.oper_type,rw:s,db_type:t.db_type,ae:n,aq:o,as:i,aw:r,hasAsynExport:1==t.asyn_export,hasAsynQuery:1==t.asyn_query,hasAsynSql:1==t.asyn_sql,hasAuditWork:1,hasRW:2==t.oper_type||4==t.oper_type,hasMN:4==t.oper_type};return l}))}))},addDB:function(t,e,a,s){return n["a"].post("/api/role/permission/add",{roleId:t,dbId:e,project:s,towner:"*",tname:"*",tcol:"*",maskConfig:"{}",rw:a})},addDBChild:function(t,e,a,s){return n["a"].post("/api/role/permission/add/child",{roleId:t,dbId:e,chk:a,project:s})},addOwnerChild:function(t,e,a,s,o,i){return n["a"].post("/api/role/permission/add/owner/child",{roleId:t,owner:a,dbId:e,type:i,rw:s,project:o})},allInstanceNew:function(t,e){return n["a"].post("/api/role/permission/all/new",{project:t,role_id:e})},subNodes:function(t){return t.table?t.path="".concat(t.id,"/").concat(t.owner,"/").concat(t.table):t.path="".concat(t.id,"/").concat(t.owner),new Promise((function(e){n["a"].post("/api/role/permission/sub_nodes",t).then((function(a){return t.parentNode&&a.List&&a.List.forEach((function(e){e.parentNode||(e.parentNode=t.parentNode)})),e(a)}))}))},allOwner:function(t,e,a){return Promise.all([u.columns(e,""),n["a"].post("/api/role/permission/all",{roleId:t,dbId:e,tname:"*",tcol:"*"})]).then((function(t){var s=t[0]||[],n=t[1]||[],o=s.map((function(t){var s=Object(y["find"])(n,{towner:t}),o=s?s.rw:a.rw,i=s?s.asyn_export:0,r=s?s.asyn_query:0,l=s?s.asyn_sql:0,c=s?s.audit_work:0,u=s?s.asyn_export:a.ae,d=s?s.asyn_query:a.aq,p=s?s.asyn_sql:a.as,f=s?s.audit_work:a.aw,m=s?s.rw:"",h={id:s?s.id:Math.random(),label:t,leaf:!0,permission:s,rw:o,db_id:e,asyn_export:u||0,asyn_query:d||0,asyn_sql:p||0,audit_work:f||0,ae:u||0,aq:d||0,as:p||0,aw:f||0,real_rw:m,real_ae:i,real_aq:r,real_as:l,real_aw:c,parent:a};return h}));return o}))},addOwner:function(t,e,a,s,o){return n["a"].post("/api/role/permission/add",{roleId:t,project:o,dbId:e,towner:a,tname:"*",tcol:"*",maskConfig:"{}",rw:s})},allTable:function(t,e,a,s,o,i,r,l,c,d,p){return Promise.all([u.columns(e,"".concat(a,"."),!1,o,i,r,l,c,d,p),n["a"].post("/api/role/permission/all",{roleId:t,dbId:e,towner:a,tcol:"*"})]).then((function(t){var e=t[0]||[];p&&(e=t[0].list||[]);var a=t[1],n=e.map((function(t){var e=Object(y["find"])(a,{tname:t}),n=e?e.rw:s.rw,o=e?e.asyn_export:s.ae,i=e?e.asyn_query:s.aq,r=e?e.asyn_sql:s.as,l=e?e.audit_work:s.aw,c={id:e?e.id:Math.random(),label:t,leaf:!0,permission:e,rw:n,ae:o||0,aq:i||0,as:r||0,aw:l||0,asyn_export:o||0,asyn_query:i||0,asyn_sql:r||0,audit_work:l||0,parent:s};return c}));return p?{list:n||[],cursor:t[0].cursor,total:t[0].total}:n||[]}))},addTable:function(t,e,a,s,o,i,r){return n["a"].post("/api/role/permission/add",{roleId:t,dbId:e,tname:s,tcol:"*",maskConfig:"{}",towner:a,rw:o,type:i,project:r})},addPermission:function(t){return n["a"].post("/api/role/permission/add2",{roleId:t.roleId,dbId:t.dbId,tname:t.tname,tcol:"*",maskConfig:"{}",towner:t.towner,rw:t.rw,aq:t.aq,ae:t.ae,as:t.as,type:t.type,project:t.project})},addPermission2:function(t){var e=Object(s["a"])(Object(s["a"])({},t),{},{maskConfig:JSON.stringify(t.maskConfig||{}),rw:t.rw||t.perm.rw,aq:t.aq||t.perm.asyn_query||t.perm.aq,ae:t.ae||t.perm.asyn_export||t.perm.ae,as:t.as||t.perm.asyn_sql||t.perm.as});return n["a"].post("/api/role/permission/add2",e)},addAsyncPermission:function(t,e,a,s,o,i,r,l){return n["a"].post("/api/role/permission/async/add",{roleId:t,dbId:e,tname:s,towner:a,rw:o,async_flag:i,async_value:r,project:l})},allColumn:function(t,e,a,s,o,i){return Promise.all([u.columns(e,"".concat(a,".").concat(s),!1,i),n["a"].post("/api/role/permission/all",{roleId:t,dbId:e,towner:a,tname:s})]).then((function(t){var e=t[0]||[],a=t[1]||[];return e.map((function(t){var e=Object(y["find"])(a,{tcol:t}),s=e?e.rw:o.rw,n={id:e?e.id:Math.random(),label:t,leaf:!0,permission:e,rw:s,parent:o,maskConfig:e?JSON.parse(e.maskConfig||"{}"):{}};return n}))}))},addColumn:function(t,e,a,s,o,i,r,l,c,u){return n["a"].post("/api/role/permission/add",{roleId:t,dbId:e,tname:s,tcol:o,maskConfig:JSON.stringify(i||{}),towner:a,rw:r,maskCode:l,mask:c,project:u})},remove:function(t){return n["a"].post("/api/role/permission/remove",t)}},S=w,E=(a("ac1f"),{ddl:function(t,e,a){return E.exec({iid:t.id,owner:e.id,sql:a,db_type:t.dbType||t.db_type,token:Date.now(),explain:!1,page_index:0,page_size:10})},audit:function(t){return n["a"].post("/api/sql/audit",t).then((function(t){return t})).catch((function(t){return console.error("error:",t),Object(l["Notification"])({title:"提示信息",message:t,type:"error",duration:2e3,position:"top-right",offset:100}),t}))},exec:function(t){return t.sql?n["a"].post("/api/sql/exec",t).then((function(e){var a=e.data,s=e.error,n=e.type,o=e.count,i=e.sql_type,r=e.work,l=e.table_name,c=e.table_rw,u=a&&!s?Object.keys(a[0]):[],d=Object.keys(u).length;if(n&&Object.keys(n).length>0&&d>0){var p=new Array(d);for(var f in n){var m=n[f];p[m.index]=m.name}u=p}return{ok:!0,head:u,type:n,sql_type:i,data:a||[],table_name:l,table_rw:c,count:o,work:r,params:t,error:s}})).catch((function(t){return console.error("error:",t),Object(l["Notification"])({title:"提示信息",message:t,type:"error",duration:2e3,position:"top-right",offset:100}),t})):(l["Message"].error({title:"请求",message:"请输入执行语句！",type:"error",duration:3e3}),Promise.reject(new Error))},history:function(t,e,a,s){return n["a"].post("/api/sql/history",{project:t,db_id:e,owner:a,keyword:s}).then((function(t){return t.list}))}}),k=E,x={page:function(t){return n["a"].post("/mask/find",t)},all:function(t){return n["a"].post("/mask/all",t)},one:function(t){return n["a"].get("/mask/".concat(t))},edit:function(t){return n["a"].post("/mask/edit",t)},delete:function(t){return n["a"].post("/mask/delete",t)}},T=x,C={page:function(t){return n["a"].post("/act/log/find",t)},all:function(t){return n["a"].post("/act/log/all",t)},one:function(t){return n["a"].get("/act/log/".concat(t))},edit:function(t){return n["a"].post("/act/log/edit",t)},delete:function(t){return n["a"].post("/act/log/delete",t)}},O=C,D={info:function(t,e,a,s,o){var i=l["Loading"].service({fullscreen:!0,background:"transparent"});return n["a"].post("/api/table/info",{id:t.id,db_type:t.dbType,owner:e,table:a,info:s,type:o}).then((function(t){return i.close(),t})).catch((function(t){throw i.close(),new Error(t)}))}},A=D,L={config:function(){return n["a"].get("/api/sysinfo/get")}},R=L,I={addInception:function(t,e){return n["a"].post("/api/system/inception/setting/add",{project:t,db_id:e}).then((function(t){return t}))},delInception:function(t,e){return n["a"].post("/api/system/inception/setting/del",{project:t,db_id:e}).then((function(t){return t}))},getInception:function(t){return n["a"].post("/api/system/inception/setting/get",{project:t}).then((function(t){return t}))},updateInceptionSetting:function(t){return n["a"].post("/api/system/inception/setting/config/update",t)},updateInceptionBackupSetting:function(t){return n["a"].post("/api/system/inception/setting/backup/update",t)},get:function(){return n["a"].post("/api/system/setting/get").then((function(t){return t}))},testEmailSetting:function(t){return n["a"].post("/api/system/setting/email/test",t)},updateWaringSetting:function(t){return n["a"].post("/api/system/setting/warning/update",t)},updateEmailSetting:function(t){return n["a"].post("/api/system/setting/email/update",t)},updateSmsSetting:function(t){return n["a"].post("/api/system/setting/sms/update",t)},updateSetting:function(t){return n["a"].post("/api/system/setting/update",t)},updateLicense:function(t){return n["a"].post("/api/system/license/update",t)},updateSafeConfig:function(t){return n["a"].post("/api/system/setting/safe/update",t)},updateMailConfig:function(t){return n["a"].post("/api/system/setting/mail/update",t)},updateSmsConfig:function(t){return n["a"].post("/api/system/setting/sms/update",t)},updateBackUpConfig:function(t){return n["a"].post("/api/system/setting/backup/update",t)},backupDel:function(t){return n["a"].post("/api/system/backup/del",{id:t})},backupList:function(t){return n["a"].post("/api/system/backup/page",t)},backup:function(t){return n["a"].post("/api/system/backup",t)},restore_backup:function(t){return n["a"].post("/api/system/restore",{id:t})},reboot:function(){return n["a"].post("/api/system/reboot")}},j=I,N={all:function(){return n["a"].post("/api/strategy/all",{}).then((function(t){return t.map((function(t){return t.label=t.name,t.children=[],t}))}))},info:function(t){return n["a"].post("/api/strategy/info",{id:t}).then((function(t){return t}))},test:function(t){return n["a"].post("/api/strategy/test",t)},save:function(t){return n["a"].post("/api/strategy/add",t)},update:function(t){return n["a"].post("/api/strategy/upd",t)},delete:function(t){return n["a"].post("/api/strategy/remove",{id:t})}},P=N,$={page:function(t){return n["a"].post("/mask/find",t)},all:function(t){return n["a"].post("/mask/all",t)},applyAdd:function(t){return n["a"].post("/api/apply/add",t)},auditExec:function(t){return n["a"].post("/api/audit/exec",t)},edit:function(t){return n["a"].post("/mask/edit",t)},delete:function(t){return n["a"].post("/mask/delete",t)}},M=$,U={export_stat_report:function(t){return n["a"].post("/api/sys/report/stat/export",t)}},q=U,F=(a("caad"),{myMsgList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0==t.msg_flag&&(t.msg_flag=1),void 0==t.page_no&&(t.page_no=0),void 0==t.page_size&&(t.page_size=10);var e=["read_state","msg_type","msg_flag","page_no","page_size"],a={};return Object.keys(t).forEach((function(s){e.includes(s)&&void 0!=t[s]&&(a[s]=t[s])})),n["a"].post("/api/my/msg/list",a)},myListRecord:function(t){void 0==t.page_no&&(t.page_no=0),void 0==t.page_size&&(t.page_size=10);var e=["user_id","page_no","page_size"],a={};return Object.keys(t).forEach((function(s){e.includes(s)&&void 0!=t[s]&&(a[s]=t[s])})),n["a"].post("/api/my/msg/record",a)},myMsgSend:function(t,e){return n["a"].post("/api/my/msg/send",{to_user:t,content:e})},myMsgRead:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n["a"].post("/api/my/msg/read",{ids:t})},myMsgDelete:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n["a"].post("/api/my/msg/del",{ids:t})},myMsgExec:function(t){return n["a"].post("/api/my/msg/exec",t)},myMsgState:function(){return n["a"].post("/api/my/msg/stat")},myProjectList:function(t){return n["a"].post("/api/my/project/list")},myWorkList:function(t){return n["a"].post("/api/my/wrok/list",t)},myApplyProjectList:function(t){return n["a"].post("/api/my/project/apply/list")},myAuth:function(t){return n["a"].post("/api/my/auth",{project:t})},myApplyRoleList:function(){return n["a"].post("/api/my/apply/role/list")},myAuthChildren:function(t){return n["a"].post("/api/my/auth/children",t)},info:function(){return n["a"].post("/api/my/info")},addAuthCode:function(){return n["a"].post("/api/my/add/auth/code")},bindAuthCode:function(t){return n["a"].post("/api/my/bind/auth/code",t)},unBindAuthCode:function(t){return n["a"].post("/api/my/close/auth/code",t)},authPinCode:function(t){return n["a"].post("/api/my/check/auth/code",t)},logout:function(){return n["a"].post("/api/my/logout")}}),V=F,z=["Audit Completed","Execute failed","Execute Successfully","Execute Successfully\nBackup failed","Execute Successfully\nBackup Successfully","unknown status","Audit fail","No Audit"],B=["RERUN","CHECKED","EXECUTED","BACKUP"],H={logList:function(t,e,a){return n["a"].post("/api/work/log/list",{id:t,page_no:e,page_size:a})},backupList:function(t){return n["a"].post("/api/work/backup/list",{id:t})},sqlAuditList:function(t,e,a){return n["a"].post("/api/work/sql/audit/list",{id:t,page_no:e,page_size:a})},page:function(t){return n["a"].post("/api/work/list",t)},info:function(t){return n["a"].post("/api/work/info",{id:t})},add:function(t){return n["a"].post("/api/work/add",t)},cancel:function(t){return n["a"].post("/api/work/cancel",t)},audit:function(t){return n["a"].post("/api/work/audit",t)},changeTime:function(t){return n["a"].post("/api/work/change/time",t)},exec:function(t,e){return n["a"].post("/api/work/exec",{id:t,status:e})},edit:function(t){return n["a"].post("/api/work/edit",t)},delete:function(t){return n["a"].post("/api/work/delete",t)},showStatus:function(t){return 0==t?"待审核":1==t?"审核通过":2==t?"审核不通过":3==t?"人工终止流程":4==t?"定时执行":5==t?"执行中":6==t?"执行成功":7==t?"执行失败":8==t?"执行成功(线下)":"未知状态"},showTagType:function(t){return 0==t?"info":1==t?"":2==t||3==t?"warning":4==t?"":5==t?"warning":6==t?"success":7==t?"danger":""},showStageStatus:function(t){return t<z.length?z[t]:"unknown status"},showStage:function(t){return t<B.length?B[t]:"unknown status"},showLevelStyle:function(t){return 0===t?"pass":1===t?"warning":2===t?"error":void 0},showLevelTagType:function(t){return 0==t?"success":1==t?"warning":2==t?"danger":""},work_audit:function(t){return n["a"].post("/api/sql/work/audit",t).then((function(t){return t})).catch((function(t){return console.error("error:",t),Object(l["Notification"])({title:"提示信息",message:t,type:"error",duration:2e3,position:"top-right",offset:100}),t}))}},Y=H,G=a("6ace"),W={userPageList:function(t,e,a){return n["a"].post("/api/project/user/page",{id:t,page_no:e,page_size:a})},user_info:function(t){return n["a"].post("/api/project/user/info",{id:t})},userAll:function(t){return n["a"].post("/api/project/user/page",Object(s["a"])({page_no:0,page_size:999},t))},publicList:function(t){return n["a"].post("/api/project/public/all")},list:function(){return n["a"].post("/api/project/list")},managerList:function(t){return n["a"].post("/api/project/manager/list",{id:t})},all:function(t){return n["a"].post("/api/project/all",t)},info:function(t,e){return n["a"].post("/api/project/info",{id:t,flag:e})},permissionAll:function(t){return n["a"].post("/api/project/perm/all",{id:t})},permissionChildren:function(t){return n["a"].post("/api/project/perm/children",t)},delete:function(t,e){return n["a"].post("/api/project/remove",{id:t,del_state:e})},state:function(t,e){return n["a"].post("/api/project/state",{id:t,state:e})},kick:function(t,e){return n["a"].post("/api/project/kick",{project:t,user_id:e})},kickDB:function(t,e){return n["a"].post("/api/project/kick/db",{project:t.id,db_id:e})},syncDB:function(t,e){return n["a"].post("/api/project/db/sync",{project:t,db_id:e})},user_upd:function(t,e,a){return n["a"].post("/api/project/user/upd",{project:t.id,user_id:e,project_role:a})},relation:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n["a"].post("/api/project/relation",{project:t.id,user_id:e,role_id:a})},relationDB:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n["a"].post("/api/project/relation/db",{project:t.id,db_id:e,role_ids:a})},updWorkSetting:function(t){return n["a"].post("/api/project/work/setting/upd",t)},updOtherConfig:function(t){return n["a"].post("/api/project/other/config/upd",t)},edit:function(t){return n["a"].post(t.id?"/api/project/upd":"/api/project/add",t)},post:function(t){return n["a"].post("/api/project/post",t)},upload:function(t){return n["a"].upload("/api/project/upload",t)}},K=W,X={page:function(t){return n["a"].post("/api/rule/page",t)},all:function(t){return n["a"].post("/api/rule/all",t)},get:function(t){return n["a"].post("/api/rule/info",{id:t})},edit:function(t){return n["a"].post("/api/rule/add",t)},delete:function(t){return n["a"].post("/api/rule/del",t)}},Q=X,J={page:function(t){return n["a"].post("/api/ssh/page",t)},get:function(t){return n["a"].post("/api/ssh/info",{id:t})},add:function(t){return n["a"].post("/api/ssh/add",t)},delete:function(t){return n["a"].post("/api/ssh/del",t)},getLog:function(t){return n["a"].post("/api/ssh/log/info",{id:t})},hardware:function(t){return n["a"].post("/api/ssh/hardware",{id:t})},deleteLog:function(t){return n["a"].post("/api/ssh/log/del",t)},addFilter:function(t){return n["a"].post("/api/ssh/filter/add",t)},filterPage:function(t){return n["a"].post("/api/ssh/filter/page",t)},delFilter:function(t){return n["a"].post("/api/ssh/filter/del",{id:t})},getFilter:function(t){return n["a"].post("/api/ssh/filter/info",{id:t})},addUser:function(t,e,a){return n["a"].post("/api/ssh/rel/user",{id:t,user_id:e,filter_id:a})},delUsers:function(t,e){return n["a"].post("/api/ssh/kick/user",{id:t,user_id:e})}},Z=J,tt={},et=tt;e["default"]=Object(s["a"])(Object(s["a"])({},n["a"]),{},{sys:R,my:V,table:A,task:i,auto:u,favorite:p,db:h,user:_,role:v,setting:j,permission:S,sql:k,mask:T,stat:q,actLog:O,strategy:P,apply:M,util:G["a"],work:Y,project:K,rule:Q,ssh:Z,sddp:et})},3660:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"work padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/sddp/list","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"工单状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.work_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.addTask()}}},[t._v("新建扫描")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源",prop:"db_name"}}),a("el-table-column",{attrs:{label:"数据源类型",prop:"db_type",width:"120"}}),a("el-form-item",{attrs:{label:"自动扫描:"}}),a("el-table-column",{attrs:{label:"扫描状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showTagType(e.row.status)}},[t._v(t._s(t.showStatus(e.row.status)))])]}}])}),a("el-table-column",{attrs:{label:"下次扫描时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"完成时间",prop:"db_name"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v("扫描 ")])]}}])})],1)],2),a("dialog-task",{ref:"taskDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c892"),l={computed:Object(o["a"])({},Object(i["c"])(["showWorkType"])),data:function(){return{search2:{db_type:null},search:{db_type:null,status:-1},work_states:[{k:-1,v:"全部"},{k:0,v:"待审核"},{k:1,v:"审核通过"},{k:2,v:"审核不通过"},{k:3,v:"人工终止流程"},{k:4,v:"定时执行"},{k:5,v:"执行中"},{k:68,v:"执行成功"},{k:7,v:"执行失败"}]}},props:{},watch:{},methods:{showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={status:-1}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},addTask:function(t){this.$refs.taskDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogTask:r["default"]},mounted:function(){}},c=l,u=(a("5a98"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"36d7":function(t,e,a){},"36ff":function(t,e,a){},"370d":function(t,e,a){},"374f":function(t,e,a){"use strict";a("f8c5")},"37f8":function(t,e,a){},"382e":function(t,e,a){"use strict";a("69f6")},3837:function(t,e,a){"use strict";a("caa3")},"384c":function(t,e,a){"use strict";a("21b9")},3867:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"工单流程设置",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-alert",{staticStyle:{"margin-bottom":"30px"},attrs:{title:"设置说明",type:"info",description:"默认为当前组审核，选择多个权限组审批流程为多级审核，权限组内有管理权限的用户都可审核"}}),a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"120px"}},[a("el-form-item",{attrs:{label:"项目"}},[t._v(" "+t._s(t.formData.name)+" ")]),a("el-form-item",{attrs:{label:"当前流程"}},[t._v(" "+t._s(t.formData.sql_audit_auth_str)+" ")]),a("el-form-item",{attrs:{label:"变更流程"}},[a("k-select",{attrs:{multiple:"",url:"/api/project/all"},model:{value:t.checks,callback:function(e){t.checks=e},expression:"checks"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("c1df")),r=a.n(i),l=a("2f62"),c=a("5c96"),u={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,projects:[],checks:[],checks2:[],formData:{name:"",roles:[],public_state:2,sql_audit_auth:""},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["e"])(["user"])),methods:{showTime:function(t){return r()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],checks:[],checks2:[],public_state:2,roles_str:""}},show:function(t){var e=this;this.id=t?t.id:null,this.checks=[],this.checks2=[],this.id?(this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,t.sql_audit_auth,e.isShow=!0})),this.$api.project.all().then((function(t){e.projects=t}))):(this.formData=this.reset(),this.isShow=!0)},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;this.checks&&this.checks.length>0?this.formData.sql_audit_auth=this.checks.join(","):this.formData.sql_audit_auth="",this.$api.project.updWorkSetting(this.formData).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){},components:{}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},"391b":function(t,e,a){"use strict";a.r(e);var s=a("5530"),n=(a("4de4"),a("5a0c")),o=a.n(n),i=a("2ef0"),r=a("c276");e["default"]={namespaced:!0,state:{log:[]},getters:{length:function(t){return t.log.length},lengthError:function(t){return t.log.filter((function(t){return"danger"===t.type})).length}},actions:{push:function(t,e){var a=t.rootState,n=t.commit,l=e.message,c=e.type,u=void 0===c?"info":c,d=e.meta;n("push",{message:l,type:u,time:o()().format("YYYY-MM-DD HH:mm:ss"),meta:Object(s["a"])({user:a.d2admin.user.info,uuid:r["a"].cookies.get("uuid"),token:r["a"].cookies.get("token"),url:Object(i["get"])(window,"location.href","")},d)})}},mutations:{push:function(t,e){t.log.push(e)},clean:function(t){t.log=[]}}}},3925:function(t,e,a){"use strict";a("3a4c")},3955:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"role",attrs:{type:"ghost"}},[a("el-row",{staticClass:"el-row",attrs:{gutter:12}},[a("el-col",{attrs:{span:5}},[a("role-list",{ref:"roleList",attrs:{project_id:t.projectId,project:t.selectProject},on:{"on-project":t.onProject,role:t.onRole}})],1),a("el-col",{attrs:{span:7}},[a("instance-list",{ref:"dbList",attrs:{project_id:t.projectId,project:t.selectProject},on:{owner:t.onOwner,"refresh-next":t.onRefreshNext}})],1),a("el-col",{staticClass:"col-table-list",attrs:{span:7}},[a("table-list",{ref:"tabList",attrs:{project_id:t.projectId,project:t.selectProject,role:t.selectRole,owner:t.selectOwner},on:{"refresh-next":t.onRefreshNext,table:t.onTable}})],1),a("el-col",{attrs:{span:5}},[a("column-list",{ref:"colList",attrs:{role:t.selectRole,project_id:t.projectId,owner:t.selectOwner,table:t.selectTable,type:t.selectType}})],1)],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("b64b"),a("2f62")),r=a("3ea6"),l=a("d23f"),c=a("890c"),u=a("b267"),d={name:"project-role",components:{RoleList:r["default"],InstanceList:l["default"],ColumnList:u["default"],TableList:c["default"]},computed:Object(o["a"])({},Object(i["e"])(["dashboard_project"])),data:function(){return{is_admin:!1,isShow:!1,title:"项目权限设置",projectId:"",selectProject:{id:""},selectRole:{},selectDbLink:"*",selectOwner:{},selectTable:{},selectType:"table"}},methods:{showHandle:function(){},show:function(t,e){var a=this;console.log("[role.index methods] show: ",t),this.projectId=t.id,this.$api.project.info(t.id).then((function(s){a.selectProject=s,""==s.other_config?a.configForm=s.other_config_po:a.configForm=JSON.parse(s.other_config),a.title="项目【"+t.name+"】权限设置(ESC退出)",a.is_admin=e,a.isShow=!0}))},hide:function(){this.is_admin=!1,this.id="",this.selectProject={id:""},this.selectRole={},this.selectOwner={},this.selectDbLink="",this.selectTable={},this.isShow=!1},onProject:function(t){this.selectProject=t,console.log("[role.index methods] onProject: ",t),this.projectId=t.id,this.selectRole={},this.selectOwner={},this.selectDbLink="",this.selectTable={},console.log("this.$refs.roleList:",this.$refs.roleList),this.$refs.roleList.refresh(t.id)},onRole:function(t){console.log("onRole......",t),this.selectRole=t,this.selectOwner={},this.selectDbLink="",this.selectTable={},this.$refs.dbList.doRefresh(t)},onOwner:function(t){console.log("onOwner: ",this.selectTable);var e=Object.keys(this.selectTable);e.length>0&&this.selectOwner!=t&&(this.selectTable={}),this.selectOwner=t},onRefreshNext:function(t){console.log("[project/role.vue]#onRefreshNext()",t),"owner"==t?(this.$refs.tabList.refresh(null,!0),this.selectTable={}):"table"==t&&this.$refs.colList.refresh()},onTable:function(t,e){this.selectTable=t,this.selectType=e}},created:function(){this.show(this.dashboard_project,!0)}},p=d,f=(a("c4d8"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,"265e2536",null);e["default"]=m.exports},"39ce":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:t.id?"修改策略":"新增策略",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-steps",{attrs:{active:t.step,"finish-status":"success"}},[a("el-step",{attrs:{title:"选择模板"}}),a("el-step",{attrs:{title:"选择目标"}}),a("el-step",{attrs:{title:"提交数据"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.step&&!t.id,expression:"step==1&&!id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略类型"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dList",attrs:{data:t.dList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center"},[a("div",{staticClass:"left",on:{click:function(e){return t.onClickList(s)}}},[a("span",[t._v(" "+t._s(s.name))])])])}}])})],1)],2)],1),a("el-col",{attrs:{span:12}},[a("k-card",{attrs:{head:"策略模板"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"typeList",attrs:{data:t.typeList,props:t.treeProps,"highlight-current":""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between hbox-center"},[a("div",{staticClass:"left",on:{click:function(e){return t.onClickType(s)}}},[a("span",[t._v(" "+t._s(s.name))])])])}}])})],1)],2)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:2==t.step&&!t.id,expression:"step==2&&!id"}],staticClass:"role"},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{span:8}},[a("db-list",{on:{db:t.onDb}})],1),a("el-col",{attrs:{span:8}},[a("owner-list",{ref:"ownerList",on:{owner:t.onOwner,refreshNext:t.refreshNext}})],1),a("el-col",{attrs:{span:8}},[a("table-list",{ref:"tabList",attrs:{db:t.selectDb,owner:t.selectOwner},on:{table:t.onTable}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"primary",disabled:!(t.selectTable&&t.selectTable.name)},on:{click:function(e){t.step=t.step+1}}},[t._v("下一步")])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:3==t.step||t.id,expression:"step==3||id"}],staticClass:"role"},[a("k-card",{attrs:{head:"参数设定"}},[a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"150px"}},[a("div",[a("el-form-item",{attrs:{label:"策略名称"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),a("el-form-item",{attrs:{label:"数据表"}},[a("el-tooltip",{attrs:{placement:"top",content:"数据表，* 代表所有表，可以前后加*模糊匹配"}},[a("el-input",{attrs:{size:"mini",disabled:"query_count"!=t.tid},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}})],1)],1),t._l(t.tplList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.name}},[a("el-tooltip",{attrs:{placement:"top",content:e.tip}},["number"==e.type?a("el-input-number",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}}):t._e(),"params_select"==e.type?a("div",[a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.mustParamsConfigList,"show-header":!1}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择"},model:{value:s["param"],callback:function(e){t.$set(s,"param",e)},expression:"row['param']"}},t._l(t.paramsList,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})})),1)]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.mustParamsConfigList)}}},[t._v(" 移除 ")]):t._e(),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addParamRow()}}},[t._v(" 添加 ")])]}}],null,!0)})],1)],1)],1):a("el-input",{attrs:{size:"mini"},model:{value:t.formData[e.id],callback:function(a){t.$set(t.formData,e.id,a)},expression:"formData[tpl.id]"}})],1)],1)}))],2)])],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.id,expression:"!id"}],on:{click:function(e){t.step=t.step-1}}},[t._v("上一步")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)],1)],1)},n=[],o=(a("b0c0"),a("a434"),a("7e57")),i=a("660b"),r=a("2971"),l=a("2e0b"),c=a("1f82"),u={data:function(){return{formData:{},match_type:"text",step:1,name:"",owner:"",tab:"",db_id:"",c_type:"",tid:"",rid:"",edit:!1,selectType:{},selectDb:{},selectOwner:{},selectTable:{},selectTpl:{},isShow:!1,id:"",treeProps:{label:"name"},dList:[{name:"查询策略",id:"SELECT",leaf:!0,c:[{name:"查询并发",id:"query_count",leaf:!0,c:[{name:"用户并发查询",id:"user_count",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"number"},{name:"全局并发查询",id:"global_count",leaf:!0,tip:"所有用户同时可进行几条查询,0或者空代表不限制。",type:"number"}]},{name:"查询条件",id:"query_where",leaf:!0,c:[{name:"查询必带参数",id:"must_param",leaf:!0,tip:"查询必带参数,可设置多个组合",type:"params_select"}]}]},{name:"脱敏策略",id:"MASK",leaf:!0}],mustParamsConfigList:[],typeList:[],tplList:[],dataList:[],paramsList:[]}},computed:{},props:{},watch:{},methods:{getName:function(){var t="";return this.selectDb&&this.selectDb.name&&(t=this.selectDb.name,this.selectOwner&&this.selectOwner.name&&(t=t+"/"+this.selectOwner.name,this.selectTable&&this.selectTable.name&&(t=t+"/"+this.selectTable.name,this.selectType&&this.selectType.name&&(t=t+"("+this.selectType.name+")")))),t},initMustParamsConfigList:function(){console.log("initMustParamsConfigList"),this.mustParamsConfigList=[],this.mustParamsConfigList.push({param:""})},onClickList:function(t){this.c_type=t.id,this.typeList=t.c?t.c:[]},onClickTpl:function(t){this.selectTpl=t,this.step++,this.tplList=t.c?t.c:[]},onClickType:function(t){console.log("onClickType:",t),this.step++,this.selectType=t,this.tid=t.id,this.tplList=t.c?t.c:[],this.formData={}},onNext:function(){},refreshNext:function(){this.$refs.tabList.refresh()},onDb:function(t){console.log("onDb......",t.name,t.id),this.selectDb=t,this.db_id=t.id,this.selectOwner={},this.selectTable={},this.rid="",this.tab="",this.$refs.ownerList.doRefresh(t)},onOwner:function(t){this.selectOwner=t,this.owner=t.name,this.selectTable={},this.rid="",this.tab=""},onTable:function(t){this.selectTable=t,this.rid=this.selectTable.id,this.tab=t.name,this.LoadParams(this.rid),this.name=this.getName()},LoadParams:function(t){var e=this;this.$api.auto.autoV3(t).then((function(t){var a=[];if(t)for(var s=0;s<t.length;s++)a.push(t[s].name);e.loading=!1,e.paramsList=a}))},show:function(t,e){t&&e?(this.id=t.id,this.db_id=t.db_id,this.c_type=t.c_type,this.tid=t.tid,this.rid=t.rid,this.name=t.name,this.owner=t.owner,this.tab=t.tab,this.formData={},this.loadStrategy()):(this.step=1,this.id="",this.formData={},this.initMustParamsConfigList()),this.isShow=!0},hide:function(){this.isShow=!1},deleteRow:function(t,e){e.splice(t,1)},addParamRow:function(){this.mustParamsConfigList.push({param:""})},loadStrategy:function(){var t=this;this.$api.strategy.info(this.id).then((function(e){if(""!=e&&e.config){t.formData=JSON.parse(e.config),t.formData.must_param&&t.formData.must_param.length>0?t.mustParamsConfigList=t.formData.must_param:t.initMustParamsConfigList();for(var a=!1,s=0;s<t.dList.length&&!a;s++){var n=t.dList[s];if(n.id==e.c_type&&n.c)for(var o=0;o<n.c.length&&!a;o++){var i=n.c[o];if(i.id==e.tid){t.tplList=i.c?i.c:[],a=!0;break}}}t.LoadParams(t.rid)}else t.$message({message:"加载失败，请刷新再试！",type:"warning"})}))},onSubmit:function(){var t=this;if(this.id){if(!this.id)return this.$message({message:"策略id不能为空",type:"warning"}),!1}else{if(!this.c_type)return this.$message({message:"模板不能为空",type:"warning"}),!1;if(!this.owner)return this.$message({message:"数据集不能为空",type:"warning"}),!1;if(!this.tab)return this.$message({message:"表名不能为空",type:"warning"}),!1;if(!this.db_id)return this.$message({message:"关联数据源不能为空",type:"warning"}),!1;if(!this.tid)return this.$message({message:"策略模板不能为空",type:"warning"}),!1}if(!this.name)return this.$message({message:"名称不能为空",type:"warning"}),!1;var e=this.formData;if("query_count"==this.tid&&e.user_count&&e.global_count){if(e.user_count=~~e.user_count,e.global_count=~~e.global_count,e.user_count>e.global_count)return this.$message({message:"用户并发查询不能大于全局并发查询",type:"warning"}),!1}else"query_where"==this.tid&&this.mustParamsConfigList&&this.mustParamsConfigList.length>0&&(e.must_param=this.mustParamsConfigList);var a=JSON.stringify(e);this.id?this.$api.strategy.update({id:this.id,config:a,tab:this.tab,name:this.name}).then((function(){t.onSuccess("更新成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})):this.$api.strategy.save({rid:this.rid,config:a,db_id:this.db_id,owner:this.owner,tab:this.tab,match_type:this.match_type,name:this.name,c_type:this.c_type,tid:this.tid}).then((function(){t.onSuccess("新增成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}},components:{ElCol:c["a"],ElRow:l["a"],DbList:o["default"],OwnerList:i["default"],TableList:r["default"]}},d=u,p=(a("9a32"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,"ea718c54",null);e["default"]=f.exports},"39e7":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.logData,border:!0}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("pre",{staticClass:"sql bg-color"},[t._v(t._s(e.row.sql))])]}}])}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sql_no)+" ")]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"sql",label:"SQL语句"}}),a("el-table-column",{attrs:{prop:"level",width:"80",label:"审核/执行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showLevelTagType(e.row.level)}},[t._v(" "+t._s(t.showLevel(e.row.level))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"result",width:"200",label:"审核/执行信息"}}),a("el-table-column",{attrs:{prop:"affected_rows",label:"扫描/影响行数",width:"80"}}),a("el-table-column",{attrs:{prop:"execute_time",width:"100",label:"执行耗时"}}),a("el-table-column",{attrs:{prop:"stage_status",width:"200",label:"当前阶段"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showStageStatus(e.row.stage_status))+" ")]}}])})],1)],1)},n=[],o={data:function(){return{}},props:{logData:Array},watch:{},computed:{},methods:{showStageStatus:function(t){return this.$api.work.showStageStatus(t)},showStage:function(t){return this.$api.work.showStage(t)},showLevel:function(t){return this.$api.work.showLevelStyle(t)},showLevelTagType:function(t){return this.$api.work.showLevelTagType(t)}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"39fd":function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("d708")),o=a("2ef0");e["default"]={namespaced:!0,state:{header:[],aside:[],asideCollapse:n["a"].menu.asideCollapse,queryPageAllowAsideCollapse:!0,asideTransition:n["a"].menu.asideTransition},actions:{asideCollapseSet:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,s.asideCollapse=e,a.next=4,n("d2admin/db/set",{dbName:"sys",path:"menu.asideCollapse",value:s.asideCollapse,user:!0},{root:!0});case 4:case"end":return a.stop()}}),a)})))()},asideCollapseToggle:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,a.asideCollapse=!a.asideCollapse,e.next=4,s("d2admin/db/set",{dbName:"sys",path:"menu.asideCollapse",value:a.asideCollapse,user:!0},{root:!0});case 4:case"end":return e.stop()}}),e)})))()},asideTransitionSet:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,s.asideTransition=e,a.next=4,n("d2admin/db/set",{dbName:"sys",path:"menu.asideTransition",value:s.asideTransition,user:!0},{root:!0});case 4:case"end":return a.stop()}}),a)})))()},asideTransitionToggle:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,a.asideTransition=!a.asideTransition,e.next=4,s("d2admin/db/set",{dbName:"sys",path:"menu.asideTransition",value:a.asideTransition,user:!0},{root:!0});case 4:case"end":return e.stop()}}),e)})))()},asideLoad:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,e.next=3,s("d2admin/db/get",{dbName:"sys",path:"menu",defaultValue:n["a"].menu,user:!0},{root:!0});case 3:o=e.sent,a.asideCollapse=void 0!==o.asideCollapse?o.asideCollapse:n["a"].menu.asideCollapse,a.asideTransition=void 0!==o.asideTransition?o.asideTransition:n["a"].menu.asideTransition;case 6:case"end":return e.stop()}}),e)})))()}},mutations:{headerSet:function(t,e){var a=e.length,s=Object(o["uniqBy"])(e,"path"),n=s.length;a!=n&&console.warn("[modules/menu.js]#headerSet:  ",a,n,e,s),t.header=s},asideSet:function(t,e){t.aside=e}}}},"3a2b":function(t,e,a){"use strict";a("2c7d")},"3a4c":function(t,e,a){},"3ae7":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.id?"修改主机信息":"新增主机信息",visible:t.isShow,width:"740px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formDataRules,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"name",label:"名称"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{prop:"ip",label:"地址"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}})],1),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",e)},expression:"formData.port"}})],1),a("el-form-item",{attrs:{label:"用户",prop:"user"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.user,callback:function(e){t.$set(t.formData,"user",e)},expression:"formData.user"}})],1),a("el-form-item",{attrs:{prop:"type",label:"认证方式"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},t._l(t.auth_types,(function(t){return a("el-option",{key:t.v,attrs:{label:t.l,value:t.v}})})),1)],1),"password"==t.formData.type?a("el-form-item",{attrs:{label:"密码",prop:"passowrd"}},[a("el-input",{attrs:{autocomplete:"off","show-password":""},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1):t._e(),"key"==t.formData.type?a("el-form-item",{attrs:{label:"密钥",prop:"rsa_key"}},[a("el-input",{attrs:{autocomplete:"off",type:"textarea",rows:10,placeholder:"复制 ~/.ssh/id_rsa 文件内容到这里"},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1):t._e(),a("el-form-item",{attrs:{prop:"info",label:"备注"}},[a("el-input",{attrs:{type:"textarea",placeholder:"",clearable:""},model:{value:t.formData.info,callback:function(e){t.$set(t.formData,"info",e)},expression:"formData.info"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onHide}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定 ")])],1)],1)},n=[],o=(a("d3b7"),a("27ae")),i=a("2ef0"),r={data:function(){return{id:0,isShow:!1,formData:this.reset(),auth_types:[{l:"密码",v:"password"},{l:"私钥id_rsa",v:"key"},{l:"本机私钥",v:"local_key"}],formDataRules:{name:[{required:!0,message:"请输入主机名称"}],user:[{required:!0,message:"请输入用户"}],port:[{required:!0,message:"请输入端口"}],ip:[{required:!0,message:"请输入地址"}]}}},props:{},watch:{},computed:{},methods:{reset:function(){return{id:0,name:"",host:"",password:"",type:"password",state:1,ip:"",port:22,info:""}},show:function(t){var e=this;this.formData=this.reset(),t?this.$api.ssh.get(t).then((function(a){e.id=t,e.formData=a,e.isShow=!0})):(this.id="",this.isShow=!0)},hide:function(){this.isShow=!1},onHide:function(){this.isShow=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=i["clone"](t.formData);a.password&&(a.password=o["Base64"].encode(a.password)),t.$api.ssh.add(a).then((function(e){t.isShow=!1,t.onSuccess("提交成功"),t.$emit("success")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})).finally((function(){t.loading=!1}))}}))}},mounted:function(){},components:{}},l=r,c=(a("c3d0"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"3aff":function(t,e,a){"use strict";a("47c4")},"3b3e":function(t,e,a){"use strict";a.r(e);var s=a("93bf"),n=a.n(s);e["default"]={namespaced:!0,state:{active:!1},actions:{listen:function(t){var e=t.commit;n.a.isEnabled&&n.a.on("change",(function(){n.a.isFullscreen||e("set",!1)}))},toggle:function(t){var e=t.commit;n.a.isFullscreen?(n.a.exit(),e("set",!1)):(n.a.request(),e("set",!0))}},mutations:{set:function(t,e){t.active=e}}}},"3b40":function(t,e,a){"use strict";a("3fce")},"3bf0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(" "+t._s(t.formData.source_name)+"(权限组) ")]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[t._v(" "+t._s(t.formData.auditor_name)+" ")]),a("el-form-item",{attrs:{label:"审核抄送",prop:"copy_to"}},[t._v(" "+t._s(""==t.copyTo?"无":t.copyTo)+" ")]),a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t._v(" "+t._s(t.showStatus())+" ")]),1!=t.formData.status?a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):t._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!=t.formData.status,expression:"formData.status!=1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)],1)},n=[],o=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],s=0;s<t.copy_to.length;s++)a.push(t.copy_to[s].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this.formData;t.status=this.status}},mounted:function(){},components:{}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"3bff":function(t,e){t.exports={keywords:["ACCESSIBLE","ACCOUNT","ACTION","ADD","AFTER","AGAINST","AGGREGATE","ALGORITHM","ALL","ALTER","ALWAYS","ANALYSE","ANALYZE","AND","ANY","AS","ASC","ASCII","ASENSITIVE","AT","AUTOEXTEND_SIZE","AUTO_INCREMENT","AVG","AVG_ROW_LENGTH","BACKUP","BEFORE","BEGIN","BETWEEN","BIGINT","BINARY","BINLOG","BIT","BLOB","BLOCK","BOOL","BOOLEAN","BOTH","BTREE","BY","BYTE","CACHE","CALL","CASCADE","CASCADED","CASE","CATALOG_NAME","CHAIN","CHANGE","CHANGED","CHANNEL","CHAR","CHARACTER","CHARSET","CHECK","CHECKSUM","CIPHER","CLASS_ORIGIN","CLIENT","CLOSE","COALESCE","CODE","COLLATE","COLLATION","COLUMN","COLUMNS","COLUMN_FORMAT","COLUMN_NAME","COMMENT","COMMIT","COMMITTED","COMPACT","COMPLETION","COMPRESSED","COMPRESSION","CONCURRENT","CONDITION","CONNECTION","CONSISTENT","CONSTRAINT","CONSTRAINT_CATALOG","CONSTRAINT_NAME","CONSTRAINT_SCHEMA","CONTAINS","CONTEXT","CONTINUE","CONVERT","CPU","CREATE","CROSS","CUBE","CURRENT","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","CURSOR_NAME","DATA","DATABASE","DATABASES","DATAFILE","DATE","DATETIME","DAY","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEALLOCATE","DEC","DECIMAL","DECLARE","DEFAULT","DEFAULT_AUTH","DEFINER","DELAYED","DELAY_KEY_WRITE","DELETE","DESC","DESCRIBE","DES_KEY_FILE","DETERMINISTIC","DIAGNOSTICS","DIRECTORY","DISABLE","DISCARD","DISK","DISTINCT","DISTINCTROW","DIV","DO","DOUBLE","DROP","DUAL","DUMPFILE","DUPLICATE","DYNAMIC","EACH","ELSE","ELSEIF","ENABLE","ENCLOSED","ENCRYPTION","END","ENDS","ENGINE","ENGINES","ENUM","ERROR","ERRORS","ESCAPE","ESCAPED","EVENT","EVENTS","EVERY","EXCHANGE","EXECUTE","EXISTS","EXIT","EXPANSION","EXPIRE","EXPLAIN","EXPORT","EXTENDED","EXTENT_SIZE","FALSE","FAST","FAULTS","FETCH","FIELDS","FILE","FILE_BLOCK_SIZE","FILTER","FIRST","FIXED","FLOAT","FLOAT4","FLOAT8","FLUSH","FOLLOWS","FOR","FORCE","FOREIGN","FORMAT","FOUND","FROM","FULL","FULLTEXT","FUNCTION","GENERAL","GENERATED","GEOMETRY","GEOMETRYCOLLECTION","GET","GET_FORMAT","GLOBAL","GRANT","GRANTS","GROUP","GROUP_REPLICATION","HANDLER","HASH","HAVING","HELP","HIGH_PRIORITY","HOST","HOSTS","HOUR","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IDENTIFIED","IF","IGNORE","IGNORE_SERVER_IDS","IMPORT","INDEX","INDEXES","INFILE","INITIAL_SIZE","INNER","INOUT","INSENSITIVE","INSERT","INSERT_METHOD","INSTALL","INSTANCE","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERVAL","INTO","INVOKER","IO","IO_AFTER_GTIDS","IO_BEFORE_GTIDS","IO_THREAD","IPC","ISOLATION","ISSUER","ITERATE","JOIN","JSON","KEY","KEYS","KEY_BLOCK_SIZE","KILL","LANGUAGE","LAST","LEADING","LEAVE","LEAVES","LEFT","LESS","LEVEL","LIKE","LIMIT","LINEAR","LINES","LINESTRING","LIST","LOAD","LOCAL","LOCALTIME","LOCALTIMESTAMP","LOCK","LOCKS","LOGFILE","LOGS","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MASTER","MASTER_AUTO_POSITION","MASTER_BIND","MASTER_CONNECT_RETRY","MASTER_DELAY","MASTER_HEARTBEAT_PERIOD","MASTER_HOST","MASTER_LOG_FILE","MASTER_LOG_POS","MASTER_PASSWORD","MASTER_PORT","MASTER_RETRY_COUNT","MASTER_SERVER_ID","MASTER_SSL","MASTER_SSL_CA","MASTER_SSL_CAPATH","MASTER_SSL_CERT","MASTER_SSL_CIPHER","MASTER_SSL_CRL","MASTER_SSL_CRLPATH","MASTER_SSL_KEY","MASTER_SSL_VERIFY_SERVER_CERT","MASTER_TLS_VERSION","MASTER_USER","MATCH","MAXVALUE","MAX_CONNECTIONS_PER_HOUR","MAX_QUERIES_PER_HOUR","MAX_ROWS","MAX_SIZE","MAX_STATEMENT_TIME","MAX_UPDATES_PER_HOUR","MAX_USER_CONNECTIONS","MEDIUM","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MEMORY","MERGE","MESSAGE_TEXT","MICROSECOND","MIDDLEINT","MIGRATE","MINUTE","MINUTE_MICROSECOND","MINUTE_SECOND","MIN_ROWS","MOD","MODE","MODIFIES","MODIFY","MONTH","MULTILINESTRING","MULTIPOINT","MULTIPOLYGON","MUTEX","MYSQL_ERRNO","NAME","NAMES","NATIONAL","NATURAL","NCHAR","NDB","NDBCLUSTER","NEVER","NEW","NEXT","NO","NODEGROUP","NONBLOCKING","NONE","NO_WAIT","NO_WRITE_TO_BINLOG","NUMBER","NUMERIC","NVARCHAR","OFFSET","OLD_PASSWORD","ON","ONE","ONLY","OPEN","OPTIMIZE","OPTIMIZER_COSTS","OPTION","OPTIONALLY","OPTIONS","OR","ORDER","OUT","OUTER","OUTFILE","OWNER","PACK_KEYS","PAGE","PARSER","PARSE_GCOL_EXPR","PARTIAL","PARTITION","PARTITIONING","PARTITIONS","PASSWORD","PHASE","PLUGIN","PLUGINS","PLUGIN_DIR","POINT","POLYGON","PORT","PRECEDES","PRECISION","PREPARE","PRESERVE","PREV","PRIMARY","PRIVILEGES","PROCEDURE","PROCESSLIST","PROFILE","PROFILES","PROXY","PURGE","QUARTER","QUERY","QUICK","RANGE","READ","READS","READ_ONLY","READ_WRITE","REAL","REBUILD","RECOVER","REDOFILE","REDO_BUFFER_SIZE","REDUNDANT","REFERENCES","REGEXP","RELAY","RELAYLOG","RELAY_LOG_FILE","RELAY_LOG_POS","RELAY_THREAD","RELEASE","RELOAD","REMOVE","RENAME","REORGANIZE","REPAIR","REPEAT","REPEATABLE","REPLACE","REPLICATE_DO_DB","REPLICATE_DO_TABLE","REPLICATE_IGNORE_DB","REPLICATE_IGNORE_TABLE","REPLICATE_REWRITE_DB","REPLICATE_WILD_DO_TABLE","REPLICATE_WILD_IGNORE_TABLE","REPLICATION","REQUIRE","RESET","RESIGNAL","RESTORE","RESTRICT","RESUME","RETURN","RETURNED_SQLSTATE","RETURNS","REVERSE","REVOKE","RIGHT","RLIKE","ROLLBACK","ROLLUP","ROTATE","ROUTINE","ROW","ROWS","ROW_COUNT","ROW_FORMAT","RTREE","SAVEPOINT","SCHEDULE","SCHEMA","SCHEMAS","SCHEMA_NAME","SECOND","SECOND_MICROSECOND","SECURITY","SELECT","SENSITIVE","SEPARATOR","SERIAL","SERIALIZABLE","SERVER","SESSION","SET","SHARE","SHOW","SHUTDOWN","SIGNAL","SIGNED","SIMPLE","SLAVE","SLOW","SMALLINT","SNAPSHOT","SOCKET","SOME","SONAME","SOUNDS","SOURCE","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_AFTER_GTIDS","SQL_AFTER_MTS_GAPS","SQL_BEFORE_GTIDS","SQL_BIG_RESULT","SQL_BUFFER_RESULT","SQL_CACHE","SQL_CALC_FOUND_ROWS","SQL_NO_CACHE","SQL_SMALL_RESULT","SQL_THREAD","SQL_TSI_DAY","SQL_TSI_HOUR","SQL_TSI_MINUTE","SQL_TSI_MONTH","SQL_TSI_QUARTER","SQL_TSI_SECOND","SQL_TSI_WEEK","SQL_TSI_YEAR","SSL","STACKED","START","STARTING","STARTS","STATS_AUTO_RECALC","STATS_PERSISTENT","STATS_SAMPLE_PAGES","STATUS","STOP","STORAGE","STORED","STRAIGHT_JOIN","STRING","SUBCLASS_ORIGIN","SUBJECT","SUBPARTITION","SUBPARTITIONS","SUPER","SUSPEND","SWAPS","SWITCHES","TABLE","TABLES","TABLESPACE","TABLE_CHECKSUM","TABLE_NAME","TEMPORARY","TEMPTABLE","TERMINATED","TEXT","THAN","THEN","TIME","TIMESTAMP","TIMESTAMPADD","TIMESTAMPDIFF","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRANSACTION","TRIGGER","TRIGGERS","TRUE","TRUNCATE","TYPE","TYPES","UNCOMMITTED","UNDEFINED","UNDO","UNDOFILE","UNDO_BUFFER_SIZE","UNICODE","UNINSTALL","UNION","UNIQUE","UNKNOWN","UNLOCK","UNSIGNED","UNTIL","UPDATE","UPGRADE","USAGE","USE","USER","USER_RESOURCES","USE_FRM","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALIDATION","VALUE","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARIABLES","VARYING","VIEW","VIRTUAL","WAIT","WARNINGS","WEEK","WEIGHT_STRING","WHEN","WHERE","WHILE","WITH","WITHOUT","WORK","WRAPPER","WRITE","X509","XA","XID","XML","XOR","YEAR","YEAR_MONTH","ZEROFILL"],operators:["AND","BETWEEN","IN","LIKE","NOT","OR","IS","NULL","INTERSECT","UNION","INNER","JOIN","LEFT","OUTER","RIGHT"],functions:["ABS","ACOS","ADDDATE","ADDTIME","AES_DECRYPT","AES_ENCRYPT","ANY_VALUE","Area","AsBinary","AsWKB","ASCII","ASIN","AsText","AsWKT","ASYMMETRIC_DECRYPT","ASYMMETRIC_DERIVE","ASYMMETRIC_ENCRYPT","ASYMMETRIC_SIGN","ASYMMETRIC_VERIFY","ATAN","ATAN2","ATAN","AVG","BENCHMARK","BIN","BIT_AND","BIT_COUNT","BIT_LENGTH","BIT_OR","BIT_XOR","Buffer","CAST","CEIL","CEILING","Centroid","CHAR","CHAR_LENGTH","CHARACTER_LENGTH","CHARSET","COALESCE","COERCIBILITY","COLLATION","COMPRESS","CONCAT","CONCAT_WS","CONNECTION_ID","Contains","CONV","CONVERT","CONVERT_TZ","ConvexHull","COS","COT","COUNT","CRC32","CREATE_ASYMMETRIC_PRIV_KEY","CREATE_ASYMMETRIC_PUB_KEY","CREATE_DH_PARAMETERS","CREATE_DIGEST","Crosses","CURDATE","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURTIME","DATABASE","DATE","DATE_ADD","DATE_FORMAT","DATE_SUB","DATEDIFF","DAY","DAYNAME","DAYOFMONTH","DAYOFWEEK","DAYOFYEAR","DECODE","DEFAULT","DEGREES","DES_DECRYPT","DES_ENCRYPT","Dimension","Disjoint","Distance","ELT","ENCODE","ENCRYPT","EndPoint","Envelope","Equals","EXP","EXPORT_SET","ExteriorRing","EXTRACT","ExtractValue","FIELD","FIND_IN_SET","FLOOR","FORMAT","FOUND_ROWS","FROM_BASE64","FROM_DAYS","FROM_UNIXTIME","GeomCollFromText","GeometryCollectionFromText","GeomCollFromWKB","GeometryCollectionFromWKB","GeometryCollection","GeometryN","GeometryType","GeomFromText","GeometryFromText","GeomFromWKB","GeometryFromWKB","GET_FORMAT","GET_LOCK","GLength","GREATEST","GROUP_CONCAT","GTID_SUBSET","GTID_SUBTRACT","HEX","HOUR","IF","IFNULL","INET_ATON","INET_NTOA","INET6_ATON","INET6_NTOA","INSERT","INSTR","InteriorRingN","Intersects","INTERVAL","IS_FREE_LOCK","IS_IPV4","IS_IPV4_COMPAT","IS_IPV4_MAPPED","IS_IPV6","IS_USED_LOCK","IsClosed","IsEmpty","ISNULL","IsSimple","JSON_APPEND","JSON_ARRAY","JSON_ARRAY_APPEND","JSON_ARRAY_INSERT","JSON_CONTAINS","JSON_CONTAINS_PATH","JSON_DEPTH","JSON_EXTRACT","JSON_INSERT","JSON_KEYS","JSON_LENGTH","JSON_MERGE","JSON_MERGE_PRESERVE","JSON_OBJECT","JSON_QUOTE","JSON_REMOVE","JSON_REPLACE","JSON_SEARCH","JSON_SET","JSON_TYPE","JSON_UNQUOTE","JSON_VALID","LAST_INSERT_ID","LCASE","LEAST","LEFT","LENGTH","LineFromText","LineStringFromText","LineFromWKB","LineStringFromWKB","LineString","LN","LOAD_FILE","LOCALTIME","LOCALTIMESTAMP","LOCATE","LOG","LOG10","LOG2","LOWER","LPAD","LTRIM","MAKE_SET","MAKEDATE","MAKETIME","MASTER_POS_WAIT","MAX","MBRContains","MBRCoveredBy","MBRCovers","MBRDisjoint","MBREqual","MBREquals","MBRIntersects","MBROverlaps","MBRTouches","MBRWithin","MD5","MICROSECOND","MID","MIN","MINUTE","MLineFromText","MultiLineStringFromText","MLineFromWKB","MultiLineStringFromWKB","MOD","MONTH","MONTHNAME","MPointFromText","MultiPointFromText","MPointFromWKB","MultiPointFromWKB","MPolyFromText","MultiPolygonFromText","MPolyFromWKB","MultiPolygonFromWKB","MultiLineString","MultiPoint","MultiPolygon","NAME_CONST","NOT IN","NOW","NULLIF","NumGeometries","NumInteriorRings","NumPoints","OCT","OCTET_LENGTH","OLD_PASSWORD","ORD","Overlaps","PASSWORD","PERIOD_ADD","PERIOD_DIFF","PI","Point","PointFromText","PointFromWKB","PointN","PolyFromText","PolygonFromText","PolyFromWKB","PolygonFromWKB","Polygon","POSITION","POW","POWER","PROCEDURE ANALYSE","QUARTER","QUOTE","RADIANS","RAND","RANDOM_BYTES","RELEASE_ALL_LOCKS","RELEASE_LOCK","REPEAT","REPLACE","REVERSE","RIGHT","ROUND","ROW_COUNT","RPAD","RTRIM","SCHEMA","SEC_TO_TIME","SECOND","SESSION_USER","SHA1","SHA","SHA2","SIGN","SIN","SLEEP","SOUNDEX","SPACE","SQRT","SRID","ST_Area","ST_AsBinary","ST_AsWKB","ST_AsGeoJSON","ST_AsText","ST_AsWKT","ST_Buffer","ST_Buffer_Strategy","ST_Centroid","ST_Contains","ST_ConvexHull","ST_Crosses","ST_Difference","ST_Dimension","ST_Disjoint","ST_Distance","ST_Distance_Sphere","ST_EndPoint","ST_Envelope","ST_Equals","ST_ExteriorRing","ST_GeoHash","ST_GeomCollFromText","ST_GeometryCollectionFromText","ST_GeomCollFromTxt","ST_GeomCollFromWKB","ST_GeometryCollectionFromWKB","ST_GeometryN","ST_GeometryType","ST_GeomFromGeoJSON","ST_GeomFromText","ST_GeometryFromText","ST_GeomFromWKB","ST_GeometryFromWKB","ST_InteriorRingN","ST_Intersection","ST_Intersects","ST_IsClosed","ST_IsEmpty","ST_IsSimple","ST_IsValid","ST_LatFromGeoHash","ST_Length","ST_LineFromText","ST_LineStringFromText","ST_LineFromWKB","ST_LineStringFromWKB","ST_LongFromGeoHash","ST_MakeEnvelope","ST_MLineFromText","ST_MultiLineStringFromText","ST_MLineFromWKB","ST_MultiLineStringFromWKB","ST_MPointFromText","ST_MultiPointFromText","ST_MPointFromWKB","ST_MultiPointFromWKB","ST_MPolyFromText","ST_MultiPolygonFromText","ST_MPolyFromWKB","ST_MultiPolygonFromWKB","ST_NumGeometries","ST_NumInteriorRing","ST_NumInteriorRings","ST_NumPoints","ST_Overlaps","ST_PointFromGeoHash","ST_PointFromText","ST_PointFromWKB","ST_PointN","ST_PolyFromText","ST_PolygonFromText","ST_PolyFromWKB","ST_PolygonFromWKB","ST_Simplify","ST_SRID","ST_StartPoint","ST_SymDifference","ST_Touches","ST_Union","ST_Validate","ST_Within","ST_X","ST_Y","StartPoint","STD","STDDEV","STDDEV_POP","STDDEV_SAMP","STR_TO_DATE","STRCMP","SUBDATE","SUBSTR","SUBSTRING","SUBSTRING_INDEX","SUBTIME","SUM","SYSDATE","SYSTEM_USER","TAN","TIME","TIME_FORMAT","TIME_TO_SEC","TIMEDIFF","TIMESTAMP","TIMESTAMPADD","TIMESTAMPDIFF","TO_BASE64","TO_DAYS","TO_SECONDS","Touches","TRIM","TRUNCATE","UCASE","UNCOMPRESS","UNCOMPRESSED_LENGTH","UNHEX","UNIX_TIMESTAMP","UpdateXML","UPPER","USER","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","UUID","UUID_SHORT","VALIDATE_PASSWORD_STRENGTH","VALUES","VAR_POP","VAR_SAMP","VARIANCE","VERSION","WAIT_FOR_EXECUTED_GTID_SET","WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS","WEEK","WEEKDAY","WEEKOFYEAR","WEIGHT_STRING","Within","X","Y","YEAR","YEARWEEK"]}},"3c28":function(t,e,a){"use strict";a("11f0")},"3c57":function(t,e,a){"use strict";a("8082")},"3c60":function(t,e,a){},"3d06":function(t,e,a){},"3d13":function(t,e,a){},"3d21":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.logData,border:!0}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("pre",{staticClass:"sql bg-color"},[t._v(t._s(e.row.sql))])]}}])}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sql_no)+" ")]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"sql",label:"SQL语句"}}),a("el-table-column",{attrs:{prop:"level",width:"80",label:"审核/执行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showLevelTagType(e.row.level)}},[t._v(" "+t._s(t.showLevel(e.row.level))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"result",width:"200",label:"审核/执行信息"}}),a("el-table-column",{attrs:{prop:"affected_rows",label:"扫描/影响行数",width:"80"}}),a("el-table-column",{attrs:{prop:"execute_time",width:"100",label:"执行耗时"}}),a("el-table-column",{attrs:{prop:"stage_status",width:"200",label:"当前阶段"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showStageStatus(e.row.stage_status))+" ")]}}])})],1)],1)},n=[],o={data:function(){return{}},props:{logData:Array},watch:{},computed:{},methods:{showStageStatus:function(t){return this.$api.work.showStageStatus(t)},showStage:function(t){return this.$api.work.showStage(t)},showLevel:function(t){return this.$api.work.showLevelStyle(t)},showLevelTagType:function(t){return this.$api.work.showLevelTagType(t)}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"3d4f":function(t,e,a){},"3d8c":function(t,e,a){},"3dbf":function(t,e,a){"use strict";var s=a("2909"),n=(a("99af"),a("a15b"),a("d81d"),{});function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e="";switch(t){case"default":e="#35495E";break;case"primary":e="#3488ff";break;case"success":e="#43B883";break;case"warning":e="#e6a23c";break;case"danger":e="#f56c6c";break;default:break}return e}n.dev=function(){},n.error=function(){var t;(t=console).error.apply(t,arguments)},n.capsule=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"primary";console.log("%c ".concat(t," %c ").concat(e," %c"),"background:#35495E; padding: 1px; border-radius: 3px 0 0 3px; color: #fff;","background:".concat(o(a),"; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff;"),"background:transparent")},n.colorful=function(t){var e;(e=console).log.apply(e,["%c".concat(t.map((function(t){return t.text||""})).join("%c"))].concat(Object(s["a"])(t.map((function(t){return"color: ".concat(o(t.type),";")})))))},n.default=function(t){n.colorful([{text:t}])},n.primary=function(t){n.colorful([{text:t,type:"primary"}])},n.success=function(t){n.colorful([{text:t,type:"success"}])},n.warning=function(t){n.colorful([{text:t,type:"warning"}])},n.danger=function(t){n.colorful([{text:t,type:"danger"}])},e["a"]=n},"3de1":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return n}));var s=function(t,e){switch(arguments.length){case 1:return parseInt(Math.random()*t+1,10);case 2:return parseInt(Math.random()*(e-t+1)+t,10);default:return 0}},n=function(t){var e=document.querySelector('link[rel="icon"]');null!==e?e.href=t:(e=document.createElement("link"),e.rel="icon",e.href=t,document.head.appendChild(e))}},"3e2c":function(t,e,a){"use strict";a("5ea6")},"3e35":function(t,e,a){},"3e9e":function(t,e,a){"use strict";a("9579")},"3ea1":function(t,e,a){},"3ea6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:"角色列表",id:t.project_id,list:t.projectList},on:{sel:t.selItem}},[a("span",[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"输入关键字过滤角色",size:"small",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-tooltip",{attrs:{content:"新建角色,新建后双击角色名可进行修改或删除"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.showAddRole}},[t._v("新建角色")])],1)],1),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"roleList",attrs:{data:t.dataList,props:t.treeProps,"node-key":"id","highlight-current":"","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"role-row pointer-default item hbox-between hbox-center",on:{click:function(e){return t.onClick(s)}}},[a("div",{staticClass:"left margin-right-12"},[a("span",{on:{dblclick:function(e){return t.onEdit(s)}}},[t._v(t._s(s.name))])]),a("div",{staticClass:"right"},[a("span",{staticClass:"pointer-active",attrs:{title:"关联/移除用户"},on:{click:function(e){return e.stopPropagation(),t.$refs.userDialog.show(s,t.project)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(s.userCount)+") ")]),a("span",{staticClass:"pointer-active",attrs:{title:"关联/移除数据源"},on:{click:function(e){return e.stopPropagation(),t.$refs.dbDialog.show(s)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(s.dbCount)+") ")]),a("span",{staticClass:"pointer-active",attrs:{title:"关联/移除策略"},on:{click:function(e){return e.stopPropagation(),t.$refs.strategyDialog.show(s)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(s.strategyCount)+") ")])])])}}])})],1),a("dialog-user",{ref:"userDialog",on:{refresh:t.refresh}}),a("dialog-db",{ref:"dbDialog",on:{refresh:t.refresh}}),a("dialog-role",{ref:"roleDialog",on:{refresh:t.refresh}}),a("dialog-strategy",{ref:"strategyDialog",on:{refresh:t.refresh}})],2)},n=[],o=(a("4de4"),a("b0c0"),a("ac1f"),a("1276"),a("48e9")),i=a("4cc5"),r=a("81f5"),l=a("9f6e"),c=a("5c96"),u={data:function(){return{input3:"",filterType:"角色名",role:null,role_name:"",project_name:null,filterText:"",dataList:[],projectList:[],treeProps:{label:"name"}}},props:["project_id","project"],watch:{filterText:function(t){this.$refs.roleList.filter(t)},filterType:function(t){this.$refs.roleList.filter(this.filterText)},project_id:function(t){console.log("rolelist project_id has change ",t),this.refresh(t)}},methods:{showAddRole:function(){this.project?this.$refs.roleDialog.show({p:this.project}):c["Message"].error({title:"请求",message:"请选择当前项目！",type:"error",duration:2e3})},selItem:function(t){console.log("[role.list methods] selItem：",t),this.$emit("on-project",t)},onEdit:function(t){this.$refs.roleDialog.show({r:t,p:this.project})},filterNode:function(t,e){if(!t)return!0;if("用户名"==this.filterType){if(e.name==this.role_name)return!0;if(""!=e.user_names){var a=e.user_names.split(",");for(var s in a)if(-1!==a[s].toLowerCase().indexOf(t.toLowerCase()))return!0}return!1}if("数据源"==this.filterType){if(e.name==this.role_name)return!0;if(""!=e.db_names){var n=e.db_names.split(",");for(var o in n)if(-1!==n[o].toLowerCase().indexOf(t.toLowerCase()))return!0}return!1}return e.name==this.role_name||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(t){var e=this;console.log("rolelist refresh ",t),this.role={},t||(t=this.project.id),t?this.$api.role.all(1,t).then((function(t){if(t&&t.length>0){for(var a=0;a<t.length;a++)t[a].edit=!1,t[a].tname=t[a].name;e.role=t[0]}e.dataList=t,e.role&&e.role.id?(e.$emit("role",e.role),e.$nextTick((function(){e.$refs.roleList.setCurrentKey(e.role.id)}))):(e.role={},e.$emit("role",{}))})):(this.role={},this.$emit("role",{}))},onRemove:function(t){var e=this;this.$api.role.remove(t.id).then((function(t){e.onSuccess("删除成功"),e.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onClick:function(t){this.role=t,this.role_name=t.name,this.$emit("role",t)}},components:{DialogUser:o["default"],DialogDb:i["default"],DialogRole:l["default"],DialogStrategy:r["default"]},mounted:function(){this.refresh(this.project_id)}},d=u,p=(a("43d7"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},"3ec1":function(t,e,a){"use strict";a.r(e);var s=a("5530"),n=a("2909"),o=(a("ac1f"),a("841c"),a("159b"),a("99af"),a("a15b"),a("d708"));e["default"]={namespaced:!0,state:{active:!1,hotkey:{open:o["a"].hotkey.search.open,close:o["a"].hotkey.search.close},pool:[]},mutations:{toggle:function(t){t.active=!t.active},set:function(t,e){t.active=e},init:function(t,e){var a=[],o=function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.forEach((function(e){e.children?t(e.children,[].concat(Object(n["a"])(o),[e.title])):a.push(Object(s["a"])(Object(s["a"])({},e),{},{fullTitle:[].concat(Object(n["a"])(o),[e.title]).join(" / ")}))}))};o(e),t.pool=a}}}},"3eff":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tabs",{staticClass:"table-info",attrs:{type:"border-card",lazy:"true"},on:{"tab-click":t.getTableInfo},model:{value:t.cur_name,callback:function(e){t.cur_name=e},expression:"cur_name"}},[a("el-tab-pane",{attrs:{label:"字段定义",name:"struct"}},[a("el-table",{attrs:{size:"mini",data:t.data.struct}},t._l(t.struct,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),t.data.indexs?a("el-tab-pane",{attrs:{label:"索引",name:"indexs"}},[a("el-table",{attrs:{size:"mini",data:t.data.indexs}},t._l(t.indexs,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1):t._e(),!t.data.triggers||"mysql"!=t.params.dbType&&"oracle"!=t.params.dbType&&"postgres"!=t.params.dbType?t._e():a("el-tab-pane",{attrs:{label:"触发器",name:"triggers"}},[a("el-table",{attrs:{size:"mini",data:t.data.triggers}},t._l(t.triggers,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),!t.data.constraints||"mysql"!=t.params.dbType&&"oracle"!=t.params.dbType&&"postgres"!=t.params.dbType?t._e():a("el-tab-pane",{attrs:{label:"约束",name:"constraints"}},[a("el-table",{attrs:{size:"mini",data:t.data.constraints}},t._l(t.constraints,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),a("el-tab-pane",{attrs:{label:"建表语句",name:"info"}},[a("pre",{domProps:{innerHTML:t._s(t.table)}})]),"mysql"==t.params.dbType?a("el-tab-pane",{attrs:{label:"表信息",name:"tableInfo"}},[a("pre",{domProps:{innerHTML:t._s(t.data.tableInfo[0])}})]):t._e()],1)},n=[],o=a("5530"),i=(a("b0c0"),{name:"table-info",data:function(){return{data:{constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]},params:{iid:null,dbName:null,dbType:null,tableName:null,tableType:null},cur_name:"struct"}},computed:{table:function(){return this.data.info&&this.data.info.data?this.data.info.data:this.data.info?this.data.info["Create Table"]:""},struct:function(){return this.head("struct")},indexs:function(){return this.head("indexs")},triggers:function(){return this.head("triggers")},constraints:function(){return this.head("constraints")},tableInfo:function(){return this.head("tableInfo")}},methods:{init:function(t){this.params=Object(o["a"])({},t),this.getTableInfo({name:this.cur_name})},head:function(t){var e=this.data[t];return e&&e.length>0?e[0]:{}},hide:function(){this.cur_name="struct",this.data={constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}},getTableInfo:function(t,e){this.load(t.name)},load:function(t){var e=this,a={id:this.params.iid,dbType:this.params.dbType};this.$api.table.info(a,this.params.dbName,this.params.tableName,t,this.params.tableType).then((function(a){e.$set(e.data,t,a)}))}}}),r=i,l=(a("a72a"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"25e16940",null);e["default"]=c.exports},"3f97":function(t,e){},"3fce":function(t,e,a){},"3fd2":function(t,e,a){"use strict";a("4f8d")},4023:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:"修改可执行时间",visible:t.isShow,"append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"时间范围"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.execTimes,callback:function(e){t.execTimes=e},expression:"execTimes"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=a("2ef0"),i=a("c1df"),r=a.n(i),l={data:function(){return{esConfigList:[],isShow:!1,execTimes:[],formData:this.reset()}},computed:{},props:{},watch:{},methods:{reset:function(){return{exec_flag:1}},show:function(t){this.isShow=!0,this.formData=t},hide:function(){this.isShow=!1},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);this.execTimes.length<2?this.onError("执行时间范围不能为空"):(console.log(this.execTimes),e.exec_start=r()(this.execTimes[0]).format("YYYY-MM-DD HH:mm:ss"),e.exec_end=r()(this.execTimes[1]).format("YYYY-MM-DD HH:mm:ss"),this.$api.work.changeTime(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})))}},components:{},mounted:function(){}},c=l,u=(a("5815"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"67447eb5",null);e["default"]=d.exports},"40c3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据源/数据库/数据集"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤数据库",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"role-instance-list"},[a("el-collapse",{directives:[{name:"loading",rawName:"v-loading",value:t.dbloading,expression:"dbloading"}],on:{change:t.onSourceOpenChange},model:{value:t.activeId,callback:function(e){t.activeId=e},expression:"activeId"}},t._l(t.sourceList,(function(e,s){return a("el-collapse-item",{key:s,attrs:{name:e.id}},[a("template",{slot:"title"},[a("span",{class:{"auth-read":1==e.rw,"auth-write":2==e.rw,"auth-disable":3==e.rw,"auth-manage":4==e.rw}},[t._v(" "+t._s(t.showRw(e.rw))+" - "+t._s(e.label)+" ")])]),a("div",{staticClass:"item hbox-between no-user-select"},[a("div",{staticClass:"left"},[a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate(e),value:t.isCheckAll(e.id)},on:{change:function(a){return t.checkAllChangeHandler(a,e)}}},[t._v("全选")])],1),a("div",{staticClass:"center",staticStyle:{"font-size":"12px"}}),a("div",{staticClass:"right all pointer-active",attrs:{title:"批量设置"},on:{click:function(a){return t.openBatchDialog(e)}}},[t._v(" 批量设置 ")])]),t._l(t.filterDatabases[e.id],(function(s,n){return a("div",{key:n,staticClass:"db-row"},[a("div",{staticClass:"item hbox-between",class:{active:t.activeIndex==e.id+"_"+n},on:{click:function(a){return t.onClick(s,e,n)}}},[a("div",{staticClass:"left flex-over"},[a("span",{on:{click:function(t){return t.stopPropagation(),function(){}.apply(null,arguments)}}},[a("el-checkbox",{attrs:{value:t.isDbSelect(e.id,s.label)},on:{change:function(a){return t.onCheckDb(a,s,e)}}})],1),a("span",{class:{"auth-read":1==s.rw,"auth-write":2==s.rw,"auth-disable":3==s.rw,"auth-manage":4==s.rw}},[t._v(" "+t._s(s.label)+" ")])]),a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==s.rw},attrs:{title:"读权限"},on:{click:function(a){return t.onAuthOwner(s,e,1)}}},[t._v("读")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-write":2==s.rw},attrs:{title:"写权限"},on:{click:function(a){return t.onAuthOwner(s,e,2)}}},[t._v("写")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-manage":4==s.rw},attrs:{title:"管理权限"},on:{click:function(a){return t.onAuthOwner(s,e,4)}}},[t._v("管")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-disable":3==s.rw},attrs:{title:"禁用权限"},on:{click:function(a){return t.onAuthOwner(s,e,3)}}},[t._v("禁")]),t._v(" ( "),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==s.aq},attrs:{title:"异步查询权限"},on:{click:function(a){return t.onAuthOwnerAsync(s,e,"aq")}}},[t._v("")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==s.ae},attrs:{title:"数据导出/异步导出权限"},on:{click:function(a){return t.onAuthOwnerAsync(s,e,"ae")}}},[t._v("")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==s.as},attrs:{title:"SQL导出权限"},on:{click:function(a){return t.onAuthOwnerAsync(s,e,"as")}}},[t._v("")]),t._v(" ) ")])])])}))],2)})),1)],1),a("dialog-batchauth",{ref:"dialogBatchauthRef",attrs:{"confirm-loading":!0},on:{confirm:t.onBatchConfirm}})],2)},n=[],o=a("5530"),i=(a("4de4"),a("caad"),a("2532"),a("b64b"),a("159b"),a("07ac"),a("d3b7"),a("3ca3"),a("ddb0"),a("99af"),a("2ef0")),r=a("aa90"),l={components:{"dialog-batchauth":r["default"]},data:function(){return{activeId:null,activeIndex:-1,batchSource:{},selectedNodeList:[],checkedDatas:{},dbloading:!1,loading:!1,cur_name:"",filterText:"",sourceList:[],sourceList2:[],sources:{},databases:{},role:{},treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:["project_id","project"],computed:{filterDatabases:function(){var t=this,e=this.databases,a={};for(var s in e){var n=e[s],o=n.filter((function(e){return e.label.toLowerCase().includes(t.filterText.toLowerCase())}));a[s]=o}return a},isIndeterminate:function(){var t=this;return function(e){return!Object(i["isEmpty"])(t.checkedDatas[e.id])&&!t.isCheckAll(e.id)}},isCheckAll:function(){var t=this;return function(e){if(Object(i["isEmpty"])(t.checkedDatas[e]))return!1;var a=Object.keys(t.checkedDatas[e]),s=Object.keys(t.databases[e]);return a.length==s.length&&(console.log("选中全部："),!0)}},isDbSelect:function(){var t=this;return function(e,a){if(Object(i["isEmpty"])(t.checkedDatas[e]))return!1;var s=Object.keys(t.checkedDatas[e]);return s.includes(a)}}},mounted:function(){this.activeIndex=-1},methods:{checkAllChangeHandler:function(t,e){if(t){var a=this.databases[e.id],s={};a.forEach((function(t){s[t.label]=t})),this.$set(this.checkedDatas,e.id,s)}else this.$set(this.checkedDatas,e.id,{})},onSourceOpenChange:function(t){t=t instanceof Array?t[t.length-1]:t,t?this.getDatabse(t):console.log("收起数据源：",t)},getDatabse:function(t){this.databases[t]||this.onNextLoad(this.sources[t])},onCheckDb:function(t,e,a){if(console.log(t,e),t){if(this.checkedDatas[a.id])this.$set(this.checkedDatas[a.id],e.label,e);else{var s={};s[e.label]=e,this.$set(this.checkedDatas,a.id,s)}console.log("选中：",this.checkedDatas[a.id])}else{if(!this.checkedDatas[a.id]||!this.checkedDatas[a.id][e.label])return!1;console.log("取消"),this.$delete(this.checkedDatas[a.id],e.label)}},openBatchDialog:function(t){if(!this.checkedDatas||!this.checkedDatas[t.id]||0==Object.keys(this.checkedDatas[t.id]).length)return this.$message({message:"请勾选相应数据源下的数据库",type:"warning"}),!1;var e=this.checkedDatas[t.id];console.log("批量内容：",Object.values(e),t);var a=Object(o["a"])(Object(o["a"])({},t),{},{aq:1,ae:1,as:1});this.batchSource=t,this.$refs.dialogBatchauthRef.show(Object.values(e),a),this.$refs.dialogBatchauthRef.setHeaders({title:"设置权限",targetText:"数据源："+t.label})},onBatchConfirm:function(t){var e=this;console.log("[instance.list.vue] 批量设置数据库权限 - 参数：",t);var a=this.checkedDatas[this.batchSource.id],s=Object.values(a),n=[];s.forEach((function(a){n.push(e.addPermission2(e.batchSource.id,"*",a.label,-1==t.rw?a.rw:t.rw,-1==t.aq?a.aq:t.aq,-1==t.ae?a.ae:t.ae,-1==t.as?a.as:t.as,""))})),Promise.all(n).then((function(e){console.log("批量设置结果：",e);for(var a=0;a<s.length;a++)-1!=t.rw&&(s[a].rw=t.rw),-1!=t.ae&&(s[a].ae=t.ae),-1!=t.aq&&(s[a].aq=t.aq),-1!=t.as&&(s[a].as=t.as)})).catch((function(t){console.log("批量设置结果：error",t)})).finally((function(){e.$refs.dialogBatchauthRef.hide(),e.$emit("refresh-next","owner")}))},addPermission2:function(t){var e=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,i={roleId:this.role.id,dbId:t,tname:"*",towner:e,rw:a,aq:s,ae:n,as:o,type:"",project:this.project_id};return this.$api.permission.addPermission(i)},doRefresh:function(t){t?(this.role=t,this.refresh()):(this.role={},this.sourceList=[],this.activeId=null,this.databases={},this.checkedDatas={},this.sourceList2Sources())},filterNode:function(t,e){return!t||(!!e.leaf||(e.label==this.cur_name||(console.log("data.label:",e.label,"  value:",t,"  tolower:",e.label.toLowerCase()),-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))))},showRw:function(t){return 1==t?"只读":2==t?"读写":4==t?"管理":3==t?"禁用":"未知"},refresh:function(){var t=this;console.log("[instance.list methods] refresh..."),this.role&&this.role.id?this.$api.permission.allInstanceNew(this.project.id,this.role.id).then((function(e){t.sourceList2=e})):(this.sourceList=[],this.sourceList2=[],this.activeId=null,this.databases={},this.sourceList2Sources(),this.checkedDatas={})},sourceList2Sources:function(){var t={};this.sourceList.forEach((function(e){t[e.id]=e})),this.sources=t},onClick:function(t,e,a){if(console.log("[instance.list methods] onClick data:",t,"   db:",e),this.activeIndex="".concat(e.id,"_").concat(a),t.leaf){if(!e.rw)return this.$emit("owner",{}),void this.onError("请选授权数据仓库");this.cur_name=e.label,t.db=e,t.db_type=e.db_type,this.$emit("owner",t)}},onAuthDBAsync:function(t,e){var a=this,s="",n="",o=0;if(console.log("db:",t.id," db.ae:",t.ae,"db.aq:",t.aq,"  t:",e),!t.rw)return this.$emit("owner",{}),void this.onError("请选授权数据仓库");if(3!=t.rw){if("aw"==e)n="工单流程",1==t.aw?(t.aw=0,s="取消"):(t.aw=1,s="设置"),o=t.aw;else if("ae"==e){if(n="文件导出",!t.hasAsynExport&&0==t.ae)return void this.onError("该数据源不支持导出操作！");1==t.ae?(t.ae=0,s="取消"):(t.ae=1,s="设置"),o=t.ae}else if("aq"==e){if(n="异步查询",!t.hasAsynQuery&&0==t.aq)return void this.onError("该数据源不支持异步查询操作！");1==t.aq?(t.aq=0,s="取消"):(t.aq=1,s="设置"),o=t.aq}else if("as"==e){if(n="导出Sql",!t.hasAsynSql&&0==t.as)return void this.onError("该数据源不支持导出ql操作！");1==t.as?(t.as=0,s="取消"):(t.as=1,s="设置"),o=t.as}this.$api.permission.addAsyncPermission(this.role.id,t.id,"*","*",t.rw,e,o,this.project_id).then((function(e){var o=s+n+"成功";a.onSuccess(o),console.log("down:",t.id," ae:",t.ae,"  aq:",t.aq),t.rw&&-1!=t.rw?(t.ae=e.asyn_export,t.aq=e.asyn_query,t.as=e.asyn_sql,t.aw=e.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0),t&&t.children&&t.children.forEach((function(e){e.ae=t.ae,e.as=t.as,e.aq=t.aq,e.aw=t.aw}))}))}},onAuthOwnerAsync:function(t,e,a){var s=this,n=0;if(console.log("db:",e.id," db.ae:",e.ae,"db.aq:",e.aq,"  t:",a),!e.rw)return this.$emit("owner",{}),void this.onError("请选授权数据仓库");if(3!=e.rw&&3!=t.rw){if("aw"==a&&(1==t.aw?t.aw=0:t.aw=1,n=t.aw),"ae"==a){if(!e.hasAsynExport&&0==t.ae)return void this.onError("该实例所在数据源不支持导出操作！");1==t.ae?t.ae=0:t.ae=1,n=t.ae}if("aq"==a){if(!e.hasAsynQuery&&0==t.aq)return void this.onError("该实例所在数据源不支持异步查询操作！");1==t.aq?t.aq=0:t.aq=1,n=t.aq}if("as"==a){if(!e.hasAsynSql&&0==t.as)return void this.onError("该实例所在数据源不支持导出Sql操作！");1==t.as?t.as=0:t.as=1,n=t.as}this.$api.permission.addAsyncPermission(this.role.id,e.id,t.label,"*",t.rw,a,n,this.project_id).then((function(e){var a="操作成功";s.onSuccess(a),t.rw&&-1!=t.rw?(t.ae=e.asyn_export,t.aq=e.asyn_query,t.as=e.asyn_sql,t.aw=e.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0),s.$emit("db",3==t.rw||-1==t.rw?{}:t)})).finally((function(){s.$emit("refresh-next","owner")}))}},onAuthOwner:function(t,e,a){var s=this;return t.rw==a&&(a=e.rw),-1==e.rw||""==e.rw||3==e.rw?(this.$message.warning("当前权限不足"),void console.error("[instance.list.vue]#onAuthOwner: ",arguments)):1==e.rw&&2==a?(this.$message.warning("只读不可修改为读写"),void console.error("[instance.list.vue]#onAuthOwner: ",arguments)):1==e.rw&&4==a?(this.$message.warning("只读不可修改为管理"),void console.error("[instance.list.vue]#onAuthOwner: ",arguments)):2==e.rw&&4==a?(this.$message.warning("读写不可修改为管理"),void console.error("[instance.list.vue]#onAuthOwner: ",arguments)):(1!=a&&2!=a||(t.real_rw=a),void this.$api.permission.addOwner(this.role.id,e.id,t.label,a,this.project_id).then((function(e){var n="操作成功";3==a?n="设置禁用成功":1==a?n="设置只读成功":2==a?n="设置读写成功":-1==a&&(n="取消设置成功"),s.onSuccess(n),t.rw&&-1!=t.rw?(t.ae=e.asyn_export,t.aq=e.asyn_query,t.as=e.asyn_sql,t.aw=e.autit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0),t.rw=a,s.$emit("db",3==a?{}:t),s.$emit("refresh-next","owner")})))},onAuthDBChk:function(t){var e=this;t.chk=!t.chk,this.loading=!0,this.$api.permission.addDBChild(this.role.id,t.id,t.chk,this.project_id).then((function(a){console.log("db.rw:",t.rw," db.asyn_export:",t.asyn_export,"  db.asyn_query:",t.asyn_query);var s="";s=t.chk?"批量禁用成功":"批量取消禁用成功",e.onSuccess(s),t&&t.children&&t.children.forEach((function(e){console.log("owner.rw:",e.rw,"   db.rw:",t.rw),t.chk?e.rw=3:e.rw=t.rw})),e.loading=!1})).catch((function(){e.loading=!1}))},onAuthDB:function(t,e){var a=this;console.log("db.rw:",t.rw,"   rw:",e),t.rw==e&&(e=-1),1!=t.operType||2!=e&&4!=e?2!=t.operType||4!=e?(t.rw=e,this.$api.permission.addDB(this.role.id,t.id,t.rw,this.project_id).then((function(s){t.rw&&-1!=t.rw?(t.ae=s.asyn_export,t.aq=s.asyn_query,t.as=s.asyn_sql,t.aw=s.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0),console.log("db.rw:",t.rw," db.asyn_export:",t.asyn_export,"  db.asyn_query:",t.asyn_query);var n="操作成功";3==e?n="设置禁用成功":1==e?n="设置只读成功":2==e?n="设置读写成功":4==e?n="设置管理成功":-1==e&&(n="取消设置成功"),a.onSuccess(n),t&&t.children&&t.children.forEach((function(e){console.log("owner.rw:",e.rw,"   db.rw:",t.rw),3!=t.rw&&-1!=t.rw||(e.real_rw=""),1==t.rw||3==t.rw||-1==t.rw?e.rw=t.rw:e.rw=e.real_rw||t.rw,e.ae=t.ae,e.aq=t.aq,e.as=t.as,e.aw=t.aw}))}))):this.onError("该数据源仅支持读写操作！"):this.onError("该数据源仅支持只读操作！")},onNextLoad:function(t){var e=this;if(t.id){console.log("加载子节点：",t),this.dbloading=!0;var a=Date.now();this.$api.permission.allOwner(this.role.id,t.id,t).then((function(a){e.$set(e.databases,t.id,a)})).finally((function(){var t=Date.now(),s=a-t+300;s>=0?setTimeout((function(){e.$nextTick((function(){e.dbloading=!1}))}),s):e.dbloading=!1}))}}}},c=l,u=(a("55aa"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"410a":function(t,e,a){"use strict";a("f88b")},4140:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.backupLoading,expression:"backupLoading"}],staticClass:"component-policy"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onBackup(1)}}},[t._v(" 本地备份 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.onBackup(2)}}},[t._v(" 远程备份 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("设置 ")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.getList}},[t._v(" 刷新 ")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{stripe:"",border:"","row-key":"id",data:t.tableData}},[a("el-table-column",{attrs:{prop:"created_at",label:"备份时间"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("dateTime")(a.created_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"file_name",label:"文件名"}}),a("el-table-column",{attrs:{prop:"file_size",label:"文件大小"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.file_size/1e3)+"kb ")]}}])}),a("el-table-column",{attrs:{prop:"back_up_state",label:"备份结果"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[0==s.back_up_state?a("el-tag",[t._v("允许")]):1==s.back_up_state?a("el-tag",{attrs:{type:"success"}},[t._v("成功")]):2==s.back_up_state?a("el-tooltip",{attrs:{content:s.error_msg,placement:"bottom",effect:"light"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(" 失败 ")])],1):a("el-tag",{attrs:{type:"danger"}},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{prop:"back_up_type",label:"备份方案"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[1==s.back_up_type?a("el-tag",[t._v("本地备份")]):2==s.back_up_type?a("el-tag",[t._v("远程备份")]):a("el-tag",{attrs:{type:"danger"}},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{prop:"restore_time",label:"恢复时间",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.format(a.restore_time))+" ")]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-link",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.restoreHandle(s)}}},[t._v("恢复备份")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-link",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteHandle(s)}}},[t._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:t.dialogVisible,width:"40%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" FTP远程备份设置 ")]),a("div",[a("el-form",{ref:"ftp_form",staticStyle:{"padding-left":"20px","padding-right":"20px"},attrs:{model:t.form,"label-width":"80px",rules:t.rules}},[a("el-form-item",{attrs:{label:"IP地址",prop:"ftp_addr"}},[a("el-input",{attrs:{placeholder:"IP地址或者域名"},model:{value:t.form.ftp_addr,callback:function(e){t.$set(t.form,"ftp_addr",e)},expression:"form.ftp_addr"}})],1),a("el-form-item",{attrs:{label:"端口号",prop:"ftp_port"}},[a("el-input",{attrs:{placeholder:"端口号,默认21"},model:{value:t.form.ftp_port,callback:function(e){t.$set(t.form,"ftp_port",e)},expression:"form.ftp_port"}})],1),a("el-form-item",{attrs:{label:"账号",prop:"ftp_user"}},[a("el-input",{attrs:{placeholder:"账号名"},model:{value:t.form.ftp_user,callback:function(e){t.$set(t.form,"ftp_user",e)},expression:"form.ftp_user"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"ftp_pwd"}},[a("el-input",{attrs:{placeholder:"密码","show-password":"","auto-complete":"new-password"},model:{value:t.form.ftp_pwd,callback:function(e){t.$set(t.form,"ftp_pwd",e)},expression:"form.ftp_pwd"}})],1),a("el-form-item",{attrs:{label:"上传目录",prop:"ftp_path"}},[a("el-input",{attrs:{placeholder:"示例/dir"},model:{value:t.form.ftp_path,callback:function(e){t.$set(t.form,"ftp_path",e)},expression:"form.ftp_path"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateBackUp}},[t._v("保存配置")])],1)])],1)},n=[],o=(a("d3b7"),a("c1df")),i=a.n(o),r={watch:{setting:"resetForm"},computed:{format:function(){return function(t){return i()(t).format("YYYY-MM-DD HH:mm:ss")}}},data:function(){return{setting:{},tableLoading:!1,backupLoading:!1,tableData:[],dialogVisible:!1,form:{back_up_mode:1,ftp_addr:"",ftp_port:21,ftp_user:"",ftp_pwd:""},states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],search:{back_up_state:0,type:0,dateRange:[i()().startOf("d").toDate(),i()().endOf("d").toDate()]},rules:{ftp_addr:[{required:!0,message:"请输入地址"}],ftp_port:{required:!0,message:"请输入端口号",trigger:"blur"},ftp_user:{required:!0,message:"请输入账号",trigger:"blur"},ftp_pwd:{required:!0,message:"请输入密码",trigger:"blur"},ftp_path:{required:!0,message:"请输入服务端路径",trigger:"blur"}}}},created:function(){this.getList(),this.getSetting()},methods:{getSetting:function(){var t=this;this.$api.setting.get().then((function(e){t.setting=e}))},updateBackUp:function(){var t=this;this.$refs.ftp_form.validate((function(e){e&&t.$api.setting.updateBackUpConfig(t.form).then((function(e){t.$message({type:"success",message:"保存成功!"}),t.$emit("refresh"),t.dialogVisible=!1}))}))},resetForm:function(){this.setting&&this.setting.backup_conf?this.form=this.setting.backup_conf:this.form={back_up_mode:1,ftp_port:21,ftp_addr:"",ftp_user:"",ftp_pwd:""}},getList:function(){var t=this;this.tableLoading=!0,this.$api.setting.backupList({page_no:-1,page_size:-1}).then((function(e){t.tableData=e.list})).finally((function(){t.tableLoading=!1}))},deleteHandle:function(t){var e=this;console.log("删除行：",t.id),this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$api.setting.backupDel(t.id).then((function(t){console.log("删除成功：",t),e.$message({type:"success",message:"删除成功!"}),e.getList()}))}))},restoreHandle:function(t){var e=this;this.$confirm("确定恢复当前备份?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.backupLoading=!0,e.$api.setting.restore_backup(t.id).then((function(){e.backupLoading=!1,e.$message({type:"success",message:"恢复成功!"}),e.getList()})).catch((function(t){e.getList(),e.backupLoading=!1}))}))},onBackup:function(t){var e=this;this.backupLoading=!0,this.$api.setting.backup({back_up_type:t}).then((function(t){console.log("备份成功：",t),e.$message({type:"success",message:"备份成功!"}),e.getList(),e.backupLoading=!1})).catch((function(t){e.getList(),e.backupLoading=!1}))}}},l=r,c=(a("a41f"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"ecd328b4",null);e["default"]=u.exports},4175:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor"},[a("el-row",[a("el-col",{attrs:{span:4}},[a("el-menu",{attrs:{router:"","default-openeds":t.defaultOpens,"default-active":t.active}},t._l(t.menuList,(function(e){return a("el-submenu",{key:e.label,attrs:{index:e.label}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.label))])]),t._l(e.children,(function(e){return a("el-menu-item",{key:e.label,attrs:{index:e.path}},[t._v(t._s(e.label))])}))],2)})),1)],1),a("el-col",{attrs:{span:20}},[a("el-main",[a("router-view")],1)],1)],1)],1)},n=[],o=(a("d81d"),[{label:"MySQL监控",children:[{label:"运行监控",path:"/monitor/mysql/process"},{label:"健康监控",path:"/monitor/mysql/health"},{label:"资源监控",path:"/monitor/mysql/resource"},{label:"键缓存监控",path:"/monitor/mysql/key_cache"},{label:"innodb监控",path:"/monitor/mysql/innodb"}]},{label:"Oracle监控",children:[{label:"状态监控",path:"/monitor/oracle/status"}]}]),i={data:function(){return{active:"",menuList:o}},computed:{defaultOpens:function(){return o.map((function(t){return t.label}))}},props:{},watch:{$route:"onActive"},methods:{onActive:function(){this.active=this.$route.path}},components:{},mounted:function(){this.onActive()}},r=i,l=(a("b3e3"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},4183:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("通知设置")])]),a("div",{staticClass:"text item"},[a("el-form",{ref:"mailForm",staticStyle:{width:"600px"},attrs:{model:t.mailForm,"label-width":"160px",size:"small",rules:t.mailRules}},[a("el-form-item",{attrs:{label:"SMTP服务器地址",prop:"host"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.mailForm.host,callback:function(e){t.$set(t.mailForm,"host",e)},expression:"mailForm.host"}})],1),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.mailForm.port,callback:function(e){t.$set(t.mailForm,"port",e)},expression:"mailForm.port"}})],1),a("el-form-item",{attrs:{label:"用户名",prop:"user"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.mailForm.user,callback:function(e){t.$set(t.mailForm,"user",e)},expression:"mailForm.user"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.mailForm.password,callback:function(e){t.$set(t.mailForm,"password",e)},expression:"mailForm.password"}})],1),a("el-form-item",{attrs:{label:"启用SSL加密",prop:"ssl"}},[a("el-checkbox",{attrs:{size:"mini"},model:{value:t.mailForm.ssl,callback:function(e){t.$set(t.mailForm,"ssl",e)},expression:"mailForm.ssl"}})],1),a("el-form-item",{attrs:{label:"发件人地址",prop:"from"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.mailForm.from,callback:function(e){t.$set(t.mailForm,"from",e)},expression:"mailForm.from"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmitEmail}},[t._v("保存")])],1)],1)],1)]),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("发信测试")])]),a("div",{staticClass:"text item"},[a("el-form",{ref:"testForm",attrs:{inline:!0,model:t.mailForm,"label-width":"160px",size:"mini"}},[a("el-form-item",{attrs:{label:"收件人地址",prop:"test"}},[a("el-input",{attrs:{size:"small"},model:{value:t.mailForm.test,callback:function(e){t.$set(t.mailForm,"test",e)},expression:"mailForm.test"}})],1),a("el-form-item",[a("el-button",{on:{click:t.onTestEmail}},[t._v("发送测试邮件")])],1)],1)],1)])],1)])],1)},n=[],o={data:function(){return{filterText:"",mailForm:{},smsForm:{},mailRules:{host:[{required:!0,message:"SMTP服务器地址不能为空!",trigger:"blur"}],port:[{required:!0,message:"端口不能为空!",trigger:"blur"},{validator:function(t,e,a){var s=/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/;s.test(e)?a():a(new Error("请输入正确的端口号"))},trigger:"blur"}],user:[{required:!0,message:"用户名不能为空!",trigger:"blur"}],password:[{required:!0,message:"密码不能为空!",trigger:"blur"}],from:[{validator:function(t,e,a){var s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;s.test(e)?a():a(new Error("请输入正确的邮箱地址"))},trigger:"blur"}]},testRules:{test:[{validator:function(t,e,a){var s=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;s.test(e)?a():a(new Error("请输入正确的收件人邮箱地址"))},trigger:"blur"}]}}},computed:{},props:{form:{}},watch:{form:"initFrom"},methods:{onSubmitEmail:function(){var t=this;this.$refs.mailForm.validate((function(e){if(console.log("........"),!e)return!1;t.$api.setting.updateEmailSetting(t.mailForm).then((function(){t.onSuccess("保存成功"),t.$emit("refresh")}))}))},onTestEmail:function(){var t=this;this.$refs.mailForm.validate((function(e){if(console.log("........"),!e)return!1;t.$refs.testForm.validate((function(e){if(!e)return!1;t.$api.setting.testEmailSetting(t.mailForm).then((function(){t.onSuccess("发送成功")}))}))}))},onSubmitSms:function(){},resetMailForm:function(){this.mailForm={host:"",port:"",user:"",password:"",from:"",test:"",ssl:!1}},resetSmsForm:function(){this.smsForm={sms_host:"",sms_port:"",sms_user:"",sms_password:"",sms_method:"",sms_test:""}},initFrom:function(t){t.mail_conf?this.mailForm=t.mail_conf:this.resetMailForm(),t.sms_conf?this.smsForm=t.sms_conf:this.resetSmsForm()}},components:{},mounted:function(){}},i=o,r=(a("95b4"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"419d":function(t,e,a){},4245:function(t,e,a){},"424c":function(t,e,a){"use strict";a("64ff")},"435c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-drawer",{staticClass:"workList",attrs:{visible:t.isShow,direction:"ttb",size:"100%"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{url:"/api/my/work/list",manual:!0,"search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("div",{staticStyle:{"margin-left":"15px"}},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"工单名称",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1)]),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.sql))])]}}])}),a("el-table-column",{attrs:{label:"工单名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"工单类型",prop:"type"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.type?a("el-tag",{attrs:{type:"danger"}},[t._v("DDL")]):1==e.row.type?a("el-tag",{attrs:{type:"success"}},[t._v("DML")]):a("el-tag",[t._v("未知")])]}}])}),a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"数据源类型",prop:"db_type"}}),a("el-table-column",{attrs:{label:"数据源/数据库",prop:"db_name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.db_name)+"/"+t._s(e.row.owner))]}}])}),a("el-table-column",{attrs:{label:"工单状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showStatus(e.row.status))+" ")]}}])}),a("el-table-column",{attrs:{label:"是否备份"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.back_up?a("span",[t._v("是")]):a("span",[t._v("否")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v("详情 ")]),6==e.row.status&&1==e.row.back_up?a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkBackUp(e.row)}}},[t._v(" 备份 ")]):t._e()]}}])})],1)],2),a("dialog-backup",{ref:"backupDialog",on:{hide:t.hide}}),a("dialog-detail",{ref:"detailDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("cdac"),l=a("096f"),c=a("c1df"),u=a.n(c),d={data:function(){return{isShow:!1,search2:{db_type:null},dateRange:[u()().startOf("d").toDate(),u()().endOf("d").toDate()],search:{db_type:null,project:0,name:""},status_types:[{k:"0",v:"全部"},{k:"1",v:"待审核"},{k:"2",v:"已通过"},{k:"3",v:"未通过"}]}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=u()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=u()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["runner","project"])),props:{},watch:{},methods:{goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!1)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id)},onCancel:function(t){var e=this;this.$api.work.cancel({id:t.id,cancel_remark:t.cancel_remark,flag:2}).then((function(t){e.onSuccess("取消成功"),e.init()}),(function(t){var a="参数错误！";"301"!=t.result&&(a=t.data),e.onError(a)}))},showStatus:function(t){return this.$api.work.showStatus(t)},show:function(){var t=this;console.log("==================================== start"),console.dir(this.runner),console.log("==================================== end"),this.isShow=!0,this.$nextTick((function(){t.refresh()}))},hide:function(){this.drawer=!1},refresh:function(){this.project?this.search.project=this.project.id:this.search.project=0},resetSearch:function(){console.log("========resetSearch========="),this.search={project:this.project.id}},reload:function(){this.$refs.st.reload()},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogDetail:r["default"],DialogBackup:l["default"]},mounted:function(){}},p=d,f=(a("6c03"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,"40994b06",null);e["default"]=m.exports},4360:function(t,e,a){"use strict";var s=a("5530"),n=a("2b0e"),o=a("2f62"),i=(a("159b"),a("d3b7"),a("ddb0"),a("ac1f"),a("5319"),a("b9f3")),r={};i.keys().forEach((function(t){r[t.replace(/(\.\/|\.js)/g,"")]=i(t).default}));var l={namespaced:!0,modules:r},c=(a("99af"),a("25f0"),a("2ef0")),u={namespaced:!0,state:{pageTimer:{}},mutations:{addOrset:function(t,e){var a=e.path,s=e.key,n=e.timer;Object(c["set"])(t.pageTimer,"".concat(a,".").concat(s),n)},clearTimeout:function(t){function e(e,a){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var a=e.path,s=e.key,n="".concat(a,".").concat(s),o=Object(c["get"])(n);clearTimeout(o),Object(c["unset"])(t.pageTimer,n)})),clearTimeoutPath:function(t,e){var a=Object(c["get"])(t.pageTimer,e);for(var s in a)clearTimeout(a[s]);Object(c["unset"])(t.pageTimer,e)}}},d=a("da6f"),p=(a("4de4"),a("365c")),f=a("a18c"),m={initStore:function(t){var e=t.commit;Object(d["b"])("runner",{data:{}}).then((function(t){e("initStore",{runner:t})})).catch((function(t){console.error("store init error: ",t)}))},myProjectList:function(t){var e=t.state,a=t.commit,s=f["a"].app.$route;p["default"].my.myProjectList().then((function(t){var n=t;if(a("setMyProjectList",n),!n||0==n.length)return a("project",{}),void a("set_options",[]);var o=0,i={};s.params.id?o=s.params.id:e.project&&e.project.id&&(o=e.project.id);var r=!1;if(n.length>0){for(var l=0;l<n.length;l++){var u=n[l];u.id==o&&(i=u,r=!0)}r||(o=n[0].id,i=n[0]),i&&i.id==o&&!Object(c["isEmpty"])(e.project)&&e.project.id==i.id||(a("project",i),a("set_options",[]));var d=0,p=null;s.params.id?d=s.params.id:e.dashboard_project&&e.dashboard_project.id&&(d=e.dashboard_project.id);var f=n.filter((function(t){return t.id==d})),m=0==f.length?n[0]:f[0];d=m.id,p=m,p&&p.id==d&&!Object(c["isEmpty"])(e.dashboard_project)&&e.dashboard_project.id==p.id||a("dashboard_project",p||{})}}))},projectAllList:function(t){t.state;var e=t.commit;p["default"].project.publicList().then((function(t){e("setProjectAllList",t||[])}))}},h=a("b85c"),b=(a("b0c0"),a("a434"),{setForcePwd:function(t,e){e?(t.forcePwd=e,window.localStorage.setItem("forcePwd",e)):(t.forcePwd=0,window.localStorage.removeItem("forcePwd"))},setForceTfa:function(t,e){e?(t.forceTfa=e,window.localStorage.setItem("forceTfa",e)):(t.forceTfa=0,window.localStorage.removeItem("forceTfa"))},initStore:function(t,e){console.log("初始化成功：",e),t.runner=e.runner},isMaxLine:function(t,e){t.isMaxLine=e},resultJumpLoading:function(t,e){t.resultJumpLoading=e},dataBaseList:function(t,e){t.dataBaseList=e||[];var a={};t.dataBaseList.length>0&&t.dataBaseList.forEach((function(t){var e=t.children;e.forEach((function(t){a[t.name]=t.db_id}))})),t.dataBaseMap=a},setMyProjectList:function(t,e){t.myProjectList=e||[]},setProjectAllList:function(t,e){t.projectAllList=e||[]},setPageSize:function(t,e){t.pageSize=e,Object(d["h"])("pageSize",e)},updateVlistKeeps:function(t,e){e&&(t.vlistKeeps=e)},updateContext:function(t,e){if(e&&e.tabId&&e.key&&e.data)if(t.contexts[e.tabId])n["default"].set(t.contexts[e.tabId],e.key,e.data);else{var a={};a[e.key]=e.data,n["default"].set(t.contexts,e.tabId,a)}else console.error('[store mutations] updateContexts参数错误，不许包含以下key：["tabId","key", "data"], ',e)},updateRun2:function(t,e){t.runList.length<1?console.warn("updateRun2 当前runList没有值：",t.runList):(e.time||(e.time=Date.now()),this.commit("addOrSetRunNames",{run:e,type:"onlyName"}),n["default"].set(t.runList,t.runActive,e),Object(d["g"])("runList",t.runList))},updateService:function(t,e){t.service=e},updateRunner:function(t,e){t.runner=e},updateOwner:function(t,e){t.owner=e,Object(d["f"])("owner",e)},setSelectedDB:function(t,e){var a=Object(d["a"])("select_db_instance",null);a||(a={}),a[e.instance.id]=e,Object(d["f"])("select_db_instance",a),window.$log.dev("[mutations#setSelectedDB]",e),t.selecedDB=e},getSelectedDB:function(t,e){if(window.$log.dev("[mutations#getSelectedDB]",e),e){var a=Object(d["a"])("select_db_instance",null);t.selecedDB=a?a[e]:null}else t.selecedDB=null},setExportCount:function(t,e){n["default"].set(t.exportCount,e.key,e.value)},setAllRunNames:function(t,e){var a=Object.assign(t.runNames,e);t.runNames=a,Object(d["g"])("runNames",a)},setWorkspaceTabName:function(t,e){var a=e.tabId,s=e.runName,o=t.runNames[a];o&&s&&(n["default"].set(t.runNames,a,s),Object(d["g"])("runNames",t.runNames))},addOrSetRunNames:function(t,e){if(console.log("in addOrSetRunNames: ",e,t.runNames),e&&e.run){var a=e.run,s="$rw-$name-$db-[$no]",o=s.replace("$name",a.name);o=o.replace("$db",a.db);var i="";1==a.rw?i="读":2==a.rw?i="读写":4==a.rw&&(i="管理"),o=o.replace("$rw",i),e.type&&"all"==e.type||(o=o.replace("$no",a.tabNo)),console.log("更改tab name：",o),n["default"].set(t.runNames,a.tabId,o),Object(d["g"])("runNames",t.runNames),window.$log.dev("runNames1: ",t.runNames)}},removeRunNames:function(t,e){window.$log.dev("before - state.runNames: ",e,t.runNames),delete t.runNames[e];var a=0;for(var s in t.runList){var n=t.runList[s];Boolean(n.tabNo)&&n.tabNo>a&&(a=n.tabNo)}t.runNames.max=a,window.$log.dev("after - state.runNames: ",t.runNames),Object(d["g"])("runNames",t.runNames),window.$log.dev("runNames3: ",t.runNames)},add_tabs:function(t,e){var a,s=!0,n=Object(h["a"])(t.options);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o.name===e.name){s=!1;break}}}catch(i){n.e(i)}finally{n.f()}s&&t.options.push(e)},delete_tabs:function(t,e){var a,s=0,n=Object(h["a"])(t.options);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(console.log("option.route :",o.path,"  route:",e),o.path===e)break;s++}}catch(i){n.e(i)}finally{n.f()}console.log("delete_tabs：",e,s),t.options.splice(s,1)},set_active_index:function(t,e){t.activeIndex=e},set_options:function(t,e){t.options=e},save_detail_info:function(t,e){t.userInfo=e},setting:function(t,e){t.setting=Object.assign({},t.setting,e),Object(d["f"])("setting",t.setting)},onlySetting:function(t,e){t.setting=Object.assign({},t.setting,e)},sysSetting:function(t,e){t.sysSetting=Object.assign({},t.sysSetting,e),Object(d["f"])("sysSetting",t.sysSetting)},allRun:function(t,e){t.runList=e},sys:function(t,e){t.sys=e},copyActiveRunner:function(t){if(t.runList&&t.runList.length>0){console.log("============");var e=Object(s["a"])({},t.runList[t.runActive]);e.time=Date.now(),console.dir(e),e.index=t.runList.length,e.tabId=Date.now()+Math.round(1e9*Math.random()),e.tabNo=++t.runNames.max,this.commit("addOrSetRunNames",{run:e}),t.runList.push(e),console.log("addRun s.runList.size:",t.runList.length),Object(d["g"])("runList",t.runList),Object(d["g"])("runner",e)}},activeRunner:function(t){this.commit("updateRunner",t)},runActive:function(t,e){t.runActive=e,Object(d["h"])("runActive",e)},user:function(t,e){if(t.user=e,Object(d["f"])("user",e),e&&e.setting)try{var a=JSON.parse(e.setting);t.setting=a,this.commit("setting",a)}catch(s){}},project:function(t,e){t.project=e,Object(d["f"])("project",e)},dashboard_project:function(t,e){t.dashboard_project=e,Object(d["f"])("dashboard_project",e)},project_home:function(t,e){t.project_home=e,Object(d["f"])("project_home",e)},home_id:function(t,e){t.home_id=e,Object(d["f"])("home_id",e)},db:function(t,e){t.db=e,Object(d["f"])("db",e)},owner:function(t,e){t.owner=e,Object(d["f"])("owner",e)},addRun:function(t,e){e._type&&(e._type="query"),e._time&&(e._time=Date.now()),e.index=t.runList.length,e.tabId=Date.now()+"_"+Math.round(1e9*Math.random()),e.tabNo=++t.runNames.max,this.commit("addOrSetRunNames",{run:e}),t.runList.push(e),console.log("[store] addRun length: ",t.runList.length),Object(d["g"])("runList",t.runList),Object(d["g"])("runner",e)},delRun:function(t,e){var a=e.index,s=e.tabId;if(console.log("[store mutations] delRun index:",a,t.runList.length),!(a<0||0==t.runList.length)){t.runList.splice(a,1),t.runList.forEach((function(t,e){t.index=e}));var n=null;n=t.runList.length>0?t.runList[t.runList.length-1]:{data:{}},Object(d["g"])("runner",n),Object(d["g"])("runList",t.runList),this.commit("removeRunNames",s),console.log("delRun after: ",t.runList)}},updateRunActive:function(t,e){console.log("[store mutations] updateRunActive:",e,t.runList),t.runActive=e,Object(d["h"])("runActive",t.runActive)},updateScript:function(t,e){var a=e.script,s=e.index;try{t.runList[s].script=a,Object(d["g"])("runList",t.runList)}catch(n){console.error("错误：",n,arguments)}},saveHistory:function(t,e){var a=e.index,s=e.history;t.historyList[a]=s,Object(d["g"])("historyList",t.historyList)}}),_=(a("d81d"),a("caad"),a("2532"),{runList:function(t){return t.runList&&t.runList.length>0?t.runList.filter((function(t){return!t._type||"query"==t._type})):t.runList},getUnjoinProjectList:function(t){var e=t.myProjectList,a=t.projectAllList,s=e.map((function(t){return t.id})),n=a.filter((function(t){return!s.includes(t.id)}));return n},showWorkType:function(t){return function(e){var a=t.sqlTypes[e];return a||"未知"}},run:function(t){return t.runList.length<=t.runActive?{}:t.runList[t.runActive]},context:function(t){if(0==t.runList.length||t.runList.length<=t.runActive)return{};var e=t.runList[t.runActive];if(!e)return{};var a=e.tabId;return a&&t.contexts[a]||{}}}),g={state:{test:"测试状态",project_menu:[],options:[],activeIndex:"",forcePwd:Object(d["a"])("forcePwd",0),forceTfa:Object(d["a"])("forceTfa",0),user:Object(d["a"])("user",{}),project:Object(d["a"])("project",{}),dashboard_project:Object(d["a"])("dashboard_project",{}),myProjectList:[],projectAllList:[],home_id:Object(d["a"])("home_id",{}),project_home:Object(d["a"])("project_home",{}),setting:Object(d["a"])("setting",{editFontSize:14}),sysSetting:Object(d["a"])("sysSetting",{}),db:{},owner:{},sys:{asyn_query:!0,asyn_export:!0,encrypt_sql:!1},historyList:[],runList:[],runNames:{max:0},runner:null,service:Object(d["a"])("service",{data:{}}),runActive:Object(d["d"])("runActive",0),exportCount:{_default:"0"},selecedDB:null,contexts:{_utime:""},vlistKeeps:30,pageSize:Object(d["d"])("pageSize",10),dataBaseList:[],dataBaseMap:{},fileTypes:{2:"CSV",3:"SQL",5:"XLS",6:"JSON"},sqlTypes:{1:"DML",2:"DDL",3:"在线查询",4:"文件导出",5:"快照查询",9:"其他脚本"},rwMap:{1:"只读",2:"读写",3:"禁用",4:"管理"},resultJumpLoading:!1,MAX_LINE:1e4,isMaxLine:0,generateSqlLineFeeds:[1,1]},getters:_,mutations:b,actions:m};n["default"].use(o["a"]);e["a"]=new o["a"].Store(Object(s["a"])(Object(s["a"])({},g),{},{modules:{d2admin:l,timer:u}}))},4372:function(t,e,a){"use strict";a("4704")},4398:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(t.currentView,{tag:"component"})},n=[],o=a("5530"),i=a("9a91"),r=a("2f62"),l={components:{normalPage:i["default"]},computed:Object(o["a"])({},Object(r["e"])(["user"])),data:function(){return{currentView:"normalPage"}},created:function(){},methods:{setPage:function(){this.currentView="normalPage"}}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"43c4":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-help",use:"d2-help-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-help"><path d="M512 1024c-284.444444 0-512-227.555556-512-512s227.555556-512 512-512 512 227.555556 512 512-227.555556 512-512 512z m0-68.266667c244.622222 0 443.733333-199.111111 443.733333-443.733333S756.622222 68.266667 512 68.266667 68.266667 267.377778 68.266667 512s199.111111 443.733333 443.733333 443.733333z m11.377778-694.044444c45.511111 0 85.333333 11.377778 113.777778 39.822222 28.444444 22.755556 45.511111 62.577778 45.511111 102.4 0 34.133333-11.377778 68.266667-28.444445 91.022222-5.688889 5.688889-28.444444 28.444444-62.577778 56.888889-11.377778 11.377778-22.755556 22.755556-28.444444 39.822222-5.688889 17.066667-11.377778 34.133333-11.377778 45.511112v11.377777H472.177778v-11.377777c0-28.444444 5.688889-51.2 17.066666-68.266667 11.377778-22.755556 39.822222-51.2 79.644445-91.022222l11.377778-11.377778c11.377778-17.066667 22.755556-34.133333 22.755555-51.2 0-22.755556-5.688889-45.511111-22.755555-56.888889-17.066667-17.066667-34.133333-22.755556-62.577778-22.755556-34.133333 0-56.888889 11.377778-73.955556 28.444445-11.377778 17.066667-17.066667 39.822222-17.066666 73.955555H352.711111c0-51.2 17.066667-96.711111 45.511111-125.155555 28.444444-34.133333 73.955556-51.2 125.155556-51.2zM512 688.355556c17.066667 0 28.444444 5.688889 39.822222 17.066666 11.377778 11.377778 17.066667 22.755556 17.066667 39.822222 0 17.066667-5.688889 28.444444-17.066667 39.822223-11.377778 11.377778-22.755556 17.066667-39.822222 17.066666-28.444444 0-51.2-22.755556-51.2-51.2 0-17.066667 5.688889-28.444444 17.066667-39.822222 5.688889-17.066667 22.755556-22.755556 34.133333-22.755555z" p-id="2816" /></symbol>'});i.a.add(r);e["default"]=r},"43ca":function(t,e,a){"use strict";a("4c39")},"43d3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-db-item-tempalte select-none"},[t.isSingleNode?a("div",{staticClass:"redis truncate custom-tree-node flex-1 py-1 pl-1 hover:bg-gray-200 cursor-pointer",class:{"card-db-item-tempalte-selected":t.isCurrentTree},on:{click:function(e){return t.onItemClick(t.source,null,null)},contextmenu:function(e){return e.preventDefault(),t.onMenuClick(e,t.source)},dblclick:function(e){return e.stopPropagation(),t.onItemDbClick(e,t.source,null)}}},[a("span",{staticClass:"ignore truncate ..."},[t._v(" "+t._s(t.source.name)+" ")]),a("span",{attrs:{hidden:""}},[t._v(t._s(t.source._uniKey))])]):a("el-tree",{ref:"treeRef",class:{"card-db-item-tempalte-disabled":t.isDisabled,"card-db-item-tempalte-selected":t.isCurrentTree||t.isRootTree},attrs:{"expand-on-click-node":!1,props:t.defaultProps,load:t.loadSubNode,"default-expand-all":!1,"node-key":"_uniKey",lazy:""},on:{"node-collapse":t.closeNodeHandle,"node-click":t.onItemClick,"node-contextmenu":t.onMenuClick},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data,n=e.node;return a("div",{staticClass:"custom-tree-node flex-1 truncate",attrs:{title:s.name+(s.info&&"  "+s.info.data_type)},on:{dblclick:function(e){return e.stopPropagation(),t.onItemDbClick(e,s,n)}}},[a("k-icon",{staticClass:"mr-2",style:{color:t.getIconColor(s)},attrs:{name:t.getIconName(s)}}),a("span",{staticClass:"ignore truncate ..."},[t._v(" "+t._s(s.name)+" "),s.info?a("span",{staticClass:"ignore ml-2 text-gray-400"},[t._v(" "+t._s(s.info.data_type)+" ")]):t._e()]),a("span",{attrs:{hidden:""}},[t._v(t._s(s._uniKey))])],1)}}],null,!1,965054169)})],1)},n=[],o=a("5530"),i=(a("caad"),a("a9e3"),a("b0c0"),a("2708"));function r(t){var e=t&&t.data&&t.data._uniKey;return t&&t.parent&&t.parent.data&&t.parent.data._uniKey?r(t.parent):e}var l={table:"#5983BB",view:"#5983BB",procedure:"#5983BB",function:"#5983BB",column_group:"#5983BB",column:"#5983BB",index_group:"#409EFF",index:"#409EFF",foreign_key_group:"#5A80B0",foreign_key:"#5A80B0",trigger_group:"#579311",trigger:"#579311",constant_group:"",constant:""},c=["table","column_group","column","index_group","index","constant_group","constant","trigger_group","trigger","foreign_key_group","foreign_key"],u={name:"card-db-item-template",mixins:[i["a"]],components:{},computed:{isDisabled:function(){return!this.source.perm||3==this.source.perm.rw},isCurrentTree:function(){return this.selectedItemKey==this.source._uniKey},isRootTree:function(){return this.selectedRootKey==this.rootUniKey},getIconName:function(){return function(t){if("column"==t.node_type&&t.info){if(t.info.pk)return"icon-column-primary";if(t.info.fk)return"icon-foreign_key"}return c.includes(t.node_type)?"icon-".concat(t.node_type):"icon-file1"}},getIconColor:function(){var t=this;return function(e){var a=t.nodeTyepColorMap[e.node_type];return a||"unset"}},isSingleNode:function(){return!this.has_child_group}},props:{has_child_group:{type:Boolean,default:function(){return!1}},index:{type:Number},selectedItemKey:{type:String},selectedRootKey:{type:String},schemaGroupType:{type:String},hasAsynSql:{},currentRun:{type:Object,default:function(){return{}}},project:{type:Object,default:function(){return{}}},source:{type:Object,default:function(){return{}}}},watch:{source:function(t){this.refreshTree()}},data:function(){return{nodeTyepColorMap:l,currentClass:!1,contextMenuTarget:null,contextMenuVisible:!1,refresh:{node_had:null,resolve_had:null},rootUniKey:"",temps:["953bdfcbfafba3a9361a896b9f8df6d9_test_abc_columns_列","1_953bdfcbfafba3a9361a896b9f8df6d9_test_table_temp","1_953bdfcbfafba3a9361a896b9f8df6d9_test_table_abc"],treeData:[],timer:null,defaultProps:{children:"children",label:"label",isLeaf:"leaf"}}},methods:{refreshTree:function(){this.refresh.node_had&&this.refresh.resolve_had?(this.refresh.node_had.childNodes=[],this.loadSubNode(this.refresh.node_had,this.refresh.resolve_had)):console.error("[card.db.item.template]#requestNewData(): arguments error")},loadSubNode:function(t,e){if(0===t.level)return this.refresh.node_had=t,this.refresh.resolve_had=e,e([Object(o["a"])({},this.source)]);if(1==t.level)this.$api.db.table.group({id:this.currentRun.id,owner:this.currentRun.name,db_type:this.currentRun.dbType,table:t.data.name,parent:this.schemaGroupType}).then((function(t){return e(t||[])})).catch((function(t){return e([])}));else{if(2!=t.level)return e([]);this.$api.db.table.tableSubNode({id:this.currentRun.id,db_type:this.currentRun.dbType,owner:this.currentRun.name,project:this.project.id,table:t.parent.data.name,object_type:t.parent.data.node_type,node_type:t.data.sub_node_type}).then((function(t){return e(t.List||[])})).catch((function(t){return e([])}))}},onItemClick:function(t,e,a){var s=this;clearTimeout(this.timer),this.timer=setTimeout((function(){s.callFuc({source:t,type:"left"},e)}),200)},onItemDbClick:function(t,e,a){clearTimeout(this.timer),this.callFuc({e:t,type:"dbleft",source:e},a)},onMenuClick:function(t,e,a,s){this.contextMenuVisible=!0,this.isSingleNode||this.$refs.treeRef.setCurrentKey(e._uniKey);var n=r(a);this.rootUniKey=n,this.dispatch("card-db","selected-item",{source:e,root:this.source,type:"custom-right",e:t,rootUniKey:n})},callFuc:function(t,e){var a=t.source,s=t.type,n=t.e,o=r(e);this.rootUniKey=o,this.dispatch("card-db","selected-item",{source:a,root:this.source,type:s,e:n,rootUniKey:o})},openNodeHandle:function(t,e,a){},closeNodeHandle:function(t,e,a){console.log("关闭： ",arguments)}}},d=u,p=(a("4832"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,"53dc804c",null);e["default"]=f.exports},"43d7":function(t,e,a){"use strict";a("a38f")},"43f9":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"异步导出",visible:t.isShow},on:{open:t.onOpen,opened:t.onOpened,closed:t.onClosed,"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{"label-width":"120px",model:t.formData,rules:t.rules}},[a("monaco-lite",{ref:"monacoLiteRef",staticClass:"exec-sql",staticStyle:{height:"200px"},attrs:{config:{readOnly:!0}}}),a("el-form-item",{attrs:{label:"查询标题",prop:"mark"}},[a("el-input",{ref:"exportTitle",model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1),a("el-form-item",{attrs:{label:"查询条数"}},[a("el-select",{model:{value:t.formData.max_rows,callback:function(e){t.$set(t.formData,"max_rows",e)},expression:"formData.max_rows"}},t._l(t.rows,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{attrs:{label:"导出方式",prop:"task_type"}},[a("el-radio-group",{model:{value:t.formData.task_type,callback:function(e){t.$set(t.formData,"task_type",e)},expression:"formData.task_type"}},t._l(t.fileTypes,(function(e,s){return a("el-radio",{key:e,attrs:{label:s}},[t._v(t._s(e))])})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)},n=[],o=a("5530"),i=a("cb68"),r=a("2f62"),l={components:{"monaco-lite":i["default"]},computed:Object(o["a"])({},Object(r["e"])(["fileTypes"])),data:function(){return{params:{},autofocus:!1,isShow:!1,notifys:["钉钉","微信","邮件"],rows:[10,2e3,3e3,5e3,1e5,2e5,5e5,1e6,5e6,2e7],rules:{mark:[{required:!0,message:"请输入文件名"}],task_type:[{required:!0,message:"请选文件类型",trigger:"change"}]},tasktypes:[{l:"CSV",v:2},{l:"SQL",v:3},{l:"XLS",v:5},{l:"JSON",v:6}],formData:this.reset()}},methods:{reset:function(){return{mark:"",max_rows:2e3,notify:null,task_type:"5",export:!0}},show:function(t,e){this.params=e||{},this.formData=this.reset(),this.cb=t,this.isShow=!0},onOpened:function(){this.$refs.monacoLiteRef.setSql(this.params.sql||"-- 未获取到SQL")},onClosed:function(){this.$refs.monacoLiteRef.setSql("")},hide:function(t){this.isShow=!1,this.autofocus=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&(t.cb(t.formData),t.hide())}))},onOpen:function(){var t=this;this.$nextTick((function(){t.$refs.exportTitle.focus()}))}}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"453c":function(t,e,a){"use strict";a("419d")},"460c":function(t,e,a){},"460e":function(t,e,a){"use strict";a("d999")},4678:function(t,e,a){var s={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="4678"},4683:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:"修改可执行时间",visible:t.isShow,"append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"时间范围"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.execTimes,callback:function(e){t.execTimes=e},expression:"execTimes"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=a("2ef0"),i=a("c1df"),r=a.n(i),l={data:function(){return{esConfigList:[],isShow:!1,execTimes:[],formData:this.reset()}},computed:{},props:{},watch:{},methods:{reset:function(){return{exec_flag:1}},show:function(t){this.isShow=!0,this.formData=t},hide:function(){this.isShow=!1},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);this.execTimes.length<2?this.onError("执行时间范围不能为空"):(console.log(this.execTimes),e.exec_start=r()(this.execTimes[0]).format("YYYY-MM-DD HH:mm:ss"),e.exec_end=r()(this.execTimes[1]).format("YYYY-MM-DD HH:mm:ss"),this.$api.work.changeTime(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})))}},components:{},mounted:function(){}},c=l,u=(a("fd1d"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"60f1ac0d",null);e["default"]=d.exports},4704:function(t,e,a){},4706:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"dialog-exec-pages",attrs:{title:"操作确认",visible:t.isShow,width:"300px;","before-close":t.hide,"append-to-body":!0},on:{"update:visible":function(e){t.isShow=e},opened:t.onOpened,close:t.onClose}},[a("monaco-lite",{ref:"monacoLite",staticClass:"exec-sql",attrs:{config:{readOnly:!0}}}),a("el-divider"),a("b",[t._v("基本信息：")]),a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{staticStyle:{color:"#ff0000","font-weight":"bold"},attrs:{label:"类型"}},[t._v(" "+t._s(t.type)+" ")]),a("el-form-item",{attrs:{label:"数据库",prop:"db_id"}},[t._v(" ["+t._s(t.data.dbType)+"] "+t._s(t.data.db)+"/"+t._s(t.data.owner)+" ")]),a("el-form-item",{attrs:{label:"审计状态"}},[0==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):1==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"warning"}},[t._v("警告")]):2==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"danger"}},[t._v("错误")]):1==t.level&&"7"==t.stage_status?a("el-tag",{attrs:{type:"warning"}},[t._v("不支持审计")]):-1==t.level?a("el-tag",{attrs:{type:"info"}},[t._v("未审计")]):a("el-tag",[t._v("未知")])],1),"0"==t.stage_status?a("el-form-item",{attrs:{label:"预估影响行数"}},[a("h3",{staticStyle:{color:"red","fond-weight":"blod"}},[t._v(t._s(t.affected_rows))])]):t._e()],1),t.confirmMessage?[a("el-divider"),a("el-checkbox",{staticStyle:{color:"#ff0000","font-weight":"bold"},model:{value:t.checkedConfirmMessage,callback:function(e){t.checkedConfirmMessage=e},expression:"checkedConfirmMessage"}},[t._v(" "+t._s(t.confirmMessage)+" ")])]:t._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success",disabled:t.disabled||!t.checkedConfirmMessage},on:{click:t.onSubmit}},[t._v("执行")])],1),a("dialog-audit-log",{ref:"sqlAuditLog"})],2)},n=[],o=a("5530"),i=(a("b0c0"),a("2f62")),r=a("ccad"),l=a("cb68"),c={data:function(){return{confirmMessage:null,checkedConfirmMessage:!1,activeName:"基本信息",showSql:!1,is_admin:!1,disabled:!1,disabled_backup:!0,sqlAuditData:[],type:null,role:{},level:-1,affected_rows:0,stage_status:"",execTimes:[],isShow:!1,config:{lang:"sql"},data:{},db:{can_backup:1},au:{},runParams:{},formData:{id:"",exec_flag:1,exec_start:null,exec_end:null,source_type:"none",source_id:"none",sql:"",type:0,name:"",mark:"",audit_id:0,back_up:0},formRule:{name:[{required:!0,message:"请输入工单名称"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},components:{DialogAuditLog:r["default"],MonacoLite:l["default"]},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["project"])),mounted:function(){},methods:{showLog:function(){this.$refs.sqlAuditLog.show(this.formData.id)},show:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.confirmMessage=s,this.checkedConfirmMessage=!s,12==e.sql_type||13==e.sql_type||14==e.sql_type?(this.formData.type=1,this.type="DML"):15==e.sql_type&&(this.formData.type=2,this.type="DDL"),this.runParams=a,this.au=e,this.data=t,this.formData.id=e.token,this.formData.exec_flag=1,this.formData.sql_type=e.sql_type,this.formData.exec_start=null,this.formData.exec_end=null,this.formData.sql=t.script||t.sql,this.formData.db_id=t.id,this.formData.owner=t.owner,this.formData.mark="",this.formData.name="",this.formData.audit_id=0,this.level=e.level,this.affected_rows=e.affected_rows,this.stage_status=e.stage_status,this.showSql=!0,this.isShow=!0},onOpened:function(){this.$refs.monacoLite.setSql(this.formData.sql||"-- 未获取到SQL"),this.$bus.emit("workpace-loading",!1)},onClose:function(){this.activeName="基本信息",this.confirmMessage=null,this.checkedConfirmMessage=!1},hide:function(t){this.$emit("action",{type:"close",submit:"submit"==t}),this.disabled=!1,this.au={},this.data={},this.isShow=!1,this.formData={sql:""},this.showSql=!1,this.workData=[]},onSubmit:function(){this.disabled=!this.disabled,this.$emit("runExec",{au:this.au,params:this.runParams}),this.hide("submit")}}},u=c,d=(a("aeb0"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"47bb":function(t,e,a){},"47c4":function(t,e,a){},"47e1":function(t,e,a){},4811:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("div",{staticClass:"project padding-x-24"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"项目列表",name:"list"}}),a("el-tab-pane",{attrs:{label:"回收站",name:"trash"}})],1),a("k-search-table",{ref:"st",attrs:{data:t.dataList,url:"/api/project/page","search-data":t.search},on:{reset:t.resetSearch}},["list"==t.activeName?a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1):t._e(),a("template",{slot:"buttons"},["list"==t.activeName?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("新建项目")]):t._e()],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),e.row.is_expire?a("el-tag",{attrs:{type:"danger"}},[t._v("已过期")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"是否启用",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 "),1==e.row.state?a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,2)}}},[t._v("[停用]")]):t._e()],1):a("span",{staticClass:"text-warn"},[t._v(" 否 "),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,1)}}},[t._v("[启用]")])],1)]}}])}),a("el-table-column",{attrs:{label:"是否公开"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.public_state?a("el-tag",{attrs:{type:"success"}},[t._v("是")]):a("el-tag",{attrs:{type:"info"}},[t._v("否")])]}}])}),a("el-table-column",{attrs:{label:"成员",prop:"user_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除用户"},on:{click:function(a){return a.stopPropagation(),t.$refs.userDialog.show(e.row)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.user_count)+") ")])]}}])}),a("el-table-column",{attrs:{label:"数据源",prop:"db_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除数据库"},on:{click:function(a){return a.stopPropagation(),t.$refs.dbDialog.show(e.row)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.db_count)+") ")])]}}])}),a("el-table-column",{attrs:{label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.createdAt)))]}}])}),"list"==t.activeName?a("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{title:"工单流程",size:"mini",type:"primary"},on:{click:function(a){return t.onWorkFlow(e.row)}}},[t._v("流程 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onRole(e.row)}}},[t._v(" 角色 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onShowInception(e.row)}}},[t._v(" 审计 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onWorkConfig(e.row)}}},[t._v(" 工单 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onEdit(e.row)}}},[t._v(" 修改 ")]),a("k-btn-tip",{attrs:{tip:"确定要将【"+e.row.name+"】项目删除吗?"},on:{click:function(a){return t.onDel(e.row,2)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除 ")])],1)]}}],null,!1,3562366640)}):t._e(),"trash"==t.activeName?a("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onDel(e.row,1)}}},[t._v("恢复项目 ")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】项目吗,删除后不可在恢复?"},on:{click:function(a){return t.onDel(e.row,3)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("彻底删除 ")])],1)]}}],null,!1,2024109581)}):t._e()],1)],2),a("dialog-edit",{ref:"dialogEdit",on:{refresh:t.refresh}}),a("dialog-auth",{ref:"dialogAuth"}),a("dialog-user",{ref:"userDialog",on:{refresh:t.refresh}}),a("dialog-db",{ref:"dbDialog",on:{refresh:t.refresh}}),a("dialog-role",{ref:"roleDialog"}),a("dialog-work-setting",{ref:"dialogWorkSetting",on:{refresh:t.refresh}}),a("dialog-inception",{ref:"dialogInceptionSetting"}),a("dialog-work",{ref:"dialogWork"})],1)])},n=[],o=a("5530"),i=(a("b0c0"),a("ac1f"),a("841c"),a("a15b"),a("2f62")),r=a("dcb1"),l=a("1e99"),c=a("3867"),u=a("c116"),d=a("dd1f"),p=a("f983"),f=a("4eaf"),m=a("1bbd"),h=a("5c96"),b=a("c1df"),_=a.n(b),g={data:function(){return{cp:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMPANY,activeName:"list",no_role:!1,search:{has_del:1},dataList:[],roles:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},computed:Object(o["a"])({},Object(i["e"])(["user"])),props:{},watch:{},methods:{handleClick:function(t,e){console.log(t,e),"trash"==t.name?this.search.has_del=2:this.search.has_del=1,this.refresh()},onUserList:function(){},showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return _()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){e.onSuccess(t),e.refresh("操作成功")}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onWorkConfig:function(t){this.$refs.dialogWork.show(t)},onNew:function(){this.$refs.dialogEdit.show()},onRole:function(t){this.$refs.roleDialog.show(t,!0)},onWorkFlow:function(t){this.$refs.dialogWorkSetting.show(t)},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onShowInception:function(t){this.$refs.dialogInceptionSetting.show(t)},onEdit:function(t){this.$refs.dialogEdit.show(t)},onState:function(t,e){var a=this;this.$api.project.state(t.id,e).then((function(){a.onSuccess("操作成功"),a.refresh()}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t,e){var a=this;this.$api.project.delete(t.id,e).then((function(t){a.onSuccess(t),a.refresh()}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},components:{DialogEdit:r["default"],DialogAuth:l["default"],DialogUser:d["default"],DialogDb:p["default"],DialogRole:u["default"],DialogWork:m["default"],DialogWorkSetting:c["default"],DialogInception:f["default"]},mounted:function(){}},v=g,y=(a("bd1d"),a("2877")),w=Object(y["a"])(v,s,n,!1,null,"f456efd8",null);e["default"]=w.exports},4826:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"ref-export",staticClass:"export-result"},[t.hasExport||t.hasAsync||t.hasSql?a("sql-card-async",{ref:"card-async",attrs:{hasAsynExport:t.hasExport,hasAsynSql:t.hasSql,hasAsynQuery:t.hasAsync,height:t.tabHeight,"run-tab-id":t.runTabId,title:"异步及导出"}}):a("div",{staticClass:"empty"},[t._v("空")])],1)},n=[],o=a("5530"),i=(a("4de4"),a("a31e")),r=a("2f62"),l={components:{SqlCardAsync:i["default"]},props:{runTabId:{}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(r["e"])(["sys","runList","runActive"])),Object(r["c"])(["run"])),{},{currentRun:function(){var t=this,e=this.runList.filter((function(e){return e.tabId==t.runTabId}));return e.length>0?e[0]:{}},hasSql:function(){return this.sys.asyn_sql&&this.currentRun.hasAsynSql},hasAsync:function(){return this.sys.asyn_query&&this.currentRun.hasAsynQuery},hasExport:function(){return this.sys.asyn_export&&this.currentRun.hasAsynExport}}),methods:{onAsync:function(){console.log(this.sys,this.currentRun,this.runList[this.runActive]),this.$refs["card-async"]&&this.$refs["card-async"].onAsync()},resize:function(){var t=this.$refs["ref-export"];if(t){var e=t.offsetHeight;this.tabHeight=e-80+"px"}}},data:function(){return{tabHeight:"150px"}}},c=l,u=(a("ef00"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"2800e683",null);e["default"]=d.exports},4832:function(t,e,a){"use strict";a("5f34")},4865:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"component-monitor apps h-full"},[a("el-card",{staticClass:"box-card h-full"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("平台性能监控")])]),a("div",{staticClass:"progress"},[a("div",{staticClass:"item"},[a("el-progress",{attrs:{width:110,type:"circle",format:t.percentageFormat,percentage:t.round(t.cpu_percent)}}),a("span",[t._v("cpu")])],1),a("div",{staticClass:"item"},[a("el-progress",{attrs:{width:110,type:"circle",format:t.percentageFormat,percentage:t.round(t.mem.usedPercent)}}),a("span",[t._v("内存")])],1),a("div",{staticClass:"item"},[a("el-progress",{attrs:{width:110,type:"circle",format:t.percentageFormat,percentage:t.round(t.disk.usedPercent)}}),a("span",[t._v("磁盘")])],1)]),a("div",{staticClass:"network-flow"},[a("span",[t._v("网络流量:")]),a("div",{staticClass:"sents"},[a("div",{staticClass:"item"},[a("span",{staticClass:"data",attrs:{title:"发送数据包"}},[t._v(t._s(t.ioFormat(t.io_data,"packetsSent")))]),a("span",{staticClass:"description"},[t._v("发送数据包")])]),a("div",{staticClass:"item"},[a("span",{staticClass:"data",attrs:{title:"发送字节"}},[t._v(t._s(t.ioFormat(t.io_data,"bytesSent")))]),a("span",{staticClass:"description"},[t._v("发送字节")])])]),a("div",{staticClass:"recvs"},[a("div",{staticClass:"item"},[a("span",{staticClass:"data",attrs:{title:"接受数据包"}},[t._v(t._s(t.ioFormat(t.io_data,"packetsRecv")))]),a("span",{staticClass:"description"},[t._v("接受数据包")])]),a("div",{staticClass:"item"},[a("span",{staticClass:"data",attrs:{title:"接受字节"}},[t._v(t._s(t.ioFormat(t.io_data,"bytesRecv")))]),a("span",{staticClass:"description"},[t._v("接受字节")])])])])])],1)},n=[],o=(a("159b"),a("a9e3"),a("b680"),{computed:{ioFormat:function(){var t=this;return function(e,a){var s=0;return e.forEach((function(t){var e=t[a];e&&e>1024&&(s+=e/1024)})),t.round(s,2)+"kb"}}},data:function(){return{h1:null,h2:null,n3:null,h4:null,mem:{usedPercent:0},cpu:{},cpu_percent:0,disk:{usedPercent:0},io_data:[],net_data:[],network:{},query:{start:"",end:"",start2:"",end2:""},stat:{db_count:0,app_count:0,user_count:0,today_count:0},dbTypeStat:{columns:["类型","数量"],rows:[]},dbTypeTitle:{text:"数据源类型"},typeTitle:{text:"当日执行类型统计",default:10},logTimeTitle:{text:"一周访问量"},logStat:{columns:["类型","数量"],rows:[]},logTitle:{text:"当日失败率统计"},logTimeStat:{columns:["时间","访问量"],rows:[]},dbStat:{columns:["数据源","访问量"],rows:[]},dbTitle:{text:"当日数据库使用量"},dbStatSettings:{dataOrder:{label:"访问量",order:"desc"}},exportStat:{columns:["应用","访问量"],rows:[]},appTitle:{text:"当日数据导出量"},userStat:{columns:["用户名","访问量"],rows:[]},typeStat:{columns:["操作","数量"],rows:[]},userTitle:{text:"当日用户访问量"},appStatSettings:{dataOrder:{label:"访问量",order:"desc"}},pubSetting1:{height:"350px",width:"100%"},pubSetting:{height:"400px",width:"100%"},chartData1:{columns:["数据源","次数"],rows:[{"次数":1393,"数据源":"查询库"},{"次数":3530,"数据源":"用户中心"},{"次数":2923,"数据源":"订单库"},{"次数":1723,"数据源":"淘宝api"},{"次数":3792,"数据源":"日志"},{"次数":4593,"数据源":"eslog"}]},chartData:{columns:["日期","访问用户","下单用户","下单率"],rows:[{"日期":"1/1","访问用户":1393,"下单用户":1093,"下单率":.32},{"日期":"1/2","访问用户":3530,"下单用户":3230,"下单率":.26},{"日期":"1/3","访问用户":2923,"下单用户":2623,"下单率":.76},{"日期":"1/4","访问用户":1723,"下单用户":1423,"下单率":.49},{"日期":"1/5","访问用户":3792,"下单用户":3492,"下单率":.323},{"日期":"1/6","访问用户":4593,"下单用户":4293,"下单率":.78}]}}},mounted:function(){var t=this;this.$nextTick((function(){t.init()})),this.$once("hook:beforeDestroy",(function(){window.$log.dev("[monitor mounted] 销毁监控定时器2"),t.stopTimer()}))},beforeDestroy:function(){window.$log.dev("[monitor beforeDestroy] 销毁监控定时器"),this.stopTimer()},methods:{percentageFormat:function(t){return 100===t?"满":"".concat(t,"%")},stopTimer:function(){clearTimeout(this.h1),this.h1=null,clearTimeout(this.h2),this.h2=null,clearTimeout(this.h3),this.h3=null,clearTimeout(this.h4),this.h4=null},dataFormat:function(t,e){var a=t[e.property];return a&&a>1024?this.round(a/1024)+" KB":a},do_cpu_stat:function(){var t=this;this.$api.post("/api/system/stat",{type:"cpu"}).then((function(e){e.info.length>0&&(t.cpu=e.info[0])}))},do_cpu_percent:function(){var t=this;clearTimeout(this.h1),this.$api.post("/api/system/stat",{type:"cpu_percent"}).then((function(e){t.cpu_percent=e,t.h1=setTimeout((function(){t.do_cpu_percent()}),2e3),t.$store.commit("timer/addOrset",{path:t.$route.path,key:"h1",timer:t.h1})}))},do_mem_stat:function(){var t=this;clearTimeout(this.h2),this.$api.post("/api/system/stat",{type:"mem"}).then((function(e){t.mem=e,t.h2=setTimeout((function(){t.do_mem_stat()}),3e3),t.$store.commit("timer/addOrset",{path:t.$route.path,key:"h2",timer:t.h2})}))},do_disk_stat:function(){var t=this;clearTimeout(this.h3),this.$api.post("/api/system/stat",{type:"disk"}).then((function(e){t.disk=e,t.h3=setTimeout((function(){t.do_disk_stat()}),6e4),t.$store.commit("timer/addOrset",{path:t.$route.path,key:"h3",timer:t.h3})}))},do_network_stat:function(){var t=this;clearTimeout(this.h4),this.$api.post("/api/system/stat",{type:"network"}).then((function(e){t.io_data=e.io,t.net_data=e.con,t.h4=setTimeout((function(){t.do_network_stat()}),2e3),t.$store.commit("timer/addOrset",{path:t.$route.path,key:"h4",timer:t.h4})}))},round:function(t,e){var a=Math.round(100*t)/100;return void 0!=e?Number(a.toFixed(e)):a},init:function(){this.do_cpu_stat(),this.do_cpu_percent(),this.do_mem_stat(),this.do_disk_stat(),this.do_network_stat()}}}),i=o,r=(a("73e6"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},4887:function(t,e,a){"use strict";a("9686e")},"48ae":function(t,e,a){"use strict";a("b85b")},"48e9":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"append-to-body":"",title:t.project.name+"-"+t.role.name+"-【用户设置】",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-alert",{attrs:{title:"提示:",description:"同一用户在同个项目中只能设置一个角色,加入当前角色后自动退出其他角色。",type:"info",closable:!1,"show-icon":""}}),a("k-search-table",{ref:"st",attrs:{select:"onSelect",url:"/api/role/user/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"用户名",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:""==t.ids},on:{click:t.onBatchAdd}},[t._v("批量添加")]),a("el-button",{attrs:{type:"danger",size:"mini",disabled:""==t.ids},on:{click:t.onBatchRemove}},[t._v("批量移除")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id",width:"80"}}),a("el-table-column",{attrs:{label:"用户名",prop:"name"}}),a("el-table-column",{attrs:{label:"姓名",prop:"user_name"}}),a("el-table-column",{attrs:{label:"角色",prop:"role_name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.role_name)+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.role_id?a("el-button",{attrs:{type:"warning",size:"mini",plain:"",disabled:2==t.user.role&&t.user.role>=e.row.role&&t.user.id!=e.row.id},on:{click:function(a){return t.onAdd(e.row.id)}}},[t._v("添加 ")]):t._e(),0!=e.row.role_id?a("el-button",{attrs:{type:"danger",size:"mini",plain:"",disabled:2==t.user.role&&t.user.role>=e.row.role&&t.user.id!=e.row.id},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{ids:"",role:{},project:{},isShow:!1,search:{},rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联当前角色"},{k:"2",v:"未关联当前角色"},{k:"4",v:"未关联任何角色"},{k:"3",v:"已关联其他角色"}]}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t,e){var a=this;this.project=e,this.role=t,this.search.role_id=t.id,this.search.project=t.project,this.isShow=!0,this.$nextTick((function(){a.refresh()}))},hide:function(t){this.isShow=!1},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this;this.$api.role.relation(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kick(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"492c":function(t,e,a){"use strict";a("99ca")},4948:function(t,e,a){"use strict";a.r(e);var s=a("c276"),n=function(){return navigator.userAgent.indexOf("Window")>0?"Windows":navigator.userAgent.indexOf("Mac OS X")>0?"Mac":navigator.userAgent.indexOf("Linux")>0?"Linux":"NUll"};e["default"]={namespaced:!0,mutations:{versionShow:function(t,e){window.os=n(),s["a"].log.capsule(window.os,"SUPPORT"),s["a"].log.capsule("SQLDEV","".concat(e.version||"3.4.0")),"business"===e.company||"COMMERCIAL"===e.company?s["a"].log.capsule("南京树安信息技术有限公司","商业版"):"community"!==e.company&&"COMMUNITY"!==e.company||(s["a"].log.capsule("南京树安信息技术有限公司","社区版"),console.log("社区版地址: https://github.com/shuaninfo/sqldev"),console.log("请不要吝啬您的 star，谢谢 ~")),s["a"].log.danger("产品官网: http://sqldev.info/")}}}},"49f8":function(t,e,a){var s={"./en.json":"edd4","./ja.json":"04231","./zh-chs.json":"2e32","./zh-cht.json":"e8626"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="49f8"},"4a22":function(t,e,a){"use strict";a("6d65")},"4ad9":function(t,e,a){"use strict";var s=a("5530"),n=(a("d3b7"),a("ac1f"),a("5319"),a("99af"),a("bc3a")),o=a.n(n),i=a("5c96"),r=a("2b0e"),l=a("a18c"),c=a("b383"),u=a.n(c),d=a("5a30"),p=a.n(d),f="",m=o.a.create({baseURL:f,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:[function(t){return t=u.a.stringify(t),t}],data:{}});m.interceptors.request.use((function(t){var e=window.localStorage.getItem("token");return e&&(t.headers["x-access-token"]=e),t}),(function(t){Promise.reject(t)}));var h=function(t,e){Object(i["Notification"])({title:e,message:t,type:"error",duration:2e3,position:"top-right",offset:100})},b={},_=function(t){return new Promise((function(e,a){t.then((function(t){switch(t=t.data,t.result){case 1:e(t.data);break;case 200:e(t.data);break;case 401:h("401 权限不足","请求"),e({});break;case 409:h(t.data);break;case 301:a(t);break;case 405:"/login"!==l["a"].currentRoute.path&&(console.log("=======405====="),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"),window.localStorage.setItem("beforeUrl",window.location.href),l["a"].push("/login?url="+l["a"].currentRoute.fullPath));break;case 408:console.log("=======408===== 双因子认证"),r["default"].bus.emit("tfa-show","reload");break;case"0001":"/login"!==l["a"].currentRoute.path&&(console.log("403~~~~~~1",window.location.href),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"),window.localStorage.setItem("beforeUrl",window.location.href),l["a"].push("/login?url="+l["a"].currentRoute.fullPath));break;case 403:"/login"!==l["a"].currentRoute.path&&(console.log("403~~~~~~2"),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"),window.localStorage.setItem("beforeUrl",window.location.href),l["a"].push("/login?url="+l["a"].currentRoute.fullPath));break;case 4001:h("4001 权限不足","请求"),l["a"].replace("/login");break;case 4003:l["a"].replace("/reg-license"),a(new Error("抱歉，许可证已过期，请联系厂商申请新的许可证。"));break;case 4004:l["a"].replace("/reg-license"),a(new Error("抱歉，软件未配置许可证信息,请配置后重新启动。"));break;default:var s=b[t.result];s?s(t):(h(t.data,"请求"),a(t))}}),(function(t){if("/api/system/update/exec"==t.config.url)return a(t);h("".concat(t.config.url,"->").concat(t),"请求")}))}))},g={addErrorHandler:function(t,e){b[t]=e},wsBase:function(){var t="ws://"+window.location.host;return""!==f&&(t=f.replace("http","ws")),t},page:function(t,e){return _(m.post(t,e))},post:function(t,e){return _(m.post(t,e))},get:function(t,e){return _(m.get(t,{params:e||{}}))},download:function(t,e){var a=t;if(e)for(var s in e)-1===a.indexOf("?")?a+="?".concat(s,"=").concat(encodeURIComponent(e[s])):a+="&".concat(s,"=").concat(encodeURIComponent(e[s]));window.open(f+a)},upload:function(t,e){var a=window.localStorage.getItem("token"),s=o.a.create({timeout:0,headers:{"Content-Type":"multipart/form-data","x-access-token":a}}),n=new p.a;for(var i in e)n.append(i,e[i]);return t=f+t,s.post(t,n).then((function(t){return t}))}};e["a"]=Object(s["a"])({},g)},"4b3b":function(t,e,a){var s={"./login":"9ed6","./login/":"9ed6","./login/cas":"2c11","./login/cas.vue":"2c11","./login/focus":"ea6f","./login/focus.vue":"ea6f","./login/index":"9ed6","./login/index.vue":"9ed6","./login/new-login":"668d","./login/new-login.vue":"668d","./login/oauth2":"6c4d","./login/oauth2.vue":"6c4d","./login/reg.license":"c041","./login/reg.license.vue":"c041","./mgt/account":"c774","./mgt/account/":"c774","./mgt/account/dialog.auth":"a299","./mgt/account/dialog.auth.vue":"a299","./mgt/account/dialog.edit":"be4f","./mgt/account/dialog.edit.vue":"be4f","./mgt/account/index":"c774","./mgt/account/index.vue":"c774","./mgt/act":"2506","./mgt/act-log":"082f","./mgt/act-log/":"082f","./mgt/act-log/index":"082f","./mgt/act-log/index.vue":"082f","./mgt/act/":"2506","./mgt/act/index":"2506","./mgt/act/index.vue":"2506","./mgt/act/operat-log":"fa69","./mgt/act/operat-log.vue":"fa69","./mgt/apply":"c464","./mgt/apply/":"c464","./mgt/apply/dialog.apply":"6e7a","./mgt/apply/dialog.apply.info":"7db0","./mgt/apply/dialog.apply.info.vue":"7db0","./mgt/apply/dialog.apply.page":"b1a1","./mgt/apply/dialog.apply.page.vue":"b1a1","./mgt/apply/dialog.apply.vue":"6e7a","./mgt/apply/index":"c464","./mgt/apply/index.vue":"c464","./mgt/audit":"76e7","./mgt/audit-setting":"0395","./mgt/audit-setting/":"0395","./mgt/audit-setting/comonents/inception":"ef64","./mgt/audit-setting/comonents/inception.vue":"ef64","./mgt/audit-setting/comonents/setting.inception":"5cbd","./mgt/audit-setting/comonents/setting.inception.vue":"5cbd","./mgt/audit-setting/comonents/work_config":"4bf5","./mgt/audit-setting/comonents/work_config.vue":"4bf5","./mgt/audit-setting/index":"0395","./mgt/audit-setting/index.vue":"0395","./mgt/audit/":"76e7","./mgt/audit/dialog.apply":"fa4d","./mgt/audit/dialog.apply.page":"18df","./mgt/audit/dialog.apply.page.vue":"18df","./mgt/audit/dialog.apply.vue":"fa4d","./mgt/audit/index":"76e7","./mgt/audit/index.vue":"76e7","./mgt/auth":"8c6a","./mgt/auth/":"8c6a","./mgt/auth/dialog.apply":"ccf4","./mgt/auth/dialog.apply.page":"ff83","./mgt/auth/dialog.apply.page.vue":"ff83","./mgt/auth/dialog.apply.vue":"ccf4","./mgt/auth/index":"8c6a","./mgt/auth/index.vue":"8c6a","./mgt/auth/my.index":"7f36","./mgt/auth/my.index.vue":"7f36","./mgt/database":"0003","./mgt/database/":"0003","./mgt/database/components/instance.info":"8c1b","./mgt/database/components/instance.info.vue":"8c1b","./mgt/database/components/monitor.mysql":"0f37","./mgt/database/components/monitor.mysql.vue":"0f37","./mgt/database/components/monitor.oracle":"77e9","./mgt/database/components/monitor.oracle.vue":"77e9","./mgt/database/dialog.cron":"6fb5","./mgt/database/dialog.cron.vue":"6fb5","./mgt/database/dialog.edit":"e7a8","./mgt/database/dialog.edit.vue":"e7a8","./mgt/database/dialog.monitor":"960e","./mgt/database/dialog.monitor.vue":"960e","./mgt/database/dialog.sddp.task":"f928","./mgt/database/dialog.sddp.task.vue":"f928","./mgt/database/index":"0003","./mgt/database/index.vue":"0003","./mgt/error":"6745","./mgt/error/":"6745","./mgt/error/index":"6745","./mgt/error/index.vue":"6745","./mgt/error/license":"b4ae","./mgt/error/license.vue":"b4ae","./mgt/find-pwd":"c14c","./mgt/find-pwd/":"c14c","./mgt/find-pwd/index":"c14c","./mgt/find-pwd/index.less":"351c","./mgt/find-pwd/index.vue":"c14c","./mgt/framework":"aa82","./mgt/framework/":"aa82","./mgt/framework/index":"aa82","./mgt/framework/index.vue":"aa82","./mgt/license":"0f4d","./mgt/license/":"0f4d","./mgt/license/index":"0f4d","./mgt/license/index.vue":"0f4d","./mgt/log":"03a4","./mgt/log/":"03a4","./mgt/log/index":"03a4","./mgt/log/index.vue":"03a4","./mgt/mask":"c6d4","./mgt/mask/":"c6d4","./mgt/mask/dialog.edit":"6150","./mgt/mask/dialog.edit.vue":"6150","./mgt/mask/index":"c6d4","./mgt/mask/index.vue":"c6d4","./mgt/monitor":"4175","./mgt/monitor/":"4175","./mgt/monitor/index":"4175","./mgt/monitor/index.vue":"4175","./mgt/monitor/mysql/mysql.health":"1f8a","./mgt/monitor/mysql/mysql.health.vue":"1f8a","./mgt/monitor/mysql/mysql.innodb":"a707","./mgt/monitor/mysql/mysql.innodb.vue":"a707","./mgt/monitor/mysql/mysql.key_cache":"cf8f","./mgt/monitor/mysql/mysql.key_cache.vue":"cf8f","./mgt/monitor/mysql/mysql.process":"f306","./mgt/monitor/mysql/mysql.process.vue":"f306","./mgt/monitor/mysql/mysql.resource":"0060","./mgt/monitor/mysql/mysql.resource.vue":"0060","./mgt/monitor/oracle/oracle.status":"8e68","./mgt/monitor/oracle/oracle.status.vue":"8e68","./mgt/monitor/system":"a7f1","./mgt/monitor/system.vue":"a7f1","./mgt/project":"4811","./mgt/project/":"4811","./mgt/project/dialog.auth":"1e99","./mgt/project/dialog.auth.vue":"1e99","./mgt/project/dialog.edit":"dcb1","./mgt/project/dialog.edit.vue":"dcb1","./mgt/project/dialog.project.db":"f983","./mgt/project/dialog.project.db.vue":"f983","./mgt/project/dialog.project.inception":"4eaf","./mgt/project/dialog.project.inception.vue":"4eaf","./mgt/project/dialog.project.role":"e34f","./mgt/project/dialog.project.role.vue":"e34f","./mgt/project/dialog.project.user":"dd1f","./mgt/project/dialog.project.user.vue":"dd1f","./mgt/project/dialog.project.work":"1bbd","./mgt/project/dialog.project.work.vue":"1bbd","./mgt/project/dialog.work.setting":"3867","./mgt/project/dialog.work.setting.vue":"3867","./mgt/project/index":"4811","./mgt/project/index copy":"07ec","./mgt/project/index copy.vue":"07ec","./mgt/project/index.vue":"4811","./mgt/project/project.list":"74b8","./mgt/project/project.list.vue":"74b8","./mgt/project/trash":"4d3a","./mgt/project/trash.vue":"4d3a","./mgt/report":"16d6","./mgt/report/":"16d6","./mgt/report/comonents/report.db":"5298","./mgt/report/comonents/report.db.vue":"5298","./mgt/report/comonents/report.stat":"20a4","./mgt/report/comonents/report.stat.vue":"20a4","./mgt/report/comonents/report.user":"c029","./mgt/report/comonents/report.user.vue":"c029","./mgt/report/index":"16d6","./mgt/report/index.vue":"16d6","./mgt/role":"c116","./mgt/role/":"c116","./mgt/role/components/column.list":"b267","./mgt/role/components/column.list.vue":"b267","./mgt/role/components/dialog.batchauth":"aa90","./mgt/role/components/dialog.batchauth.vue":"aa90","./mgt/role/components/dialog.mask":"5bf4","./mgt/role/components/dialog.mask.vue":"5bf4","./mgt/role/components/dialog.role.db":"4cc5","./mgt/role/components/dialog.role.db.vue":"4cc5","./mgt/role/components/dialog.role.form":"9f6e","./mgt/role/components/dialog.role.form.vue":"9f6e","./mgt/role/components/dialog.role.strategy":"81f5","./mgt/role/components/dialog.role.strategy.vue":"81f5","./mgt/role/components/dialog.role.user":"48e9","./mgt/role/components/dialog.role.user.vue":"48e9","./mgt/role/components/dialog.role.user2":"5e49","./mgt/role/components/dialog.role.user2.vue":"5e49","./mgt/role/components/dialog.table":"3372","./mgt/role/components/dialog.table.vue":"3372","./mgt/role/components/instance.list":"d23f","./mgt/role/components/instance.list copy":"40c3","./mgt/role/components/instance.list copy.vue":"40c3","./mgt/role/components/instance.list.vue":"d23f","./mgt/role/components/permission.list":"23f3","./mgt/role/components/permission.list.vue":"23f3","./mgt/role/components/role.list":"3ea6","./mgt/role/components/role.list.vue":"3ea6","./mgt/role/components/table.info":"eaf8","./mgt/role/components/table.info.vue":"eaf8","./mgt/role/components/table.list":"890c","./mgt/role/components/table.list copy":"4cd4","./mgt/role/components/table.list copy.vue":"4cd4","./mgt/role/components/table.list.vue":"890c","./mgt/role/components/table.tip":"a694","./mgt/role/components/table.tip.vue":"a694","./mgt/role/components/vlist.template":"f13c","./mgt/role/components/vlist.template.vue":"f13c","./mgt/role/components/备份vlist.template":"99cf","./mgt/role/components/备份vlist.template.vue":"99cf","./mgt/role/index":"c116","./mgt/role/index.vue":"c116","./mgt/rule":"f73c","./mgt/rule/":"f73c","./mgt/rule/dialog.edit":"1607","./mgt/rule/dialog.edit.vue":"1607","./mgt/rule/index":"f73c","./mgt/rule/index.vue":"f73c","./mgt/sddp":"3660","./mgt/sddp/":"3660","./mgt/sddp/com/audit.form":"ee0c","./mgt/sddp/com/audit.form.vue":"ee0c","./mgt/sddp/com/audit.log":"db2c","./mgt/sddp/com/audit.log.vue":"db2c","./mgt/sddp/com/sql.audit.log":"3d21","./mgt/sddp/com/sql.audit.log.vue":"3d21","./mgt/sddp/com/work.sql":"b591","./mgt/sddp/com/work.sql.vue":"b591","./mgt/sddp/dialog.edit":"c892","./mgt/sddp/dialog.edit.exec.time":"4023","./mgt/sddp/dialog.edit.exec.time.vue":"4023","./mgt/sddp/dialog.edit.vue":"c892","./mgt/sddp/index":"3660","./mgt/sddp/index.vue":"3660","./mgt/setting":"d70f","./mgt/setting/":"d70f","./mgt/setting/backup":"4140","./mgt/setting/backup.vue":"4140","./mgt/setting/comonents/setting.backup":"cf60","./mgt/setting/comonents/setting.backup.vue":"cf60","./mgt/setting/comonents/setting.notify":"4183","./mgt/setting/comonents/setting.notify.vue":"4183","./mgt/setting/comonents/setting.policy":"d75b","./mgt/setting/comonents/setting.policy.vue":"d75b","./mgt/setting/comonents/setting.warning":"2ab5","./mgt/setting/comonents/setting.warning.vue":"2ab5","./mgt/setting/func":"3551","./mgt/setting/func.vue":"3551","./mgt/setting/index":"d70f","./mgt/setting/index.vue":"d70f","./mgt/setting/license":"c5c5","./mgt/setting/license.vue":"c5c5","./mgt/setting/login":"affe","./mgt/setting/login.vue":"affe","./mgt/setting/notice":"d2ec","./mgt/setting/notice.vue":"d2ec","./mgt/setting/policy":"e2cb","./mgt/setting/policy.vue":"e2cb","./mgt/setting/update":"f8be","./mgt/setting/update.vue":"f8be","./mgt/ssh":"5292","./mgt/ssh/":"5292","./mgt/ssh/dialog.edit":"3ae7","./mgt/ssh/dialog.edit.vue":"3ae7","./mgt/ssh/dialog.trem":"ad1b","./mgt/ssh/dialog.trem.vue":"ad1b","./mgt/ssh/dialog.user":"2ab6","./mgt/ssh/dialog.user.vue":"2ab6","./mgt/ssh/index":"5292","./mgt/ssh/index.vue":"5292","./mgt/ssh/new-terminal":"fb1d","./mgt/ssh/new-terminal.vue":"fb1d","./mgt/ssh/ssh.trem.page":"9461","./mgt/ssh/ssh.trem.page.vue":"9461","./mgt/ssh_log":"bc16","./mgt/ssh_log/":"bc16","./mgt/ssh_log/dialog.trem.log":"5fc3","./mgt/ssh_log/dialog.trem.log.vue":"5fc3","./mgt/ssh_log/index":"bc16","./mgt/ssh_log/index.vue":"bc16","./mgt/ssh_strategy":"feca","./mgt/ssh_strategy/":"feca","./mgt/ssh_strategy/dialog.edit":"cb22","./mgt/ssh_strategy/dialog.edit.vue":"cb22","./mgt/ssh_strategy/index":"feca","./mgt/ssh_strategy/index.vue":"feca","./mgt/stat":"60c3","./mgt/stat/":"60c3","./mgt/stat/index":"60c3","./mgt/stat/index.vue":"60c3","./mgt/strategy":"02ae","./mgt/strategy/":"02ae","./mgt/strategy/components/column.list":"c7ed","./mgt/strategy/components/column.list.vue":"c7ed","./mgt/strategy/components/db.list":"7e57","./mgt/strategy/components/db.list.vue":"7e57","./mgt/strategy/components/mask.strategy":"1eec","./mgt/strategy/components/mask.strategy.vue":"1eec","./mgt/strategy/components/owner.list":"660b","./mgt/strategy/components/owner.list.vue":"660b","./mgt/strategy/components/query.strategy":"39ce","./mgt/strategy/components/query.strategy.vue":"39ce","./mgt/strategy/components/table.list":"2971","./mgt/strategy/components/table.list.vue":"2971","./mgt/strategy/dialog.edit":"2a76","./mgt/strategy/dialog.edit.vue":"2a76","./mgt/strategy/dialog.test":"1ae3","./mgt/strategy/dialog.test.vue":"1ae3","./mgt/strategy/index":"02ae","./mgt/strategy/index.vue":"02ae","./mgt/strategy/strategy":"782c","./mgt/strategy/strategy.js":"782c","./mgt/work":"cda8","./mgt/work/":"cda8","./mgt/work/com/audit.form":"da6fe","./mgt/work/com/audit.form.vue":"da6fe","./mgt/work/com/audit.log":"9672","./mgt/work/com/audit.log.vue":"9672","./mgt/work/com/sql.audit.log":"39e7","./mgt/work/com/sql.audit.log.vue":"39e7","./mgt/work/com/work.sql":"e649","./mgt/work/com/work.sql.vue":"e649","./mgt/work/dialog.backup":"096f","./mgt/work/dialog.backup.vue":"096f","./mgt/work/dialog.detail":"cdac","./mgt/work/dialog.detail.vue":"cdac","./mgt/work/dialog.edit":"da46","./mgt/work/dialog.edit.exec.time":"4683","./mgt/work/dialog.edit.exec.time.vue":"4683","./mgt/work/dialog.edit.vue":"da46","./mgt/work/dialog.exec.scheduler":"344a","./mgt/work/dialog.exec.scheduler.vue":"344a","./mgt/work/dialog.work":"9fae","./mgt/work/dialog.work.info":"9992","./mgt/work/dialog.work.info.vue":"9992","./mgt/work/dialog.work.page":"34bb","./mgt/work/dialog.work.page.vue":"34bb","./mgt/work/dialog.work.vue":"9fae","./mgt/work/index":"cda8","./mgt/work/index.vue":"cda8","./personal":"972a","./personal/":"972a","./personal/index":"972a","./personal/index.vue":"972a","./personal/info":"3392","./personal/info.vue":"3392","./personal/notice":"0423","./personal/notice/":"0423","./personal/notice/components/send-view":"2109","./personal/notice/components/send-view.vue":"2109","./personal/notice/index":"0423","./personal/notice/index.vue":"0423","./personal/notice/personal-notice":"8b53","./personal/notice/personal-notice-list":"fabe","./personal/notice/personal-notice-list.vue":"fabe","./personal/notice/personal-notice.vue":"8b53","./personal/notice/system-notice-list":"939f","./personal/notice/system-notice-list.vue":"939f","./personal/password":"1eed","./personal/password.vue":"1eed","./personal/security":"5db0","./personal/security.vue":"5db0","./project":"707c","./project/":"707c","./project/components/dialog.apply":"33e4","./project/components/dialog.apply.audit":"8862","./project/components/dialog.apply.audit.vue":"8862","./project/components/dialog.apply.info":"3bf0","./project/components/dialog.apply.info.vue":"3bf0","./project/components/dialog.apply.vue":"33e4","./project/components/dialog.project.apply":"e802","./project/components/dialog.project.apply.vue":"e802","./project/components/dialog.project.post":"9ef2","./project/components/dialog.project.post.vue":"9ef2","./project/components/dialog.role.auth":"72ca","./project/components/dialog.role.auth.vue":"72ca","./project/dashboard":"0778","./project/dashboard.vue":"0778","./project/datasource":"26dd","./project/datasource.vue":"26dd","./project/index":"707c","./project/index.vue":"707c","./project/log":"5818","./project/log.vue":"5818","./project/member":"aa8f","./project/member.vue":"aa8f","./project/notice":"0798","./project/notice.vue":"0798","./project/post":"7d3d","./project/post.vue":"7d3d","./project/query":"8d5a","./project/query/":"8d5a","./project/query/components/node-info":"711d","./project/query/components/node-info.vue":"711d","./project/query/components/tab":"8546","./project/query/components/tab/":"8546","./project/query/components/tab/index":"8546","./project/query/components/tab/index.vue":"8546","./project/query/components/tab/left/card.db":"fb22","./project/query/components/tab/left/card.db.item.template":"43d3","./project/query/components/tab/left/card.db.item.template.vue":"43d3","./project/query/components/tab/left/card.db.vue":"fb22","./project/query/components/tab/left/table/dialog.redis.info":"bda3","./project/query/components/tab/left/table/dialog.redis.info.vue":"bda3","./project/query/components/tab/left/table/dialog.table":"092b","./project/query/components/tab/left/table/dialog.table.edit":"8f44","./project/query/components/tab/left/table/dialog.table.edit.vue":"8f44","./project/query/components/tab/left/table/dialog.table.vue":"092b","./project/query/components/tab/left/table/edit.field":"6cc5","./project/query/components/tab/left/table/edit.field.vue":"6cc5","./project/query/components/tab/left/table/edit.index":"29bf","./project/query/components/tab/left/table/edit.index.vue":"29bf","./project/query/components/tab/left/table/edit.schema":"f17c","./project/query/components/tab/left/table/edit.schema.js":"f17c","./project/query/components/tab/left/table/table.info":"3eff","./project/query/components/tab/left/table/table.info.vue":"3eff","./project/query/components/tab/monaco/functions.ext":"c890","./project/query/components/tab/monaco/functions.ext.js":"c890","./project/query/components/tab/monaco/languages/mongodb":"acc0","./project/query/components/tab/monaco/languages/mongodb.js":"acc0","./project/query/components/tab/monaco/languages/oracle":"18f5","./project/query/components/tab/monaco/languages/oracle.js":"18f5","./project/query/components/tab/monaco/mysql":"3bff","./project/query/components/tab/monaco/mysql.js":"3bff","./project/query/components/tab/monaco/oracle":"2ca1","./project/query/components/tab/monaco/oracle.js":"2ca1","./project/query/components/tab/monaco/pgsql":"0470","./project/query/components/tab/monaco/pgsql.js":"0470","./project/query/components/tab/monaco/regexps":"3f97","./project/query/components/tab/monaco/regexps.js":"3f97","./project/query/components/tab/monaco/sql":"60ba","./project/query/components/tab/monaco/sql.js":"60ba","./project/query/components/tab/right":"356b","./project/query/components/tab/right/":"356b","./project/query/components/tab/right/card.async":"a31e","./project/query/components/tab/right/card.async.vue":"a31e","./project/query/components/tab/right/dialog.async":"dcb4","./project/query/components/tab/right/dialog.async.vue":"dcb4","./project/query/components/tab/right/dialog.diff":"f9b1","./project/query/components/tab/right/dialog.diff.vue":"f9b1","./project/query/components/tab/right/dialog.effect":"4ea6","./project/query/components/tab/right/dialog.effect.vue":"4ea6","./project/query/components/tab/right/dialog.error":"d7dc","./project/query/components/tab/right/dialog.error.vue":"d7dc","./project/query/components/tab/right/dialog.export":"43f9","./project/query/components/tab/right/dialog.export.vue":"43f9","./project/query/components/tab/right/dialog.favorite":"5de3","./project/query/components/tab/right/dialog.favorite.vue":"5de3","./project/query/components/tab/right/dialog.longtext":"270c","./project/query/components/tab/right/dialog.longtext.vue":"270c","./project/query/components/tab/right/dialog.sql.export":"c9ff","./project/query/components/tab/right/dialog.sql.export.vue":"c9ff","./project/query/components/tab/right/index":"356b","./project/query/components/tab/right/index.vue":"356b","./project/query/components/tab/right/result.explain":"803d","./project/query/components/tab/right/result.explain.vue":"803d","./project/query/components/tab/right/result.export":"4826","./project/query/components/tab/right/result.export.vue":"4826","./project/query/components/tab/right/result.history":"736a","./project/query/components/tab/right/result.history.vue":"736a","./project/query/components/tab/right/result.info":"adc8","./project/query/components/tab/right/result.info.vue":"adc8","./project/query/components/tab/right/result.result":"23b2","./project/query/components/tab/right/result.result.vue":"23b2","./project/query/components/tab/right/result.work":"a887","./project/query/components/tab/right/result.work.vue":"a887","./project/query/components/tab/right/tool":"a414","./project/query/components/tab/right/tool.column":"1c01","./project/query/components/tab/right/tool.column.vue":"1c01","./project/query/components/tab/right/tool.table":"b61e","./project/query/components/tab/right/tool.table.vue":"b61e","./project/query/components/tab/right/tool.vue":"a414","./project/query/components/tab/service":"69e1","./project/query/components/tab/service.auto.db":"d18d","./project/query/components/tab/service.auto.db.dbsuggest":"232e","./project/query/components/tab/service.auto.db.dbsuggest.js":"232e","./project/query/components/tab/service.auto.db.js":"d18d","./project/query/components/tab/service.condition":"fad0","./project/query/components/tab/service.condition.js":"fad0","./project/query/components/tab/service.js":"69e1","./project/query/components/tab/service.remove":"034e","./project/query/components/tab/service.remove.js":"034e","./project/query/components/tab/service.rightkey":"8c66","./project/query/components/tab/service.rightkey.js":"8c66","./project/query/components/tab/service.rightkey.keymap":"b982","./project/query/components/tab/service.rightkey.keymap.js":"b982","./project/query/components/table":"ff86","./project/query/components/table/":"ff86","./project/query/components/table/index":"ff86","./project/query/components/table/index.vue":"ff86","./project/query/components/tabs":"6c72","./project/query/components/tabs.vue":"6c72","./project/query/components/top":"f7a1","./project/query/components/top/":"f7a1","./project/query/components/top/dialog.apply":"4cca","./project/query/components/top/dialog.apply.vue":"4cca","./project/query/components/top/dialog.audit.log":"ccad","./project/query/components/top/dialog.audit.log.vue":"ccad","./project/query/components/top/dialog.exec":"4706","./project/query/components/top/dialog.exec.vue":"4706","./project/query/components/top/dialog.favorite":"d024","./project/query/components/top/dialog.favorite.vue":"d024","./project/query/components/top/dialog.new-work":"d0e2","./project/query/components/top/dialog.new-work.vue":"d0e2","./project/query/components/top/dialog.work":"4db0","./project/query/components/top/dialog.work.vue":"4db0","./project/query/components/top/dialog.workList":"435c","./project/query/components/top/dialog.workList.vue":"435c","./project/query/components/top/index":"f7a1","./project/query/components/top/index.vue":"f7a1","./project/query/components/top/monaco-lite":"cb68","./project/query/components/top/monaco-lite/":"cb68","./project/query/components/top/monaco-lite/index":"cb68","./project/query/components/top/monaco-lite/index.vue":"cb68","./project/query/components/top/select-database":"0c52","./project/query/components/top/select-database/":"0c52","./project/query/components/top/select-database/index":"0c52","./project/query/components/top/select-database/index.vue":"0c52","./project/query/components/top/tool":"a463","./project/query/components/top/tool.db":"c8e5","./project/query/components/top/tool.db.vue":"c8e5","./project/query/components/top/tool.favorite":"9c01","./project/query/components/top/tool.favorite.vue":"9c01","./project/query/components/top/tool.history":"6fef","./project/query/components/top/tool.history.vue":"6fef","./project/query/components/top/tool.setting":"7638","./project/query/components/top/tool.setting.vue":"7638","./project/query/components/top/tool.vue":"a463","./project/query/index":"8d5a","./project/query/index.vue":"8d5a","./project/query/new-work":"a9c4","./project/query/new-work.vue":"a9c4","./project/role":"3955","./project/role.vue":"3955","./project/temp-member":"ddbc","./project/temp-member.vue":"ddbc","./project/work":"bdf1","./project/work.vue":"bdf1","./system/error/404":"e29a","./system/error/404/":"e29a","./system/error/404/index":"e29a","./system/error/404/index.vue":"e29a","./system/function/redirect":"f271","./system/function/redirect/":"f271","./system/function/redirect/index":"f271","./system/function/redirect/index.js":"f271","./system/function/refresh":"0284","./system/function/refresh/":"0284","./system/function/refresh/index":"0284","./system/function/refresh/index.js":"0284","./system/index":"4398","./system/index/":"4398","./system/index/components/dialog.project.apply":"9583","./system/index/components/dialog.project.apply.vue":"9583","./system/index/components/monitor":"4865","./system/index/components/monitor.vue":"4865","./system/index/components/normal.page":"9a91","./system/index/components/normal.page.vue":"9a91","./system/index/components/system.page":"e18d","./system/index/components/system.page.vue":"e18d","./system/index/components/unknow.page":"4edf","./system/index/components/unknow.page.vue":"4edf","./system/index/index":"4398","./system/index/index.vue":"4398","./system/log":"b380","./system/log/":"b380","./system/log/index":"b380","./system/log/index.vue":"b380","./system/setting/font":"71a9","./system/setting/font.vue":"71a9"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="4b3b"},"4b64":function(t,e,a){"use strict";a("2858")},"4bd03":function(t,e,a){},"4bef":function(t,e,a){"use strict";a("2111")},"4bf5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{staticClass:"box-card"},[a("el-form",{attrs:{model:t.configForm,"label-width":"280px",size:"mini",disabled:!t.edit}},[a("el-form-item",{attrs:{label:"开启工单自动审批"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后，符合条件的工单自动审核并执行。"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.work_auto_review,callback:function(e){t.$set(t.configForm,"work_auto_review",e)},expression:"configForm.work_auto_review"}})],1)],1),t.configForm.work_auto_review?a("el-form-item",{attrs:{label:"自动审批最大行数",prop:"user"}},[a("el-tooltip",{attrs:{placement:"top",content:"超过最大行数走人工审批"}},[a("el-input",{attrs:{type:"number",size:"mini"},model:{value:t.configForm.max_update_rows,callback:function(e){t.$set(t.configForm,"max_update_rows",t._n(e))},expression:"configForm.max_update_rows"}})],1)],1):t._e(),t.configForm.work_auto_review?a("el-form-item",{attrs:{label:"自动审批仅支持DML",prop:"user"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后自动审核仅支持DML工单"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.auto_review_only_dml,callback:function(e){t.$set(t.configForm,"auto_review_only_dml",e)},expression:"configForm.auto_review_only_dml"}})],1)],1):t._e(),t.configForm.work_auto_review?a("el-form-item",{attrs:{label:"不自动审批的表达式",prop:"user"}},[a("el-tooltip",{attrs:{placement:"top",content:"正则表达式，匹配的脚本走人工审批"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.configForm.auto_review_regex,callback:function(e){t.$set(t.configForm,"auto_review_regex",e)},expression:"configForm.auto_review_regex"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:"强制备份"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后，支持备份的数据源会强制备份。"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_backup_switch,callback:function(e){t.$set(t.configForm,"enable_backup_switch",e)},expression:"configForm.enable_backup_switch"}})],1)],1),a("el-form-item",{attrs:{label:"开启工单线下手工执行"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启后，工单执行支持线下执行,支持DBA线下手动执行语句并且确认执行结束。"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.work_manual,callback:function(e){t.$set(t.configForm,"work_manual",e)},expression:"configForm.work_manual"}})],1)],1),a("el-form-item",{attrs:{label:"驳回等级",prop:"port"}},[a("el-radio",{attrs:{label:1},model:{value:t.configForm.auto_review_wrong,callback:function(e){t.$set(t.configForm,"auto_review_wrong",e)},expression:"configForm.auto_review_wrong"}},[t._v("警告驳回")]),a("el-radio",{attrs:{label:2},model:{value:t.configForm.auto_review_wrong,callback:function(e){t.$set(t.configForm,"auto_review_wrong",e)},expression:"configForm.auto_review_wrong"}},[t._v("错误驳回")])],1)],1)],1),a("el-card",{staticClass:"box-card"},[a("el-form",[a("el-form-item",{staticClass:"el-col-24"},[t.edit?a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"medium"},on:{click:t.onSubmit}},[t._v("保存")]):t._e()],1)],1)],1)],1)},n=[],o={data:function(){return{real_id:0,filterText:""}},computed:{},props:{configForm:{},edit:{type:Boolean,default:function(){return!1}}},watch:{},methods:{onSubmit:function(){!this.configForm.work_auto_review||this.configForm.max_update_rows?this.$emit("submit",this.configForm):this.onError("请输入自动审批最大行数")}},components:{},mounted:function(){}},i=o,r=(a("946c"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"4c39":function(t,e,a){},"4c7e":function(t,e,a){},"4cc5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"【"+t.role.name+"】-- 数据源",visible:t.isShow,width:"950px","append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:"onSelect",url:"/api/role/db/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"数据源类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:""==t.ids},on:{click:t.onBatchAdd}},[t._v("批量添加")]),a("el-button",{attrs:{type:"danger",size:"mini",disabled:""==t.ids},on:{click:t.onBatchRemove}},[t._v("批量移除")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源",prop:"name",width:"280"}}),a("el-table-column",{attrs:{label:"类型",prop:"db_type"}}),a("el-table-column",{attrs:{label:"启用",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 ")]):a("span",{staticClass:"text-warn"},[t._v(" 否 ")])]}}])}),a("el-table-column",{attrs:{label:"连接状态",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("div",[3==e.row.con_state?a("el-tooltip",{attrs:{content:e.row.err_msg,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("连接失败")])]):2==e.row.con_state?a("span",{staticClass:"text-success"},[t._v("已连接")]):1==e.row.con_state?a("span",{staticClass:"text-info"},[t._v("连接中")]):a("span",{staticClass:"text-info"},[t._v("未连接")])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"读写",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.oper_type?a("span",{staticClass:"auth-read"},[t._v("只读")]):a("span",{staticClass:"text-error"},[t._v("读写")])]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.role_id?a("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(a){return t.onAdd(e.row.id)}}},[t._v("添加 ")]):t._e(),0!=e.row.role_id?a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=a("2909"),r=(a("99af"),a("a15b"),a("ac1f"),a("841c"),a("2f62")),l={data:function(){return{db:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).DB,role:{},ids:"",isShow:!1,search:{db_types:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],db_types:[{label:"全部",value:""}].concat(Object(i["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]))}},props:{},watch:{},computed:Object(o["a"])({},Object(r["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.role=t,this.search.role_id=t.id,this.search.project=t.project,this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this;this.$api.role.relationDB(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kickDB(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"4cca":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请权限",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"申请组",prop:"role"}},[a("k-select",{attrs:{url:"/api/role/all"},model:{value:t.formData.role,callback:function(e){t.$set(t.formData,"role",e)},expression:"formData.role"}})],1),a("el-form-item",{attrs:{label:"申请理由",prop:"reason"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.reason,callback:function(e){t.$set(t.formData,"reason",e)},expression:"formData.reason"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{isShow:!1,formData:{},formRule:{role:[{required:!0,message:"请选择申请的组"}],reason:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t){this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){this.$refs.form.validate((function(t){}))}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"4cd4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-cardx",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"file-table-list",attrs:{head:"数据表",isTypes:"redis"!=t.owner.db_type,types:t.types,db_type:t.owner.db_type},on:{selected:t.selItem}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字过滤数据表",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.refresh(null,!0)}}},[t._v("刷新")])],1),a("div",{staticClass:"role-table-list"},[t.owner&&t.vnodeList&&t.vnodeList.length>0?a("div",{staticClass:"item hbox-between"},[a("div",{staticClass:"left"},[a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(e){return t.checkAllChangeHandler(e,!0)}},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("全选")])],1),a("div",{staticClass:"center",staticStyle:{"font-size":"12px"}},[t._v(" "+t._s(t.pages.nodeLength)+"/"+t._s(t.pages.total)+" ")]),3!=t.owner.rw?a("div",{staticClass:"right all pointer-active",attrs:{title:"批量设置"},on:{click:t.batchClickHandle}},[t._v(" 批量设置 ")]):t._e()]):t._e(),t._v("   "),t.filterDataList.length>0?a("virtual-list",{ref:"table-vlist",staticClass:"table-vlist",attrs:{"data-key":"label","estimate-size":t.itemHeight,keeps:t.vlistKeeps,"data-sources":t.filterDataList,"data-component":t.vlistTemplate,"extra-props":{selectedNodeList:t.selectedNodeList,selectedItemLabel:t.selectedItemLabel}},on:{tobottom:t.onScrollToBottom}},[a("div",{staticClass:"loading-spinner no-user-select",attrs:{slot:"footer"},slot:"footer"},[t._v("结束.")])]):a("div",{ref:"table-vlist",staticClass:"empty"},[t._v(" "+t._s(t.emptyText)+" ")])],1),a("dialog-batchauth",{ref:"dialogBatchauthRef",attrs:{"confirm-loading":!0},on:{confirm:t.onBatchConfirm}})],2)},n=[],o=(a("498a"),a("b0c0"),a("d3b7"),a("159b"),a("99af"),a("3ca3"),a("ddb0"),a("4de4"),a("2ef0")),i=a("aa90"),r=a("89c1"),l=a.n(r),c=a("f13c"),u=a("ac9c"),d=a("163b"),p={name:"role-table-list",data:function(){return{selectedType:null,types:[],vlistTemplate:c["default"],vlistKeeps:30,itemHeight:24,selectedNodeList:[],selectedItemLabel:"",pages:{no:0,size:100,total:0,nodeLength:0},vnodeList:[],emptyText:"请选择数据实例",isCheckAll:!1,isIndeterminate:!1,tooltipAsync:"",confirmAsync:!1,checked:{},check_rw:-1,type:"table",cur_name:"",filterText:"",loading:!1,def_checks:[],ids:[],dataList:[],treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:{role:{},owner:{},project:{}},computed:{filterDataList:function(){var t=this;return""==this.filterText.trim()?this.vnodeList:Object(o["filter"])(this.vnodeList,(function(e){return-1!=e.label.toUpperCase().indexOf(t.filterText.toUpperCase())}))}},watch:{owner:{handler:function(t){console.log("[table.list watch] owner:",t),this.emptyText="请选择数据实例",this.refresh(null,!0)}}},methods:{batchClickHandle:function(){this.selectedNodeList.length>0?(this.$refs.dialogBatchauthRef.show(this.selectedNodeList,this.owner),this.$refs.dialogBatchauthRef.setHeaders({title:"设置权限",targetText:"数据库："+(this.owner&&this.owner.label)})):this.$message({message:"请勾选数据表",type:"warning"})},onScrollToBottom:function(){this.loading?console.info("[table.list methods] onScrollToBottom() 防止多次查询"):this.pages.cursor?(this.pages.no=this.pages.cursor,console.log("[table.list methods] onScrollToBottom：",this.pages),this.refresh(null,!1)):this.loading=!1},checkAllChangeHandler:function(t,e){e&&t?(console.log("全选",this.vnodeList.length),this.selectedNodeList=this.vnodeList):(console.log("取消全选"),this.selectedNodeList=[]),this.setCheckAllBox()},selItem:function(t){this.type=t.value||t,this.selectedType=t,this.refresh(null,!0)},filterNode:function(t,e){return!t||(e.label==this.cur_name||(console.log("data.label:",e.label,"  value:",t),-1!==e.label.toLowerCase().indexOf(t.toLowerCase())))},vlistToTop:function(){this.$refs["table-vlist"]&&this.$refs["table-vlist"].scrollToIndex&&this.$refs["table-vlist"].scrollToIndex(0)},vlistReset:function(){this.$refs["table-vlist"]&&this.$refs["table-vlist"].reset&&this.$refs["table-vlist"].reset()},refresh:function(t,e){var a=this;if(!this.role.id||!this.owner.name)return this.vnodeList=[],void console.warn("[table.list]#refresh(): ",this.role,this.owner);console.log("[table.list methods] refresh：",t,e),this.loading=!0;var s={roleId:this.role.id,dbId:this.owner.db.id,tableName:this.owner.label,owner:this.owner,type:this.type,pageSize:this.pages.size,pageNo:this.pages.no};this.$api.db.schema.group({id:this.owner.perm.dbId}).then((function(t){console.log("结果：-----：2  ",t);var e=[];t.forEach((function(t){var a={label:t.name,value:t.sub_node_type};e.push(a)})),a.types=e,a.selectedType=e[0]||{}})).finally((function(){var t={id:a.owner.perm.dbId,db_type:a.owner.db_type,owner:a.owner.name,project:a.project.id,object_type:a.selectedType.value,node_type:a.selectedType.value};a.$api.db.schema.schemaSubNode(t).then((function(s){console.log("结果：-----：  ",s),e||t.f?(a.vlistReset(),a.vnodeList=s.List,a.selectedNodeList=[],a.isIndeterminate=!1):a.vnodeList=a.vnodeList.concat(s.List)})).finally((function(){a.loading=!1}))})),t&&d["a"].has(t,["f","type"])&&(console.log("[card.db methods] onChangeDB 自带config参数：",t),s=Object.assign(s,t)),this.loading=!0,this.$api.permission.allTable(s.roleId,s.dbId,s.tableName,s.owner,s.type,null,null,s.pageNo,s.pageSize,s.f,!0).then((function(t){console.info("dataList: dataList",t,e),e||s.f?(console.log("强制刷新..."),a.vlistReset(),a.vnodeList=t.list,a.selectedNodeList=[],a.isIndeterminate=!1):a.vnodeList=a.vnodeList.concat(t.list),a.check_rw=-1,a.setCheckAllBox(),a.pages.cursor=t.cursor,a.pages.total=t.total,a.pages.nodeLength=a.vnodeList.length})).finally((function(){a.selectedItemLabel="",a.loading=!1,0==a.vnodeList.length?a.emptyText="空数据":a.emptyText="请选择数据实例"}))},onClick:function(t){this.cur_name=t.label,this.$emit("table",t,this.selectedType.value)},onAuthAsync:function(t,e){var a=this;console.log("owner.ae:",this.owner.ae," owner.aq:",this.owner.aq);var s="",n="",o=0;if(3!=this.owner.rw&&""!=this.owner.rw&&-1!=this.owner.rw){if("ae"==e){if(n="文件导出",0==this.owner.ae&&0==t.ae)return void this.onError("该数据表所在实例不支持导出操作！");1==t.ae?(t.ae=0,s="取消"):(t.ae=1,s="设置"),o=t.ae}if("aq"==e){if(n="异步查询",0==this.owner.aq&&0==t.aq)return void this.onError("该数据表所在实例不支持异步查询操作！");1==t.aq?(t.aq=0,s="取消"):(t.aq=1,s="设置"),o=t.aq}if("as"==e){if(n="导出Sql",0==this.owner.as&&0==t.as)return void this.onError("该数据表所在实例不支持导出Sql操作！");1==t.as?(t.as=0,s="取消"):(t.as=1,s="设置"),o=t.as}if("aw"==e){if(n="工单流程",0==this.owner.aw&&0==t.aw)return void this.onError("该数据表所在实例不支持工单流程操作！");1==t.aw?(t.aw=0,s="取消"):(t.aw=1,s="设置"),o=t.aw}this.addTablePermAsync(t,e,o).then((function(){var e=s+n+"成功";a.onSuccess(e),a.this.onSelectRow(t)}))}else this.onError("该数据表所在实例不支持该操作！")},onAuth:function(t,e,a){var s=this;return console.log("onAuth rw:",e),3==this.owner.rw||""==this.owner.rw||-1==this.owner.rw?this.onError("该数据表所在实例不支持该操作！"):1!=this.owner.rw||2!=e&&4!=e?2==this.owner.rw&&4==e?this.onError("该数据表所在实例不支持该操作！"):void this.addTablePerm(t.label,e).then((function(a){t.rw=e,t.rw&&-1!=t.rw?(t.ae=a.asyn_export,t.aq=a.asyn_query,t.as=a.asyn_sql):(t.ae=0,t.aq=0,t.as=0);var n="操作成功";3==e?n="设置禁用成功":4==e?n="设置管理成功":1==e?n="设置只读成功":2==e?n="设置读写成功":-1==e&&(n="取消设置成功"),console.log("刷新下级:"),s.$emit("refresh-next","table"),s.onSuccess(n),s.onSelectRow(t)})):this.onError("该数据表所在实例不支持该操作！")},onBatchConfirm:function(t){var e=this,a=!0;if(3==this.owner.rw||""==this.owner.rw||-1==this.owner.rw?(console.warn("[table.list methods] 数据库被禁：",this.owner.rw,this.owner),a=!1):1!=this.owner.rw||2!=t.rw&&4!=t.rw?2==this.owner.rw&&4==t.rw?a=!1:-1==t.rw&&(t.rw=null,this.$message.warning("[warn-201] 没有选择读写权限")):a=!1,!a)return this.$message.error("[err-201] 权限选择错误"),this.loading=!1,void this.$refs.dialogBatchauthRef.hide();var s=this.selectedNodeList;this.loading=!0;var n=[];console.log("[table.list methods] onBatchaConfirm 设置后的权限:",t),s.forEach((function(a){n.push(e.addTablePerm2(a.label,t.rw,t.aq,t.ae,t.as))})),Promise.all(n).then((function(){for(var a="操作成功",n=0;n<s.length;n++)s[n].rw=t.rw,s[n].aq=t.aq,s[n].ae=t.ae,s[n].as=t.as;e.onSuccess(a)})).catch((function(){e.onError("操作失败"),e.refresh(null,!0)})).finally((function(){e.loading=!1,e.$refs.dialogBatchauthRef.hide()}))},addTablePerm2:function(t,e,a,s,n){var o={roleId:this.role.id,dbId:this.owner.db.id,towner:this.owner.label,tname:t,rw:e,aq:a,ae:s,as:n,type:this.selectedType.value,project:this.project.id};return this.$api.permission.addPermission(o)},addTablePerm:function(t,e){return this.$api.permission.addTable(this.role.id,this.owner.db.id,this.owner.label,t,e,this.selectedType.value,this.project.id)},addTablePermAsync:function(t,e,a){return this.$api.permission.addAsyncPermission(this.role.id,this.owner.db.id,this.owner.label,t.label,t.rw,e,a,this.project.id)},setCheckAllBox:function(){this.isCheckAll=this.selectedNodeList.length===this.vnodeList.length&&0!=this.selectedNodeList.length,this.isCheckAll?this.isIndeterminate=!1:this.selectedNodeList.length>0?this.isIndeterminate=!0:0==this.selectedNodeList.length&&(this.isCheckAll=!1,this.isIndeterminate=!1)},onSelectRow:function(t){this.selectedItemLabel=t.label,"redis"!=this.owner.db_type&&this.onClick(t)}},components:{"dialog-batchauth":i["default"],"virtual-list":l.a},mounted:function(){var t=this,e=Object(u["a"])(this.$refs["table-vlist"],this.itemHeight);this.vlistKeeps=e||this.vlistKeeps,this.$on("vnode-change",(function(e){var a=e.type,s=e.source,n=e.e,o=e.auth;"selected-line"==a?t.onSelectRow(s):"checked-item"==a?(n?(t.selectedNodeList.push(s),t.setCheckAllBox()):(t.selectedNodeList=t.selectedNodeList.filter((function(t){return s.label!=t.label})),t.setCheckAllBox()),console.log("checked-item: ",s,n?"选中":"取消")):"change-auth"==a?(console.log("change-auth: 读、写、管、禁",s,o),t.onAuth(s,o.value)):"change-auth2"==a&&t.onAuthAsync(s,o.key)}))}},f=p,m=(a("ffa8"),a("e0e2"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,"026b4970",null);e["default"]=h.exports},"4d24":function(t,e,a){"use strict";a("bbaa5")},"4d3a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("ProjectList",{attrs:{type:"trash"}})],1)},n=[],o=a("74b8"),i={components:{ProjectList:o["default"]}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"4d627":function(t,e,a){"use strict";a("9741")},"4db0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dialog-work"},[a("el-dialog",{staticClass:"dialog-work-dialog",attrs:{title:"提交工单",visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",staticClass:"dialog-work-form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("div",{staticClass:"left-section"},[a("monaco-lite",{ref:"monacoLite",staticClass:"work-sql",attrs:{"sql-data":t.sql},on:{change:t.monacoListChangeHandler}})],1),a("div",{staticClass:"right-section"},[a("div",{staticClass:"right-section-top"},[a("el-form-item",{staticClass:"project-name",attrs:{label:"项目"}},[t._v(" "+t._s(t.project.name)+" ")]),a("el-form-item",{attrs:{label:"导入文件"}},[a("el-input",{attrs:{readonly:!0,placeholder:"仅支持5M内的SQL文件"}},[a("template",{slot:"append"},[a("span",{staticClass:"open-file",on:{click:t.loadFile}},[t._v("打开文件")])])],2)],1),a("el-form-item",{staticClass:"work-name",attrs:{label:"工单名称",prop:"name"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入工单名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"数据库",prop:"db_id"}},[a("select-database",{ref:"selectDatabse",on:{"select-change":t.onSelectDatabseChangeHandler}})],1),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[t.has_au?a("span",[t._v(t._s(t.currentSqlTypeText))]):t.has_au?a("el-tag",[t._v("未知")]):a("el-tag",[t._v("未审计")])],1),t.isAuditDQL?[a("el-form-item",{attrs:{label:"查询条数"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:t.formData.fetch_size,callback:function(e){t.$set(t.formData,"fetch_size",e)},expression:"formData.fetch_size"}})],1),a("el-form-item",{attrs:{label:"查询类型"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:!t.sqlTypeToolTip,content:t.sqlTypeToolTip,placement:"top"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.formData2TypeHandler},model:{value:t.formData2.type,callback:function(e){t.$set(t.formData2,"type",e)},expression:"formData2.type"}},[a("el-option",{attrs:{title:t.sqlTypeToolTips[5],label:"快照查询",value:"5"}}),a("el-option",{attrs:{title:t.sqlTypeToolTips[3],label:"在线查询",value:"3"}}),a("el-option",{attrs:{title:t.sqlTypeToolTips[4],label:"文件导出",value:"4"}})],1)],1)],1),4==t.formData2.type?a("el-form-item",{attrs:{label:"导出方式"}},[a("el-select",{attrs:{placeholder:"文件类型"},model:{value:t.formData.file_type,callback:function(e){t.$set(t.formData,"file_type",e)},expression:"formData.file_type"}},t._l(t.fileTypes,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1):t._e()]:t._e(),t.isAuditDQL?a("el-form-item",{attrs:{label:"忽略脱敏的字段"}},[a("el-tooltip",{attrs:{content:"越过脱敏策略，查询源数据"}},[a("el-input",{attrs:{placeholder:"请使用 , 号(英文逗号)分割"},model:{value:t.formData.no_mask_field,callback:function(e){t.$set(t.formData,"no_mask_field",e)},expression:"formData.no_mask_field"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:"自动审计"}},[t.has_au?99==t.formData.sql_type?a("el-tag",{attrs:{type:"warning"}},[t._v("不支持审计")]):0==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):1==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"warning"}},[t._v("警告")]):2==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"danger"}},[t._v("错误")]):1==t.level&&"7"==t.stage_status?a("el-tag",{attrs:{type:"warning"}},[t._v("不支持审计")]):a("el-tag",[t._v("未知")]):a("el-tag",[t._v("未审计")])],1),"0"==t.stage_status?a("el-form-item",{attrs:{label:"预估影响行数"}},[a("h3",{staticStyle:{color:"red","fond-weight":"blod"}},[t._v(t._s(t.affected_rows))])]):t._e(),a("el-form-item",{attrs:{label:"审计日志"}},[a("el-link",{on:{click:t.showLog}},[t._v("查看")])],1),a("el-form-item",{attrs:{label:"审批流程"}},[a("el-tag",[t._v(t._s(t.project.sql_audit_auth_str))])],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-checkbox",{attrs:{disabled:t.isAuditDQL,"true-label":1,"false-label":2},on:{change:t.onExecFlagHandler},model:{value:t.formData.exec_flag,callback:function(e){t.$set(t.formData,"exec_flag",e)},expression:"formData.exec_flag"}},[t._v("不限 ")])],1),2==t.formData.exec_flag?a("el-form-item",{staticClass:"work-exec-time",attrs:{label:"时间范围",prop:"execTimes"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.formData.execTimes,callback:function(e){t.$set(t.formData,"execTimes",e)},expression:"formData.execTimes"}})],1):t._e(),a("el-form-item",{attrs:{label:"工单说明",prop:"mark"}},[a("el-input",{attrs:{rows:4,type:"textarea",placeholder:"请输入工单说明"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1)],2),a("div",{staticClass:"dialog-footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),t.has_au?a("el-button",{attrs:{type:"success",disabled:t.disabled},on:{click:t.onSubmit}},[t._v("提 交")]):a("el-button",{attrs:{type:"danger"},on:{click:t.handAudit}},[t._v("手 动 审 计")])],1)])]),a("dialog-audit-log",{ref:"sqlAuditLog"})],1),a("div",{attrs:{hidden:""}},[a("input",{ref:"openFile",staticClass:"file",attrs:{id:"sql-upload",name:"sql-upload",accept:".sql",type:"file"},on:{change:t.getFile}})])],1)},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("b0c0"),a("2f62")),l=a("c1df"),c=a.n(l),u=a("ccad"),d=a("cb68"),p=a("0c52"),f=a("e31c"),m=a("ff60"),h={computed:Object(i["a"])(Object(i["a"])({},Object(r["e"])(["project","sys","service","sqlTypes","fileTypes"])),{},{isAuditDQL:function(){var t=this.has_au&&(3==this.formData.type||4==this.formData.type||5==this.formData.type);return t&&(this.formData.exec_flag=2),t},sqlTypeToolTip:function(){var t=this.sqlTypeToolTips[this.formData.type];return t||!1},currentSqlTypeText:function(){return this.sqlTypes[this.formData.type]}}),data:function(){return{sqlTypeToolTips:{3:"在线查询：审批通过后，在工单执行时间范围内可多次查询实时数据",4:"文件导出：工单执行时根据查询结果生成文件，在工单执行时间范围内可重复下载",5:"查询快照：工单执行时根据结果生成数据快照，在工单执行时间范围内可多次查询数据快照"},has_au:!1,activeName:"工单详情",sql:"",workType:"auto",disabled:!1,disabled_backup:!0,typeText:null,role:{},level:0,affected_rows:0,stage_status:"",execTimes:[],isShow:!1,config:{lang:"sql"},data:{},db:{can_backup:1},formData2:{type:"3"},formData:this.resetFormData(),formRule:{execTimes:[{required:!0,message:"请选择时间范围"}],mark:[{required:!0,message:"请输入工单说明"}],name:[{required:!0,message:"请输入工单名称"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},components:{DialogAuditLog:u["default"],MonacoLite:d["default"],"select-database":p["default"]},methods:{loadFile:function(t){console.log("打开文件：",t),this.openFileEncode=t,this.$refs.openFile.click()},addContent:function(t){this.$refs.monacoLite.setSql(t)},getFile:function(t){if(window.FileReader){var e=t.target.files[0],a=e.size;if(a>1048576)this.$message({showClose:!0,type:"error",message:"打开失败，文件过大！（max=1M）"});else if(-1!=e.name.indexOf(".sql")){var s=new FileReader,n=this;s.onload=function(){n.addContent(this.result),t.target.value=""},s.readAsText(e,this.openFileEncode)}else this.$message.error("不支持该类型的文件上传")}},onExecFlagHandler:function(t){console.log(t),1==t&&(this.execTimes=[])},formData2TypeHandler:function(t){this.formData.exec_flag=3==t?2:1,this.formData.type=t},onSelectDatabseChangeHandler:function(t){var e=t.source,a=t.instance;console.log("触发数据库... ..."),this.formData.dbType=a.db_type,this.formData.db_id=a.db_id,this.formData.owner=a.label,this.formData.db=e.label,this.has_au=!1},monacoListChangeHandler:function(t){this.formData.sql=t,this.has_au=!1,console.log("触发，monacoListChangeHandler",this.formData.sql)},handAudit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.formData.sql){e.next=3;break}return t.$message.error("审计内容不可为空，请输入SQL"),e.abrupt("return");case 3:return console.log("手动审计... ..",t.formData.sql),e.next=6,t.onAudit(t.formData.sql);case 6:a=e.sent,s=Object(i["a"])(Object(i["a"])({},t.service.data),{},{script:t.formData.sql}),t.show(s,a,"hand-audit");case 9:case"end":return e.stop()}}),e)})))()},onAudit:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return delete e.service.data.async,e.service.encrypt_sql=e.sys.encrypt_sql,e.service.onReset(),s=null,a.prev=4,n=Object(i["a"])(Object(i["a"])({},e.service.data),{},{sql:t}),n.project=e.project.id,n.iid=n.db_id,n.db_type=n.dbType,n.token=Object(m["a"])(),a.next=12,e.$api.work.work_audit(n);case 12:s=a.sent,a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](4),console.log("dialg.work ==========   e:",a.t0),s=a.t0;case 19:return a.abrupt("return",s);case 20:case"end":return a.stop()}}),a,null,[[4,15]])})))()},show:function(t,e,a){var s=this,n=Object(i["a"])({},this.formData);e?(console.log("au: ",e),12==e.sql_type||13==e.sql_type||14==e.sql_type?n.type=1:15==e.sql_type?n.type=2:11==e.sql_type?n.type=3:n.type=9):e={},this.has_au=!0,this.data=t,n.id=e.token||Object(m["a"])(),n.exec_flag=1,n.sql_type=e.sql_type||99,n.exec_start=null,n.exec_end=null,"hand-audit"!=a&&(t.script=f["a"].removeSoftRoute(t.script),this.sql=t.script,console.log("data.script: ",t.script),n.sql=t.script,n.mark="",n.name=""),n.dbType=e.db_type||t.dbType,n.db_id=e.db_id||t.id,n.owner=e.owner||t.owner,n.audit_id=0,this.level=e.level,this.affected_rows=e.affected_rows,this.stage_status=e.stage_status,this.formData=Object(i["a"])({},n),this.isShow=!0,this.$nextTick((function(){s.$refs.monacoLite&&(s.$refs.monacoLite.setCount(0),s.$refs.monacoLite.init(s.formData.sql),s.$refs.selectDatabse.init({db_id:s.formData.db_id,owner:s.formData.owner},!0))}))},tabHandleClick:function(t,e){console.log(t,e)},showLog:function(){this.$refs.sqlAuditLog.show(this.formData.id)},resetFormData:function(){return{id:"",exec_flag:1,exec_start:null,exec_end:null,source_type:"none",source_id:"none",sql:"",type:"",no_mask_field:"",fetch_size:500,file_type:"5",name:"",mark:"",audit_id:0,back_up:0,execTimes:[]}},hide:function(t){this.disabled=!1,this.isShow=!1,this.has_au=!1,this.level=0,this.affected_rows=0,this.formData=this.resetFormData(),this.formData2.type="3",this.$refs.monacoLite.setCount(0)},editorInit:function(){a("2099"),a("8882"),a("8ef6"),a("1d29")},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=Object(i["a"])({},t.formData);if(delete a.execTimes,2==a.exec_flag){if(t.formData.execTimes<2)return void t.onError("时间范围出错，请重新选择！！");a.exec_start=c()(t.formData.execTimes[0]).format("YYYY-MM-DD HH:mm:ss"),a.exec_end=c()(t.formData.execTimes[1]).format("YYYY-MM-DD HH:mm:ss")}a.project=t.project.id,t.$api.work.add(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}))}}))}},mounted:function(){}},b=h,_=(a("d588"),a("2877")),g=Object(_["a"])(b,s,n,!1,null,null,null);e["default"]=g.exports},"4ddc":function(t,e,a){},"4ea6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-effect-pages",attrs:{title:"修改数据",visible:t.isShow,"append-to-body":!0,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("monaco-lite",{ref:"monacoLite",staticClass:"effect-sql",on:{change:t.monacoListChangeHandler}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.isShow=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.onClick("exec")}}},[t._v("提 交")])],1)],1)},n=[],o=a("cb68"),i={name:"dialog-effect",components:{MonacoLite:o["default"]},data:function(){return{isShow:!1,sql:""}},methods:{onClick:function(t){"exec"==t?(this.$emit("action",this.sql),this.isShow=!1):"copy"==t||this.$message.error("参数错误")},monacoListChangeHandler:function(){console.log("修改了")},show:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sql:null},a=e.sql;this.isShow=!0,this.$nextTick((function(){a&&(t.sql=a),t.$refs.monacoLite.setSql(a||"-- SQL生成错误")}))}}},r=i,l=(a("567d"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"4eaf":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.pro.name+"/审计管理",visible:t.isShow,fullscreen:"",width:"100%"},on:{"update:visible":function(e){t.isShow=e}}},[a("setting-inception",{attrs:{db_id:"*",project:t.id,project_name:t.pro.name}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=a("2f62"),r=a("5cbd"),l={data:function(){return{setting:{},inter:null,run_str:"",size:"small",activeName:"inception",db:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).DB,pro:{},id:"",isShow:!1,search:{db_types:null}}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{reset:function(){this.setting={},this.activeName="inception",this.id=""},show:function(t){this.pro=t,this.id=t.id;var e=this;e.isShow=!0},hide:function(t){this.isShow=!1}},mounted:function(){},components:{SettingInception:r["default"]}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"4edf":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._v(" 未知用户级别 ")])},n=[],o=a("2877"),i={},r=Object(o["a"])(i,s,n,!1,null,null,null);e["default"]=r.exports},"4f17":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-query",use:"d2-query-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-query"><path d="M1006.08 927.232l-88.576-89.088c25.088-40.96 39.936-88.576 39.936-140.288 0-146.944-119.296-266.24-266.752-266.24s-267.264 119.296-267.264 266.24 119.296 266.24 266.752 266.24c55.808 0 107.008-16.896 150.016-46.08l87.04 87.552c10.24 10.24 24.064 16.384 39.424 16.384 30.72 0 55.808-24.576 55.808-55.296-0.512-15.36-6.656-29.184-16.384-39.424z m-315.904-45.568c-101.888 0-184.32-82.432-184.32-183.808s82.432-183.808 184.32-183.808 184.32 82.432 184.32 183.808c0.512 101.376-82.432 183.808-184.32 183.808zM423.424 392.192c265.728 0 451.072-67.072 451.072-150.016V152.064C874.496 69.12 689.152 2.048 423.424 2.048 157.696 2.56 2.048 69.632 2.048 152.064v90.112c0 82.432 155.648 150.016 421.376 150.016z m-64 374.784c-182.272-6.656-279.552-64.512-335.36-120.32-14.336 14.336-20.992 29.184-20.992 45.056v119.808c0 82.944 155.648 150.016 421.376 150.016 26.624 0 52.224-0.512 77.824-2.048-69.12-49.152-127.488-107.008-142.848-192.512z m4.096-76.8c0-79.36 28.672-152.064 75.264-208.896h-17.408c-215.552 0-336.896-44.032-398.336-104.96C8.704 390.656 2.048 405.504 2.048 421.376v119.808c0 76.8 132.608 139.776 361.472 148.992z" p-id="29122" /></symbol>'});i.a.add(r);e["default"]=r},"4f4e":function(t,e,a){"use strict";a("304a")},"4f8b":function(t,e,a){},"4f8d":function(t,e,a){},"4f98":function(t,e,a){},5202:function(t,e,a){},5248:function(t,e,a){},5292:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/ssh/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"ip",prop:"host"}},[a("el-input",{model:{value:t.search.host,callback:function(e){t.$set(t.search,"host",e)},expression:"search.host"}})],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("添加主机")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id"}}),a("el-table-column",{attrs:{label:"名称",prop:"name"}}),a("el-table-column",{attrs:{prop:"ip",label:"地址"}}),a("el-table-column",{attrs:{prop:"add_user",label:"添加人"}}),a("el-table-column",{attrs:{prop:"info",label:"备注"}}),a("el-table-column",{attrs:{label:"授权用户",prop:"user_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"pointer-active",attrs:{disabled:t.user.id!=e.row.add_user,title:"单击关联/移除用户"},on:{click:function(a){return a.stopPropagation(),t.showUserListPage(e.row)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.user_count)+") ")])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{title:"打开终端",type:"primary",size:"mini"},on:{click:function(a){return t.onTerm(e.row)}}},[t._v("ssh ")]),a("el-button",{attrs:{title:"edit ssh connection configuration",type:"warning",size:"mini",icon:"el-icon-edit",disabled:t.user.id!=e.row.add_user},on:{click:function(a){return t.onEdit(e.row.id)}}}),a("el-button",{attrs:{title:"view ssh machine information",type:"success",size:"mini",icon:"el-icon-view"},on:{click:function(a){return t.handleClickView(e.row)}}}),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】主机信息吗?"},on:{click:function(a){return t.onDel(e.row.id)}}},[a("el-button",{attrs:{title:"delete ssh connection",type:"danger",size:"mini",icon:"el-icon-delete-solid",disabled:t.user.id!=e.row.add_user}})],1)]}}])})],1)],2),a("dialog-term",{ref:"termDialog",attrs:{obj:t.selectedRow},on:{pclose:t.doClose}}),a("dialog-edit",{ref:"sshDialog",on:{success:t.refresh}}),a("dialog-user",{ref:"userDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("5530"),i=(a("b0c0"),a("ac1f"),a("841c"),a("ad1b")),r=a("3ae7"),l=a("2ab6"),c=a("2f62"),u={components:{DialogTerm:i["default"],DialogUser:l["default"],DialogEdit:r["default"]},name:"ViewSsh",computed:Object(o["a"])({},Object(c["e"])(["user"])),props:{},data:function(){return{search:{name:"",state:""},termVisible:!1,selectedRow:{},dialogInfoVisible:!1,formLabelWidth:"120px",dialogFormVisible:!1,total:0,page:1,size:10,tableData:[],q:"",form:{},info:{}}},mounted:function(){},created:function(){},methods:{handleClickView:function(t){var e=this;this.info=t,this.$api.ssh.hardware(t.id).then((function(t){t&&(e.info=t),e.dialogInfoVisible=!0}))},showUserListPage:function(t){t&&this.user.id==t.add_user?this.$refs.userDialog.show(t):this.$message.success("只允许添加人查看.")},onTerm:function(t){console.log("m: ",t);var e=this.$router.resolve({path:"/ssh/".concat(t.id),query:{id:t.id,name:t.name}});console.log("routeData.href: ",e.href),window.open(e.href,"_blank")},onNew:function(){this.$refs.sshDialog.show()},onEdit:function(t){this.$refs.sshDialog.show(t)},onDel:function(t){var e=this;this.$api.ssh.delete({id:t}).then((function(){e.refresh()}))},resetSearch:function(){console.log("========resetSearch========="),this.search={}},refresh:function(){this.$refs.st.search()},doClose:function(t){this.termVisible=t},pageChange:function(t){this.page=t,this.refresh()},sizeChange:function(t){this.page=1,this.size=t,this.refresh()},handleClickConsole:function(t){this.selectedRow=t,this.termVisible=!0},handleClickSftp:function(t){this.$router.push({name:"sftp",params:t})},handleClickUpdate:function(t){this.form=t,this.dialogFormVisible=!0},doCreate:function(){this.form={user:"",port:22,password:"",name:"",ID:0,type:"password"},this.dialogFormVisible=!0},doDelete:function(t){var e=this;this.$http.delete("api/ssh/".concat(t.id)).then((function(t){t&&(e.$message.success(t.msg),e.refresh())}))}}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},5298:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"log"},[a("k-search-table",{ref:"st",attrs:{url:"/api/sys/report/stat","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"操作类型:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.task_type,callback:function(e){t.$set(t.search,"task_type",e)},expression:"search.task_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请填写操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onExport}},[t._v("导出")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"db_name",label:"数据库"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.db_name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"db_type",label:"库类型"}}),a("el-table-column",{attrs:{prop:"hits",label:"执行次数"}}),a("el-table-column",{attrs:{label:"数据行数",prop:"data_count"}})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行次数排序"},{k:1,v:"按数据总量顺序"}],types:[{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:99,v:"其他"}],search:{ip:"",start:"",end:"",type:this.defaultType,owner:"",order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),props:{defaultType:{}},watch:{},methods:{onDownload:function(t){var e=window.localStorage.getItem("token");this.$api.download("/api/download/export/excel",{id:t,access_token:e})},onExport:function(){var t=this,e=Object(o["a"])({},this.search);e.dateRange&&(e.start=l()(e.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),e.end=l()(e.dateRange[1]).format("YYYY-MM-DD HH:mm:ss")),this.$api.post("/api/sys/report/stat/export",e).then((function(e){console.log("ret:",e),t.onDownload(e)}))},quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={start:"",end:"",type:this.defaultType,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e}))}},u=c,d=(a("17c5"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"52dd":function(t,e,a){},5514:function(t,e,a){},"55aa":function(t,e,a){"use strict";a("47bb")},5647:function(t,e,a){"use strict";a("03ad")},"566b":function(t,e,a){a("159b"),a("d3b7"),a("ddb0");var s=function(t){return t.keys().forEach(t)};try{s(a("7213"))}catch(n){console.log(n)}},"567d":function(t,e,a){"use strict";a("cead")},"56ab":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);var s={};a.r(s),a.d(s,"KIcon",(function(){return _})),a.d(s,"KDataCascade",(function(){return gs})),a.d(s,"KDataStep",(function(){return Va})),a.d(s,"KTimeRefresh",(function(){return pa})),a.d(s,"KHSplit",(function(){return ia})),a.d(s,"KAvatar",(function(){return We})),a.d(s,"KCard",(function(){return ue})),a.d(s,"KCardx",(function(){return be})),a.d(s,"KCardx2",(function(){return Se})),a.d(s,"KQueryCardx",(function(){return De})),a.d(s,"KEditor",(function(){return ne})),a.d(s,"KSearchPop",(function(){return Q})),a.d(s,"KImage",(function(){return Jt})),a.d(s,"KTitle",(function(){return Yt})),a.d(s,"KBtnApi",(function(){return qt})),a.d(s,"KBtnTip",(function(){return E})),a.d(s,"KBtnTime",(function(){return D})),a.d(s,"KSearchTable",(function(){return P})),a.d(s,"KSearchList",(function(){return z})),a.d(s,"KUpload",(function(){return st})),a.d(s,"KLoading",(function(){return jt})),a.d(s,"KRanger",(function(){return it})),a.d(s,"KSelect",(function(){return ut})),a.d(s,"KTags",(function(){return Ot})),a.d(s,"KMultiUpload",(function(){return bt})),a.d(s,"KTip",(function(){return St})),a.d(s,"KWaterMark",(function(){return ta})),a.d(s,"ProjectCard",(function(){return Pe})),a.d(s,"tfa",(function(){return ks})),a.d(s,"ProjectCard2",(function(){return Ve}));a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("4de4"),a("b680");var n=a("2b0e"),o=a("c1df"),i=a.n(o);a("d3b7");n["default"].mixin({methods:{isValidate:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"form";return new Promise((function(a,s){t.$refs[e].validate((function(t){t?a():s(new Error)}))}))},validateEmail:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"请输入正确的邮箱地址";return{validator:function(e,a,s){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;n.test(a)?s():s(new Error(t))},trigger:"blur"}},validatePhone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"请输入正确的手机号";return{validator:function(e,a,s){/^1[2345789]\d{9}$/.test(a)?s():s(new Error(t))},trigger:"blur"}}}});a("ac1f"),a("841c");n["default"].mixin({data:function(){return{dateRange:[]}},watch:{dateRange:function(t){t&&2===t.length&&this.search&&(this.search.start=i()(t[0]).format("YYYY-MM-DD HH:mm:ss"),this.search.end=i()(t[1]).format("YYYY-MM-DD HH:mm:ss"))}}});a("caad"),a("2532"),a("a9e3"),a("5319");n["default"].directive("dialogDrag",{bind:function(t,e,a,s){var n=t.querySelector(".el-dialog__header"),o=t.querySelector(".el-dialog");n.style.cursor="move";var i=o.currentStyle||window.getComputedStyle(o,null);n.onmousedown=function(t){var e,a,s=t.clientX-n.offsetLeft,r=t.clientY-n.offsetTop;i.left.includes("%")?(e=Number(document.body.clientWidth)*(Number(i.left.replace(/%/g,""))/100),a=Number(document.body.clientHeight)*(Number(i.top.replace(/%/g,""))/100)):(e=Number(i.left.replace(/\px/g,"")),a=Number(i.top.replace(/\px/g,""))),document.onmousemove=function(t){var n=t.clientX-s,i=t.clientY-r;o.style.left="".concat(n+e,"px"),o.style.top="".concat(i+a,"px")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}}}}),n["default"].directive("dialogDragWidth",{bind:function(t,e,a,s){var n=e.value.$el.querySelector(".el-dialog");t.onmousedown=function(e){var a=e.clientX-t.offsetLeft;document.onmousemove=function(t){t.preventDefault();var e=t.clientX-a;n.style.width="".concat(e,"px")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}}}});var r=!1,l=(n["default"].directive("business",{inserted:function(t,e,a){!1!==e.value&&r&&t.parentNode&&t.parentNode.removeChild(t)}}),n["default"].directive("only-community",{inserted:function(t,e,a){r||t.parentNode&&t.parentNode.removeChild(t)}}),a("365c")),c=a("5c96"),u=a.n(c),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return"svg"==t.type?a("svg",{staticClass:"icon xxxxxxxx",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":t.icon2Class}})]):a("img",{staticClass:"icon",attrs:{src:t.icon2Class,alt:t.icon||t.name}})},p=[],f=(a("b0c0"),{name:"Icon",props:{icon:{type:String},name:{type:String},type:{type:String,default:function(){return"svg"}}},computed:{icon2Class:function(){var t=this.icon||this.name;return"svg"==this.type?t.includes("icon-")?"#".concat(t):"#icon-".concat(this.icon):"/static/icons/"+t+".png"}}}),m=f,h=(a("ba5d"),a("2877")),b=Object(h["a"])(m,d,p,!1,null,null,null),_=b.exports,g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"btn-del"},[a("el-popover",{ref:"popover",attrs:{placement:"top",width:"160"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("p",[t._v(t._s(t.tip))]),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:t.size,type:"text"},on:{click:function(e){t.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onConfirm}},[t._v("确定")])],1),a("div",{attrs:{slot:"reference"},on:{click:function(t){t.stopPropagation()}},slot:"reference"},[t._t("default")],2)])],1)},v=[],y={data:function(){return{visible:!1}},props:{type:{default:"danger"},size:{default:""},tip:{default:"确定要删除数据吗?"}},methods:{onConfirm:function(){this.visible=!1,this.$emit("click")}}},w=y,S=(a("b93e"),Object(h["a"])(w,g,v,!1,null,"132e2cbd",null)),E=S.exports,k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-button",{attrs:{type:t.type},on:{click:t.onClick}},[t.showTime?[t._v(" "+t._s(t.remain)+"后"+t._s(t.placeholder)+" ")]:t._t("default")],2)},x=[],T={data:function(){return{showTime:!1,remain:this.time}},computed:{},props:{placeholder:{default:"可再次点击"},time:{default:60},type:{}},watch:{},methods:{tick:function(){var t=this;if(0==this.remain)return this.remain=this.time,void(this.showTime=!1);this.remain--,setTimeout((function(){t.tick()}),1e3)},onClick:function(){this.showTime||(this.$emit("click"),this.showTime=!0,this.tick())}},components:{},mounted:function(){}},C=T,O=Object(h["a"])(C,k,x,!1,null,null,null),D=O.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-table"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:t.$slots["searchs"],expression:"$slots['searchs']"}],ref:"searchForm",staticClass:"search-container",attrs:{model:t.searchData,size:"small",inline:!0}},[t._t("searchs"),a("el-form-item",{staticStyle:{float:"right"}},[t._t("searchs-right"),a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onSearch}},[t._v("搜索")]),a("el-button",{staticClass:"add-btn",on:{click:t.onReset}},[t._v("重置")])],2),a("div",{staticClass:"clearfix"})],2),t.$slots["buttons"]?a("el-row",{staticClass:"button-container"},[a("el-col",{attrs:{span:24}},[t._t("buttons")],2)],1):t._e(),t.$slots["columns"]?a("el-table",{staticStyle:{width:"100%"},attrs:{"default-expand-all":t.expand,size:"small",height:t.height,data:t.dataList,fit:t.fit,border:"","row-class-name":t.onTableRowClassName},on:{"selection-change":t.onSelected,"expand-change":t.onExpand}},[t.select?a("el-table-column",{attrs:{type:"selection",width:"55"}}):t._e(),t._t("columns")],2):t._e(),t.$slots["columns"]&&t.page?a("el-pagination",{staticClass:"pagination",attrs:{"page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.onPageChange,"size-change":t.onSizeChange,"update:pageSize":function(e){t.size=e},"update:page-size":function(e){t.size=e}}}):t._e(),a("div",{staticClass:"clearfix"})],1)},L=[],R=a("2ef0"),I={data:function(){return{pageIndex:0,size:this.defaultSize||10,dataList:[],tableLoading:!1,total:0,selectItems:[]}},props:{url:{},searchData:{},title:{},manual:{},defaultSize:{},select:{},height:{},expand:{},fit:{default:!0},data:{},page:{default:!0}},mounted:function(){this.url&&!this.manual&&this.load(this.searchData)},watch:{size:function(){this.search()},data:function(t){this.dataList=t},searchData:{deep:!0,handler:Object(R["debounce"])((function(){this.search()}),300,{leading:!0})}},methods:{search:function(){this.pageIndex=0,this.url?this.load(this.searchData):this.$emit("search",this.searchData)},reload:function(){this.load(this.searchData)},load:function(t){var e=this;t=t||{},t.page_no=this.pageIndex>=1?this.pageIndex-1:this.pageIndex,t.page_size=this.size,this.tableLoading=!0,this.$api.page(this.url,t).then((function(t){t.length?(e.dataList=t,e.total=t.length):(e.dataList=t.data||t.list,e.total=t.total||t.count),e.$emit("data",e.dataList),e.$emit("total",e.total)})).finally((function(){e.tableLoading=!1}))},onExpand:function(t){var e=!1;e=!t.isExpand,t.isExpand=e,this.$emit("expand",t,e)},onReset:function(){this.$refs.searchForm.resetFields(),this.$emit("reset")},onSearch:function(){this.search()},onSelected:function(t){this.selectItems=t,this.$emit("select",t)},onPageChange:function(t){this.pageIndex=t,this.load(this.searchData)},onSizeChange:function(t){this.size=t},onTableRowClassName:function(t,e){return 1===e?"info-row":3===e?"positive-row":""}}},j=I,N=(a("2ad2"),a("3c28"),Object(h["a"])(j,A,L,!1,null,"09a657a6",null)),P=N.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-list"},[t._t("default"),a("el-pagination",{staticClass:"pagination",attrs:{size:"small","page-size":t.size,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.onPageChange,"size-change":t.onSizeChange,"update:pageSize":function(e){t.size=e},"update:page-size":function(e){t.size=e}}})],2)},U=[],q={data:function(){return{page:0,size:this.defaultSize||10,dataList:[],total:0}},props:["url","searchData","title","manual","defaultSize"],mounted:function(){this.url&&!this.manual&&this.load(this.searchData)},watch:{size:function(){this.search()}},methods:{search:function(){this.page=0,this.url?this.load(this.searchData):this.$emit("search",this.searchData)},load:function(t){var e=this;t=t||{},t.page=this.page>=1?this.page-1:this.page,t.size=this.size,l["default"].page(this.url,t).then((function(t){t.length?(e.dataList=t,e.total=t.length):(e.dataList=t.content,e.total=t.totalElements),e.$emit("data",e.dataList)}))},onPageChange:function(t){this.page=t,this.load(this.searchData)},onSizeChange:function(t){this.size=t,this.search()},onTableRowClassName:function(t,e){return 1===e?"info-row":3===e?"positive-row":""}}},F=q,V=(a("4d24"),Object(h["a"])(F,M,U,!1,null,null,null)),z=V.exports,B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-pop"},[a("el-popover",{ref:"searchPopover",attrs:{"popper-class":t.popClass,trigger:"manual",placement:"bottom-start",width:t.popWidth},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t._t("default",null,{data:t.data})],2),a("el-input",{directives:[{name:"popover",rawName:"v-popover:searchPopover",arg:"searchPopover"}],attrs:{size:"small",placeholder:t.placeholder,"prefix-icon":"el-icon-search"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1)},H=[],Y=a("ade3"),G=a("5530"),W={data:function(){return{show:!1,data:{},keyword:""}},computed:{},props:{popClass:{default:""},popWidth:{},paramName:{default:"keyword"},search:{},url:{},placeholder:{}},watch:{keyword:Object(R["debounce"])((function(t){t?this.onChange(t):this.data={}}),300)},methods:{onClose:function(){this.show=!1,this.keyword=""},onChange:function(t){var e=this;l["default"].post(this.url,Object(G["a"])(Object(Y["a"])({},this.paramName,t),this.search)).then((function(t){e.data=t,e.show=!0}))}},components:{},mounted:function(){}},K=W,X=(a("63e8"),Object(h["a"])(K,B,H,!1,null,null,null)),Q=X.exports,J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"//qdlfz.oss-cn-beijing.aliyuncs.com",data:t.uploadData,"on-error":t.onError,"show-file-list":!1,"on-success":t.onSuccess,"before-upload":t.onBeforeUpload}},[t.model?a("img",{staticClass:"avatar",attrs:{src:t.model}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])},Z=[],tt=(a("99af"),{data:function(){return{uploadData:{key:"",token:""},model:this.value}},watch:{value:function(t){this.model=t}},props:["value","extra"],methods:{refresh:function(){var t=this;l["default"].get("/upload").then((function(e){t.uploadData=e,t.uploadData.OssaccessKeyId=e.ossaccessKeyId}))},onBeforeUpload:function(t){return this.loading=c["Loading"].service({fullscreen:!0}),!0},onSuccess:function(t,e){this.model="//qdlfz.oss-cn-beijing.aliyuncs.com/".concat(this.uploadData.key).concat(this.extra||""),this.$emit("input",this.model),this.onEnd()},onError:function(t){console.log("上传出错 => "+t),this.onEnd()},onEnd:function(){this.loading&&this.loading.close(),this.refresh()}},mounted:function(){this.refresh()}}),et=tt,at=(a("610a"),Object(h["a"])(et,J,Z,!1,null,null,null)),st=at.exports,nt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",{class:{"select-open":t.isOpen},attrs:{placeholder:t.placeholder,"no-data-text":"sdfa",filterable:"",clearable:"",multiple:t.multiple},on:{"visible-change":t.onOpen,change:t.onChange},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},[t._l(t.items,(function(e){return a("el-option",{key:e[t.valueName],attrs:{label:e[t.labelName],value:e[t.valueName]}})})),t._t("default")],2)},ot=[],it=(a("d81d"),{month:function(){for(var t=[],e=1;e<=12;e++)t.push({label:"".concat(e,"月"),value:e});return t},year:function(){for(var t=[],e=(new Date).getFullYear(),a=10;a>=0;a--)t.push({label:"".concat(e-a,"年"),value:e-a});for(var s=0;s<=10;s++)t.push({label:"".concat(e+s,"年"),value:e+s});return t}}),rt={data:function(){return{isOpen:!1,model:this.value,items:[]}},watch:{url:"autoRefresh",value:function(t){this.model=t},params:"autoRefresh",filterList:"autoRefresh"},props:{value:{},placeholder:{},url:{},filterList:{},dataList:{},dataType:{},params:{},manual:{},method:{default:"post"},labelName:{default:"name"},valueName:{default:"id"},multiple:{default:!1}},methods:{autoRefresh:function(){this.manual||this.refresh()},refresh:function(){var t=this;this.url?this.$api[this.method](this.url,this.params).then((function(e){t.items=e.map((function(e){return Object(R["isString"])(e)?{id:e,name:e}:t.filterList&&t.filterList.includes(e.id)?void 0:e}))})):(this.items=[],this.model="",this.$emit("input",""))},onOpen:function(t){this.isOpen=t},onChange:function(t){this.$emit("input",t),this.$emit("change",t)}},mounted:function(){if(this.dataType)switch(this.dataType){case"month":this.items=it.month();break;case"year":this.items=it.year();break}else this.url&&this.autoRefresh()}},lt=rt,ct=Object(h["a"])(lt,nt,ot,!1,null,null,null),ut=ct.exports,dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-upload",{attrs:{action:"//qdlfz.oss-cn-beijing.aliyuncs.com","show-file-list":!1,data:t.uploadData,"on-error":t.onError,"on-success":t.onSuccess,"before-upload":t.onBeforeUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传图片、文档、压缩包")])],1),t._l(t.fileList,(function(e,s){return a("div",{key:s},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.onOpen(e)}}},[t._v(t._s(e.name))])],1)}))],2)},pt=[],ft={data:function(){return{fileList:[],uploadData:{key:"",token:""}}},watch:{value:function(t){this.fileList=t.map((function(t){return{name:t}}))}},props:{value:{}},methods:{refresh:function(){var t=this;l["default"].get("/upload").then((function(e){t.uploadData=e,t.uploadData.OssaccessKeyId=e.ossaccessKeyId}))},onOpen:function(t){window.open("//qdlfz.oss-cn-beijing.aliyuncs.com/".concat(t.name))},onBeforeUpload:function(t){return this.loading=c["Loading"].service({fullscreen:!0}),t.key=i()().format("YYYYMMDD")+"_"+t.name,this.uploadData.key=t.key,!0},onSuccess:function(t,e){var a=Object(R["cloneDeep"])(this.uploadData);this.fileList=this.fileList||[],this.fileList.push({name:a.key}),this.$emit("input",this.fileList.map((function(t){return t.name}))),this.onEnd()},onError:function(t){console.log("上传输错 => "+t),this.onEnd()},onEnd:function(t){this.loading&&this.loading.close(),this.refresh()}},mounted:function(){this.refresh()}},mt=ft,ht=Object(h["a"])(mt,dt,pt,!1,null,null,null),bt=ht.exports,_t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-popover",{ref:"popover1",attrs:{placement:"top-start",trigger:"hover",content:t.content}}),a("span",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}]},[t._t("default")],2)],1)},gt=[],vt={data:function(){return{}},computed:{},props:{content:{}},watch:{},methods:{},components:{},mounted:function(){}},yt=vt,wt=Object(h["a"])(yt,_t,gt,!1,null,null,null),St=wt.exports,Et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"common-tag"},[t._l(t.dynamicTags,(function(e){return a("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return t.onClose(e)}}},[t._v(" "+t._s(e)+" ")])})),t.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"mini"},on:{blur:t.onInput},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onInput.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):a("el-button",{attrs:{size:"mini"},on:{click:t.onShow}},[t._v(t._s(t.buttonText))])],2)},kt=[],xt=(a("a434"),{data:function(){return{dynamicTags:[],inputVisible:!1,inputValue:""}},computed:{},props:{value:{},buttonText:{default:"新增"}},watch:{value:function(t){this.dynamicTags=t}},methods:{onClose:function(t){this.dynamicTags.splice(this.dynamicTags.indexOf(t),1)},onShow:function(){var t=this;this.inputVisible=!0,this.$nextTick((function(e){t.$refs.saveTagInput.$refs.input.focus()}))},onInput:function(){var t=this.inputValue;t&&this.dynamicTags.push(t),this.inputVisible=!1,this.inputValue="",this.$emit("input",this.dynamicTags)}},components:{},mounted:function(){}}),Tt=xt,Ct=(a("5ce6"),Object(h["a"])(Tt,Et,kt,!1,null,null,null)),Ot=Ct.exports,Dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],attrs:{"element-loading-text":"请求数据中..."}},[t._t("default",null,{data:t.data})],2)},At=[],Lt={data:function(){return{isLoading:!1,data:this.defaultData}},computed:{},props:{url:{},method:{default:"post"},params:{default:function(){return null}},defaultData:{}},watch:{url:"refresh",params:"refresh"},methods:{refresh:function(){var t=this;this.url&&(this.isLoading=!0,l[this.method](this.url,this.params).then((function(e){t.data=e})).finally((function(){t.isLoading=!1})))}},components:{},mounted:function(){this.refresh()}},Rt=Lt,It=Object(h["a"])(Rt,Dt,At,!1,null,null,null),jt=It.exports,Nt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-button",{attrs:{"show-loading":t.isLoadding,"action-type":"button",disabled:t.isLoadding,type:t.type},nativeOn:{click:function(e){return t.onClick.apply(null,arguments)}}},[t._t("default")],2)},Pt=[],$t={data:function(){return{isLoadding:!1}},computed:{},props:{type:{default:"primary"},click:{}},watch:{},methods:{onClick:function(){var t=this;if(this.click){this.isLoadding=!0;var e=this.click();e.then?e.finally((function(){return t.isLoadding=!1})):this.isLoadding=!1}}},components:{},mounted:function(){}},Mt=$t,Ut=Object(h["a"])(Mt,Nt,Pt,!1,null,null,null),qt=Ut.exports,Ft=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{staticClass:"common-title shadow"},[a("el-col",{staticClass:"title",attrs:{span:16}},[a("router-link",{staticStyle:{color:"#4298ff"},attrs:{to:t.to,exact:""}},[t._v(" "+t._s(t.title)+" ")]),t.item?a("span",[a("img",{staticClass:"right",attrs:{src:"/static/images/icon_right.png",alt:""}}),a("span",[t._v(t._s(t.item.name||t.item))])]):t._e()],1),a("el-col",{attrs:{span:8}},[t._t("default")],2)],1),a("div",{staticStyle:{clear:"both"}})],1)},Vt=[],zt={data:function(){return{}},computed:{},props:{to:{default:"/"},title:{},paths:{default:function(){return[]}},item:{}},watch:{},methods:{},components:{},mounted:function(){}},Bt=zt,Ht=(a("ad3a"),Object(h["a"])(Bt,Ft,Vt,!1,null,null,null)),Yt=Ht.exports,Gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("img",{attrs:{src:t.url+"?_t="+t.t,alt:""},on:{click:t.onRefresh}})},Wt=[],Kt={data:function(){return{t:(new Date).getTime()}},props:{url:{}},methods:{onRefresh:function(){this.t=(new Date).getTime()}}},Xt=Kt,Qt=Object(h["a"])(Xt,Gt,Wt,!1,null,null,null),Jt=Qt.exports,Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"editor",staticClass:".editor-box"})},te=[],ee={data:function(){return{editor:null}},computed:{},props:{height:{default:300},value:{}},watch:{value:function(t){var e=this;t!=this.value&&this.$nextTick((function(){e.editor.summernote("code",t)}))}},methods:{},components:{},mounted:function(){var t=this;this.editor||(this.editor=$(this.$refs.editor),this.editor.summernote({lang:"zh-CN",height:this.height,callbacks:{onImageUpload:function(e,a,s){l["default"].upload("",e[0]).then((function(e){t.editor.summernote("insertImage",e.url)}))},onChange:function(e,a){t.$emit("input",e)}}}))}},ae=ee,se=(a("d9e8"),Object(h["a"])(ae,Zt,te,!1,null,null,null)),ne=se.exports,oe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"card"},[a("div",{staticClass:"hbox-between hbox-center",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"head-text"},[t._v(t._s(t.head))]),t._t("tools",(function(){return[t.isFilter?a("el-input",{staticClass:"filter",attrs:{size:"mini",placeholder:"过滤"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}):t._e()]}))],2),t._t("default")],2)},ie=[],re={data:function(){return{filter:""}},computed:{},props:{head:{},isFilter:{}},watch:{filter:function(t){this.$emit("input",t)}},methods:{refresh:function(){}},components:{},mounted:function(){}},le=re,ce=(a("a704c"),Object(h["a"])(le,oe,ie,!1,null,null,null)),ue=ce.exports,de=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"card"},[a("div",{staticClass:"hbox-between hbox-center",attrs:{slot:"header"},slot:"header"},[t.isTypes?a("div",{staticClass:"head-text"},[a("el-dropdown",{attrs:{"split-button":"",type:"default",size:"mini"},on:{command:t.handleCommand}},[t._v(" "+t._s(t.selectedType&&t.selectedType.label||t.selectedType)+" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.intypes,(function(e,s){return a("el-dropdown-item",{key:s,attrs:{command:e}},[t._v(" "+t._s(e.label||e)+" ")])})),1)],1)],1):t._e(),t._t("tools",(function(){return[t.isFilter?a("el-input",{staticClass:"filter",attrs:{size:"mini",placeholder:"过滤",title:t.filter},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}):t._e(),t.isRefresh?a("i",{staticClass:"sn-font text-primary no-user-select pointer-active",staticStyle:{"padding-top":"4px"},attrs:{title:"刷新列表"},on:{click:t.refreshClickHandle}},[t._v("")]):t._e()]}))],2),t._t("default")],2)},pe=[],fe={computed:{intypes:function(){var t=null;return"redis"==this.db_type&&(t=this.types&&this.types.length>0?this.types:["string","hash","set","zset","list"]),t=this.types&&this.types.length>0?this.types:["table","view","synonym"],t}},data:function(){return{groups:null,filter:""}},props:{selectedType:{type:Object|String},dbId:{type:String},head:{},types:{type:Array,default:function(){return[]}},isTypes:{type:Boolean,default:!0},isRefresh:{type:Boolean,default:!0},isFilter:{}},watch:{filter:function(t){this.$emit("input",t)}},methods:{handleCommand:function(t){this.$emit("sel",t.value||t),this.$emit("selected",t)},refreshClickHandle:function(){this.$emit("refresh",{type:this.selectedType.value||this.selectedType,sel:this.selectedType,filter:this.filter})}},components:{},mounted:function(){var t=this;this.dbId&&this.$api.db.schema.group({id:this.dbId}).then((function(e){t.groups=e})),console.log("[cardx mounted] :",this.itemName)}},me=fe,he=(a("5e57"),Object(h["a"])(me,de,pe,!1,null,null,null)),be=he.exports,_e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"card"},[a("div",{staticClass:"hbox-between hbox-center",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"head-text"},[a("el-dropdown",{attrs:{"split-button":"",type:"default",size:"mini"},on:{command:t.handleCommand}},[a("el-tooltip",{attrs:{content:"项目:"+t.sel.name,placement:"bottom",effect:"light"}},[a("span",{staticClass:"project_name"},[t._v(" "+t._s(t.sel.name)+" ")])]),a("el-dropdown-menu",{staticStyle:{width:"100px"},attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.list,(function(e){return a("el-dropdown-item",{key:e.id,attrs:{label:e.name,command:e}},[t._v(t._s(e.name)+" ")])})),1)],1)],1),t._t("tools")],2),t._t("default")],2)},ge=[],ve={data:function(){return{list:[],sel:{id:0,name:"未选择"}}},computed:{},props:{id:{}},watch:{sel:function(t){console.log("this.sel:",this.sel.id,this.sel.name,"    v:",t.id),this.$emit("sel",t)}},methods:{handleCommand:function(t){this.sel=t},refresh:function(){var t=this;console.log("cardx2 refresh id:",this.id),this.$api.project.list().then((function(e){if(e&&e.length>0)if(t.id){for(var a=0;a<e.length;a++)if(e[a].id==t.id){t.sel=e[a];break}t.sel||t.sel.id||(t.sel={id:0,name:"未选择"})}else t.sel=e[0];else t.sel={id:0,name:"未选择"};t.list=e}))}},components:{},mounted:function(){this.refresh()}},ye=ve,we=(a("3583"),Object(h["a"])(ye,_e,ge,!1,null,"2cc5409c",null)),Se=we.exports,Ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"card"},[a("div",{staticClass:"hbox-between hbox-center",attrs:{slot:"header"},slot:"header"},[t.isTypes?a("div",{staticClass:"head-text"},[a("el-dropdown",{attrs:{"split-button":"",type:"default",size:"mini"},on:{command:t.handleCommand}},[t._v(" "+t._s(t.selectedItem.name)+" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.types,(function(e,s){return a("el-dropdown-item",{key:s,attrs:{command:e}},[t._v(" "+t._s(e.name)+" ")])})),1)],1)],1):t._e(),t._t("tools",(function(){return[t.isFilter?a("el-input",{staticClass:"filter",attrs:{clearable:t.clearable,size:"mini",placeholder:"过滤",title:t.filter},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}):t._e(),t.isRefresh?a("i",{staticClass:"sn-font text-primary no-user-select pointer-active",staticStyle:{"padding-top":"4px"},attrs:{title:"刷新列表"},on:{click:t.refreshClickHandle}},[t._v("")]):t._e()]}))],2),t._t("default")],2)},ke=[],xe=a("2f62"),Te={computed:Object(G["a"])({},Object(xe["e"])(["selecedDB","runner"])),data:function(){return{types:[],filter:"",selectedItem:{name:"表"}}},props:{dbId:{type:String},clearable:{type:Boolean,default:!1},head:{},isTypes:{type:Boolean,default:!0},isRefresh:{type:Boolean,default:!0},isFilter:{}},watch:{filter:function(t){this.$emit("input",t)}},methods:{handleCommand:function(t){this.selectedItem=t,this.$emit("sel",this.selectedItem)},refreshClickHandle:function(){var t=this;this.refreshTypes().catch((function(e){console.warn("[query-cardx.vue]#refreshClickHandle(): ",e),t.$message.warning("数据库schema查询失败！")})).finally((function(){t.$emit("refresh",{type:t.selectedItem,filter:t.filter})}))},refreshTypes:function(t){var e=this;return new Promise((function(a,s){var n=t||e.dbId;if(!n)return s(new Error("数据库ID为空"));e.$api.db.schema.group({id:n}).then((function(t){if(e.types=t,t&&t.length>0){var s=t.filter((function(t){return t.name==e.selectedItem.name}));0==s.length&&(e.selectedItem=t[0])}return a(t)})).catch((function(t){return s(t)}))}))}},mounted:function(){this.refreshTypes(),console.log("[cardx mounted] :",this.itemName)}},Ce=Te,Oe=(a("384c"),Object(h["a"])(Ce,Ee,ke,!1,null,null,null)),De=Oe.exports,Ae=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"project-text"},[a("span",{directives:[{name:"only-community",rawName:"v-only-community"}],staticClass:"text-primary pointer-active no-user-select project-name"},[t._v(" "+t._s(t.sel.name)+" ")]),a("span",{directives:[{name:"business",rawName:"v-business"},{name:"popover",rawName:"v-popover:projects",arg:"projects"}],staticClass:"text-primary pointer-active no-user-select project-name"},[t._v(" "+t._s(t.sel.name)+" ")]),a("el-popover",{ref:"projects",staticStyle:{padding:"0"},attrs:{placement:"top-start",trigger:"click"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("div",{staticClass:"project-list"},t._l(t.projectList,(function(e){return a("div",{key:e.id,staticClass:"project-item no-user-select ",class:{"projec-selected":t.sel.name==e.name},on:{click:function(a){return t.change(e)}}},[t._v(" "+t._s(e.name)+" ")])})),0)])],1)])},Le=[],Re=a("b85c"),Ie={data:function(){return{visible:!1,filter:"",projectList:[],sel:{}}},computed:Object(G["a"])({},Object(xe["e"])(["user","project","runList","sys","runActive"])),props:{},watch:{sel:function(t){console.log("切换项目 v2:",t),this.$emit("selProject",t)},project:function(t){t.id!=this.sel.id&&(this.sel=t)}},methods:{change:function(t){if(t.id!=this.sel.id){var e=this.runList[this.runActive];e&&this.$store.commit("getSelectedDB",null),this.visible=!1,this.sel=t}else this.$message({message:"请不要切换同一项目！",type:"warning"})},handleCommand:function(t){this.sel=t},refresh:function(){}},components:{},mounted:function(){var t=this;this.$api.my.myProjectList().then((function(e){if(e&&e.length>0)if(t.project&&t.project.id){var a,s=Object(Re["a"])(e);try{for(s.s();!(a=s.n()).done;){var n=a.value;if(n.id==t.project.id){t.sel=n;break}}}catch(o){s.e(o)}finally{s.f()}}else t.sel=e[0];t.projectList=e,console.log("projectList: ",t.projectList)}))}},je=Ie,Ne=(a("bb03"),a("9ea5"),a("1c4e"),Object(h["a"])(je,Ae,Le,!1,null,"4fad5c44",null)),Pe=Ne.exports,$e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-menu",{staticClass:"component-header-project flex justify-center items-center",attrs:{mode:"horizontal"}},[a("el-submenu",{attrs:{"popper-class":"project-menus",index:"2"}},[a("template",{slot:"title"},[t._v(" "+t._s(t.dashboard_project.name?t.dashboard_project.name:"未加入项目")+" ")]),t.myProjectList.length>0?a("el-menu-item-group",[a("span",{attrs:{slot:"title"},slot:"title"},[t._v("已加入项目")]),t._l(t.myProjectList,(function(e,s){return a("el-menu-item",{key:s,attrs:{index:e.id+e.name},on:{click:function(a){return t.switchProject(e)}}},[a("div",{staticClass:"flex justify-between items-center"},[t._v(" "+t._s(e.name)+" "),t.isActiveProject(e.id)?a("d2-icon",{attrs:{name:"check"}}):t._e()],1)])}))],2):t._e(),t.getUnjoinProjectList.length>0?a("el-menu-item-group",[a("span",{attrs:{slot:"title"},slot:"title"},[a("span",[t._v("未加入项目（点击申请加入）")])]),t._l(t.getUnjoinProjectList,(function(e,s){return a("el-menu-item",{key:s,attrs:{index:e.id+e.name},on:{click:function(a){return t.joinProject(e)}}},[t._v(" "+t._s(e.name)+" ")])}))],2):t._e()],2)],1)},Me=[],Ue={props:{prefix:{type:String,default:function(){return""}}},computed:Object(G["a"])(Object(G["a"])(Object(G["a"])({},Object(xe["e"])(["project","dashboard_project","myProjectList","user","sys","runList","runActive"])),Object(xe["c"])(["getUnjoinProjectList"])),{},{isActiveProject:function(){var t=this;return function(e){return e&&e===t.dashboard_project.id}}}),methods:{switchProject:function(t){if(t.id!=this.dashboard_project.id){var e=this.runList[this.runActive];e&&(console.warn("mutations#getSelectedDB"),this.$store.commit("getSelectedDB",null)),""==this.prefix?(this.$bus.emit("switch-project",t),this.$store.commit("project",t),this.$store.dispatch("d2admin/page/openedLoad")):"dashboard_"==this.prefix&&(this.$store.commit("dashboard_project",t),this.$router.push("/project/".concat(t.id,"/dashboard")))}else this.$message({message:"请不要切换同一项目",type:"warning"})},joinProject:function(t){this.$bus.emit("join-project",t.id)}}},qe=Ue,Fe=(a("e2c8"),Object(h["a"])(qe,$e,Me,!1,null,null,null)),Ve=Fe.exports,ze=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"my-avatar"},[a("el-dropdown",{on:{command:t.onCommand}},[a("div",{staticClass:"el-dropdown-link hbox hbox-center"},[a("i",{staticClass:"sn-font text-primary"},[t._v("")]),a("span",{staticClass:"name",attrs:{title:t.name}},[t._v(t._s(t.name))])]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{staticClass:"my-avatar-my-item",attrs:{command:"my"}},[a("a",{attrs:{href:"#/my/info"}},[t._v("账户信息")])]),a("el-dropdown-item",{attrs:{command:"logout",divided:""}},[t._v("退出登录")])],1)],1)],1)},Be=[],He={data:function(){return{}},computed:Object(G["a"])(Object(G["a"])({},Object(xe["e"])(["user"])),{},{name:function(){return this.user.user_name||this.user.name}}),props:{},watch:{},methods:{onCommand:function(t){var e=this;switch(t){case"logout":return this.$api.my.logout().then((function(t){if(window.localStorage.removeItem("token"),e.user&&"focus_oauth2"==e.user.login_mode){var a=window.localStorage.getItem("oauth2_url");a&&(window.location.href=a+"&logout=1")}e.$router.replace("/login")}));case"my":this.$router.replace("/my/info")}}},components:{},mounted:function(){}},Ye=He,Ge=(a("317b"),a("101e"),Object(h["a"])(Ye,ze,Be,!1,null,"68897039",null)),We=Ge.exports,Ke=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div")},Xe=[],Qe={computed:Object(G["a"])({},Object(xe["c"])("d2admin/theme",["activeSetting"])),props:{inputText:{type:String,default:"SQLDev"},inputAllowDele:{type:Boolean,default:!0},inputDestroy:{type:Boolean,default:!0},hasDay:{type:Boolean,default:!1}},data:function(){return{observer:{},maskDiv:{}}},mounted:function(){var t=this;this.$nextTick((function(){t.init(),t.inputAllowDele||t.Monitor()}))},methods:{getDay:function(){var t=i()(new Date).format("YYYY-MM-DD");return t},init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=document.createElement("canvas");e.id="water-canvas",e.width="250",e.height="250",this.maskDiv=document.createElement("div");var a=e.getContext("2d");a.font="normal 18px Microsoft Yahei",a.fillStyle=t.color||this.activeSetting&&this.activeSetting.wmcolor||"#cc00ff09",a.rotate(30*Math.PI/180),this.hasDay?a.fillText(this.inputText+" "+this.getDay(),30,20):a.fillText(this.inputText,30,20),a.fillText(this.inputText,30,20);var s=e.toDataURL("image/png");this.maskDiv.style.position="fixed",this.maskDiv.style.zIndex="9999",this.maskDiv.id="_waterMark",this.maskDiv.style.top="30px",this.maskDiv.style.left="0",this.maskDiv.style.height="100%",this.maskDiv.style.width="100%",this.maskDiv.style.pointerEvents="none",this.maskDiv.style.backgroundImage="URL("+s+")",document.body.appendChild(this.maskDiv)},Monitor:function(){var t=document.getElementsByTagName("body")[0],e={childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0};this.observer=new MutationObserver(this.callback),this.observer.observe(t,e)},callback:function(t,e){console.log("*****************   wm  callback *****************  "),"_waterMark"===t[0].target.id&&this.removeMaskDiv(),"id"===t[0].attributeName&&(this.removeMaskDiv(),this.init()),t[0].removedNodes[0]&&"_waterMark"===t[0].removedNodes[0].id&&this.init()},removeMaskDiv:function(){document.body.removeChild(this.maskDiv)},createMaskDiv:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.init(t)},resetColor:function(t){this.removeMaskDiv(),this.createMaskDiv()}},watch:{inputText:function(t){var e=this;this.$nextTick((function(){e.removeMaskDiv(),t&&e.createMaskDiv()}))}},destroyed:function(){console.log("*****************   wm  destroy *****************  "),this.inputDestroy&&this.removeMaskDiv()}},Je=Qe,Ze=Object(h["a"])(Je,Ke,Xe,!1,null,null,null),ta=Ze.exports,ea=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h-split"},[a("keep-alive",[t.isHide?t._e():t._t("left")],2),a("div",{staticClass:"split",on:{click:t.onSplit}},[t.isHide?a("i",{staticClass:"sn-font"},[t._v("")]):a("i",{staticClass:"sn-font"},[t._v("")])]),t._t("right")],2)},aa=[],sa={data:function(){return{isHide:!1}},computed:{},props:{},watch:{},methods:{onSplit:function(){this.isHide=!this.isHide}},components:{},mounted:function(){}},na=sa,oa=(a("98ed"),Object(h["a"])(na,ea,aa,!1,null,null,null)),ia=oa.exports,ra=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticClass:"time-refresh"},[a("el-checkbox",{attrs:{label:t.label},model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}})],1)},la=[],ca={data:function(){return{isOpen:!1,wait:this.time}},computed:{label:function(){return this.isOpen?"即将刷新(".concat(this.wait,")"):"开启刷新"}},props:{time:{}},watch:{isOpen:"onChange"},methods:{doTime:function(){var t=this;this.timeId=setTimeout((function(){t.wait--,t.wait<=0&&(t.wait=t.time,t.$emit("refresh")),t.doTime()}),1e3)},onChange:function(){clearTimeout(this.timeId),this.isOpen&&(this.wait=this.time,this.doTime())}},components:{},mounted:function(){},destroyed:function(){clearTimeout(this.timeId)}},ua=ca,da=(a("3aff"),Object(h["a"])(ua,ra,la,!1,null,null,null)),pa=da.exports,fa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"data-step"},[a("el-row",{attrs:{gutter:4}},t._l(t.comps,(function(e,s){return a("el-col",{key:s,attrs:{span:24/t.comps.length}},[a(e,{tag:"component",attrs:{index:s,values:t.values},on:{select:function(e){return t.onSelect(e,s)}}})],1)})),1)],1)},ma=[],ha=(a("fb6a"),a("ddb0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:"数据库"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字过滤数据库",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"tree-list"},[a("el-tree",{ref:"dbList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var s=e.data;return a("div",{staticClass:"left",on:{click:function(e){return t.onClick(s)}}},[a("span",[t._v(t._s(s.name))])])}}])})],1)],2)}),ba=[],_a={data:function(){return{filterText:"",dataList:[],treeProps:{label:"name"}}},computed:{},props:{},watch:{filterText:function(t){this.$refs.dbList.filter(t)}},methods:{filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.$api.db.group_all().then((function(e){t.dataList=e}))},onClick:function(t){t.db_type&&this.$emit("select",t)}},components:{},mounted:function(){this.refresh()}},ga=_a,va=(a("fca0"),Object(h["a"])(ga,ha,ba,!1,null,null,null)),ya=va.exports,wa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:"数据集"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"tree-list"},[a("el-tree",{ref:"instanceList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"",lazy:"","empty-text":t.db?"没有关联数据库":"请选择角色","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"left",on:{click:function(e){return t.onClick(s)}}},[t._v(t._s(s.name))])}}])})],1)],2)},Sa=[],Ea={data:function(){return{filterText:"",dataList:[],db:{},treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:{values:{}},watch:{values:function(t){this.doRefresh(t[0])},filterText:function(t){this.$refs.instanceList.filter(t)}},methods:{doRefresh:function(t){t!=this.db&&(this.db=t,this.refresh())},filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.$api.auto.autoV3(this.db.id).then((function(e){t.dataList=e.map((function(t){return t.leaf=!0,t}))}))},onClick:function(t){this.$emit("select",t)}},components:{},mounted:function(){}},ka=Ea,xa=(a("7648"),Object(h["a"])(ka,wa,Sa,!1,null,"08dbec8c",null)),Ta=xa.exports,Ca=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:"数据表"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字过滤表",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"tree-list"},[a("el-tree",{ref:"tableList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据实例","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var s=e.data;return a("div",{on:{click:function(e){return t.onClick(s)}}},[a("span",[t._v(t._s(s.name))])])}}])})],1)],2)},Oa=[],Da={data:function(){return{filterText:"",dataList:[],treeProps:{id:"id",label:"name",isLeaf:"leaf"}}},props:{values:{}},watch:{values:function(t){t[0]&&t[1]?t[0]==this.db&&t[1]==this.owner||(this.db=t[0],this.owner=t[1],this.refresh()):this.dataList=[]},filterText:function(t){this.$refs.tableList.filter(t)}},methods:{filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.dataList=[],this.$api.auto.autoV3(this.owner.id).then((function(e){t.dataList=e.map((function(t){return t.leaf=!0,t})),console.log(t.dataList)}))},onClick:function(t){this.$emit("select",t)}}},Aa=Da,La=(a("3b40"),Object(h["a"])(Aa,Ca,Oa,!1,null,null,null)),Ra=La.exports,Ia=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:"数据字段"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"tree-list"},[a("el-tree",{ref:"colList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据表","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){e.node;var s=e.data;return a("div",{on:{click:function(e){return t.onClick(s)}}},[a("span",[t._v(t._s(s.name))])])}}])})],1)],2)},ja=[],Na={data:function(){return{db:null,owner:null,table:null,filterText:"",dataList:[],treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},computed:{},props:{values:{}},watch:{values:function(t){t[0]&&t[1]&&t[2]?t[0]==this.db&&t[1]==this.owner&&t[2]==this.table||(this.db=t[0],this.owner=t[1],this.table=t[2],this.refresh()):this.dataList=[]},filterText:function(t){this.$refs.colList.filter(t)}},methods:{filterNode:function(t,e){return!t||(console.log("data.label:",e.label,"  value:",t),-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))},refresh:function(){var t=this;this.$api.auto.autoV3(this.table.id).then((function(e){t.dataList=e.map((function(t){return t.leaf=!0,t}))}))},onClick:function(t){this.$emit("select",t)}},components:{},mounted:function(){}},Pa=Na,$a=(a("b9c0"),Object(h["a"])(Pa,Ia,ja,!1,null,null,null)),Ma=$a.exports,Ua={data:function(){return{values:[]}},computed:{comps:function(){switch(this.mode){case"table":return[ya,Ta,Ra];default:return[ya,Ta,Ra,Ma]}}},props:{mode:{default:"column"}},watch:{},methods:{onSelect:function(t,e){var a=this.values.slice(0,e);a.push(t),this.values=a,console.log(e," ==> ",this.values),a.length==this.comps.length&&this.$emit("select",this.values)}},components:{},mounted:function(){}},qa=Ua,Fa=(a("4b64"),Object(h["a"])(qa,fa,ma,!1,null,null,null)),Va=Fa.exports,za=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"data-cascade"},[a("el-row",{attrs:{gutter:4}},t._l(t.comps,(function(e,s){return a("el-col",{key:s,attrs:{span:24/t.comps.length}},[a(e,{tag:"component",attrs:{manual:t.manual,index:s,values:t.values},on:{select:function(e){return t.onSelect(e,s)}}})],1)})),1)],1)},Ba=[],Ha=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-autocomplete",{attrs:{"fetch-suggestions":t.onRefresh,placeholder:"请选择数据源","value-key":"name"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},Ya=[],Ga={data:function(){return{value:null,dataList:[],nameMap:{}}},computed:{},props:{},watch:{value:function(t){this.$emit("select",this.nameMap[t]||t)}},methods:{onRefresh:function(t,e){e(t?this.dataList.filter((function(e){return-1!=e.name.indexOf(t)})):this.dataList)}},components:{},mounted:function(){var t=this;this.$api.db.all().then((function(e){t.dataList=e.map((function(e){return t.nameMap[e.name]=e,e}))}))}},Wa=Ga,Ka=Object(h["a"])(Wa,Ha,Ya,!1,null,null,null),Xa=Ka.exports,Qa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-autocomplete",{attrs:{"fetch-suggestions":t.onRefresh,placeholder:"请选择空间","value-key":"name"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},Ja=[],Za={data:function(){return{value:null,db:{},dataList:[],nameMap:{}}},computed:{},props:{values:{}},watch:{values:function(t){this.dataList=[],this.nameMap={},t[0]&&t[0]==this.db||(this.db=t[0],this.refresh())},value:function(t){this.$emit("select",this.nameMap[t]||t)}},methods:{onRefresh:function(t,e){e(t?this.dataList.filter((function(e){return-1!=e.name.indexOf(t)})):this.dataList)},refresh:function(){var t=this;this.db.id&&this.$api.auto.autoV3(this.db.id).then((function(e){t.dataList=e.map((function(e){return t.nameMap[e.name]=e,e})),console.log(t.dataList)}))}},components:{},mounted:function(){}},ts=Za,es=Object(h["a"])(ts,Qa,Ja,!1,null,null,null),as=es.exports,ss=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-autocomplete",{attrs:{"fetch-suggestions":t.onRefresh,placeholder:"请选择表","value-key":"name"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},ns=[],os={data:function(){return{value:null,owner:{},dataList:[],nameMap:{}}},computed:{},props:{values:{}},watch:{values:function(t){this.nameMap={},this.dataList=[],t[1]&&(this.owner=t[1],this.refresh())},value:function(t){this.$emit("select",this.nameMap[t]||t)}},methods:{onRefresh:function(t,e){e(t?this.dataList.filter((function(e){return-1!=e.name.indexOf(t)})):this.dataList)},refresh:function(){var t=this;this.owner.id&&this.$api.auto.autoV3(this.owner.id).then((function(e){t.dataList=e.map((function(e){return t.nameMap[e.name]=e,e}))}))}},components:{},mounted:function(){}},is=os,rs=Object(h["a"])(is,ss,ns,!1,null,null,null),ls=rs.exports,cs=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-autocomplete",{attrs:{"fetch-suggestions":t.onRefresh,placeholder:"请选择字段","value-key":"name"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},us=[],ds={data:function(){return{value:null,table:null,dataList:[],nameMap:{}}},computed:{},props:{values:{}},watch:{values:function(t){this.nameMap={},this.dataList=[],t[2]&&(this.table=t[2],this.refresh())},value:function(t){this.$emit("select",this.nameMap[t]||t)}},methods:{onRefresh:function(t,e){e(t?this.dataList.filter((function(e){return-1!=e.name.indexOf(t)})):this.dataList)},refresh:function(){var t=this;this.table.id&&this.$api.auto.autoV3(this.table.id).then((function(e){t.dataList=e.map((function(e){return t.nameMap[e.name]=e,e}))}))}},components:{},mounted:function(){}},ps=ds,fs=(a("9ab4"),Object(h["a"])(ps,cs,us,!1,null,null,null)),ms=fs.exports,hs={data:function(){return{values:[]}},computed:{comps:function(){switch(this.mode){case"table":return[Xa,as,ls];default:return[Xa,as,ls,ms]}}},props:{manual:{default:!1},mode:{default:"column"}},watch:{},methods:{onSelect:function(t,e){var a=this.values.slice(0,e);a.push(t),this.values=a,console.log(e," ==> ",this.values),a.length==this.comps.length&&this.$emit("input",this.values)}},components:{},mounted:function(){}},bs=hs,_s=(a("3fd2"),Object(h["a"])(bs,za,Ba,!1,null,null,null)),gs=_s.exports,vs=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.visiable,expression:"visiable"}],staticClass:"tfa-code"},[a("div",{staticClass:"main"},[a("el-input",{ref:"tfaCodeInput",staticClass:"tfa-input",attrs:{placeholder:"请输入pin码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit.apply(null,arguments)}},model:{value:t.pinCode,callback:function(e){t.pinCode=e},expression:"pinCode"}},[a("el-button",{attrs:{slot:"append"},on:{click:t.submit},slot:"append"},[t._v("验证")])],1),a("a",{attrs:{href:"JavaScript:void(0)"},on:{click:t.loginOutHandler}},[t._v("退出登录")])],1),a("div",{staticClass:"close",attrs:{title:"退出登录"},on:{click:t.loginOutHandler}},[a("i",{staticClass:"el-icon-close"})])])},ys=[],ws={name:"tfa-code",data:function(){return{pinCode:"",visiable:!1,type:"reload"}},mounted:function(){var t=this;this.$bus.off("tfa-show"),this.$bus.on("tfa-show",(function(e){t.type="reload",e&&(t.type=e),t.show()}))},methods:{loginOutHandler:function(){var t=this;this.$api.my.logout().then((function(e){if(window.localStorage.removeItem("token"),t.user&&"focus_oauth2"==t.user.login_mode){var a=window.localStorage.getItem("oauth2_url");a&&(window.location.href=a+"&logout=1")}t.$router.replace("/login"),t.visiable=!1}))},show:function(){this.pinCode="",this.visiable=!0,this.inputFocus()},inputFocus:function(){var t=this;this.$nextTick((function(){t.$refs.tfaCodeInput.$el.querySelector("input").focus()}))},submit:function(){var t=this;this.$api.my.authPinCode({pin_code:this.pinCode}).then((function(e){"fail"==e?t.$message({message:"pin code错误",type:"error",duration:8e3,showClose:!0}):"ok"==e&&("emit"==t.type?t.$bus.emit("tfa-emit"):window.location.reload(),t.visiable=!1),console.log("resp: ",e)}))}}},Ss=ws,Es=(a("2194"),Object(h["a"])(Ss,vs,ys,!1,null,null,null)),ks=Es.exports,xs=a("b828"),Ts=a("4eb5"),Cs=a.n(Ts),Os=a("87e3"),Ds=a.n(Os),As=a("5743"),Ls={pickOptions:{shortcuts:As["a"].shortcuts},logState:{0:"运行中",1:"正常",2:"错误"},permissionRW:{1:"读",2:"写"}},Rs=a("f6f1"),Is=a.n(Rs),js=(a("c695"),a("a388")),Ns=a.n(js);a("778e");for(var Ps in n["default"].use(Ds.a),i.a.locale("zh-cn"),a("1b9c"),n["default"].component("tfa",ks),n["default"].use(Ns.a),n["default"].use(Is.a),n["default"].use(Cs.a),n["default"].use(xs["a"]),n["default"].prototype.$api=l["default"],n["default"].prototype.$constant=Ls,s)n["default"].component(Ps,s[Ps]);n["default"].prototype.onSuccess=function(t,e,a){Object(c["Notification"])({title:e,message:t,type:"success",duration:a||0===a?a:2e3,position:"top-right",offset:100})},n["default"].prototype.onError=function(t,e,a){Object(c["Notification"])({title:e,message:t,type:"error",duration:a||0===a?a:2e3,position:"top-right",offset:100})},n["default"].filter("userRole",(function(t){return 1==t?"超级管理员":2==t||3==t?"管理员":4==t?"普通用户":"未知身份"})),n["default"].filter("per",(function(t){return t?(100*t).toFixed(0)+"%":t})),n["default"].filter("kb",(function(t,e){if(!t)return"";switch(e){case"m":return Math.ceil(t/1024/1024)+"M";default:return Math.ceil(t/1024)+"KB"}})),n["default"].filter("date",(function(t){return t&&i()(t).format("YYYY-MM-DD")})),n["default"].filter("dateTime",(function(t,e){return t&&i()(t).format(e||"YYYY-MM-DD HH:mm:ss")})),n["default"].filter("showTime",(function(t){if(!t)return"0毫秒";if(t<1e3)return t+"毫秒";var e=Math.floor(t/1e3/3600%24),a=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3%60),n=s+"秒";return a>0&&(n=a+"分"+n),e>0&&(n=e+"小时"+n),n})),n["default"].filter("relative",(function(t){return i()(t).fromNow()})),n["default"].filter("constant",(function(t,e){return Ls[e][t]||t})),n["default"].filter("duration",(function(t,e,a){return-1!=t.indexOf("000")?"-":e&&t?i()(t).diff(i()(e),a||"milliseconds"):"-"})),n["default"].prototype.toUser=function(){var t=window.localStorage.getItem("user");return t?JSON.parse(t):{}},n["default"].prototype.isAdmin=function(){var t=n["default"].prototype.toUser();return!!t&&t.role<=4};a("466d"),a("b64b");var $s=a("a925"),Ms=a("c276");function Us(){var t,e=a("49f8"),s={},n=Object(Re["a"])(e.keys());try{for(n.s();!(t=n.n()).done;){var o=t.value,i=o.match(/([A-Za-z0-9-_]+)\./i);if(i&&i.length>1){var r=i[1],l=a("2bba")("./".concat(e(o)._element));s[r]=Object(G["a"])(Object(G["a"])({},e(o)),l?l.default:{})}}}catch(c){n.e(c)}finally{n.f()}return s}n["default"].use($s["a"]);var qs=Us();n["default"].prototype.$languages=Object.keys(qs).map((function(t){return{label:qs[t]._name,value:t}}));var Fs=new $s["a"]({locale:Ms["a"].cookies.get("lang")||"zh-chs",fallbackLocale:"en",messages:qs}),Vs=Fs,zs=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[t.sys.water_mark?a("k-water-mark",{ref:"wm",attrs:{hasDay:!0,inputText:t.user.name}}):t._e(),a("dialog-project-apply",{ref:"dialogProjectApply"}),a("dialog-detail",{ref:"detailDialog"}),a("tfa",{ref:"tfa"}),a("router-view")],1)},Bs=[],Hs=a("9583"),Ys=a("cdac"),Gs={components:{DialogProjectApply:Hs["default"],DialogDetail:Ys["default"]},name:"app",computed:Object(G["a"])(Object(G["a"])(Object(G["a"])(Object(G["a"])({},Object(xe["e"])("d2admin",{headerMenus:function(t){return t.menu.header}})),Object(xe["e"])(["user","sys"])),Object(xe["c"])("d2admin/theme",["activeSetting"])),Object(xe["e"])("d2admin/theme",["activeName"])),watch:{activeName:function(t){this.activeSetting&&this.activeSetting.wmcolor&&this.$refs.wm&&this.$refs.wm.resetColor({color:this.activeSetting.wmcolor})}},created:function(){var t=this;window.onbeforeunload=function(){return"Your work will be lost."},this.$bus.off("join-project"),this.$bus.on("join-project",(function(e){t.$refs.dialogProjectApply.show(e)})),this.$bus.off("work-detail-show"),this.$bus.on("work-detail-show",(function(e,a,s){t.$refs.detailDialog.show(e,a,s)})),this.i18nHandle(this.$i18n.locale),this.$api.post("/api/setting",{}).then((function(e){t.$store.commit("sysSetting",e),t.$store.commit("d2admin/releases/versionShow",e)}))},methods:{i18nHandle:function(t,e){Ms["a"].cookies.set("lang",t),document.querySelector("html").setAttribute("lang",t)}}},Ws=Gs,Ks=(a("5c0b"),Object(h["a"])(Ws,zs,Bs,!1,null,null,null)),Xs=Ks.exports,Qs=a("1da1"),Js=(a("96cf"),a("0fae"),a("32dd"),a("3ca3"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.show?a("div",{staticClass:"d2-source",class:{"d2-source--active":t.isActive},on:{click:t.handleClick}},[a("d2-icon",{attrs:{name:"code"}}),t._v(" 本页源码 ")],1):t._e()}),Zs=[],tn={data:function(){return{isActive:!1,path:""}},computed:{show:function(){return!1}},watch:{$route:{handler:function(t){this.path=Object(R["get"])(Object(R["last"])(t.matched),"components.default.__source")},immediate:!0}},mounted:function(){var t=this;setTimeout((function(){t.isActive=!0}),500)},methods:{handleClick:function(){this.$open("".concat("https://github.com/shuaninfo/sqldev","/blob/master/").concat(this.path))}}},en=tn,an=(a("e13a"),Object(h["a"])(en,Js,Zs,!1,null,"ebced34e",null)),sn=an.exports,nn={full:function(){return a.e("chunk-00ec11bc").then(a.bind(null,"854f"))},fullbs:function(){return Promise.all([a.e("chunk-index"),a.e("chunk-6e20e992")]).then(a.bind(null,"411d"))},ghost:function(){return a.e("chunk-c2695eb8").then(a.bind(null,"637a"))},ghostbs:function(){return Promise.all([a.e("chunk-index"),a.e("chunk-81750a5c")]).then(a.bind(null,"bbb2"))},card:function(){return a.e("chunk-3bf191cc").then(a.bind(null,"3fdb"))},cardbs:function(){return Promise.all([a.e("chunk-index"),a.e("chunk-04f2e609")]).then(a.bind(null,"8221"))}},on={name:"d2-container",props:{type:{type:String,required:!1,default:"full"},betterScroll:{type:Boolean,required:!1,default:!1}},computed:{component:function(){return nn["".concat(this.type).concat(this.betterScroll?"bs":"")]||"div"}},render:function(t){var e=this,a=[this.$slots.default,this.$slots.header?t("template",{slot:"header"},[this.$slots.header]):null,this.$slots.footer?t("template",{slot:"footer"},[this.$slots.footer]):null];return t("div",{ref:"container",class:"container-component"},[t(this.component,{ref:"component",attrs:Object(G["a"])({},this.$attrs),on:{scroll:function(t){return e.$emit("scroll",t)}}},[a]),t(sn)])},methods:{scrollToTop:function(){this.$refs.component.scrollToTop();var t=this.$refs.component.BS;t&&this.$refs.component.scroll()},scrollBy:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;if(this.betterScroll){var s=this.$refs.component.BS;s&&(s.scrollBy(-t,-e,a),this.$refs.component.scroll())}else this.$refs.component.$refs.body.scrollBy(t,e)},scrollTo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;if(this.betterScroll){var s=this.$refs.component.BS;s&&(s.scrollTo(-t,-e,a),this.$refs.component.scroll())}else this.$refs.component.$refs.body.scrollTo(t,e)},scrollTop:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;if(this.betterScroll){var a=this.$refs.component.BS;a&&(a.scrollTo(a.x,-t,e),this.$refs.component.scroll())}else this.$refs.component.$refs.body.scrollTop=t}}},rn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",t._b({},"d2-container",t.$attrs,!1),[a("iframe",{staticClass:"d2-container-frame",attrs:{src:t.src,frameborder:"0"}})])},ln=[],cn={name:"d2-container-frame",props:{src:{type:String,required:!1,default:"https://d2.pub/zh/doc/d2-admin"}}},un=cn,dn=(a("460e"),Object(h["a"])(un,rn,ln,!1,null,"96a42f8e",null)),pn=dn.exports,fn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-button-group",[t.title?a("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.$open(t.link)}}},[t._v(t._s(t.title))]):t._e(),a("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.$open(t.link)}}},[a("d2-icon",{attrs:{name:t.icon}}),t._v(" "+t._s(t.link)+" ")],1)],1)},mn=[],hn={name:"d2-link-btn",props:{title:{type:String,required:!1,default:""},icon:{type:String,required:!1,default:"link"},link:{type:String,required:!1,default:"https://github.com/d2-projects"}}},bn=hn,_n=Object(h["a"])(bn,fn,mn,!1,null,null,null),gn=_n.exports;n["default"].component("d2-container",on),n["default"].component("d2-container-frame",pn),n["default"].component("d2-link-btn",gn),n["default"].component("d2-highlight",(function(){return Promise.all([a.e("chunk-3c9663d2"),a.e("chunk-31a071fe")]).then(a.bind(null,"d55d"))})),n["default"].component("d2-icon",(function(){return a.e("chunk-6ead409f").then(a.bind(null,"01bf"))})),n["default"].component("d2-icon-svg",(function(){return a.e("chunk-2d221854").then(a.bind(null,"cb65"))})),n["default"].component("d2-module-index-menu",(function(){return a.e("chunk-8f88b34c").then(a.bind(null,"d4a1"))})),n["default"].component("d2-scrollbar",(function(){return Promise.all([a.e("chunk-element"),a.e("chunk-d7a40dea")]).then(a.bind(null,"7e39"))}));var vn=function(t){return t.keys().map(t)},yn=a("ec39"),wn=vn(yn);n["default"].prototype.$IconSvg=wn.map((function(t){return t.default.id.slice(3)}));var Sn=a("4360"),En={install:function(t,e){function a(e){return function(a,s){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.nextTick((function(){Sn["a"].dispatch("d2admin/log/push",{message:"".concat(n,": ").concat(Object(R["isObject"])(a)?a.message:a),type:e,meta:{error:a,vm:s}})}))}}t.config.errorHandler=a("danger"),window.onunhandledrejection=function(t){Sn["a"].dispatch("d2admin/log/push",{message:Object(R["get"])(t,"reason.message","Unknown error"),type:"danger",meta:{error:Object(R["get"])(t,"reason"),trace:Object(R["get"])(t,"reason.stack")}})},window.onerror=function(t,e,a,s,n){Sn["a"].dispatch("d2admin/log/push",{message:Object(R["get"])(n,"message","Unknown error"),type:"danger",meta:{error:n,trace:Object(R["get"])(n,"stack"),source:"".concat(e,"@").concat(a,":").concat(s),event:t}})}}},kn=a("53ca"),xn={install:function(t,e){t.prototype.$log=Object(G["a"])(Object(G["a"])({},Ms["a"].log),{},{push:function(t){"string"===typeof t?Sn["a"].dispatch("d2admin/log/push",{message:t}):"object"===Object(kn["a"])(t)&&Sn["a"].dispatch("d2admin/log/push",t)}})}},Tn={install:function(t,e){t.prototype.$open=Ms["a"].open}},Cn={install:function(t,e){return Object(Qs["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.config.productionTip=!1,t.prototype.$env="production",t.prototype.$baseUrl="/",t.prototype.$version="3.4.0",t.prototype.$buildTime="2021-10-27 14:44:47",t.use(u.a,{i18n:function(t,e){return Vs.t(t,e)}}),t.use(En),t.use(xn),t.use(Tn);case 9:case"end":return e.stop()}}),e)})))()}},On=a("a18c"),Dn=a("8f54"),An=a("d046"),Ln=(a("ba8c"),a("3dbf"));window.$log=Ln["a"],n["default"].use(Cn),n["default"].config.devtools=!0,new n["default"]({router:On["a"],store:Sn["a"],i18n:Vs,render:function(t){return t(Xs)},created:function(){this.$store.commit("d2admin/page/init",An["b"]),this.$store.commit("d2admin/menu/headerSet",Dn["b"]),this.$store.commit("d2admin/search/init",Dn["a"])},mounted:function(){this.$store.commit("d2admin/menu/asideSet",Dn["a"]||[]),this.$store.dispatch("d2admin/account/load"),this.$store.commit("d2admin/ua/get"),this.$store.dispatch("d2admin/fullscreen/listen")},watch:{}}).$mount("#app")},"56fa":function(t,e,a){"use strict";a("3d06")},5743:function(t,e,a){"use strict";a("ac1f"),a("1276"),a("159b");var s=a("c1df"),n=a.n(s),o=a("7f45"),i=a.n(o),r=(a("d3b7"),a("25f0"),a("2ef0")),l=["y","M","w","d","h","m","s"];function c(t,e,a){if(t){if(n.a.isMoment(t))return t;if(Object(r["isDate"])(t))return n()(t);var s,o,i,l="";return"now"===t.substring(0,3)?(s="utc"===a?n.a.utc():n()(),l=t.substring("now".length)):(o=t.indexOf("||"),-1===o?(i=t,l=""):(i=t.substring(0,o),l=t.substring(o+2)),s=n()(i,n.a.ISO_8601)),l.length?u(l,s,e):s}}function u(t,e,a){var s=e,n=0,o=t.length;while(n<o){var i,c,u,d=t.charAt(n++);if("/"===d)i=0;else if("+"===d)i=1;else{if("-"!==d)return;i=2}if(isNaN(t.charAt(n)))c=1;else if(2===t.length)c=t.charAt(n);else{var p=n;while(!isNaN(t.charAt(n)))if(n++,n>10)return;c=parseInt(t.substring(p,n),10)}if(0===i&&1!==c)return;if(u=t.charAt(n++),!Object(r["includes"])(l,u))return;0===i?a?s.endOf(u):s.startOf(u):1===i?s.add(c,u):2===i&&s.subtract(c,u)}return s}var d=[{from:"now/d",to:"now/d",display:"今天",section:2},{from:"now/d",to:"now",display:"最近一天",section:2},{from:"now/w",to:"now/w",display:"这个星期",section:2},{from:"now/w",to:"now",display:"最近一周",section:2},{from:"now/M",to:"now/M",display:"这个月",section:2},{from:"now/M",to:"now",display:"最近一个月",section:2},{from:"now/y",to:"now/y",display:"今年",section:2},{from:"now/y",to:"now",display:"最近一年",section:2},{from:"now-1d/d",to:"now-1d/d",display:"昨天",section:1},{from:"now-2d/d",to:"now-2d/d",display:"前天",section:1},{from:"now-7d/d",to:"now-7d/d",display:"上一周的今天",section:1},{from:"now-1w/w",to:"now-1w/w",display:"上一周",section:1},{from:"now-1M/M",to:"now-1M/M",display:"上一月",section:1},{from:"now-1y/y",to:"now-1y/y",display:"上一年",section:1},{from:"now-5m",to:"now",display:"最近5分钟",section:3},{from:"now-15m",to:"now",display:"最近15分钟",section:3},{from:"now-30m",to:"now",display:"最近30分钟",section:3},{from:"now-1h",to:"now",display:"最近1小时",section:3},{from:"now-3h",to:"now",display:"最近3小时",section:3},{from:"now-6h",to:"now",display:"最近6小时",section:3},{from:"now-12h",to:"now",display:"最近12小时",section:3},{from:"now-24h",to:"now",display:"最近24小时",section:3},{from:"now-2d",to:"now",display:"最近2天",section:0},{from:"now-7d",to:"now",display:"最近7天",section:0},{from:"now-30d",to:"now",display:"最近30天",section:0},{from:"now-90d",to:"now",display:"最近90天",section:0},{from:"now-6M",to:"now",display:"最近6个月",section:0},{from:"now-1y",to:"now",display:"最近1年",section:0}],p={};function f(){return d}function m(t){var e=p[t];return e}Object(r["each"])(d,(function(t){p[t.from+" to "+t.to]=t}));var h=function(t){var e,a,s=m(t);if(s&&s.from&&s.to)e=c(s.from,!1),a=c(s.to,!0);else{var n=t.split(" to ");n.length>1&&(e=c(n[0],!1),a=c(n[1],!0))}return[e||e,a||a]},b=[],_=[],g=f();g&&g.length>0&&g.forEach((function(t){var e=t.from+" to "+t.to,a={text:t.display,n:e,r:t,onClick:function(t){t.$emit("pick",h(e))}};b.push(a),_.push({n:e,k:t.display})}));var v=function(t){if(!t)return"0毫秒";if(t<1e3)return t+"毫秒";var e=Math.floor(t/1e3/3600%24),a=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3%60),n=s+"秒";return a>0&&(n=a+"分"+n),e>0&&(n=e+"小时"+n),n},y=function(t){return n()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},w=function(t){var e=i()(t).tz("Asia/ShangHai").format("YYYY-MM-DD HH:mm:ss");return e};e["a"]={utc2date:w,daterange:_,timeRange:h,showTime:y,showExecTime:v,shortcuts:b}},"574a":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-multiple",use:"d2-multiple-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-multiple"><path d="M186.181818 605.090909a46.545455 46.545455 0 0 1 0 93.090909H139.636364a139.636364 139.636364 0 0 1-139.636364-139.636363V139.636364a139.636364 139.636364 0 0 1 139.636364-139.636364h418.909091a139.636364 139.636364 0 0 1 139.636363 139.636364v46.545454a46.545455 46.545455 0 0 1-93.090909 0V139.636364a46.545455 46.545455 0 0 0-46.545454-46.545455H139.636364a46.545455 46.545455 0 0 0-46.545455 46.545455v418.909091a46.545455 46.545455 0 0 0 46.545455 46.545454z m279.272727-279.272727h418.909091a139.636364 139.636364 0 0 1 139.636364 139.636363v418.909091a139.636364 139.636364 0 0 1-139.636364 139.636364h-418.909091a139.636364 139.636364 0 0 1-139.636363-139.636364v-418.909091a139.636364 139.636364 0 0 1 139.636363-139.636363z m0 93.090909a46.545455 46.545455 0 0 0-46.545454 46.545454v418.909091a46.545455 46.545455 0 0 0 46.545454 46.545455h418.909091a46.545455 46.545455 0 0 0 46.545455-46.545455v-418.909091a46.545455 46.545455 0 0 0-46.545455-46.545454z" p-id="23284" /></symbol>'});i.a.add(r);e["default"]=r},5815:function(t,e,a){"use strict";a("9844")},5818:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page-funs-log padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/project/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{prop:"owner",label:"数据库"}},[a("el-input",{attrs:{placeholder:"数据库名称",clearable:""},model:{value:t.search.owner,callback:function(e){t.$set(t.search,"owner",e)},expression:"search.owner"}})],1),a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),t.dashboard_project.is_manager?a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1):t._e(),a("el-form-item",{attrs:{prop:"script",label:"脚本"}},[a("el-input",{attrs:{placeholder:"请输入脚本",clearable:""},model:{value:t.search.script,callback:function(e){t.$set(t.search,"script",e)},expression:"search.script"}})],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"开始时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.start_time)))])]),a("el-form-item",{attrs:{label:"结束时间"}},[a("span",[t._v(t._s(t._f("dateTime")(e.row.end_time)))])]),a("el-form-item",{staticClass:"row",attrs:{label:"数据库"}},[a("span",[t._v(t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】")])]),a("el-form-item",{attrs:{label:"IP"}},[a("span",[t._v(t._s(e.row.ip))])]),a("el-form-item",{attrs:{label:"行数"}},[a("span",[t._v(t._s(e.row.data_count))])])],1),a("el-form",{staticClass:"demo-sql-expand",attrs:{"label-position":"left"}},[a("el-form-item",{attrs:{label:"SQL"}},[a("pre",[t._v(t._s(e.row.script))])])],1)]}}])}),a("el-table-column",{attrs:{prop:"user_name",label:"操作人",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{placement:"top",content:e.row.user_name}},[a("el-button",{attrs:{type:"text"}},[t._v(" "+t._s(e.row.user_name)+"("+t._s(e.row.real_name)+") ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"db_type",label:"库类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.quickSearch("type",e.row.db_type)}}},[t._v(t._s(e.row.db_type)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"db_name",label:"数据库",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"nowrap-sricpt",attrs:{title:e.row.db_name+"【"+e.row.owner+"】"}},[t._v(" "+t._s(e.row.db_name)+"【"+t._s(e.row.owner)+"】 ")])]}}])}),a("el-table-column",{attrs:{prop:"start_time",label:"开始时间",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.start_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"耗时(ms)",prop:"exec_time",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("showTime")(e.row.exec_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v("成功")]):0==e.row.state?a("span",{staticClass:"text-info"},[t._v("查询中")]):a("el-tooltip",{attrs:{content:e.row.result,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("失败")])])]}}])}),a("el-table-column",{attrs:{label:"类型",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.toType(e.row.type))+" ")]}}])}),a("el-table-column",{attrs:{label:"脚本","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"nowrap-sricpt"},[t._v(t._s(e.row.script))])]}}])})],1)],2),a("dialog-detail",{ref:"detailDialog",on:{refresh:t.refresh}}),a("dialog-backup",{ref:"backupDialog"})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("cdac"),l=a("096f"),c=a("c1df"),u=a.n(c),d={data:function(){return{formData:{name:""},id:this.$route.params.id,search:{project:this.$route.params.id,ip:"",script:"",user_name:"",user:0,owner:"",type:0,order_by:0,db_id:null,dateRange:[u()().startOf("d").toDate(),u()().endOf("d").toDate()]},instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行时间倒序(默认)"},{k:1,v:"按执行时间顺序"},{k:2,v:"按耗时由高到低"},{k:3,v:"按行数由多到少"}],types:[{k:0,v:"全部"},{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:15,v:"管理"},{k:99,v:"其他"}]}},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user","dashboard_project"])),{},{searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=u()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=u()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}}),methods:{resetSearch:function(){this.search={project:this.id,ip:"",script:"",user_name:"",owner:"",type:0,order_by:0,db_id:null,dateRange:[u()().startOf("d").toDate(),u()().endOf("d").toDate()]}},quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":15==t?"管理":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogDetail:r["default"],DialogBackup:l["default"]},mounted:function(){}},p=d,f=(a("9ca2"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},"582b":function(t,e,a){"use strict";a("8959")},"586b":function(t,e,a){},"586b2":function(t,e,a){"use strict";a("123e")},"586f":function(t,e,a){"use strict";a("7a3f")},"587d":function(t,e,a){},"588f":function(t,e,a){},5973:function(t,e,a){},"59bb":function(t,e,a){"use strict";a("f633")},"5a3d":function(t,e,a){"use strict";a("194a")},"5a6e":function(t,e,a){},"5a98":function(t,e,a){"use strict";a("4f98")},"5bf4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"脱敏规则",visible:t.isShow,modal:!1,width:"550px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{size:"small",model:t.formData,"label-suffix":":","label-width":"80px"}},[a("el-form-item",{attrs:{label:"字段名称"}},[t.ismut?a("div",{staticStyle:{"white-space":"pre-line"}},[t._v(" "+t._s(t.columns.join(","))+" ")]):a("span",[t._v(" "+t._s(t.column.name)+" ")])]),a("el-form-item",{attrs:{label:"替换规则"}},[a("el-radio-group",{model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("el-radio",{attrs:{label:1}},[t._v("隐藏")]),a("el-radio",{attrs:{label:2}},[t._v("打码")]),a("el-radio",{attrs:{label:3}},[t._v("替换")])],1)],1),1==t.formData.type?[a("el-form-item",{attrs:{label:"显示文字"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"隐藏后显示文字，可修改。",placement:"top"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{maxlength:20},model:{value:t.formData.hide_str,callback:function(e){t.$set(t.formData,"hide_str",e)},expression:"formData.hide_str"}})],1)],1)]:t._e(),2==t.formData.type?[a("el-form-item",{attrs:{label:"打码方式"}},[a("el-radio-group",{model:{value:t.formData.opt_type,callback:function(e){t.$set(t.formData,"opt_type",e)},expression:"formData.opt_type"}},[a("el-radio",{attrs:{label:1}},[t._v("两边打码")]),a("el-radio",{attrs:{label:2}},[t._v("中间打码")])],1)],1),a("el-form-item",{attrs:{label:"替换字符"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"打码的替换字符,默认*",placement:"top"}},[a("el-input",{attrs:{maxlength:1},model:{value:t.formData.opt_str,callback:function(e){t.$set(t.formData,"opt_str",e)},expression:"formData.opt_str"}})],1)],1),1==t.formData.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"前几位打码",placement:"top"}},[a("el-input",{staticClass:"mr-2",staticStyle:{width:"120px"},attrs:{placeholder:"前几位打码"},model:{value:t.formData.front,callback:function(e){t.$set(t.formData,"front",e)},expression:"formData.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"后几位打码",placement:"top"}},[a("el-input",{staticClass:"mr-2",staticStyle:{width:"120px"},attrs:{placeholder:"后几位打码"},model:{value:t.formData.end,callback:function(e){t.$set(t.formData,"end",e)},expression:"formData.end"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.formData.ignore,callback:function(e){t.$set(t.formData,"ignore",e)},expression:"formData.ignore"}})],1)],1):t._e(),2==t.formData.opt_type?a("el-form-item",{attrs:{label:"替换位置"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"中间替换几位",placement:"top"}},[a("el-input",{staticClass:"mr-2",staticStyle:{width:"120px"},attrs:{placeholder:"中间替换几位"},model:{value:t.formData.front,callback:function(e){t.$set(t.formData,"front",e)},expression:"formData.front"}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"不替换的字符",placement:"top"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"不替换的字符",maxlength:1},model:{value:t.formData.ignore,callback:function(e){t.$set(t.formData,"ignore",e)},expression:"formData.ignore"}})],1)],1):t._e()]:t._e(),3==t.formData.type?[a("el-form-item",{attrs:{label:"替换规则"}},[a("el-select",{model:{value:t.maskCode,callback:function(e){t.maskCode=e},expression:"maskCode"}},t._l(t.replaceRules,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"是否唯一"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置后，生成的伪数据不会重复",placement:"top"}},[a("el-checkbox",{model:{value:t.formData.unique,callback:function(e){t.$set(t.formData,"unique",e)},expression:"formData.unique"}})],1)],1),a("el-form-item",{attrs:{label:"全局唯一"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置后，生成的伪数据不会重复,相同的源数据生成的伪数据相同。",placement:"top"}},[a("el-checkbox",{model:{value:t.formData.global,callback:function(e){t.$set(t.formData,"global",e)},expression:"formData.global"}})],1)],1),a("el-form-item",{attrs:{label:"关联KEY"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"关联key,通常为主键或者外键。设置后，相同关联key的生成的伪数据相同。",placement:"top"}},[a("el-select",{model:{value:t.formData.global_key,callback:function(e){t.$set(t.formData,"global_key",e)},expression:"formData.global_key"}},t._l(t.columnList,(function(t){return a("el-option",{key:t.name,attrs:{value:t.name}})})),1)],1)],1)]:t._e()],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.canbeDelete?a("el-button",{attrs:{type:"danger"},on:{click:t.onDelete}},[t._v("取消设置")]):t._e(),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("设置脱敏")])],1)],1)},n=[],o=a("5530"),i=(a("4de4"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("caad"),a("2532"),{data:function(){return{ismut:!1,isShow:!1,formData:this.reset(),columnList:[],column:{},type:"",columns:[],canbeDelete:!1,maskCode:"101",replaceRules:[{k:"301",v:"身份证"},{k:"302",v:"手机"},{k:"303",v:"姓名"},{k:"304",v:"地址"},{k:"305",v:"银行卡"},{k:"307",v:"价格"},{k:"308",v:"邮箱"},{k:"309",v:"ip地址"}]}},props:{role:{},owner:{},table:{}},watch:{"formData.type":function(t){switch(t){case 1:this.maskCode="101";break;case 2:this.maskCode="201";break;case 3:this.maskCode="301";break}}},methods:{reset:function(){return{project_id:null,type:1,maskCode:"101",hide_str:"(敏感信息,屏蔽显示)",opt_type:1,opt_str:"*",front:"1",end:"1",ignore:"",unique:!1,global:!1,global_key:""}},show:function(t,e,a,s,n,i){console.log("columnList: ",t),this.columnList=t,this.project_id=n,e&&e.perm&&e.perm.maskConfig&&"string"===typeof e.perm.maskConfig&&(e.perm.maskConfig=JSON.parse(e.perm.maskConfig)),this.column=e,this.type=i,this.isShow=!0,this.maskCode="101",s?(this.ismut=!0,this.columns=a.filter((function(t){return"全部"!=t})),this.formData=this.reset(),this.canbeDelete=!1):(this.ismut=!1,this.columns=[],e.perm&&e.perm.maskConfig&&e.perm.maskConfig.type?(this.formData=Object(o["a"])({},e.perm.maskConfig),this.canbeDelete=!0,this.maskCode=e.maskCode):(this.formData=this.reset(),this.canbeDelete=!1))},hide:function(t){this.isShow=!1},onDelete:function(){var t=this;this.$api.permission.remove({role_id:this.role.id,db_id:this.owner.perm.dbId,towner:this.owner.name,tname:this.table.name,tcol:this.column.name}).then((function(){t.column.maskConfig={},t.$emit("refresh-column"),t.onSuccess("取消成功"),t.hide()}))},addColMask:function(t){var e={roleId:this.role.id,dbId:this.owner.perm.dbId,towner:this.owner.name,tname:this.table.name,tcol:t,maskConfig:this.formData,rw:3,maskCode:this.maskCode,mask:3,project:this.project_id,aq:1,ae:1,as:1,type:this.type};return this.$api.permission.addPermission2(e)},onSubmit:function(){var t=this;if(this.ismut){for(var e=[],a=0;a<this.columns.length;a++)e.push(this.addColMask(this.columns[a]));Promise.all(e).then((function(e){for(var a=0;a<t.columnList.length;a++)if(t.columns.includes(t.columnList[a].name)){for(var s=0;s<e.length;s++)if(e[s].tcol==t.columnList[a].name){t.columnList[a].id=e[s].id;break}t.columnList[a].maskConfig=Object(o["a"])({},t.formData),t.columnList[a].maskCode=t.maskCode,t.columnList[a].rw=3}t.onSuccess("设置成功"),t.$emit("refresh-column"),t.hide()}))}else this.addColMask(this.column.name).then((function(e){console.log("col.id:",e.id," column.id:",t.column.id),t.column.id=e.id,t.column.maskConfig=Object(o["a"])({},t.formData),t.column.maskCode=t.maskCode,t.column.perm.rw=3,t.onSuccess("设置成功"),t.hide(),t.$emit("refresh-column")}))}},mounted:function(){},components:{}}),r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"5c0b":function(t,e,a){"use strict";a("9c0c")},"5ca5":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-sqldev-admin-text",use:"d2-sqldev-admin-text-usage",viewBox:"0 0 622 400",content:'<symbol xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 622 400" id="d2-sqldev-admin-text">  <image id="d2-sqldev-admin-text_image0" width="622" height="400" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAm4AAAGQCAMAAAAgBhzVAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\nAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAflBMVEX///8RFBUGPUMIQUYa\nMzQRGhsGPUMGPEIJQkgHPkQSHh8QGRolnJ0nqKgknJwqraweiIoVbXAQEBAQEBAREREREREQEBAQ\nEBAQEBAQEBAREREQEBAQEBAGPEIrtLMhlZUjnZ0orKsmpKQdiosafX8WcHMRYmYNVVoQEBD///9d\nNpbVAAAAHXRSTlMASM97DS2u6lyVHDsyzpFirtGevWx9ruz3ylmO3e2enkMAAAABYktHRACIBR1I\nAAAAB3RJTUUH5QgLABkA9ixFSQAAK55JREFUeNrtnYl6ozizhk039IKzNQZjMHH2jO//CgeBltIu\nYRwvqa/Pef6JDULL61KpJKTFAhWt5MfP9NR5QH0TZb8eHx9//zl1NlDfQenfx1E/slNnBXX1+vP7\nketvfurcoK5ayx+PUL/RhUMdTfmvR1W/k1NnCnWdSn8+mvQLXTjU/IJOm6y/2KOi5pXitCk9KgZF\nUDPK4LTJ+rE8dRZR16L05+9Hr35hUAQ1h/4EwEaEQRHUwcp+hMGGLhzqYPEZqzChC4c6QCFOG7pw\nqFm0DO9H0YVDHSZv8ANdONRcinTaFBcO57VQMQoNftiE81qoYE1z2uQe9eepC4G6DE122pQeFZcm\nobyyLDOaIgyKoDw61GmThS4cyqGIGaswYVAEZVN+SPDDJpzXQhkVP2MVJnThUJqSqH40rtPFeS2U\npCwq+NF7ZHHREnThUEJxM1b05dK4WDDOa6Go4oIfwhWLc/bwlXvUItpKwYFmrFU8dVFRp9aBPlic\nz4fzWt9bkTNWpkmCP1HGEV+5/8aa6rTJinThMCjyPRU3Y+WYHYibjcCgyHdUJCNuN382clFXqaAX\n42N6wHn6ZdRVKhKOEP8+ctSB81rfRpHRi1BfC+e1ULomzViFCee1UIqOO/OELhwK6Oj254i2E3Vh\n+hLvCl04FFHki/HTDU/kSk104a5RX+lW4bzWN9cBy4ymCJcmfWedwJ/Cea3vqhmWGU0RBkW+pY4w\nYxWmE2GOOqEiO7V519tiUOR76eQu+xcPUVCn1DkEJNCF+yY6Yrg1BswvCy+jTqjoF+PDdXN7exeT\nFXThrl3HNCn3u93t09N9THZwadJV64gO0/3tbsDt6eEmJkfn4EaijqIjDgdvCGwjbk9Pd8dz4XBe\n61J0TE/pbrcDuEX2qPjK/fXpmKH8+9udgtvTbVSPerIJDtRxdESn7YbDBnCLdOFmf+EQdVJFdVcx\nTlt6t9tpuD0/PfeKcuHiXqfGmMh5K7wl45zx+9udATcCHCEuzoWLGMggbuet4/RTN7cvLy86bs/U\nvD0/H8uFQ9zOW4HNGOWFp3evLy8yb8C6UeLu4lw4xO0qFNaPRrXi/e3r66sJN2HcnuNduLCgCOJ2\n3gqBLWrG6ub2+flV4w10ppS4175HnX9eC3E7bwX0ozHBj/RuQMmMm2Tbhotmd+EQt/OWr/3iZr/v\nn4aBJ+ftBeL2LBH3Sv69vs48r4W4nbfmdNpuHp4obs+qebvl3/CudKCt16zzWojbecvZeFFOW3r3\n9vb2RLFSu1PNujHYSI8aBZx7DSjidt6ay2lb3L8R2t6AeYO83cqe26vEW6QL55rXQtzOW3anLeqt\nk5uH97dBFvN2K8VBXofvGW8v/YVzuXCI23lrFqctvXt/H3EbzNuTbt4M1u2V0zZcOM+8FuJ23rKE\n66P60T/vRG/v3LzB0cILxw2OSp+FcRusW6+4HvUX4naRMofrI/q2m38f7yNvDvN2C2iTutKXgbZ4\n4BC3S5WpZwrGLX346DVat3fJe5PM263cl8JxArNuROEuHOJ2udKDC6HN/ueD0UZge7eOFm4JZU+G\nYenAmuAt2IVD3C5ZanAhDLebf58fHxJwtu70VvLcQFc6/B/VjvwL7FERt4uWssQnBLf07+fniNs7\n+Sd4M5i3W0vIDRq2EbjdLqhHRdwuXNKYIaDF/3yOAubtDQTfZPN2+yzNJzzDIMgrNG5D1xtg4BC3\nixcYM/hxu3saWGO0Qd54d/rKeLsfV4qAqXmrbSMKcOAQtysQHzME4LZ7eQPm7V1y32TzNvSON7em\n6asXaNy4dUPcvovomrIQ3Ha713dg39TelPHGff/7W0agztrY5aJ1+3YaxwxhuO12zx/ce6PmTQmG\nSMs97pTeVER4B8PGe1PE7RuJjBlCcdvtnqh5ex+70zc5GKLss5XeSaNS1brt0Lp9R2U/wnHrXTjZ\nuoGpU8ML8ze35q50N/SlaN1QZoGX5F/fNfeNmDdLwPZeAAeJ2wHzhrihFEl7Mjy/q8GQN/tmR32P\nSm2bPJ/ARwqIG0qVhNvu5UmZynpwdcdjjypH3Xbou6HsknHru8I3EHzz7nJEgANz85JtQ9xQmiBu\nxPHq2eG0hSzruH99gW6btKMI4oZSJFm3kbeXpwG4wEVr6Z3Uk0LiEDeUojsNNmLg3t4jdgsc9kl6\neZFRQ9xQBumd6cuwwCPqFZf7W3myFHFDmXVnMm7xL43eq6NSxA1lkKEzfR15i9z3404elSJuKIPu\nbLCRNUZRRxINW0bjyBTlkt6ZsrmpYTPUSBcOrRvKqTsFNmbdnl8n7L4rb1OOuKFU3XHadrArfaW0\nPcceSXSHuH0DTT7vmFs3s3EbtteK6lHBqR+I27Vq8tE+d1JfCscJnLbYI4nuEbdrF2mjv1MO2L5T\nPDe5K32ediTRHeJ23RoaKW5v8VF3ShDkxWTd3vr/i3Lhxh4VcbtW0WaKP2Bbtm4jbRy2J2bdhrVv\n0S4c4nat4g0VO2a4M0R4OW+UNmLcCHH/Il04xO1aBZoqbi/eO2lYKvekXG+jeXvzr7eESnHThmuV\n1FhRx6zdmayb5rkx3uJcOL8Qt4uU3FpRYwa+PlIL8ArPjdP2HunC+YS4XaTU9ooaM9D1kfKo9In3\npm9PTwK29/f3OBfOLcTtIqW3WNSYgayPVGIgz5rjRngje6m+vz9MifAZhbhdpExtFjNm6HtUuS99\nop7b6Lg9MeP2NvIW+iKDV4jbRcrcan8jUri5Y7C9gmGCYtwYbX2POg8RiNtFytxqMRvd07eUTX0p\nGCi8c97mceEQt4vUHLiRl0blySs4TBhNG4eNbJU0gwuHuF2k5sFt2ElL5k2OgrwLfZD9RCZM0spC\n3C5SM+FGDmFTHLcni3H7GHg71IVD3C5Ss+E27r5r4u1N6Urp9lyHuXCI20VqRtx6F84wKpVGCe/U\nto16OKBHRdwuUrPi1rtwps4UAPchAzedDsTtIjUvbvQ8esm4QdMmwUY2LZ/swiFuF6m5cSPzWlrM\nDQ4UhGkjvH1+TnThELeL1Py49cApqL2ZYPsc//WaFBRB3C5Sx8Ctd+FM01cqcQS2gbfPCZAgbhep\no+BGXDgdtg/VcaOwkR41+m1XxO0idSTc+h5VD4MMIwXFdWOKW7mOuF2ojobbYnEn0Ua70XepI6XA\n/df/i3ThELeL1BFxW6QPkuOmjBSgdet5+++/KBcu/Yu4XaCOiRtx4aSY2zuE7RPANvL2X5QLl/9C\n3C5Ox8Wtd+H+wYUgwHGDIwUC28Dbf1Eu3PIH4nZhOjZui/ROM26fclf63/iPKsqFo6evIm6XoqPj\n1vd6D3RyXg7yip4UwNbrR5QL9/M34nZBmoxb1EYz/2THDQxKpa6UARf1yv1fxO1yNBm3+6i92/78\n+1AnsNRxAtfn00NUEeCYAXE7b03HbbeLeYkvvVNh+zAZt8f//nvf7R4iCyHGDIjbeesQ3IJ2xuLK\nH1gMRLFuknH7IDveP0QXg40ZELfz1mG47aI2tL/5x2MgFtg+n4dUH+LLQccMiNt560DceuCiXDgW\n4v34NBH3RtN8mFKSYcyAuJ23DsYt0oX7+WH12975yTEP08qS/ULczlwz4Bbnwt38M9u2j1eR3sPU\n0iynbtuP+hrNgltcj7r8p/ejn08wuYdT1wrqSJoHt5eXOBdOjfC+7XaI23fQXLi9vES5cH9hhPdd\nOV8ScbtazYLbuGNqZFCEzZVCpw1xu3LNgRvfoDdyXuvzU3XaELcr11y40R0Fozan/Pn5+fayQ9y+\nkWbAjRm3ccOtmIOa742wIW7Xq5lwo8Zt2B8k1IW7ud3tELfvpcNxA7TR0zuCjohRDmhG3L6FDsbt\nRcUt7IiY+90Ocft+mgU3ibaQU/7s/SjidtU6ELfhVKxX6LnRkxRc+4u7+lHE7ap1qHUzdaV0d1Sb\nC3e/8+nh1LWCOpIOw40bt2fVuFmPiLm/9dIWgttspx2hvlKHdqYm48a3BdF3Q70JgC0It1+/slNX\nHSpeB+GmGbc3YNzGN68kF87rtEXg9vj4Fy3cxenAzlQNucHj/dj+4rl0y3y4PT4efBgI6ot1mHUz\nGrd3aN0++G6oYf1oFG5xp6+iTq85cNOMG6Rt2O75T3A/Godb5OmrqFPrENxcxg3S1ushArbdLmCa\nX7w5j2OGC9Jk3IaDmu1d6bu09cx//2JoC5njh5u74ZjhYjQdN7J+6EWfTzDQ9l8UbmFL5qS9BH/j\nmOFCdAhu5FhJbT4Bem58791w3EIXBCtbV+KY4TJ0EG7jKX/yfMIbMG5ip+dA3MJXn2s7peKY4RJ0\nIG7EhdMmSwVsrC8NxC3i3RrDxrw4Zjh/HYxb36M+K/MJmnULwy3qPQfjRvd/0YU7c1lwS2LSIKf8\nWXvS8TV5P25Rb3Et8h/GbP/GHvW8ZcHtMe4Ul5tbPcJLN7P/L8y6xbyjulj8/G3JNo4YzluPVsUF\nF+7FZCk/GSbcukX1o4vkhzXTiNt5y45bZHBhOOXPGHPz4hbXj2a/HHlG3M5bjy7FBRduHvTpBGrc\nXLjFwWY5nAhxuww9uhXpwv0Dx/pB2hy4xTltf34/Im4XrEef4ly4P+/S1Px/PtzinLblD19uEbfz\nlhe3WBfuQR8nWHGLDH788mcWcTtv+Vuwd+GiwvXD/uKfknF7NOMW1Y+mP0Oyiridt0LaMDZc/+cf\n70wd1i2uH/U5bYjbRSgMt8ffP2MSTX9+yMbt8d9h/WjmddoQt4tQYDPGBkXyv5JxU3GLdNr+BucS\ncTtvBTdkbFAk+8doe9R8t0inLawfRdwuQBG4RbtwgLd/x3baELeLUEh0QSgyKPKTwvYIcJtxxkrT\nj6iFLKhTyB87lVo0zoX7pVq3uH403Gl7jB3OoE6luP4qzoVb/iDGjeEW14/GOG24tvJyFGdFYue1\nfjPc4vrRSKuLK8cvSEd14f4OuM0/YzU1Q6jTKzmiMcl+/Tum04Zb01yiIl2luKVJRwx+xDmTqHPR\nmQwEjzlURp2Tgucmx5Y+RpgLnbbvpMh+bO7xYNgyIy4Mfly6Ttrg6LR9P52sO4vsytFpuxKdxFk/\nk4EK6gT6+l4NZ6y+s7440BoXZMa9jq5PX+jCxS0zwuDHdeqLJsljnTbsR69Vx5zXYsLgB4rp6JYH\nlxmhoI7qV+GMFUrV0ea1Iicw0Gn7Hop69S48JoZOG8qsiBeLHwMj/jhjhbJrZjoi+UWn7dtpxr7v\nSL0z6po029KkE6+pQ12IZolb4IvxqFAdvDQJlxmhYnSYC4dOGypOByxNwhkrVLwmzmvhjBVqmia8\nco8vxqOmK3ZpEs5YoQ5RpLWKsoY4Y4XSFDevFSx02lBmxfWQYcLgB8qmyHktv9BpQ7kUF93wCJ02\nlE9xsVuHcMYKFaJ5XDh02lBhmiEogjNWqHAd6MJh8AMVpwNcOHwxHhWvuHktIQx+oKZokguHThtq\nquKWJqHThjpQcUERDH6gDlPES33otKEOV2BQBGesUPMoYGkSzlih5pPPhUOnDTWnnEuT8MV41Nyy\nunA/MPiBOoKM81rotKGOJd2Fm7ZdNAoVImVeC2esUMcVmNfCGSvU8cVeucdlRqgvEZnXwhkr1Fcp\n/4szVigUCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoVCoVAoFAqF\nQqFQKBQKhUKhUCgUCoVCoVAoFAqFuhjleBSCV4G7XOdZOkMqTMWKqDw899W6VzW57EsiDsnw13LK\ntt9pUharer85fH/6oulVxN/XlkTJpFoYboWNkSaDolNabgeZv8zaat1s6rCUtvt9vSoq/febJ1XR\n1HvfD1tuiGZPtF0cqu3+oISK4e6O/TkmNgXeZLx1f/APaD2ms47mdqzRleuSam3+fDk+U/8kOhOl\nlhJQN34ZBvFYHANVRUiLp+sm1VM7GDdK2+SUZsNtsdrLSU1TumYFWsU2tR+3vrLMVtODGzVZmgw/\nLSdu1fhlkOVOrdWZjd84jWTSKRU4D26ctqlJzYcbbaDA365F6UoUqInkzYvb1trWHtzavVkGW+nE\nLd/4QWFq7a268lb0VsveLLhtYeEnuDtz4sZ6wdWkm0elDSxQE+dD+nAr7NX0RbixLIT8ImnTmg40\nSXztXepEzIHbVi79FN5mxI0aea8Pa5dMW5+tKN7cuPFeemPI31fhtgzviDq5YQzfOYwkxRo8aAbc\nGG0FS30CbxNw29pUU/NmvcCTl6xjtVQx3mLQdeK2ZGlvTKblq3CjeXT5t2NsYEkt2Jr+KRu5ymsk\nmU/CW/Jg3PjPdc37sQnDuXjc0v1UbdxZaWvxm2TdwaYNL4oLt4rnQW+jtizpD7cUEp8s58SNfu34\nFVkeJTVs7rUuvJ9gxT0Ut5wlONQvoznS3Tkn3OQxdiv9FSQ7bjkfgJhsW+3O9Va47UJdMG5FDbWh\n2ZA+lLCx4tZWQmOWa/CJGp9LqTWvc1g5k8OzS1ZJ4/iN01xHHpZ3LrgJIihfySb2F2TFjZtNc+0E\n4wYysgrHzV8vYbit3Imo3UBOeWvGP7uDcCt5Y1Ary3nbxMVZzwQ37loJa8Z5qwNDKxbcMtFOjbET\nu07cFssNTH2s34kxeN7xiLFbrjdYiM4DN/7rgRXCDXjgj9KIWwqauzB7tleKG8vKiEg9HTfR8cBI\ngeAtJh4/GbduHaHOiZvNtco4CKuQEaoJt1KwZB11zIJbTkeQ1BAkfDw5CbfNSmgzFbfx0XT0aL3I\nK+GKyG4NHzw4u5+0lRD341aqTmgAkqq2LtyEaVNdK/EL2gQ8Tset7URzNFZiq+2WjuzBWEB80gbh\nVu0N6hYTcYORkm4ybr2DVbdSo8XP+OR8UlELe4AZIEu/kZf9j6WG33lx6wfdddGCW2y4uQyQA7dM\nhHb1QUEO/C7vGEjBLS0BbJvKafHD4m4H4NZkRq0jcFt3TpkMV16wLNPQSfSh68K0mXw08VPqjCA3\n2g/Bi9tY1Y34wIJbtu+KxNamVtzSauMqT9+M4HuPjyDhllawj1x5RrdHx80SfC4cuOV0QVQHMhKi\nrDSIZm9b2mVICpg2s9sHSm0ycJVaS37cChUFC25DzjYrs3dgw00MSLnZ12pPXNK5+wKIWwlh67wu\ny9nhllZ9aTbDA2NxK/fTpKcETNvGUvWtsAaG1hmnNeESSC9uY2lBUmbc2HoQ89jHjFsGl39Y+2I4\ntly5egOIWyaqYeOzioszxG0szFY0wNfjloAJbDiZSJei0gwl4He91tpQC7/4cMthtY/Nb8SNrXYz\nV4sJtwxYavfAAxbJAZzUmfJZsCIkSszgEkpMuImvGxW3Up42GP84ALeW24Uvwk2xBdAUyB0lrRmG\nVi5dqFT2Vi28DzfNdTPj5lnLq+OWwxFb44lzSEWyAicPFdbhsAnbrOnwKfqpvhs3b6fATWodJc6h\n4AYjC1pXQutVNIIPN811M+NGDa9tqYOKW7qFWQwIcsAiGYw2yANr2LTryx46/3WGuA3PJEGEr8dN\nah1tmKXhBt1rMpELs6r2pj7cxuslX3uMPkofsfaw+eRlM4j/DfvRVVMEaAUNnPkxSiAkC4btLHEb\na76VcasMERDV2LemMAlFyhhC2ai4QXr0OVEdN8m9lmtF7U09uFHXzddw8nSwXxnPW5Ms4E/J8eMT\nMVvLYwJejbHpHHEr6X0Qt60hE0GxtFppVz0TADdgHw1ujgE32b1e6hen8rOsuJVBGLHmCA9a059D\nR347gbgJG2+p4CvDLd2MrToHbpmrfcZMgLXBbPHSvja54kbc+sZh+ZFX4Y0YtvKzrLiNXZhv0p9m\nL6Klh5dEaDcfiltfa4WlkQcdjps+iSXh1ghtjo/b6HFsZ8GtNSIiZaLWLzdHkBJLWnQsu8kNia/l\nP224pXqJ8pUmFqDpVj6JPFZ9aWjGwnEboye2YezhuOmfBMfdmCy4deZI/sqFW0LC5uUsuDnnrNca\nbkNV2pZF2HAb3zZUO+zxah7pdePW6jnJQ+CwSVjztOD5jcGNzNGIvKTSolh6YR0o2ExHx80p25xp\nlahxt6m4reRWNuEmfbl0zMTYcetzXKuB17SWGt6Nm2EKeSbcgJT3Z9hb9AGv1Uxfeqfk5Ui4pfmM\nK0IEbpUUaw7BrbZl14Lbgq/JSMfAAIDLhdsiX5pTZ0V046Y4esfBTVESful545ZvyTzwMXCj3wTj\nlinNagLCYvpyrbKcuOlqpdSduKnDWPD8q8QtFzJOYokb/LhlxWb4oUbglpOVqMMnNViaujkcN5r/\n4cpUG22OZbFEHw7GLZUud+JmGlVdM266puLWjhe0ckTbg9vScc1BuNGRAkmjd+fV9wWPixvNZenH\nLTUtcE8rWZvxlk75uGJe7RZ+GBLnvwrcqDhudeNQ5cvFobh1DKhxAZtxdYVlRH84btLEggs3vZZ1\nWSO8tN7Xi1hF4LZooWilwo+oW9KaBIt1RNwMsQ6bjoUbdd22/GUjedRpLQuRFTd9MswZOKGhEBdu\naxf2o1gAem37In51fAxukgxxNyXqY9VMuKXJtpNub6NeXz8Wbux1Hd4oG+mexlgWKituuiy4jbMj\nNAUHbvQ658titCQbzQLSX3nwLKpWnFlwCykC0Qy49agpG+r0DkYa9T7xsXDr+I+OvdtWw/Yak7HY\n38Nxk35wDtxKnkur2KJZrTbZ72jCi41z4hZioIn0SawCtjL97YDpETWQVdL384DompmIFzxT0seP\n7QE6/fpQ3GhfOmSW+T5w77wO4KBpBtwqYHgcuDmN7CjrGl7aQHX4Mi21OPPg5t8CZpAn7lZZKljU\njRru2PDAaGRpcq3SD4670R6ohX/AJ9RHxg3GlOy4ZTCXzoT0ygw2buxtYCBKSKl/4xnXmnCjvalv\nwOLBbWupYJGsumaEZ9Uw6xyQE9iz6bixWg3ErYNF0bfiopOIlu5+Btyg82bHrfDaJ+s4ge8X4DVu\nUUtPPS9UGafoC3dVSI1sxc0WqhUFV6OR6hfBYYOxMYmpySq4uwfMCKuHMNxoSVi95Gxumd/ntAxW\n3EptqG9tbLCsyIobZdI1pKJ9jD5OYC6d32M5Om7QcfE2if7JWIW2UC1Ile1v1SkpmSZmXBrNZJUP\nQ9xMpDwdt0apPDYgYbYgdVbu4XE3yXmz4kZZcnRgdGPjvoVL+Sq2G5PfuB0fN9Z52O/Nsyxj68GE\nwCcL634JADfSzXXbRFsRMlajZyNFrULK8ceuvfi3lto+CDfW0aitz3OvAyXVzgy4gZ+cFTfrhnlc\n8DffwO3smKsTsAHK8XGjZa2tvxvfLFPN6wLQqA2j2m67BAXin9M9G4KbpqIlHXJVqwuQVhJgIbjR\nmSHJNWMBm7Hzce/nMAduwHmz4dY6mR8yIkc09x0jjvmSIQsdj48bPxbEdpsfN8O7Z8Hr3ZxBLYMK\nWu0JLzHErZFaOgQ3U2CU+TrjptjU3bD8HOfADThvNtyUz41abpW9qhrybjX3RUMy9AW4sT7fFmn1\n47bUqjwct/Hh4eFHbr86VhiIWyeREYAbc9Rk3tlxIim4xOL4zILb8LzhvRRrZ5oRZ9VbTUkhE7dZ\nt/pI26VUE4u76d94krItHvf07X7cSv33H4pbFts2HKiK/QfETSbDjxv76avxBXIn25SFTvTZUpgD\nt2VX0Clq15zpMmB3jUWa0BVZiiZMX0nFmSfMO+SQzRSak/Tjpr0ZF45b62xLQ23SR7J2LiXccrmx\nvLjxV6rUX1rfnfK3leX1j6pmwU1ojmM8pJ3UWCNNOTUQFmc+3ISvYl673ri1oglLv59Q3GJHCpm4\nvqFPALgl8lMFbubK5vv96XVSiX6rslXboDPErdeyUExc/AkPSnFmxC3slAY5w6loQTqwktyfUNyc\nE0QGteJRAwabFOJWya0jcOsaw0GUC9c5OUKGlw+BzhM3YuLkBRF10FpKg46Am+gw7c5otoFbj7S1\nSIct0IVXB+KWmPsyu8CkaEarAeC2llMTuBGqOwVqcXaiuzkbZ8WcK24LbWpxU0zK0jFwE4dtWa0u\nAWhN/aBh0WsFv9krQ7dA3KjXF27p4fai3Wh1BG40hpbJFzPclDOyxE7NnhmV2lndZ4tbZoi9r4On\nprXizLPejaUieLMsOi3BU1upBWiFy/5XIG7OF+4Mkt4j2Y7FEbip4w4XbmLTDs85nbS6bV3RmeKW\nW6axm+i91WfDbdj3mtW1ZxNzGjEYmWKrp3L4l3xXGG7RfakEVDKGDwRuagEV3ODgUsQzfTOJ+pYN\ncsWcI2452Hh5U8lmzr8zrqx5cFtWyrbXYBKk020u9XPoF7QAK5CsUr1huEX3pdpujwuA21KFV+C2\nkXEDWzj7zuikHbR12uP8cEtbGLoindVSBi7Owh2OWwqCz6IeczCUUTe1bOWLWXS0FF91pmd5cKPz\nGRHHfppWmnPctBVhAjdgmuXd3GsfFYXZABfsLVfako1475VW48p8YAv4aS0Nm8SMFctPKaF1a7jQ\n5oUt5XkFGhleysHTRofHsLDSt7zSs8hyrOSmlMLOAJMU5Ene2JIu4RexQpqHDe/L1Lcf9zbcCoBb\nxNnMtC4lGysVK2XRQ+0E5iXLDjWKCTy7xBcdYH6D+rnnJB27wAPbqWmY+Cet1G5Xcr7ANq6ZApyK\naxXzcChbEMuyyhRWOBw6b0Q6uY4U705pnSmzQNa3GtkCjKEGLE1pl2H6QkxpUqsC6nH8JGFFL7Rq\nNx/mUtTNal1st1XF3xvTurPzwS1bJm1ZbQv9ZZD9WvoxKcAp9nFu3NgBd4rkfYxbuC07R4Q2JBx7\nsnl9Nl9CH1p0XbNarTs9K8XQhMzSD4itnfk1iLJKrVRetskyY9vNs/qCnTrd16goQDAZrHmwnf2o\nY6Av2T4f3BrLBYYwmwKcZAxmx81wKVnvKAuc9sYrhn4kx96V7NGLlQUspe36lchQxNtBtH3YHgYb\nWBLTAumtKTci4mNzf/RtN/Se63xwy4xf1+aNl5cQTqntZ+9M1RoyzuuIPcx5/8EiOHKdp9I0MB9D\nyI+wvjBC8rhWnuPXVm4xaXd/gwVW2zOTmsexvEKd4TZk8XxwM72X1JXWwokdnGVOZsdNcszWpdVJ\nHqMEvN1SS59HKovFdMQYQmopGLCQtisZLOfoEUa9+lhIqcIaauEmRlxSR8O62aEe1q4RqdKApgqt\nthMFiptNTYNI5F/+4e/rdekebZeSS3I03Jh92ayqpSeQ3kntNtg7fe6rGWI6A4yiB4MtJQcZYNOP\n1w8+Ydx73du9uRtp6OHVStmlAw1YifrmadyDYckS+09SPLVEdknT+q8ftgxX441pPlFWlOrQ/PSE\nSe3Wt5ohGkpX+xVSDwZaSondbfUG7A2nezm0rgqaQ96jDTnJaoOpLFfDsQh1BxznxBfmTMlYb7Bf\nVTstWvu1Kpr1tiqTLHjNR77eHP9HVIahZlC6ddy5hWOIlO7h3GZqy9NzHVspLriNnsJrt/C/ByQS\nmmJumZ/xr3P+fpq82vL0OhsDgFShUCgUCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoVCoVAoFAqFQqFQ\nKBQKhUKhUCgUCoVCoVAoFOpbKVmvo/eJ+G5KKrKJ8NnsjXCuyrb+XX7LyWewRKm9iD04zLmUN5k/\nd52spjOwGZc1E1+CW9tN3Ob+S2XJJdmAtG6a5gJKcNKaJvW09mXiS3Arpp6q8KWy5JKc0nsxe/uc\nsKaFdXNkAnHz5DKNOV325DplTS+Z74a4Tc9lbj+69Qx1FjU9ETdTF6LtRBiyNaH6fGPC5v90pK5/\nZbg65BP6WShunty7P/V8lIbdAj6T7wipafvDwkvmvGgCbhk5cKVe8V06q6JIFxk5kKFbifFuWfSe\nTU32Xe2/Nz9gWRTkonX/PxW/Z9MUzB8aEl6uNv3Dhv9MyNXNsENxviWPM0cglFTIxc2G+PSVKHqy\n7ZPtLxIJGEtFHr7plFyyr4s1KSCRO4FaNYH6w9Wb4b1VsaXnKXUF3J3Z/by0bGpS5vEhvpqWpFeX\n4Wq5DMOzmbYkw3J2xj9EJvr/B5GRtihaK25sd3/+7Wq/z5ds71/6WH6W+L4kDrX5dwBOliBbFotz\nKuh5SP3faUL3be6fwS5fpfzIS8PpIloqC3GsV81G42LzY1ZNplKl6uFBYGNlaaN2TwKKg6c/XLsZ\n3rva16KmVgIB5/Na/u1wKKWvpqG06jJdrZRhBU8l2Awnz0jZGRAAmeikfmHcTd2IG9nLf7Oq2ooc\n9DMWvk+4L/u6LLcN29A8GyxbmVT91a0Vt6RpyE+w6/+nNxDLjpyV0rYklXpJEyYY192G4Fbs621J\nEtwX2WbfZ2F4nBry0lMh29Kvy7atOna8Cqm/el215ZCYvVT04XuYS6Z1/2czhkGaxpOAhJv+cMPN\n8N4et7Zv6W079Bf0CF3P80jLNmWbDA/Z+msa0qZWl+FqrQxm3ETxBwRAJtY1uCEZD1Yw4rblzyRI\nFbSc7FiZLT0HYsV/Ce1mU9twI+KdOTnygJ6k0MNb00rvxr3Xhx/YmGIy/DhK9jj5JGJDKmlv8xNe\nkw19Jm01cl5eaS0Ve3iA7+ZLQCqw8nDDzfDe1X6zoQ1B+owm4Hm5CKsm/EwjV02DClSry3S1VgYz\nbqL43OKwTGwBW+uxGky45RtxBEROj5QgKLCeuBnuacFJu8P5SgG4VeAAwmrMwEr0HitxElSxF1d2\nKgZ6KktwoFUz1Eom566xl4p3XT7cvAlw6Q833QzvXe3FiRqEt8T/vAq0HG9YV00LadVluFovgxk3\nUXwNt0wcFUMATy24reFn7VhdK5DDZMhcBw8GWgfhlksnPXRDZgBjK3HsCOGXlW2rnAdlSCUBbkK7\nXo9tKap4qChLqcRRZz7cvAnA5ykPN90M713Bs/KSMW3P86pCcJ6x1nHV9AI+QKouS7soZTDjtoEH\nJMm4LVbcRJWUZxNusvHthqes5NNpViT8CcqwDMKtlU5X3Q6ZAYyJ3JFG5s6QmkVDKuT0OemglVQ6\n7SkhZxhZSiVu8+HmTcDxcNPN8N6VVMYx7eDnDU9svDUNLleqy1SjehnMuIl0dNxabqMa6oAbcMvk\nSFPBLD9vi4G0pXQgYxqEm2zVW+YRMI7BMyDMrVLFplSI79uBs1UyLVpmK1ULP3Lh5k/A/nDjzfDe\nlQREQf4Kfl7ai1WXq6blKoTVZbjaUAYzbiI7Om6Lmho/3q0acEvk48kr3U8kNysQDEOFXD8ZTXp+\n3z004jjvZkgBMAae4cLNlAoNGdTrNjWVwVEqQZgHN38ClkfZbob3StU7fh3wvLRcN+yUMxk3Yx0B\nydVluNpQBjNuIjsG3LZinFTZcFM+ahkVMm7KVcOz9KNEN9LztZNt12PoJg43Uyr9HRX9nHhuhmLZ\nSiVssgc3fwKWR9luhveu6PHw/Oqt/3lpsQGVIONmriMgqboMVxvKYIm7uXDLab465uIZklWad7xC\nw03BfzPgVquSK4EE1iqocgpuplTGwrXjMdQtbbCgUgXj5k9AosX/dAW3VPna9zxyPuSmaJOMnDKo\n4matI1gyXl2Gqw1lmIDbEJgbbPsalkKS7JUJj17GTe7c8yDfbWvwPOJxM6UiMr8eKnCp/Z5tpQrG\nzZ+A5VG2mxXcltLXrfd5KxiCUXFz1pFWXYarDWWYgttolNZwhKrilmoH2GcG3BZSCKAMws00DI7H\nzbOIZUsqKpdiw+1qldhKFYybPwFwi/Jw480KbqDB1+Rrz/NSEBcTrrirpu3VZbjaUIY1qJ/+gUG4\nkW407QfCrCSmfHVwmCQSVnArAAVpHYRbIpWh2GySKbgZUlnX4nzsdMhwDdkZKspSqmDc/Alw6Q83\n3azgJvqKfIyJup8nOTOVipuppoXU6jJdrZcB2sAqFDcywgGMmXBr4dPXPPiv4EYqhT5+PC/didvY\nVTRy9K5bTMHNkEoFPknZJ7w1+pw21lJJuBneRxC4eROAra883HSzgpt4+HYssPt50LnKNgA3a01L\n+ZOry3C1XoZSfJLXHtx4WYiVbES7Gq0umUJIeRt0CgrMUyDBm+0yXaRJs193LtzYeJh4BHQebpim\nUxosFDc9FTjjUg1eR1qLWNKKP8lQqlTPpSQwZ+pLgMvwcMPNCm41K1NLJ3zcz1sKGMn8Oq0uV00L\nadVluFovQ8ZWP4xLgey4SRW5lsbFJVmHIGk5zsk2bd6PXcgsRWLBbeBtTybn903qxK0Hpt6W5TgN\nvqn6POdlTTMxATdDKuREdhJDSpcFnbluyaxrkvZl6Og15lKlhlxacPMlIBVYebjhZtV329f91+ly\ny6dPnc8jOKxJXrO+xFVDq8tV03IFytVluFovA1mgUvZOZdLtV66hglSRw/ok3pWXashlaKt8iMQM\nYZ2OT39puI0/KzIcTxdO3BYdT3lEdEh5zX7C0bjpqaQNR5+Z63G53HBNMz7BWKrUlEszbt4EhPSH\n6zcruOWkUONtbcjzhmURHVkk2V/PcHPVNJBeXYartTJkbL1j/7cLN7kiO9iVm3HrDeKYdM0WBxpx\n6yskqarhpcJueLxNadFtaMpLGlPsEp5wPG5aKn1BWHidLzbOV2MYtBaW3VAquFJd5NKMmy8BeJv+\ncPVmFTfywtzQlsuw5y2lQG3nrWlJWnUZrtbKMPro+802dQZC5Irchg2S86SMeEVWW5RmV7osy+Tg\nl2/1VLKkrNql/FFbtpnEQ1ypDqoW/eH2m+kvrS/TUsHX9bysrZw16axprbpMV6tl6HNTtnGvQXbS\n/NxkJdDNyXT/ABWh1TxtcoZKZnqTTRrTBlpMlEXXi9s6cH7Dp96p4cHCTFufjIrS1eKW751OfYR6\ni9YN4KZkOUt5aHLfWleL29a8HnSKhmBfs+pMC1xQUbpW3NJ6voKlfDTd+Xf2Qrl0rbi182550Q+m\ni0od7qOiledXSdsizXPIxv//VwqSkyuaigAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wOC0xMFQx\nNjoyNTowMCswODowMNOosDUAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDgtMTBUMTY6MjU6MDAr\nMDg6MDCi9QiJAAAAIHRFWHRzb2Z0d2FyZQBodHRwczovL2ltYWdlbWFnaWNrLm9yZ7zPHZ0AAAAY\ndEVYdFRodW1iOjpEb2N1bWVudDo6UGFnZXMAMaf/uy8AAAAYdEVYdFRodW1iOjpJbWFnZTo6SGVp\nZ2h0ADQwMHlaadsAAAAXdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgANjIyNRfuRgAAABl0RVh0VGh1\nbWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNjI4NTgzOTAw\nDhx4agAAABN0RVh0VGh1bWI6OlNpemUAMTA0NTNCQtUBjEAAAABGdEVYdFRodW1iOjpVUkkAZmls\nZTovLy9hcHAvdG1wL2ltYWdlbGMvaW1ndmlldzJfOV8xNjI2Njc5MDk2NDA5ODg5Ml85Ml9bMF2g\nSGsfAAAAAElFTkSuQmCC"></image>\n</symbol>'});i.a.add(r);e["default"]=r},"5cbd":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-tabs",{attrs:{type:"border-card"}},[0!=t.project?a("el-tab-pane",{attrs:{label:"基本信息"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item"},[a("el-form",{ref:"ruleForm",attrs:{"label-width":"300px"}},[a("el-form-item",{attrs:{label:"项目"}},[t._v(" "+t._s(t.project_name)+" ")]),a("el-form-item",{attrs:{label:"级别"}},[t._v(" "+t._s(t.edit?"项目":"全局")+" ")]),a("el-form-item",{attrs:{label:"权限"}},[t._v(" "+t._s(t.edit?"读写":"只读")+" ")]),a("el-form-item",{attrs:{label:"开启项目专有审计"}},[a("el-tooltip",{attrs:{placement:"top",content:"开启会拷贝一份全局配置到项目，项目级别审计仅对本项目使用数据源有效"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.setting_form.project_setting,callback:function(e){t.$set(t.setting_form,"project_setting",e)},expression:"setting_form.project_setting"}})],1)],1)],1)],1)]),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text item"},[a("el-form",{ref:"ruleForm2",attrs:{"label-width":"20px"}},[a("el-form-item",{staticClass:"el-col-24"},[a("k-btn-tip",{attrs:{tip:"确定要"+(t.setting_form.project_setting?"开启":"关闭")+"项目审计配置吗?"},on:{click:t.onChangeProjectSettingMode}},[a("el-button",{staticStyle:{width:"100%"},attrs:{size:"medium",type:"primary"}},[t._v("保存")])],1)],1)],1)],1)])],1):t._e(),a("el-tab-pane",{attrs:{label:"规则设置"}},[a("inception",{attrs:{configForm:t.configForm,otherForm:t.otherConfig,edit:t.edit},on:{submit:t.submit}})],1),a("el-tab-pane",{attrs:{label:"备份设置"}},[a("el-card",{staticClass:"box-card"},[a("el-alert",{attrs:{title:"修改备份数据库地址可能导致之前的备份不能恢复。",type:"warning"}}),a("el-form",{ref:"configForm",attrs:{model:t.form,"label-width":"280px",size:"mini",disabled:!t.edit}},[a("el-form-item",{staticClass:"rule-item-label",attrs:{label:"备份数据库地址"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.form.backup_host,callback:function(e){t.$set(t.form,"backup_host",e)},expression:"form.backup_host"}})],1),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.form.backup_port,callback:function(e){t.$set(t.form,"backup_port",e)},expression:"form.backup_port"}})],1),a("el-form-item",{attrs:{label:"用户名",prop:"user"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.form.backup_user,callback:function(e){t.$set(t.form,"backup_user",e)},expression:"form.backup_user"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.form.backup_password,callback:function(e){t.$set(t.form,"backup_password",e)},expression:"form.backup_password"}})],1)],1)],1),a("el-card",{staticClass:"box-card"},[a("el-form",[a("el-form-item",{staticClass:"el-col-24"},[t.edit?a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"medium"},on:{click:t.onSubmitBackup}},[t._v("保存 ")]):t._e()],1)],1)],1)],1)],1)],1)])],1)},n=[],o=(a("a9e3"),a("ef64")),i={data:function(){return{setting_form:{project_setting:this.project==this.real_id},form:{},edit:!1,real_id:0,configForm:{},otherConfig:{},filterText:""}},computed:{},props:{project:{type:Number,default:function(){return 0}},project_name:{type:String,default:function(){return""}},db_id:{type:String,default:function(){return"*"}}},watch:{project:"init"},methods:{onChangeProjectSettingMode:function(){var t=this;this.setting_form.project_setting?this.$api.setting.addInception(this.project,this.db_id).then((function(e){t.onSuccess("开启项目配置成功"),t.getConfig(t.project)})):this.$api.setting.delInception(this.project,this.db_id).then((function(e){t.onSuccess("关闭项目配置成功"),t.getConfig(t.project)}))},submit:function(t,e){var a=this,s={};s.config=JSON.stringify(t),s.other_config=JSON.stringify(e),s.db_id=this.form.db_id,s.project=this.real_id,s.db_id=this.form.db_id,s.project=this.real_id,this.$api.setting.updateInceptionSetting(s).then((function(){a.onSuccess("审计规则更新成功"),a.$emit("refresh")}))},onSubmitBackup:function(){var t=this,e=this.form;e.project=this.real_id,this.$api.setting.updateInceptionBackupSetting(e).then((function(){t.onSuccess("备份数据库信息更新成功"),t.$emit("refresh")}))},reset:function(){this.configForm={}},initFrom:function(t){t.warning_conf?this.waringForm=t.warning_conf:this.reset()},init:function(){var t=this;this.setting_form={project_setting:this.project==this.real_id},this.form={},this.edit=!1,this.real_id=0,this.configForm={},this.otherConfig={},this.$nextTick((function(){t.getConfig(t.project)}))},getConfig:function(t){var e=this;this.$api.setting.getInception(t).then((function(t){console.log("data:",t),e.configForm=JSON.parse(t.config),e.form=t,e.real_id=t.project;try{e.otherConfig=JSON.parse(t.other_config)}catch(a){console.log(a),e.otherConfig={}}e.real_id==e.project?(e.edit=!0,e.setting_form.project_setting=!0):(e.edit=!1,e.setting_form.project_setting=!1)}))}},components:{Inception:o["default"]},mounted:function(){this.init()}},r=i,l=(a("0e40"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"5cdc":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-search",use:"d2-search-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-search"><path d="M492.5 917.7c-247 0-447.9-200.9-447.9-447.9s200.9-448 447.9-448 447.9 200.9 447.9 447.9-200.9 448-447.9 448z m0-810.6c-200 0-362.6 162.7-362.6 362.6s162.7 362.6 362.6 362.6 362.6-162.7 362.6-362.6-162.6-362.6-362.6-362.6z" fill="#3688FF" /><path d="M951.1 971c-10.9 0-21.8-4.2-30.2-12.5l-96-96c-16.7-16.7-16.7-43.7 0-60.3 16.6-16.7 43.7-16.7 60.3 0l96 96c16.7 16.7 16.7 43.7 0 60.3-8.2 8.4-19.2 12.5-30.1 12.5z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},"5ce6":function(t,e,a){"use strict";a("7b60")},"5d45":function(t,e,a){},"5db0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("安全设置")])]),a("div",{staticClass:"text item"},[a("el-form",{ref:"form",staticClass:"userInfo",attrs:{model:t.form,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"启用两步验证"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":2,disabled:t.isTfaOpen},model:{value:t.form.tfa_state,callback:function(e){t.$set(t.form,"tfa_state",e)},expression:"form.tfa_state"}})],1),t.isShowTfaSwitch?[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.qrcodeLoading,expression:"qrcodeLoading"}]},[a("el-form-item",{attrs:{label:"认证方式",prop:"sex"}},[a("el-radio-group",{attrs:{disabled:t.isTfaOpen},model:{value:t.form.tfa_type,callback:function(e){t.$set(t.form,"tfa_type",e)},expression:"form.tfa_type"}},[a("el-radio",{attrs:{label:"ga"}},[t._v("google-authenticator")])],1)],1),t.isShowGa?a("el-form-item",[a("div",{staticClass:"pin-code-label",attrs:{slot:"label"},slot:"label"},[a("span",[t._v("验证码")]),a("el-tooltip",{attrs:{placement:"right"}},[a("i",{staticClass:"el-icon-question tooltip"}),a("div",{attrs:{slot:"content"},slot:"content"},[a("img",{staticStyle:{width:"300px",height:"400px"},attrs:{src:"/static/image/otp-tool.png?t=1",alt:"oto工具"}})])])],1),a("span",[t._v(" 使用方法 "),a("br"),t._v(" 1. 微信搜索小程序“运维密码工具”，或扫描下方小程序码。 "),a("br"),t._v(" 2 扫描下方二维码，生成pin码。 ")]),a("div",{staticClass:"qrcode-section"},[a("img",{staticStyle:{width:"200px",height:"200px"},attrs:{src:"/static/image/mini-app-qrcode.png",alt:"微信小程序码"}}),a("img",{staticStyle:{width:"200px",height:"200px",border:"1px"},attrs:{src:t.img}}),a("p",{staticClass:"description"},[t._v(" 无法扫描二维码？ "),a("br"),t._v(" 请在手机应用中输入以下信息手动进行绑定。 "),a("el-link",{attrs:{type:"danger"}},[t._v("请把二维码保存在一个安全的地方，以免设备丢失无法访问")]),a("br"),t._v(" 账号："+t._s(t.account)+" "),a("br"),t._v(" 密钥："+t._s(t.tfa_code)+" "),a("br"),t._v(" 密钥类型：基于时间 ")],1)])]):t._e(),a("el-form-item",{attrs:{prop:"pin_code"}},[a("div",{staticClass:"pin-code-label",attrs:{slot:"label"},slot:"label"},[a("span",[t._v("pin码")]),a("el-tooltip",{attrs:{placement:"right"}},[a("i",{staticClass:"el-icon-question tooltip"}),a("div",{attrs:{slot:"content"},slot:"content"},[a("img",{staticStyle:{height:"305px",width:"174px"},attrs:{src:"/static/image/tfa-preview.png",alt:""}})])])],1),a("el-input",{model:{value:t.pin_code,callback:function(e){t.pin_code=e},expression:"pin_code"}}),a("el-link",{attrs:{type:"danger"}},[t._v("如果pin码错误，请下拉刷新小程序")])],1),a("el-form-item",[t.isTfaOpen?a("el-button",{attrs:{type:"danger"},on:{click:t.onUnBind}},[t._v("关闭两步验证")]):a("el-button",{attrs:{type:"success"},on:{click:t.onBind}},[t._v("保存两步验证设置")])],1)],1)]:t._e()],2)],1)])},n=[],o=a("5530"),i=(a("d3b7"),a("498a"),a("2f62")),r=a("2ef0"),l={components:{},data:function(){return{form:{},img:"",qrcodeLoading:!1,tfa_code:"",account:"",pin_code:""}},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user"])),{},{isTfaOpen:function(){return 1==this.user.tfa_state},isShowTfaSwitch:function(){return 1==this.form.tfa_state},isShowGa:function(){return"ga"==this.form.tfa_type&&0==this.isTfaOpen&&1==this.form.tfa_state}}),watch:{isShowTfaSwitch:"changeTFAState"},methods:{changeTFAState:function(t){var e=this;t&&!this.isTfaOpen?(this.qrcodeLoading=!0,this.$api.my.addAuthCode().then((function(t){e.img=t.img,e.tfa_code=t.hash_code,e.account=t.account,e.pin_code=""})).finally((function(){e.qrcodeLoading=!1}))):2==t&&console.log("关闭：",t)},resetForm:function(){var t=Object(r["cloneDeep"])(this.user);t||(t={}),t&&""==t.tfa_type&&(t.tfa_type="ga"),t.tfa_type="ga",this.form=t},freshAndUser:function(){var t=this;this.$api.my.info().then((function(e){e&&(t.$store.commit("user",e),t.pin_code="",t.tfa_code="",t.account="",t.img="",t.resetForm())}))},onUnBind:function(){var t=this;""!=this.pin_code.trim()?this.$api.my.unBindAuthCode({pin_code:this.pin_code}).then((function(e){"fail"==e?t.onError("验证失败！","提示信息"):"ok"==e?t.freshAndUser():t.onError("未知错误！","提示信息")})):this.$message({message:"pin码错误",type:"error",duration:8e3,showClose:!0})},onBind:function(){var t=this;""!=this.pin_code.trim()?this.$api.my.bindAuthCode({tfa_code:this.tfa_code,pin_code:this.pin_code}).then((function(e){"ok"==e?(t.onSuccess("输入正确,绑定成功!"),t.$store.commit("setForceTfa",0),t.freshAndUser()):"fail"==e?t.onError("输入错误,绑定失败!"):t.onError("绑定出错了!"),console.log("bindAuthCode v:",e)})):this.$message({message:"pin code错误",type:"error",duration:8e3,showClose:!0})}},mounted:function(){this.freshAndUser()}},c=l,u=(a("e10f"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"5ddb":function(t,e,a){"use strict";a("3004")},"5de3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"收藏",visible:t.isShow,"custom-class":"dialog-favorite",width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),a("el-form-item",{attrs:{label:"SQL"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRow:4}},model:{value:t.formData.script,callback:function(e){t.$set(t.formData,"script",e)},expression:"formData.script"}})],1),a("el-form-item",{attrs:{label:"目录"}},[a("el-tree",{attrs:{data:t.treeData,props:t.treeProps},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"tree-item hbox-between hbox-center"},[a("div",{staticClass:"left"},[t._v(t._s(s.name))]),0==s.id?a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font",attrs:{title:"新增子目录"}},[t._v("")])]):t._e()])}}])})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.hide}},[t._v("保存")])],1)],1)},n=[],o=(a("159b"),a("2ef0")),i={data:function(){return{isShow:!1,formData:{},treeData:[],treeProps:{label:"name"}}},props:{},watch:{},computed:{},methods:{show:function(t){var e=this;this.isShow=!0,this.formData=t,console.log("[dialog.favorite methods] show: ",t),this.$api.post("/api/sql/favorite/all",{dbId:t.id}).then((function(t){t=Object(o["orderBy"])(t,["pid","asc"],["id","desc"]);var a=[],s={};t.forEach((function(t){if(-1==t.pid)a.push(t);else{var e=s[t.pid];e.children=e.children||[],e.children.push(t)}s[t.id]=t})),e.treeData=a}))},hide:function(t){this.isShow=!1},onAddFolder:function(){},onEditFolder:function(){},onRemoveFolder:function(){},onSubmit:function(){}},mounted:function(){},components:{}},r=i,l=(a("3c57"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"5e49":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"append-to-body":"","custom-class":"database-edit",title:"用户/角色",visible:t.isShow,width:"900px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("span",[a("el-alert",{attrs:{title:"提示:",description:"同一用户在同个项目中只能设置一个角色,加入当前角色后自动退出其他角色。",type:"info",closable:!1,"show-icon":""}})],1),a("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:""}},[a("el-transfer",{attrs:{data:t.list,props:{key:"id",label:"name"},titles:["用户",t.role.name],"button-texts":["移出","添加"]},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)},n=[],o=a("b85c"),i=a("5530"),r=(a("a15b"),a("2f62")),l={data:function(){return{id:"",role:{},isShow:!1,formData:this.reset(),p:{},list:[],value:[]}},props:{},watch:{},computed:Object(i["a"])({},Object(r["e"])(["user"])),methods:{reset:function(){return{id:"",name:"",info:"",role_type:1}},show:function(t,e){var a=this;this.project=e,this.role=t,this.isShow=!0,this.$nextTick((function(){a.refresh()}))},hide:function(t){this.formData=this.reset(),this.isShow=!1},refresh:function(){var t=this;this.value=[],this.$api.post("/api/role/user/page",{role_id:this.role.id,project:this.project.id,page_no:-1,page_size:-1}).then((function(e){console.log(JSON.stringify(e)),t.list=e.data;var a,s=Object(o["a"])(e.data);try{for(s.s();!(a=s.n()).done;){var n=a.value;n.role_id&&t.value.push(n.id)}}catch(i){s.e(i)}finally{s.f()}}))},onSubmit:function(){var t=this;this.$api.role.relation_all(this.role,this.value.join(",")).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}))}},mounted:function(){},components:{}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"5e57":function(t,e,a){"use strict";a("7363")},"5ea6":function(t,e,a){},"5f34":function(t,e,a){},"5f51":function(t,e,a){},"5fc3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:t.isShow,title:t.termTitle,center:"",modal:!1,"destroy-on-close":!0,fullscreen:"","custom-class":"felix-dialog"},on:{"update:visible":function(e){t.isShow=e},opened:t.doOpened,open:t.doOpen,close:t.doClose}},[a("div",{ref:"terminal",staticClass:"felix-xterm"})])},n=[],o=(a("99af"),a("fcf3")),i=a("47d0"),r=a("d1f9"),l=a("408b"),c=(a("f9ab"),new i["FitAddon"]),u=new l["WebLinksAddon"],d=new r["SearchAddon"],p={name:"CompTerm",data:function(){return{log:{},id:"",isFullScreen:!1,searchKey:"",isShow:!1,ws:null,term:null,fitAddon:null,termTitle:"网页终端日志"}},watch:{visible:function(t){this.v=t}},computed:{},methods:{reset:function(){this.ws=null,this.term=null},show:function(t){this.log=t,this.isShow=!0,this.termTitle="网页终端日志:".concat(t.started_at," - ").concat(t.created_at)},onWindowResize:function(){console.log("resize"),c.fit()},doLink:function(t,e){"click"===t.type&&window.open(e)},doClose:function(){window.removeEventListener("resize",this.onWindowResize),this.ws&&this.ws.close(),this.term&&this.term.dispose(),this.id="",this.$emit("afterClose")},doOpen:function(){},doOpened:function(){this.term=new o["Terminal"]({disableStdin:!0,rows:60,fontSize:12,convertEol:!0,cursorBlink:!1,bellStyle:"sound"}),this.term.loadAddon(c),this.term.loadAddon(u),this.term.loadAddon(d),this.term.open(this.$refs.terminal),c.fit(),this.term.clear();var t=this.log.log;this.term.write(t)}}},f=p,m=a("2877"),h=Object(m["a"])(f,s,n,!1,null,null,null);e["default"]=h.exports},"60ba":function(t,e){t.exports={keywords:["ABORT_AFTER_WAIT","ABSENT","ABSOLUTE","ACCENT_SENSITIVITY","ACTION","ACTIVATION","ACTIVE","ADD","ADDRESS","ADMIN","AES","AES_128","AES_192","AES_256","AFFINITY","AFTER","AGGREGATE","ALGORITHM","ALL_CONSTRAINTS","ALL_ERRORMSGS","ALL_INDEXES","ALL_LEVELS","ALL_SPARSE_COLUMNS","ALLOW_CONNECTIONS","ALLOW_MULTIPLE_EVENT_LOSS","ALLOW_PAGE_LOCKS","ALLOW_ROW_LOCKS","ALLOW_SINGLE_EVENT_LOSS","ALLOW_SNAPSHOT_ISOLATION","ALLOWED","ALTER","ANONYMOUS","ANSI_DEFAULTS","ANSI_NULL_DEFAULT","ANSI_NULL_DFLT_OFF","ANSI_NULL_DFLT_ON","ANSI_NULLS","ANSI_PADDING","ANSI_WARNINGS","APPEND","APPLICATION","APPLICATION_LOG","ARITHABORT","ARITHIGNORE","AS","ASC","ASSEMBLY","ASYMMETRIC","ASYNCHRONOUS_COMMIT","AT","ATOMIC","ATTACH","ATTACH_REBUILD_LOG","AUDIT","AUDIT_GUID","AUTHENTICATION","AUTHORIZATION","AUTO","AUTO_CLEANUP","AUTO_CLOSE","AUTO_CREATE_STATISTICS","AUTO_SHRINK","AUTO_UPDATE_STATISTICS","AUTO_UPDATE_STATISTICS_ASYNC","AUTOMATED_BACKUP_PREFERENCE","AUTOMATIC","AVAILABILITY","AVAILABILITY_MODE","BACKUP","BACKUP_PRIORITY","BASE64","BATCHSIZE","BEGIN","BEGIN_DIALOG","BIGINT","BINARY","BINDING","BIT","BLOCKERS","BLOCKSIZE","BOUNDING_BOX","BREAK","BROKER","BROKER_INSTANCE","BROWSE","BUCKET_COUNT","BUFFER","BUFFERCOUNT","BULK","BULK_LOGGED","BY","CACHE","CALL","CALLED","CALLER","CAP_CPU_PERCENT","CASCADE","CASE","CATALOG","CATCH","CELLS_PER_OBJECT","CERTIFICATE","CHANGE_RETENTION","CHANGE_TRACKING","CHANGES","CHAR","CHARACTER","CHECK","CHECK_CONSTRAINTS","CHECK_EXPIRATION","CHECK_POLICY","CHECKALLOC","CHECKCATALOG","CHECKCONSTRAINTS","CHECKDB","CHECKFILEGROUP","CHECKIDENT","CHECKPOINT","CHECKTABLE","CLASSIFIER_FUNCTION","CLEANTABLE","CLEANUP","CLEAR","CLOSE","CLUSTER","CLUSTERED","CODEPAGE","COLLATE","COLLECTION","COLUMN","COLUMN_SET","COLUMNS","COLUMNSTORE","COLUMNSTORE_ARCHIVE","COMMIT","COMMITTED","COMPATIBILITY_LEVEL","COMPRESSION","COMPUTE","CONCAT","CONCAT_NULL_YIELDS_NULL","CONFIGURATION","CONNECT","CONSTRAINT","CONTAINMENT","CONTENT","CONTEXT","CONTINUE","CONTINUE_AFTER_ERROR","CONTRACT","CONTRACT_NAME","CONTROL","CONVERSATION","COOKIE","COPY_ONLY","COUNTER","CPU","CREATE","CREATE_NEW","CREATION_DISPOSITION","CREDENTIAL","CRYPTOGRAPHIC","CUBE","CURRENT","CURRENT_DATE","CURSOR","CURSOR_CLOSE_ON_COMMIT","CURSOR_DEFAULT","CYCLE","DATA","DATA_COMPRESSION","DATA_PURITY","DATABASE","DATABASE_DEFAULT","DATABASE_MIRRORING","DATABASE_SNAPSHOT","DATAFILETYPE","DATE","DATE_CORRELATION_OPTIMIZATION","DATEFIRST","DATEFORMAT","DATETIME","DATETIME2","DATETIMEOFFSET","DAY","DAYOFYEAR","DAYS","DB_CHAINING","DBCC","DBREINDEX","DDL_DATABASE_LEVEL_EVENTS","DEADLOCK_PRIORITY","DEALLOCATE","DEC","DECIMAL","DECLARE","DECRYPTION","DEFAULT","DEFAULT_DATABASE","DEFAULT_FULLTEXT_LANGUAGE","DEFAULT_LANGUAGE","DEFAULT_SCHEMA","DEFINITION","DELAY","DELAYED_DURABILITY","DELETE","DELETED","DENSITY_VECTOR","DENY","DEPENDENTS","DES","DESC","DESCRIPTION","DESX","DHCP","DIAGNOSTICS","DIALOG","DIFFERENTIAL","DIRECTORY_NAME","DISABLE","DISABLE_BROKER","DISABLED","DISK","DISTINCT","DISTRIBUTED","DOCUMENT","DOUBLE","DROP","DROP_EXISTING","DROPCLEANBUFFERS","DUMP","DURABILITY","DYNAMIC","EDITION","ELEMENTS","ELSE","EMERGENCY","EMPTY","EMPTYFILE","ENABLE","ENABLE_BROKER","ENABLED","ENCRYPTION","END","ENDPOINT","ENDPOINT_URL","ERRLVL","ERROR","ERROR_BROKER_CONVERSATIONS","ERRORFILE","ESCAPE","ESTIMATEONLY","EVENT","EVENT_RETENTION_MODE","EXEC","EXECUTABLE","EXECUTE","EXIT","EXPAND","EXPIREDATE","EXPIRY_DATE","EXPLICIT","EXTENDED_LOGICAL_CHECKS","EXTENSION","EXTERNAL","EXTERNAL_ACCESS","FAIL_OPERATION","FAILOVER","FAILOVER_MODE","FAILURE_CONDITION_LEVEL","FALSE","FAN_IN","FAST","FAST_FORWARD","FETCH","FIELDTERMINATOR","FILE","FILEGROUP","FILEGROWTH","FILELISTONLY","FILENAME","FILEPATH","FILESTREAM","FILESTREAM_ON","FILETABLE_COLLATE_FILENAME","FILETABLE_DIRECTORY","FILETABLE_FULLPATH_UNIQUE_CONSTRAINT_NAME","FILETABLE_NAMESPACE","FILETABLE_PRIMARY_KEY_CONSTRAINT_NAME","FILETABLE_STREAMID_UNIQUE_CONSTRAINT_NAME","FILLFACTOR","FILTERING","FIRE_TRIGGERS","FIRST","FIRSTROW","FLOAT","FMTONLY","FOLLOWING","FOR","FORCE","FORCE_FAILOVER_ALLOW_DATA_LOSS","FORCE_SERVICE_ALLOW_DATA_LOSS","FORCED","FORCEPLAN","FORCESCAN","FORCESEEK","FOREIGN","FORMATFILE","FORMSOF","FORWARD_ONLY","FREE","FREEPROCCACHE","FREESESSIONCACHE","FREESYSTEMCACHE","FROM","FULL","FULLSCAN","FULLTEXT","FUNCTION","GB","GEOGRAPHY_AUTO_GRID","GEOGRAPHY_GRID","GEOMETRY_AUTO_GRID","GEOMETRY_GRID","GET","GLOBAL","GO","GOTO","GOVERNOR","GRANT","GRIDS","GROUP","GROUP_MAX_REQUESTS","HADR","HASH","HASHED","HAVING","HEADERONLY","HEALTH_CHECK_TIMEOUT","HELP","HIERARCHYID","HIGH","HINT","HISTOGRAM","HOLDLOCK","HONOR_BROKER_PRIORITY","HOUR","HOURS","IDENTITY","IDENTITY_INSERT","IDENTITY_VALUE","IDENTITYCOL","IF","IGNORE_CONSTRAINTS","IGNORE_DUP_KEY","IGNORE_NONCLUSTERED_COLUMNSTORE_INDEX","IGNORE_TRIGGERS","IMAGE","IMMEDIATE","IMPERSONATE","IMPLICIT_TRANSACTIONS","IMPORTANCE","INCLUDE","INCREMENT","INCREMENTAL","INDEX","INDEXDEFRAG","INFINITE","INFLECTIONAL","INIT","INITIATOR","INPUT","INPUTBUFFER","INSENSITIVE","INSERT","INSERTED","INSTEAD","INT","INTEGER","INTO","IO","IP","ISABOUT","ISOLATION","JOB","KB","KEEP","KEEP_CDC","KEEP_NULLS","KEEP_REPLICATION","KEEPDEFAULTS","KEEPFIXED","KEEPIDENTITY","KEEPNULLS","KERBEROS","KEY","KEY_SOURCE","KEYS","KEYSET","KILL","KILOBYTES_PER_BATCH","LABELONLY","LANGUAGE","LAST","LASTROW","LEVEL","LEVEL_1","LEVEL_2","LEVEL_3","LEVEL_4","LIFETIME","LIMIT","LINENO","LIST","LISTENER","LISTENER_IP","LISTENER_PORT","LOAD","LOADHISTORY","LOB_COMPACTION","LOCAL","LOCAL_SERVICE_NAME","LOCK_ESCALATION","LOCK_TIMEOUT","LOGIN","LOGSPACE","LOOP","LOW","MANUAL","MARK","MARK_IN_USE_FOR_REMOVAL","MASTER","MAX_CPU_PERCENT","MAX_DISPATCH_LATENCY","MAX_DOP","MAX_DURATION","MAX_EVENT_SIZE","MAX_FILES","MAX_IOPS_PER_VOLUME","MAX_MEMORY","MAX_MEMORY_PERCENT","MAX_QUEUE_READERS","MAX_ROLLOVER_FILES","MAX_SIZE","MAXDOP","MAXERRORS","MAXLENGTH","MAXRECURSION","MAXSIZE","MAXTRANSFERSIZE","MAXVALUE","MB","MEDIADESCRIPTION","MEDIANAME","MEDIAPASSWORD","MEDIUM","MEMBER","MEMORY_OPTIMIZED","MEMORY_OPTIMIZED_DATA","MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT","MEMORY_PARTITION_MODE","MERGE","MESSAGE","MESSAGE_FORWARD_SIZE","MESSAGE_FORWARDING","MICROSECOND","MILLISECOND","MIN_CPU_PERCENT","MIN_IOPS_PER_VOLUME","MIN_MEMORY_PERCENT","MINUTE","MINUTES","MINVALUE","MIRROR","MIRROR_ADDRESS","MODIFY","MONEY","MONTH","MOVE","MULTI_USER","MUST_CHANGE","NAME","NANOSECOND","NATIONAL","NATIVE_COMPILATION","NCHAR","NEGOTIATE","NESTED_TRIGGERS","NEW_ACCOUNT","NEW_BROKER","NEW_PASSWORD","NEWNAME","NEXT","NO","NO_BROWSETABLE","NO_CHECKSUM","NO_COMPRESSION","NO_EVENT_LOSS","NO_INFOMSGS","NO_TRUNCATE","NO_WAIT","NOCHECK","NOCOUNT","NOEXEC","NOEXPAND","NOFORMAT","NOINDEX","NOINIT","NOLOCK","NON","NON_TRANSACTED_ACCESS","NONCLUSTERED","NONE","NORECOMPUTE","NORECOVERY","NORESEED","NORESET","NOREWIND","NORMAL","NOSKIP","NOTIFICATION","NOTRUNCATE","NOUNLOAD","NOWAIT","NTEXT","NTLM","NUMANODE","NUMERIC","NUMERIC_ROUNDABORT","NVARCHAR","OBJECT","OF","OFF","OFFLINE","OFFSET","OFFSETS","OLD_ACCOUNT","OLD_PASSWORD","ON","ON_FAILURE","ONLINE","ONLY","OPEN","OPEN_EXISTING","OPENTRAN","OPTIMISTIC","OPTIMIZE","OPTION","ORDER","OUT","OUTPUT","OUTPUTBUFFER","OVER","OVERRIDE","OWNER","OWNERSHIP","PAD_INDEX","PAGE","PAGE_VERIFY","PAGECOUNT","PAGLOCK","PARAMETERIZATION","PARSEONLY","PARTIAL","PARTITION","PARTITIONS","PARTNER","PASSWORD","PATH","PER_CPU","PER_NODE","PERCENT","PERMISSION_SET","PERSISTED","PHYSICAL_ONLY","PLAN","POISON_MESSAGE_HANDLING","POOL","POPULATION","PORT","PRECEDING","PRECISION","PRIMARY","PRIMARY_ROLE","PRINT","PRIOR","PRIORITY","PRIORITY_LEVEL","PRIVATE","PRIVILEGES","PROC","PROCCACHE","PROCEDURE","PROCEDURE_NAME","PROCESS","PROFILE","PROPERTY","PROPERTY_DESCRIPTION","PROPERTY_INT_ID","PROPERTY_SET_GUID","PROVIDER","PROVIDER_KEY_NAME","PUBLIC","PUT","QUARTER","QUERY","QUERY_GOVERNOR_COST_LIMIT","QUEUE","QUEUE_DELAY","QUOTED_IDENTIFIER","RAISERROR","RANGE","RAW","RC2","RC4","RC4_128","READ","READ_COMMITTED_SNAPSHOT","READ_ONLY","READ_ONLY_ROUTING_LIST","READ_ONLY_ROUTING_URL","READ_WRITE","READ_WRITE_FILEGROUPS","READCOMMITTED","READCOMMITTEDLOCK","READONLY","READPAST","READTEXT","READUNCOMMITTED","READWRITE","REAL","REBUILD","RECEIVE","RECOMPILE","RECONFIGURE","RECOVERY","RECURSIVE","RECURSIVE_TRIGGERS","REFERENCES","REGENERATE","RELATED_CONVERSATION","RELATED_CONVERSATION_GROUP","RELATIVE","REMOTE","REMOTE_PROC_TRANSACTIONS","REMOTE_SERVICE_NAME","REMOVE","REORGANIZE","REPAIR_ALLOW_DATA_LOSS","REPAIR_FAST","REPAIR_REBUILD","REPEATABLE","REPEATABLEREAD","REPLICA","REPLICATION","REQUEST_MAX_CPU_TIME_SEC","REQUEST_MAX_MEMORY_GRANT_PERCENT","REQUEST_MEMORY_GRANT_TIMEOUT_SEC","REQUIRED","RESAMPLE","RESEED","RESERVE_DISK_SPACE","RESET","RESOURCE","RESTART","RESTORE","RESTRICT","RESTRICTED_USER","RESULT","RESUME","RETAINDAYS","RETENTION","RETURN","RETURNS","REVERT","REVOKE","REWIND","REWINDONLY","ROBUST","ROLE","ROLLBACK","ROLLUP","ROOT","ROUTE","ROW","ROWCOUNT","ROWGUIDCOL","ROWLOCK","ROWS","ROWS_PER_BATCH","ROWTERMINATOR","ROWVERSION","RSA_1024","RSA_2048","RSA_512","RULE","SAFE","SAFETY","SAMPLE","SAVE","SCHEDULER","SCHEMA","SCHEMA_AND_DATA","SCHEMA_ONLY","SCHEMABINDING","SCHEME","SCROLL","SCROLL_LOCKS","SEARCH","SECOND","SECONDARY","SECONDARY_ONLY","SECONDARY_ROLE","SECONDS","SECRET","SECURITY_LOG","SECURITYAUDIT","SELECT","SELECTIVE","SELF","SEND","SENT","SEQUENCE","SERIALIZABLE","SERVER","SERVICE","SERVICE_BROKER","SERVICE_NAME","SESSION","SESSION_TIMEOUT","SET","SETS","SETUSER","SHOW_STATISTICS","SHOWCONTIG","SHOWPLAN","SHOWPLAN_ALL","SHOWPLAN_TEXT","SHOWPLAN_XML","SHRINKDATABASE","SHRINKFILE","SHUTDOWN","SID","SIGNATURE","SIMPLE","SINGLE_BLOB","SINGLE_CLOB","SINGLE_NCLOB","SINGLE_USER","SINGLETON","SIZE","SKIP","SMALLDATETIME","SMALLINT","SMALLMONEY","SNAPSHOT","SORT_IN_TEMPDB","SOURCE","SPARSE","SPATIAL","SPATIAL_WINDOW_MAX_CELLS","SPECIFICATION","SPLIT","SQL","SQL_VARIANT","SQLPERF","STANDBY","START","START_DATE","STARTED","STARTUP_STATE","STAT_HEADER","STATE","STATEMENT","STATIC","STATISTICAL_SEMANTICS","STATISTICS","STATISTICS_INCREMENTAL","STATISTICS_NORECOMPUTE","STATS","STATS_STREAM","STATUS","STATUSONLY","STOP","STOP_ON_ERROR","STOPAT","STOPATMARK","STOPBEFOREMARK","STOPLIST","STOPPED","SUBJECT","SUBSCRIPTION","SUPPORTED","SUSPEND","SWITCH","SYMMETRIC","SYNCHRONOUS_COMMIT","SYNONYM","SYSNAME","SYSTEM","TABLE","TABLERESULTS","TABLESAMPLE","TABLOCK","TABLOCKX","TAKE","TAPE","TARGET","TARGET_RECOVERY_TIME","TB","TCP","TEXT","TEXTIMAGE_ON","TEXTSIZE","THEN","THESAURUS","THROW","TIES","TIME","TIMEOUT","TIMER","TIMESTAMP","TINYINT","TO","TOP","TORN_PAGE_DETECTION","TRACEOFF","TRACEON","TRACESTATUS","TRACK_CAUSALITY","TRACK_COLUMNS_UPDATED","TRAN","TRANSACTION","TRANSFER","TRANSFORM_NOISE_WORDS","TRIGGER","TRIPLE_DES","TRIPLE_DES_3KEY","TRUE","TRUNCATE","TRUNCATEONLY","TRUSTWORTHY","TRY","TSQL","TWO_DIGIT_YEAR_CUTOFF","TYPE","TYPE_WARNING","UNBOUNDED","UNCHECKED","UNCOMMITTED","UNDEFINED","UNIQUE","UNIQUEIDENTIFIER","UNKNOWN","UNLIMITED","UNLOAD","UNSAFE","UPDATE","UPDATETEXT","UPDATEUSAGE","UPDLOCK","URL","USE","USED","USER","USEROPTIONS","USING","VALID_XML","VALIDATION","VALUE","VALUES","VARBINARY","VARCHAR","VARYING","VERIFYONLY","VERSION","VIEW","VIEW_METADATA","VIEWS","VISIBILITY","WAIT_AT_LOW_PRIORITY","WAITFOR","WEEK","WEIGHT","WELL_FORMED_XML","WHEN","WHERE","WHILE","WINDOWS","WITH","WITHIN","WITHOUT","WITNESS","WORK","WORKLOAD","WRITETEXT","XACT_ABORT","XLOCK","XMAX","XMIN","XML","XMLDATA","XMLNAMESPACES","XMLSCHEMA","XQUERY","XSINIL","YEAR","YMAX","YMIN"],operators:["ALL","AND","ANY","BETWEEN","EXISTS","IN","LIKE","NOT","OR","SOME","EXCEPT","INTERSECT","UNION","APPLY","CROSS","FULL","INNER","JOIN","LEFT","OUTER","RIGHT","CONTAINS","FREETEXT","IS","NULL","PIVOT","UNPIVOT","MATCHED"],functions:["AVG","CHECKSUM_AGG","COUNT","COUNT_BIG","GROUPING","GROUPING_ID","MAX","MIN","SUM","STDEV","STDEVP","VAR","VARP","CUME_DIST","FIRST_VALUE","LAG","LAST_VALUE","LEAD","PERCENTILE_CONT","PERCENTILE_DISC","PERCENT_RANK","COLLATE","COLLATIONPROPERTY","TERTIARY_WEIGHTS","FEDERATION_FILTERING_VALUE","CAST","CONVERT","PARSE","TRY_CAST","TRY_CONVERT","TRY_PARSE","ASYMKEY_ID","ASYMKEYPROPERTY","CERTPROPERTY","CERT_ID","CRYPT_GEN_RANDOM","DECRYPTBYASYMKEY","DECRYPTBYCERT","DECRYPTBYKEY","DECRYPTBYKEYAUTOASYMKEY","DECRYPTBYKEYAUTOCERT","DECRYPTBYPASSPHRASE","ENCRYPTBYASYMKEY","ENCRYPTBYCERT","ENCRYPTBYKEY","ENCRYPTBYPASSPHRASE","HASHBYTES","IS_OBJECTSIGNED","KEY_GUID","KEY_ID","KEY_NAME","SIGNBYASYMKEY","SIGNBYCERT","SYMKEYPROPERTY","VERIFYSIGNEDBYCERT","VERIFYSIGNEDBYASYMKEY","CURSOR_STATUS","DATALENGTH","IDENT_CURRENT","IDENT_INCR","IDENT_SEED","IDENTITY","SQL_VARIANT_PROPERTY","CURRENT_TIMESTAMP","DATEADD","DATEDIFF","DATEFROMPARTS","DATENAME","DATEPART","DATETIME2FROMPARTS","DATETIMEFROMPARTS","DATETIMEOFFSETFROMPARTS","DAY","EOMONTH","GETDATE","GETUTCDATE","ISDATE","MONTH","SMALLDATETIMEFROMPARTS","SWITCHOFFSET","SYSDATETIME","SYSDATETIMEOFFSET","SYSUTCDATETIME","TIMEFROMPARTS","TODATETIMEOFFSET","YEAR","CHOOSE","COALESCE","IIF","NULLIF","ABS","ACOS","ASIN","ATAN","ATN2","CEILING","COS","COT","DEGREES","EXP","FLOOR","LOG","LOG10","PI","POWER","RADIANS","RAND","ROUND","SIGN","SIN","SQRT","SQUARE","TAN","APP_NAME","APPLOCK_MODE","APPLOCK_TEST","ASSEMBLYPROPERTY","COL_LENGTH","COL_NAME","COLUMNPROPERTY","DATABASE_PRINCIPAL_ID","DATABASEPROPERTYEX","DB_ID","DB_NAME","FILE_ID","FILE_IDEX","FILE_NAME","FILEGROUP_ID","FILEGROUP_NAME","FILEGROUPPROPERTY","FILEPROPERTY","FULLTEXTCATALOGPROPERTY","FULLTEXTSERVICEPROPERTY","INDEX_COL","INDEXKEY_PROPERTY","INDEXPROPERTY","OBJECT_DEFINITION","OBJECT_ID","OBJECT_NAME","OBJECT_SCHEMA_NAME","OBJECTPROPERTY","OBJECTPROPERTYEX","ORIGINAL_DB_NAME","PARSENAME","SCHEMA_ID","SCHEMA_NAME","SCOPE_IDENTITY","SERVERPROPERTY","STATS_DATE","TYPE_ID","TYPE_NAME","TYPEPROPERTY","DENSE_RANK","NTILE","RANK","ROW_NUMBER","PUBLISHINGSERVERNAME","OPENDATASOURCE","OPENQUERY","OPENROWSET","OPENXML","CERTENCODED","CERTPRIVATEKEY","CURRENT_USER","HAS_DBACCESS","HAS_PERMS_BY_NAME","IS_MEMBER","IS_ROLEMEMBER","IS_SRVROLEMEMBER","LOGINPROPERTY","ORIGINAL_LOGIN","PERMISSIONS","PWDENCRYPT","PWDCOMPARE","SESSION_USER","SESSIONPROPERTY","SUSER_ID","SUSER_NAME","SUSER_SID","SUSER_SNAME","SYSTEM_USER","USER","USER_ID","USER_NAME","ASCII","CHAR","CHARINDEX","CONCAT","DIFFERENCE","FORMAT","LEFT","LEN","LOWER","LTRIM","NCHAR","PATINDEX","QUOTENAME","REPLACE","REPLICATE","REVERSE","RIGHT","RTRIM","SOUNDEX","SPACE","STR","STUFF","SUBSTRING","UNICODE","UPPER","BINARY_CHECKSUM","CHECKSUM","CONNECTIONPROPERTY","CONTEXT_INFO","CURRENT_REQUEST_ID","ERROR_LINE","ERROR_NUMBER","ERROR_MESSAGE","ERROR_PROCEDURE","ERROR_SEVERITY","ERROR_STATE","FORMATMESSAGE","GETANSINULL","GET_FILESTREAM_TRANSACTION_CONTEXT","HOST_ID","HOST_NAME","ISNULL","ISNUMERIC","MIN_ACTIVE_ROWVERSION","NEWID","NEWSEQUENTIALID","ROWCOUNT_BIG","XACT_STATE","TEXTPTR","TEXTVALID","COLUMNS_UPDATED","EVENTDATA","TRIGGER_NESTLEVEL","UPDATE","CHANGETABLE","CHANGE_TRACKING_CONTEXT","CHANGE_TRACKING_CURRENT_VERSION","CHANGE_TRACKING_IS_COLUMN_IN_MASK","CHANGE_TRACKING_MIN_VALID_VERSION","CONTAINSTABLE","FREETEXTTABLE","SEMANTICKEYPHRASETABLE","SEMANTICSIMILARITYDETAILSTABLE","SEMANTICSIMILARITYTABLE","FILETABLEROOTPATH","GETFILENAMESPACEPATH","GETPATHLOCATOR","PATHNAME","GET_TRANSMISSION_STATUS"]}},"60c3":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"apps"},[a("el-row",{staticStyle:{"margin-left":"-6px","margin-right":"-6px"},attrs:{type:"flex"}},[a("div",{staticClass:"el-col el-col-6 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-danger"},[t._v(" 今日查询量 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.today_count))])])]),a("div",{staticClass:"el-col el-col-6 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-success"},[t._v(" 项目 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.project_count))])])]),a("div",{staticClass:"el-col el-col-6 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-info"},[t._v(" 数据源 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.db_count))])])]),a("div",{staticClass:"el-col el-col-6 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-warning"},[t._v(" 用户数 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.user_count))])])])]),a("el-row",{attrs:{gutter:0}},[a("el-col",{staticClass:"chart",attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{padding:"35px"}},[t._v(" 数据源类型 ")])]),a("div",[a("ve-ring",t._b({attrs:{data:t.dbTypeStat,title:t.dbTypeTitle}},"ve-ring",t.pubSetting1,!1))],1)])],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 访问量 "),a("el-date-picker",{staticStyle:{float:"right","margin-bottom":"5px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.$constant.pickOptions},on:{change:t.queryStat},model:{value:t.query.logTimeRange,callback:function(e){t.$set(t.query,"logTimeRange",e)},expression:"query.logTimeRange"}})],1)]),a("div",[a("ve-line",t._b({attrs:{data:t.logTimeStat,toolbox:t.toolbox,title:t.logTimeTitle}},"ve-line",t.pubSetting1,!1))],1)])],1)],1),a("el-row",{staticStyle:{"margin-top":"10px"}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 其他统计 "),a("el-date-picker",{staticStyle:{float:"right","margin-bottom":"5px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.$constant.pickOptions},on:{change:t.queryToday},model:{value:t.query.todayRange,callback:function(e){t.$set(t.query,"todayRange",e)},expression:"query.todayRange"}})],1)]),a("div",[a("el-row",{attrs:{gutter:0}},[a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-bar",t._b({attrs:{data:t.dbStat,"legend-visible":!1,settings:t.dbStatSettings,title:t.dbTitle}},"ve-bar",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-pie",t._b({attrs:{data:t.logStat,"legend-visible":!1,title:t.logTitle}},"ve-pie",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-pie",t._b({attrs:{data:t.typeStat,"legend-visible":!1,title:t.typeTitle}},"ve-pie",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-bar",t._b({attrs:{data:t.userStat,"legend-visible":!1,settings:t.appStatSettings,title:t.userTitle}},"ve-bar",t.pubSetting,!1))],1)],1)],1)])],1)],1)},n=[],o=a("b85c"),i=(a("b0c0"),a("5743")),r=a("2819"),l=a("2e0b"),c={data:function(){return this.toolbox={feature:{magicType:{type:["line","bar"]}}},{query:{start:"",end:"",todayRange:[],logTimeRange:[],dbUseRange:[]},stat:{db_count:0,app_count:0,user_count:0,today_count:0,project_count:0},dbTypeStat:{columns:["类型","数量"],rows:[]},dbTypeTitle:{text:""},typeTitle:{text:"脚本类型统计",textStyle:{fontStyle:"normal",fontWeight:"normal",fontSize:16},default:10},logTimeTitle:{text:"",range:{start:"",end:""}},logStat:{columns:["类型","数量"],rows:[]},logTitle:{text:"失败率统计",textStyle:{fontStyle:"normal",fontWeight:"normal",fontSize:16}},logTimeStat:{columns:["时间","访问量"],rows:[]},dbStat:{columns:["数据源","访问量"],rows:[]},dbTitle:{text:"数据源使用量",textStyle:{fontStyle:"normal",fontWeight:"normal",fontSize:16}},dbStatSettings:{dataOrder:{label:"访问量",order:"desc"}},appTitle:{text:"当日数据导出量"},userStat:{columns:["用户名","访问量"],rows:[]},typeStat:{columns:["操作","数量"],rows:[]},userTitle:{text:"用户执行统计",textStyle:{fontStyle:"normal",fontWeight:"normal",fontSize:16}},appStatSettings:{dataOrder:{label:"访问量",order:"desc"}},pubSetting1:{height:"350px",width:"100%"},pubSetting:{height:"400px",width:"100%"},chartData1:{columns:["数据源","次数"],rows:[{"次数":1393,"数据源":"查询库"},{"次数":3530,"数据源":"用户中心"},{"次数":2923,"数据源":"订单库"},{"次数":1723,"数据源":"淘宝api"},{"次数":3792,"数据源":"日志"},{"次数":4593,"数据源":"eslog"}]},chartData:{columns:["日期","访问用户","下单用户","下单率"],rows:[{"日期":"1/1","访问用户":1393,"下单用户":1093,"下单率":.32},{"日期":"1/2","访问用户":3530,"下单用户":3230,"下单率":.26},{"日期":"1/3","访问用户":2923,"下单用户":2623,"下单率":.76},{"日期":"1/4","访问用户":1723,"下单用户":1423,"下单率":.49},{"日期":"1/5","访问用户":3792,"下单用户":3492,"下单率":.323},{"日期":"1/6","访问用户":4593,"下单用户":4293,"下单率":.78}]}}},methods:{showRange:function(t){console.log("range:",t);var e="时间";if(t&&t.length>1){var a=i["a"].utc2date(t[0]),s=i["a"].utc2date(t[1]);e=a+"-"+s}return e},onChangeLogTimeRange:function(t){console.log("v:",t)},queryStat:function(t){var e=this;if(this.query.logTimeRange&&this.query.logTimeRange.length>1){var a=i["a"].utc2date(this.query.logTimeRange[0]),s=i["a"].utc2date(this.query.logTimeRange[1]);this.$api.post("/api/sys/stat",{type:"log_time_stat",start:a,end:s}).then((function(t){var a,s=[],n=Object(o["a"])(t);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"时间":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}e.logTimeStat.rows=s}))}},queryToday:function(){var t=this;if(this.query.todayRange&&this.query.todayRange.length>1){var e=i["a"].utc2date(this.query.todayRange[0]),a=i["a"].utc2date(this.query.todayRange[1]);this.$api.post("/api/sys/stat",{type:"log_stat",start:e,end:a}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"类型":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.logStat.rows=s})),this.$api.post("/api/sys/stat",{type:"db_stat_list",start:e,end:a}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"数据源":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.dbStat.rows=s})),this.$api.post("/api/sys/stat",{type:"type_stat",start:e,end:a}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"操作":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.typeStat.rows=s})),this.$api.post("/api/sys/stat",{type:"user_stat_list",start:e,end:a}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"用户名":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.userStat.rows=s}))}},queryBase:function(){var t=this;this.$api.post("/api/sys/stat",{type:"base_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.db_count=e.db_count,t.stat.user_count=e.user_count,t.stat.project_count=e.project_count})),this.$api.post("/api/sys/stat",{type:"total_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.today_count=e.hits})),this.$api.post("/api/sys/stat",{type:"db_type_stat",start:this.query.start,end:this.query.end}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"类型":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}console.log("rows:xxxx ",s),t.dbTypeStat.rows=s}))},init:function(){this.queryBase(),this.queryStat(),this.queryToday()}},components:{ElRow:l["a"],VeLine:r["VeLine"],VeBar:r["VeBar"],VePie:r["VePie"],VeRing:r["VeRing"]},mounted:function(){var t=this,e=i["a"].timeRange("now/d to now/d");this.query.todayRange=e,e&&e.length>1&&(this.query.start=i["a"].utc2date(e[0]),this.query.end=i["a"].utc2date(e[1])),this.query.logTimeRange=i["a"].timeRange("now-7d to now"),this.$nextTick((function(){t.init()}))}},u=c,d=(a("e266"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,"56878812",null);e["default"]=p.exports},"60e9":function(t,e,a){},"60fe":function(t,e,a){"use strict";a.d(e,"g",(function(){return s})),a.d(e,"i",(function(){return n})),a.d(e,"a",(function(){return o})),a.d(e,"h",(function(){return i})),a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return l})),a.d(e,"f",(function(){return c})),a.d(e,"d",(function(){return u})),a.d(e,"e",(function(){return d}));var s="PROJECT_MANAGE",n=[1,2,3,4,9,s],o=[1,2,3,4,s],i=[s],r=[1,2,3,4],l="project-index",c="project-",u="personal-",d="personal-notice-"},"610a":function(t,e,a){"use strict";a("b198")},6150:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"mask-edit-dialog",attrs:{title:t.id?"编辑脱敏":"新增脱敏",visible:t.isShow,width:"30%"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formDataRules,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"name",label:"名称"}},[a("el-input",{attrs:{placeholder:"请输入脱敏模板名称",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{prop:"config",label:"配置"}},[a("el-input",{attrs:{placeholder:"请输入模板配置",clearable:""},model:{value:t.formData.config,callback:function(e){t.$set(t.formData,"config",e)},expression:"formData.config"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onHide}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定")])],1)],1)},n=[],o={data:function(){return{id:"",isShow:!1,formData:this.reset(),formDataRules:{name:[{required:!0,message:"请输入{description}"}],dateType:[{required:!0,message:"请输入{description}"}],maskCode:[{required:!0,message:"请输入{description}"}],config:[{required:!0,message:"请输入{description}"}]}}},props:{},watch:{},computed:{},methods:{reset:function(){return{id:"",name:"",dateType:"",maskCode:"",config:""}},show:function(t){var e=this;this.formData=this.reset(),t?this.$api.mask.one(t).then((function(a){e.id=t,e.formData=a,e.isShow=!0})):(this.id="",this.isShow=!0),this.$nextTick((function(){e.$refs.form.clearValidate()}))},onHide:function(){this.isShow=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&t.$api.mask.edit(t.formData).then((function(e){t.isShow=!1,t.onSuccess("提交成功"),t.$emit("success")}))}))}},mounted:function(){},components:{}},i=o,r=(a("6950"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"630f":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-camera",use:"d2-camera-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-camera"><path d="M899.9 938.7H124.1C55.7 938.7 0 883 0 814.6V273.4C0 205 55.7 149.3 124.1 149.3h68.7l85.3-106.7h467.7l85.3 106.7h68.7c68.4 0 124.1 55.7 124.1 124.1v541.1c0.1 68.5-55.6 124.2-124 124.2z m-775.8-704c-21.4 0-38.8 17.4-38.8 38.8v541.1c0 21.4 17.4 38.8 38.8 38.8h775.8c21.4 0 38.8-17.4 38.8-38.8V273.4c0-21.4-17.4-38.8-38.8-38.8H790.2L704.8 128H319.2l-85.3 106.7H124.1z" fill="#3688FF" /><path d="M512 768c-117.6 0-213.3-95.7-213.3-213.3S394.4 341.3 512 341.3 725.3 437 725.3 554.7 629.6 768 512 768z m0-341.3c-70.6 0-128 57.4-128 128s57.4 128 128 128 128-57.4 128-128-57.4-128-128-128z" fill="#5F6379" /><path d="M810.7 341.3m-42.7 0a42.7 42.7 0 1 0 85.4 0 42.7 42.7 0 1 0-85.4 0Z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},"63e8":function(t,e,a){"use strict";a("81ee")},"64b2":function(t,e,a){},"64c0":function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("d3b7"),a("4de4"),a("d81d"),a("7db09"),a("b0c0"),a("a434"),a("c740"),a("159b"),a("2ca0"),a("caad"),a("2532"),a("99af"),a("2ef0")),o=a("a18c"),i=a("d708"),r=a("60fe"),l=function(t){return Object(n["get"])(t,"meta.cache",!1)};e["default"]={namespaced:!0,state:{pool:[],opened:Object(n["get"])(i["a"],"page.opened",[]),openedLoaded:!1,current:"",keepAlive:[]},actions:{isLoaded:function(t){var e=t.state;return e.openedLoaded?Promise.resolve():new Promise((function(t){var a=setInterval((function(){e.openedLoaded&&t(clearInterval(a))}),10)}))},openedLoad:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s,r,l,c,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.commit,r=t.dispatch,e.next=3,r("d2admin/db/get",{dbName:"sys",path:"page.opened",defaultValue:i["a"].page.opened,user:!0,project:!1},{root:!0});case 3:l=e.sent,c=[],u=Object(n["uniqBy"])(l,"name"),a.opened=u.map((function(t){if(!t)return{};if("/index"===t.fullPath)return c.push(1),t;var e=a.pool.find((function(e){return e.name===t.name}));return c.push(e?1:0),Object(n["merge"])({},t,e)})).filter((function(t,e){return 1===c[e]})),a.current&&(d=a.opened.find((function(t){return t.fullPath===a.current})),d||o["a"].push("/")),a.openedLoaded=!0,s("keepAliveRefresh");case 10:case"end":return e.stop()}}),e)})))()},opened2db:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t.state,s=t.dispatch,s("d2admin/db/set",{dbName:"sys",path:"page.opened",value:a.opened,user:!0,project:!1},{root:!0});case 2:case"end":return e.stop()}}),e)})))()},openedUpdate:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,o,i,r,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,t.commit,n=t.dispatch,o=e.index,i=e.name,r=e.params,l=e.query,c=e.fullPath,u=e.meta,d=s.opened[o],d.params=r||d.params,d.query=l||d.query,d.fullPath=c||d.fullPath,d.meta=u||d.meta,d.name=i||d.name,s.opened.splice(o,1,d),a.next=11,n("opened2db");case 11:case"end":return a.stop()}}),a)})))()},openedSort:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,o,i,r,l,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,t.commit,o=t.dispatch,i=e.oldIndex,r=e.newIndex,l=s.opened[i],c=Object(n["cloneDeep"])(s.opened),c.splice(i,1),c.splice(r,0,l),s.opened=c,a.next=9,o("opened2db");case 9:case"end":return a.stop()}}),a)})))()},add:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,o,i,r,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.commit,o=t.dispatch,i=e.tag,r=e.params,c=e.query,u=e.fullPath,d=i,d.params=r||d.params,d.query=c||d.query,d.fullPath=u||d.fullPath,s.opened.push(d),l(d)&&n("keepAlivePush",i.name),a.next=10,o("opened2db");case 10:case"end":return a.stop()}}),a)})))()},open:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,o,i,c,u,d,p,f,m,h,b,_;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.state,o=t.commit,i=t.dispatch,c=e.name,u=e.params,d=e.query,p=e.fullPath,f=e.meta,m=s.opened,h=0,b=m.find((function(t,e){var a=t.fullPath===p,s=Object(n["startsWith"])(t.name,r["f"])&&Object(n["startsWith"])(c,r["f"])||!Object(n["startsWith"])(t.name,r["e"])&&Object(n["startsWith"])(t.name,r["d"])&&Object(n["startsWith"])(c,r["d"])||Object(n["startsWith"])(t.name,r["e"])&&Object(n["startsWith"])(c,r["e"]);return s&&(a=!0),h=a?e:h,a})),!b){a.next=10;break}return a.next=8,i("openedUpdate",{index:h,name:c,params:u,query:d,fullPath:p});case 8:a.next=14;break;case 10:if(_=s.pool.find((function(t){return t.name===c})),!_){a.next=14;break}return a.next=14,i("add",{tag:Object(n["merge"])({},_),params:u,query:d,fullPath:p});case 14:l({meta:f})&&o("keepAlivePush",c),o("currentSet",p);case 16:case"end":return a.stop()}}),a)})))()},close:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,i,r,l,c,u,d,p,f,m,h,b,_,g,v,y;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.state,n=t.commit,i=t.dispatch,r=e.tagName,l={},c=s.current===r,!c){a.next=14;break}u=s.opened.length,d=0;case 7:if(!(d<u)){a.next=14;break}if(s.opened[d].fullPath!==r){a.next=11;break}return l=d<u-1?s.opened[d+1]:s.opened[d-1],a.abrupt("break",14);case 11:d++,a.next=7;break;case 14:return p=s.opened.findIndex((function(t){return t.fullPath===r})),p>=0&&(n("keepAliveRemove",s.opened[p].name),s.opened.splice(p,1)),a.next=18,i("opened2db");case 18:if(!c){a.next=23;break}return f=l,m=f.name,h=void 0===m?"index":m,b=f.params,_=void 0===b?{}:b,g=f.query,v=void 0===g?{}:g,y={name:h,params:_,query:v},a.next=23,o["a"].push(y);case 23:case"end":return a.stop()}}),a)})))()},update:function(t,e){var a=t.state,s=e.tagName,n=e.title,o=a.opened.findIndex((function(t){return t.fullPath===s}));0!==o&&n&&a.opened[o]&&(a.opened[o].meta.title=n)},closeLeft:function(t){var e=arguments;return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,i,r,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.state,n=t.commit,i=t.dispatch,r=e.length>1&&void 0!==e[1]?e[1]:{},l=r.pageSelect,c=l||s.current,u=0,s.opened.forEach((function(t,e){t.fullPath===c&&(u=e)})),!(u>0)){a.next=15;break}d=s.opened.length-1;case 7:if(!(d>=0)){a.next=15;break}if(!("index"===s.opened[d].name||d>=u)){a.next=10;break}return a.abrupt("continue",12);case 10:n("keepAliveRemove",s.opened[d].name),s.opened.splice(d,1);case 12:d--,a.next=7;break;case 15:return a.next=17,i("opened2db");case 17:if(s.current=c,o["a"].app.$route.fullPath===c){a.next=21;break}return a.next=21,o["a"].push(c);case 21:case"end":return a.stop()}}),a)})))()},closeRight:function(t){var e=arguments;return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,i,r,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s=t.state,n=t.commit,i=t.dispatch,r=e.length>1&&void 0!==e[1]?e[1]:{},l=r.pageSelect,c=l||s.current,u=0,s.opened.forEach((function(t,e){t.fullPath===c&&(u=e)})),d=s.opened.length-1;case 6:if(!(d>=0)){a.next=14;break}if(!("index"===s.opened[d].name||u>=d)){a.next=9;break}return a.abrupt("continue",11);case 9:n("keepAliveRemove",s.opened[d].name),s.opened.splice(d,1);case 11:d--,a.next=6;break;case 14:return a.next=16,i("opened2db");case 16:if(s.current=c,o["a"].app.$route.fullPath===c){a.next=20;break}return a.next=20,o["a"].push(c);case 20:case"end":return a.stop()}}),a)})))()},closeOther:function(t){var e=arguments;return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,i,r,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s=t.state,n=t.commit,i=t.dispatch,r=e.length>1&&void 0!==e[1]?e[1]:{},l=r.pageSelect,c=l||s.current,u=0,s.opened.forEach((function(t,e){t.fullPath===c&&(u=e)})),d=s.opened.length-1;case 6:if(!(d>=0)){a.next=14;break}if("index"!==s.opened[d].name&&u!==d){a.next=9;break}return a.abrupt("continue",11);case 9:n("keepAliveRemove",s.opened[d].name),s.opened.splice(d,1);case 11:d--,a.next=6;break;case 14:return a.next=16,i("opened2db");case 16:if(s.current=c,o["a"].app.$route.fullPath===c){a.next=20;break}return a.next=20,o["a"].push(c);case 20:case"end":return a.stop()}}),a)})))()},closeAll:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t.state,s=t.commit,n=t.dispatch,i=a.opened.length-1;case 2:if(!(i>=0)){e.next=10;break}if("index"!==a.opened[i].name){e.next=5;break}return e.abrupt("continue",7);case 5:s("keepAliveRemove",a.opened[i].name),a.opened.splice(i,1);case 7:i--,e.next=2;break;case 10:return e.next=12,n("opened2db");case 12:if("index"===o["a"].app.$route.name){e.next=15;break}return e.next=15,o["a"].push({name:"index"});case 15:case"end":return e.stop()}}),e)})))()}},mutations:{keepAliveRefresh:function(t){t.keepAlive=t.opened.filter((function(t){return l(t)})).map((function(t){return t.name}))},keepAliveRemove:function(t,e){var a=Object(n["cloneDeep"])(t.keepAlive),s=a.findIndex((function(t){return t===e}));-1!==s&&(a.splice(s,1),t.keepAlive=a)},keepAlivePush:function(t,e){var a=Object(n["cloneDeep"])(t.keepAlive);a.push(e),e.startsWith(r["f"])&&!a.includes(r["c"])&&(e="".concat(e,"-").concat(o["a"].app.$route.params.id),a.push(r["c"])),t.keepAlive=Object(n["uniq"])(a)},keepAliveProjectSet:function(t,e){var a=e.from,s=e.to;console.log("form, to ,",a,s);var o=t.keepAlive.includes(a),i=t.keepAlive.includes(s);if(o&&!i)t.keepAlive=t.keepAlive.filter((function(t){return t!==r["c"]}));else if(!o&&i){var l=Object(n["cloneDeep"])(t.keepAlive);l.push(r["c"]),t.keepAlive=Object(n["uniq"])(l)}},keepAliveClean:function(t){t.keepAlive=[]},currentSet:function(t,e){t.current=e},init:function(t,e){var a=[],s=function t(e){e.forEach((function(e){if(e.children&&e.children.length>0)t(e.children);else if(!e.hidden){var s=e.meta,n=e.name,o=e.path;a.push({meta:s,name:n,path:o})}}))};s(e),t.pool=a}}}},"64da":function(t,e,a){"use strict";a("5202")},"64ff":function(t,e,a){},6501:function(t,e,a){"use strict";a("67456")},"652d":function(t,e,a){},"6547a":function(t,e,a){},"657c":function(t,e,a){},"65bc":function(t,e,a){"use strict";a("b99b")},"660b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:t.headText}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-instance-list"},[a("el-tree",{ref:"instanceList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"",lazy:"","empty-text":t.db?"没有关联数据库":"请选择角色","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between",on:{click:function(e){return t.onClick(s)}}},[a("div",{staticClass:"left"},[t._v(" "+t._s(s.name)+" ")])])}}])})],1)],2)},n=[],o=(a("4de4"),a("b0c0"),{data:function(){return{cur_name:"",filterText:"",dataList:[],owner:{},db:{},treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:{headText:{type:String,default:"数据集"}},watch:{filterText:function(t){this.$refs.instanceList.filter(t)}},methods:{doRefresh:function(t){this.db=t,this.refresh()},filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},refresh:function(){var t=this;this.$api.auto.tree(this.db.id,"",!0,!1,null).then((function(e){t.dataList=e}))},onClick:function(t,e){console.log("onClick data:",t,"   data:",t),this.cur_name=t.name,this.owner=t,this.$emit("owner",t)}}}),i=o,r=(a("bbbb"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"1ba7cfab",null);e["default"]=l.exports},6616:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-theme",use:"d2-theme-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-theme"><path d="M512 65.408c-327.008 0-448 285.216-448 445.088s116.288 448 438.496 448c0 0 80.096 1.408 80.096-70.592s-36-48.992-36-100.8c0-51.904 36-74.912 53.312-74.912s131.104 8.608 194.496-15.904C857.696 671.904 960 594.08 960 461.6c0-116.704-120.992-396.192-448-396.192zM238.912 512a77.76 77.76 0 1 1-0.032-155.616A77.76 77.76 0 0 1 238.912 512z m146.688-192.512a77.76 77.76 0 1 1-0.032-155.616 77.76 77.76 0 0 1 0.032 155.616z m249.504 0a77.824 77.824 0 1 1 0.064-155.648 77.824 77.824 0 0 1-0.064 155.648zM783.2 512a77.824 77.824 0 1 1 0.064-155.648A77.824 77.824 0 0 1 783.2 512z" p-id="3469" /></symbol>'});i.a.add(r);e["default"]=r},6618:function(t,e,a){},6649:function(t,e,a){"use strict";a("c3db")},"668d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-login-page bg-gray-50 flex h-screen ",staticStyle:{"min-width":"900px"}},[a("div",{staticClass:"relative bg-image left company-info w-2/5 ",staticStyle:{"max-width":"570px","background-repeat":"no-repeat","background-size":"100% 100%","background-position":"center center"},style:t.companyInfo},[a("div",{staticClass:"group h-full  bg-black bg-opacity-25 text-white px-10 pt-10 pb-20 flex flex-col justify-between"},[a("div",{staticClass:"absolute invisible group-hover:visible",staticStyle:{right:"10px",top:"10px"},on:{click:t.switchBgHandle}},[t._m(0)]),a("div",{staticClass:"company-logo",staticStyle:{width:"200px"}},[a("div",{staticClass:"flex items-center"},[a("img",{staticClass:"mr-3",staticStyle:{width:"28px"},attrs:{src:t.ENV_DATA.LOGIN_LOGO}}),a("h2",{staticStyle:{"font-size":"20px"}},[t._v(t._s(t.ENV_DATA.NAME))])])]),a("div",{staticClass:"flex justify-end"},[a("div",{staticClass:"w-4/5 "},[a("div",{staticClass:"description text-base"},[t._v(" "+t._s(t.bgItem.text)+" ")])])])])]),a("div",{staticClass:"right login-section flex-1 flex justify-center  items-center"},[a("div",{staticClass:"login-container bg-white p-10 shadow rounded-md ",staticStyle:{width:"450px"}},[t._m(1),a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formRules}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"账号","auto-complete":"on",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{prop:"pwd"}},[a("el-input",{attrs:{"prefix-icon":"el-icon-lock",type:"password",placeholder:"密码",clearable:"","show-password":!0,"auto-complete":"new-password"},model:{value:t.formData.pwd,callback:function(e){t.$set(t.formData,"pwd",e)},expression:"formData.pwd"}})],1),a("el-form-item",{attrs:{prop:"code"}},[a("div",{staticClass:"flex items-center"},[a("el-input",{attrs:{"prefix-icon":"el-icon-thumb",placeholder:"验证码",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSubmit.apply(null,arguments)}},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}}),a("div",{staticClass:"ml-3 cursor-pointer",attrs:{title:"点击刷新验证码"},on:{click:t.getCaptcha}},[a("img",{staticStyle:{width:"100px",height:"38px",border:"1px"},attrs:{src:t.formData.captcha}})])],1)]),a("el-form-item",{attrs:{prop:"ldap"}},[a("el-checkbox",{staticClass:"ignore",model:{value:t.formData.ldap,callback:function(e){t.$set(t.formData,"ldap",e)},expression:"formData.ldap"}},[t._v("ldap登录")])],1),a("el-form-item",[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"w-full",attrs:{round:"",type:"primary"},on:{click:t.onSubmit}},[t._v("登 录")])],1)],1),"normal"!=t.mode?[a("el-divider",{staticClass:"text-gray-500 select-none"},[t._v("其他登录方式")]),a("div",{staticClass:"other-login-secton flex justify-center"},[a("div",{staticClass:"cursor-pointer hover:opacity-80 active:opacity-60 cas flex flex-col items-center",on:{click:t.goCasLogin}},[a("k-icon",{staticStyle:{"font-size":"36px"},attrs:{name:"icon-dandiandengluquanxian"}}),a("span",{staticClass:"text-sm ignore select-none"},[t._v("CAS")])],1)])]:t._e()],2)]),t.isChrome?t._e():a("el-alert",{staticStyle:{position:"fixed",top:"0"},attrs:{title:"本产品标准运行环境为Chrome 48.0.2564 及以上版本，请使用Chrome浏览器进行访问，以便获得最佳体验。",type:"warning"}})],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"bg-gray-600 hover:bg-gray-700 active:bg-gray-800 rounded-full",staticStyle:{width:"30px",height:"30px"}},[a("i",{staticClass:"el-icon-refresh"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mb-6"},[a("h1",{staticClass:"text-3xl  mb-2",staticStyle:{color:"#409EFF"}},[t._v(" SQLDEV ")]),a("h3",{staticClass:"text-2xl"},[t._v(" 数据库安全访问管控系统 ")])])}],o=a("1da1"),i=a("5530"),r=(a("b0c0"),a("96cf"),a("2f62")),l=a("c276"),c=a("3de1"),u=a("0582"),d={computed:Object(i["a"])(Object(i["a"])({},Object(r["e"])(["user"])),{},{companyInfo:function(){var t=this.bgItem.imagePath,e={"background-image":"url(".concat(t,") ")};return e}}),data:function(){var t=this.$route.query,e=[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}]||!1,a=Object(c["b"])(0,e.length-1);return{bgList:e,randomNum:a,bgItem:e[a],loading:!1,ENV_DATA:{LOGIN_LOGO:"/image/logo-white.png",NAME:"SQLDEV",DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",INTRODUCTION:"企业数据安全治理工具",VERSION:"3.4.0",TITLE:"SQLDEV",COMPANY:"南京树安信息技术有限公司",WEBSITE:"http://www.shuaninfo.com/"},isChrome:!1,path:"",mode:"normal",back_url:t.url,url:"",formData:{name:"",pwd:"",captcha:"",captcha_id:"",code:"",ldap:!1},formRules:{name:[{required:!0,message:"请输入账号"}],pwd:[{required:!0,message:"请输入密码"}],code:[{type:"string",len:4,message:"请输入4位验证码",required:!0}]}}},methods:{switchBgHandle:function(){var t=0;this.randomNum<this.bgList.length-1&&(t=this.randomNum+1),this.bgItem=this.bgList[t],this.randomNum=t,console.log("this.bgItem ;",this.bgItem)},getCaptcha:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.formData.code="",e.next=3,t.$api.get("/api/captcha");case 3:a=e.sent,s=a.id,n=a.img,t.formData.captcha=n,t.formData.captcha_id=s;case 8:case"end":return e.stop()}}),e)})))()},checkBrowser:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1;return e?"Opera":t.indexOf("Firefox")>-1?"FF":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!e?"IE":void 0},goCasLogin:function(){this.url&&(window.location.href=this.url)},onSubmit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n,o,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.isValidate();case 4:return a=Object(i["a"])({},t.formData),s="/api/login",delete a.captcha,e.next=9,t.$api.post(s,a);case 9:if(n=e.sent,o=n.token,r=n.user,t.$store.commit("user",r),r&&r.setting)try{c=JSON.parse(r.setting),c.theme&&Object(u["a"])(c.theme)}catch(d){console.error("[new-loaing.vue]#onSubmit: 设置主题出错，",r.setting)}if(l["a"].cookies.set("uuid","u7".concat(r.id,"81")),window.localStorage.setItem("name",t.formData.name),window.localStorage.setItem("token",o),t.$store.commit("setForceTfa",0),r.must_tfa&&1!==r.tfa_state||2!==r.account_level){e.next=25;break}return console.log("this.$refs.tfa : "),t.$bus.emit("tfa-show","emit"),t.$bus.off("tfa-emit"),t.$bus.on("tfa-emit",(function(){console.log("this.$refs.tfa : tfa-emit"),t.loginSuccessHandler(o,r)&&t.showLoginMessage(r)})),t.loading=!1,e.abrupt("return");case 25:return e.next=27,t.$store.dispatch("d2admin/account/load");case 27:r.must_tfa&&1!==r.tfa_state?(t.onError("管理员已强制开启二次验证，请设置！ 正在跳转(2秒)..."),setTimeout((function(){t.$router.push("/personal/security"),t.$store.commit("setForceTfa",1),t.loading=!1,t.showLoginMessage(r)}),2e3)):(t.loginSuccessHandler(o,r)&&t.showLoginMessage(r),t.loading=!1),e.next=34;break;case 30:e.prev=30,e.t0=e["catch"](1),t.loading=!1,t.getCaptcha();case 34:case"end":return e.stop()}}),e,null,[[1,30]])})))()},showLoginMessage:function(t){},loginSuccessHandler:function(t,e){var a=this;if(this.$store.commit("setForcePwd",0),e.pw_score<2)return this.onError("你的密码过于简单，登录后请修改密码！正在跳转(2秒)..."),setTimeout((function(){a.$store.commit("setForcePwd",1),a.$router.push("/personal/password")}),1500),!1;if(this.$route.query.url){var s=Object(i["a"])({},this.$route.query);return delete s.url,this.$router.push({path:this.$route.query.url,query:s}),!0}return this.$router.push("/"),!0}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$loading().close(),"Chrome"===t.checkBrowser()&&(t.isChrome=!0),t.getCaptcha(),e.next=5,t.$api.post("/api/setting",{});case 5:a=e.sent,s=a.login_mode,n=a.url,t.$store.commit("sysSetting",a),t.mode=s,e.t0=s,e.next="cas"===e.t0?12:"ldap"===e.t0?14:"normal"===e.t0?15:17;break;case 12:return t.url=n,e.abrupt("break",17);case 14:return e.abrupt("break",17);case 15:return t.formData.name=window.localStorage.getItem("name")||"",e.abrupt("break",17);case 17:case"end":return e.stop()}}),e)})))()}},p=d,f=(a("033c"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,"6a5c549d",null);e["default"]=m.exports},6699:function(t,e,a){},6736:function(t,e,a){},6745:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container shadow"},[t._m(0),a("div",{staticClass:"body"},[a("h3",{staticClass:"error-msg"},[t._v(t._s(t.msg))]),t._m(1)])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ali-center"},[a("img",{staticClass:"logo",attrs:{src:"/static/image/sqldev.png"}}),a("h4",[t._v("企业数据安全访问系统")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"site-link"},[a("a",{attrs:{href:"http://www.shuaninfo.com",target:"_blank"}},[t._v("树安官网")])])}],o=a("5530"),i=a("2f62"),r={data:function(){var t=this.$route.query;return{msg:t.msg||""}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getCaptcha:function(){var t=this;this.$api.get("/api/captcha").then((function(e){var a=e.id,s=e.img;t.formData.captcha=s,t.formData.captcha_id=a}))},goCasLogin:function(){this.url&&(window.location.href=this.url)},onSubmit:function(){}},mounted:function(){window.parent&&(window.parent.location.href=window.location.href)}},l=r,c=(a("4bef"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},67456:function(t,e,a){},6778:function(t,e,a){"use strict";a("689f")},6894:function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("ac1f"),a("5319"),a("d3b7"),a("2b0e")),o=a("a18c"),i={"12px":"mini","13px":"small","14px":"medium","16px":"default"};e["default"]={namespaced:!0,state:{value:"13px"},actions:{apply:function(t,e){var a=t.state,s=t.commit,r=document.querySelector("html");r&&(r.style.fontSize=a.value),i[a.value]&&(n["default"].prototype.$ELEMENT.size=i[a.value]),e&&(s("d2admin/page/keepAliveClean",null,{root:!0}),o["a"].replace("/refresh"))},isLoaded:function(t){var e=t.state;return e.value?Promise.resolve():new Promise((function(t){var a=setInterval((function(){e.value&&t(clearInterval(a))}),10)}))},set:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,s.value=e,n("apply",!0),a.next=5,n("d2admin/db/set",{dbName:"sys",path:"size.value",value:s.value,user:!0,project:!1},{root:!0});case 5:case"end":return a.stop()}}),a)})))()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,e.next=3,s("d2admin/db/get",{dbName:"sys",path:"size.value",defaultValue:"default",user:!0,project:!1},{root:!0});case 3:a.value=e.sent,s("apply");case 5:case"end":return e.stop()}}),e)})))()}}}},"689f":function(t,e,a){},6950:function(t,e,a){"use strict";a("2a77")},"69a2":function(t,e,a){"use strict";a.r(e),e["default"]={namespaced:!0,state:{active:!1},mutations:{toggle:function(t){t.active=!t.active},set:function(t,e){t.active=e}}}},"69e1":function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return S}));var s=a("1da1"),n=a("5530"),o=a("d4ec"),i=a("bee2"),r=a("ade3"),l=(a("96cf"),a("b0c0"),a("caad"),a("99af"),a("ac1f"),a("5319"),a("d3b7"),a("b680"),a("07ac"),a("d81d"),a("365c")),c=a("5c96"),u=a("2ef0"),d=a("4360"),p=a("f9ae"),f=a.n(p),m=a("da6f"),h=a("e31c"),b=a("ff60"),_=a("ec26"),g=a("8c66"),v=a("8ba6"),y=a("d18d"),w=a("034e");v["init"](["oracle","custom-redis"],{suggest:!1});var S=function(){function t(e,a,s){Object(o["a"])(this,t),Object(r["a"])(this,"editorType","monaco"),Object(r["a"])(this,"index",void 0),Object(r["a"])(this,"editor",void 0),Object(r["a"])(this,"bus",void 0),Object(r["a"])(this,"data",void 0),Object(r["a"])(this,"project",void 0),Object(r["a"])(this,"token",void 0),Object(r["a"])(this,"auto",void 0),Object(r["a"])(this,"itemType","table"),Object(r["a"])(this,"head",[]),Object(r["a"])(this,"filterHead",[]),Object(r["a"])(this,"body",{}),Object(r["a"])(this,"rowUnique","_XID_VUE_UUID_"),Object(r["a"])(this,"rows",{}),Object(r["a"])(this,"colsWidth",{}),Object(r["a"])(this,"hasNext",!1),Object(r["a"])(this,"colsMaxLength",60),Object(r["a"])(this,"colsMinLength",8),Object(r["a"])(this,"affected_rows",0),Object(r["a"])(this,"result",!0),Object(r["a"])(this,"encrypt_sql",!1),Object(r["a"])(this,"encrypt_flag",!1),Object(r["a"])(this,"resultText",""),Object(r["a"])(this,"queryType",""),Object(r["a"])(this,"runType",""),Object(r["a"])(this,"mode",!1),Object(r["a"])(this,"auditResult",{}),Object(r["a"])(this,"runParams",{}),Object(r["a"])(this,"execResult",{}),Object(r["a"])(this,"errorText",""),Object(r["a"])(this,"loading",!1),Object(r["a"])(this,"explain",!1),Object(r["a"])(this,"runSql",""),Object(r["a"])(this,"sourceRunSql",""),Object(r["a"])(this,"page",0),Object(r["a"])(this,"size",10),Object(r["a"])(this,"cli_page",0),Object(r["a"])(this,"pastePosition",{}),console.info("[service.js] service constructor：",e,a),this.setSize(),this.index=e,this.data=a,this.data.db_id=this.data.id,this.bus=s,this.supportLanguage(),this.auto=new y["default"](this.data)}return Object(i["a"])(t,[{key:"setSize",value:function(t){this.size="number"!==typeof t||isNaN(t)?d["a"].state.pageSize?d["a"].state.pageSize:this.size:t,d["a"].commit("setPageSize",this.size),console.log("[service.js setSize()] 设置：",t,this.size)}},{key:"supportLanguage",value:function(){!this.data.dbType||Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]})["monaco-dbs"]&&-1==Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]})["monaco-dbs"].indexOf(this.data.dbType)?this.data.databaseLanguage="mycat"==this.data.dbType?"mysql":"sql":"redis"==this.data.dbType?this.data.databaseLanguage="custom-redis":"postgres"==this.data.dbType?this.data.databaseLanguage="sql":this.data.databaseLanguage=this.data.dbType}},{key:"update",value:function(t){if(console.log("[service.js] xxxxxxxx : data",t.name),this.data=Object(n["a"])(Object(n["a"])({},t),{},{db_id:t.id}),this.supportLanguage(),this.updateEditor(),this.auto=new y["default"](this.data),!this.editor)return console.warn("[service.js] update() this.editor is undefined：",this.editor);this.auto.registerCompletionItemProvider(this.editor)}},{key:"updateEditor",value:function(){var t=this.editor.getModel();console.log("[service.js] updateEditor(): ",t.id),monaco.editor.setModelLanguage(t,this.data.databaseLanguage)}},{key:"init",value:function(t,e,a){var s=this,o=this;this.data=Object(n["a"])(Object(n["a"])({},e),{},{db_id:e.id}),this.project=a,console.info("[service.js class] init 初始化参数：",this.index,this.data.dbType,this.data.databaseLanguage),this.setSize();var i="vs";console.log("Store: xxxx",d["a"],Object(u["get"])(d["a"],"getters.d2admin/theme/activeSetting"));var r=Object(u["get"])(d["a"],"getters.d2admin/theme/activeSetting");r&&r.code&&["vs","vs-dark","hc-black"].includes(r.code)&&(i=r.code);var l=monaco.editor.create(t,{value:e.script,language:this.data.databaseLanguage,theme:i,automaticLayout:!0,selectionHighlight:!0,contextmenu:!0,wordWrap:"on",scrollbar:{useShadows:!1,verticalHasArrows:!0,horizontalHasArrows:!0,vertical:"hidden",horizontal:"hidden",verticalScrollbarSize:0,horizontalScrollbarSize:17,arrowSize:30}});this.editor=l,Object(g["init"])(this,l),Object(w["reomveRightKeys"])(),this.auto.registerCompletionItemProvider(this.editor),this.editor.setValue||(this.editor.setValue=l.getModel().setValue()),this.editor.getSelectedText||(this.editor.getSelectedText=function(){var t=l.getModel().getValueInRange(l.getSelection());return t}),this.editor.clearSelection||(l.clearSelection=function(){o.editor.setPosition(o.editor.getPosition())});var c=this.editor.getModel();Object(m["b"])("historyList",{}).then((function(t){console.info("[service.js] init  获取历史记录列表：",t,s.data.index,t[s.data.index]),v["setEditStack"](c,t[s.data.index])})),this.editor.onDidChangeModelContent((function(t){if(-1!=d["a"].state.MAX_LINE){var e=s.editor.getModel().getLineCount();if(e>d["a"].state.MAX_LINE)return void d["a"].commit("isMaxLine",d["a"].state.isMaxLine+1);d["a"].commit("isMaxLine",0)}var a=v["getEditStack"](c,10);d["a"].commit("saveHistory",{history:a,index:s.data.index}),d["a"].commit("updateScript",{script:s.editor.getValue(),index:s.data.index})})),console.info("monaco editor init end...")}},{key:"updateRightKeys",value:function(){Object(g["init"])(this,this.editor)}},{key:"emit",value:function(t,e){this.bus.emit("".concat(this.index,".").concat(t),e)}},{key:"setFontSize",value:function(t){t&&"ace"==this.editorType.toLowerCase()?this.editor.setOptions({fontSize:"".concat(t,"px")}):t&&this.editor.updateOptions({fontSize:t})}},{key:"assignData",value:function(t,e){Object.assign(this.data,t),Object.assign(this.auto.data,t),t.script&&(e?this.insertSQL(t.script):this.setSQL(t.script))}},{key:"setData",value:function(t,e){this.data=t,this.auto.data=t,this.data.script&&(e?this.insertSQL(this.data.script):this.setSQL(this.data.script))}},{key:"getCursorRange",value:function(){var t=this.editor.getPosition();return{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber,endColumn:t.column}}},{key:"insertSQL",value:function(t,e){this.page=0,this.cli_page=0;var a=Object(n["a"])({clean:!1,selection:this.editor.getSelection(),wrap:[0,0]},e);this.editor.executeEdits(null,[{range:a.selection,text:t,forceMoveMarkers:!1}]),console.log("[service.js#insertSQL()]: ",this.editor.getModel().id,a.selection,this.editor.getSelection()),this.editor.focus(),a.clean&&this.clean()}},{key:"clean",value:function(t){this.colsWidth={},this.head=[],this.filterHead=[],this.body={},this.affected_rows=0,this.resultText="",this.runParams={},this.execResult={},t&&(this.explain=!1,this.page=0,this.cli_page=0,this.hasNext=!1)}},{key:"onReset",value:function(){this.explain=!1,this.page=0,this.cli_page=0}},{key:"setConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in t){var a=t[e];this[e]=a}}},{key:"getConfig",value:function(t){return t?this[t]:null}},{key:"setSQL",value:function(t,e){console.info("[service setSQL] start..."),this.page=0,this.cli_page=0,this.editor.executeEdits("",[{range:this.editor.getModel().getFullModelRange(),text:t,forceMoveMarkers:!0}]),this.editor.clearSelection(),e&&(this.colsWidth={},this.head=[],this.filterHead=[],this.body={})}},{key:"getSQL",value:function(){var t=this.editor.getSelectedText()||this.editor.getValue();return t}},{key:"getSelectSQL",value:function(){var t=this.editor.getSelectedText();return t}},{key:"getSQLValue",value:function(){return this.getSQL().replace(/^\s*--.*\r?\n?/gm,"").replace(/\/\*(.|\n)*\*\//g,"")}},{key:"getFullSQL",value:function(){return this.editor.getValue()}},{key:"onStop",value:function(){var t=this;return l["default"].post("/api/sql/stop",{iid:this.data.db_id,token:this.token}).then((function(){Object(c["Notification"])({title:"提示信息",message:"中断成功",type:"success",duration:2e3,position:"top-right",offset:100})})).finally((function(){t.loading=!1}))}},{key:"onFirst",value:function(){this.page=0,this.cli_page=this.page,this.onRun(!1,null,{single_script:this.runSql,is_change_pagesize:!0,runType:"pre"})}},{key:"onPre",value:function(){this.page=this.page>1?this.page-1:0,this.cli_page=this.page,this.onRun(!1,null,{single_script:this.runSql,is_change_pagesize:!0,runType:"pre"})}},{key:"onNext",value:function(t){if(!this.hasNext)return console.log("======没有下一页====="),!1;this.page=this.page+1,t||(this.cli_page=this.page),this.onRun(t,null,{single_script:this.runSql,is_change_pagesize:!0,runType:"next"})}},{key:"onRun",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a,s){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.runType=s&&s.runType,"快照查询-工单"!=this.mode.mode&&"查询-异步"!=this.mode.mode){t.next=3;break}return t.abrupt("return",this.onRunAsyncData(e,a,s));case 3:if("在线查询-工单"!=this.mode.mode){t.next=5;break}return t.abrupt("return",this.onRunNormal(e,a,s));case 5:return n=null,t.prev=6,t.next=9,this.onAudit(s);case 9:n=t.sent,t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](6),n=t.t0;case 15:if(!n||!n.error){t.next=25;break}this.body={},this.head=[],this.filterHead=[],this.affected_rows=0,this.colsWidth={},this.result=!1,this.resultText="执行错误:"+n.error,t.next=27;break;case 25:return o=n?n.atk:"",t.abrupt("return",this.onRunNormal(e,o,s));case 27:case"end":return t.stop()}}),t,this,[[6,12]])})));function e(e,a,s){return t.apply(this,arguments)}return e}()},{key:"onAudit",value:function(t){return this.queryType="",console.log("onAudit encode:",this.encrypt_sql),this.onRunAudit(t)}},{key:"onCheckAudit",value:function(t){var e="";return e=t&&(t.no_check_script||t.single_script)?t.single_script:this.getSQL(),this.mode=h["a"].parserComments(e),console.log("this.mode: ",this.mode),this.mode&&this.mode.mode&&"标准"!=this.mode.mode?(console.log("跳过审计：",this.mode),Promise.resolve(this.mode)):this.onAudit(t)}},{key:"onRunAudit",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var a,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e||(e={}),a=null,a=e&&(e.no_check_script||e.single_script)?e.single_script:this.getSQL(),!this.loading){t.next=5;break}return t.abrupt("return");case 5:if(this.loading=!0,this.runSql=a,this.token=Object(b["a"])(),this.resultText="",this.encrypt_sql&&(a=this.encryptSql(a)),a){t.next=13;break}return this.loading=!1,t.abrupt("return",Promise.reject({error:"请输入脚本！"}));case 13:return t.abrupt("return",l["default"].sql.audit({iid:this.data.id,sql:a,project:this.project.id,encrypt_flag:this.encrypt_flag,owner:e.owner||this.data.owner,db_type:e.dbType||this.data.dbType,token:this.token}).then((function(t){return s.auditResult=t,t})).catch((function(){s.auditResult={}})).finally((function(){s.loading=!1})));case 14:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"onRunNormal",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a,s){var o,i,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=null,this.runType=s&&s.runType,o=s&&s.single_script?s.single_script:this.getSQL(),s&&s.mode&&(this.mode=s.mode),!this.loading){t.next=6;break}return t.abrupt("return");case 6:return this.loading=!0,i=Date.now(),this.resultText="",this.affected_rows=0,this.runSql=o,this.encrypt_sql&&(o=this.encryptSql(o)),this.setSize(),this.runParams={item_type:this.itemType,atk:a,iid:this.data.id,project:this.project.id,sql:o,encrypt_flag:this.encrypt_flag,owner:this.data.owner,db_type:this.data.dbType,token:this.data.token||this.token,page_index:this.page,page_size:this.size,explain:this.explain},t.abrupt("return",l["default"].sql.exec(this.runParams).then((function(t){var a=t.ok,s=t.head,o=t.type,l=t.data,c=t.count,u=t.error,d=t.sql_type,p=t.work,f=t.table_name,m=t.table_rw;if(r.execResult=Object(n["a"])(Object(n["a"])({},r.execResult),{},{table_name:f,table_rw:m,sql_type:d,work:p}),r.result=a,a){if(l){r.hasNext=l.length>=r.size,r.affected_rows=11==d?c:c||l.length;var h=r.transformHeadAndData(s,o,l);r.head=h.head,"next"!=r.runType&&"pre"!=r.runType&&(r.filterHead=[].concat(r.head));var b=e?Object.assign(r.body,h.data):Object.assign({},h.data);r.body=JSON.parse(JSON.stringify(b)),r.calculateColsWidth(r.head,r.body)}if(u)r.result=!a,r.resultText="执行错误:".concat(u);else if(l.error)r.result=!a,r.resultText="执行错误:".concat(l.error);else{var _=Date.now()-i;r.resultText=_>1e3?"共耗时 ".concat((_/1e3).toFixed(2)," 秒"):"共耗时 ".concat(_," 毫秒")}}else r.resultText="执行错误: ".concat(l.data)})).finally((function(){r.loading=!1,r.queryType="同步"})));case 15:case"end":return t.stop()}}),t,this)})));function e(e,a,s){return t.apply(this,arguments)}return e}()},{key:"onRunAsync",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a){var s,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=null,!a||a.error||!a.atk){t.next=5;break}s=a,t.next=8;break;case 5:return t.next=7,this.onAudit(e);case 7:s=t.sent;case 8:if(console.log("----------onAudit--------------:",s),!s||!s.error){t.next=14;break}return console.log("错误：",s.error),t.abrupt("return",Promise.resolve(s));case 14:return o=s?s.atk:"",i="",i=e&&e.single_script?e.single_script:this.getSQL(),this.sourceRunSql=i,this.runSql=i,this.encrypt_sql&&(i=this.encryptSql(i)),this.setSize(),t.abrupt("return",l["default"].sql.exec(Object(n["a"])(Object(n["a"])({},e),{},{item_type:this.itemType,iid:e.iid||this.data.id,atk:o,project:this.project.id,sql:i,encrypt_flag:this.encrypt_flag,owner:e.owner||this.data.owner,db_type:e.dbType||this.data.dbType,token:this.token,page_index:this.page,page_size:this.size})));case 22:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"onRunAsyncData",value:function(t,e,a){var s=this;this.runType=a&&a.runType,this.data.async=a&&a.async?a.async:this.data.async,a&&a.mode&&(this.mode=a.mode);var n=Date.now();return this.setSize(),l["default"].task.data({id:this.data.async,page_index:this.page,page_size:this.size}).then((function(e){var a=e.ok,o=e.head,i=e.data,r=e.count;if(s.result=a,a){s.hasNext=i.length>=s.size,s.affected_rows=r;var l=s.transformHeadAndData(o,{},i);return s.head=l.head,s.filterHead=l.head,s.body=t?Object.assign(s.body,l.data):Object.assign({},l.data),s.calculateColsWidth(s.head,s.body),void(s.resultText="共耗时 ".concat(((Date.now()-n)/1e3).toFixed(2)," 秒"))}s.resultText="执行错误: ".concat(i.data)})).finally((function(){s.loading=!1,s.queryType="异步"}))}},{key:"onFormatter",value:function(){var t="sql";"oracle"==this.data.dbType?t="pl/sql":"db2"==this.data.dbType&&(t="db2");var e=this.getSQL(),a=f.a.format(e,{language:t,indent:"    "});console.log("getSelect: ",this.editor.getSelectedText()||"你好");var s=this.editor.getSelectedText()?this.editor.getSelection():this.editor.getModel().getFullModelRange();this.editor.executeEdits("",[{range:s,text:a,forceMoveMarkers:!0}])}},{key:"onSaveLocal",value:function(){}},{key:"onOpenLocal",value:function(){}},{key:"calculateColsWidth",value:function(t,e){for(var a=0;a<t.length;a++){var s=t[a].label,n=this.strlen(s);n=this.explain?Math.max(n,this.colsMinLength):n>this.colsMaxLength?this.colsMaxLength:n<this.colsMinLength?this.colsMinLength:n,n+=1.5,"id"==s&&console.log("id--： ",n),this.colsWidth[s]=n}for(var o=Object.values(e),i=0,r=o;i<r.length;i++){var l=r[i];for(var c in l)if(this.explain||this.colsWidth[c]!=this.colsMaxLength){var u=this.strlen(l[c]),d=this.colsWidth[c];this.explain?this.colsWidth[c]=Math.max(u,d):this.colsWidth[c]=u>d?u>this.colsMaxLength?this.colsMaxLength:u:d}}}},{key:"strlen",value:function(t){for(var e=0,a=0;a<t.length;a++){var s=t.charCodeAt(a);s>=1&&s<=126||s>=65376&&s<=65439?e++:e+=2}return e}},{key:"transformHeadAndData",value:function(t,e,a){e=e||{};var s={},n={};if(a&&a.length>0)for(var o=0;o<a.length;o++){var i=a[o];for(var r in i._XID_VUE_UUID_=Object(_["a"])(),s[i._XID_VUE_UUID_]=i,i)i[r].length>100&&(n[r.toLowerCase()]=1)}var l=(t||[]).map((function(t){var a=e[t]||{},s={label:t,width:null,type:(a.type||"").toLowerCase()};switch((a.type||"").toLowerCase()){case"varchar":break;case"text":s.width=250;break;case"blob":s.width=250;break;case"longtext":s.width=250;break}return n[t.toLowerCase()]&&(s.width=250),s}));return{head:l,data:s}}},{key:"hasScript",value:function(){return!!this.editor.getValue()}},{key:"encryptSql",value:function(t){return console.log("[service.js]#encryptSql 开始加密sql: ",t),t=l["default"].util.aesEncrypted(t),this.encrypt_flag=!0,t}}]),t}()},"69f6":function(t,e,a){},"6a2f":function(t,e,a){"use strict";a("56ab")},"6ace":function(t,e,a){"use strict";a("d3b7"),a("25f0"),a("ac1f"),a("5319"),a("4d63");var s=a("c198"),n=a.n(s),o=a("c1df"),i=a.n(o),r=function(t){var e=n.a.encrypt(t,"000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f");return e.toString()},l=function(t,e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t)||[,""])[1].replace(/\+/g,"%20"))||null},c=function(t,e){return t&&i()(t).format(e||"YYYY-MM-DD HH:mm:ss")};e["a"]={aesEncrypted:r,getUrlKey:l,formatTime:c}},"6b4e":function(t,e,a){},"6b7e":function(t,e,a){},"6bde":function(t,e,a){},"6bf1":function(t,e,a){},"6c03":function(t,e,a){"use strict";a("0a70")},"6c4d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]})},n=[],o=a("5530"),i=(a("ac1f"),a("5319"),a("4d63"),a("25f0"),a("2f62")),r={data:function(){return{loading:!0}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getUrlKey:function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(window.location.href)||[,""])[1].replace(/\+/g,"%20"))||null}},mounted:function(){var t=this,e=this.getUrlKey("code");e?this.$api.post("/api/login/oauth2",{code:e}).then((function(e){t.$store.commit("user",e),window.localStorage.setItem("token",e.token),window.localStorage.setItem("user",JSON.stringify(e)),t.onSuccess("登录成功");var a=window.localStorage.getItem("beforeUrl");console.log("beforeUrl",a),t.$router.push("/"),t.loading=!1})).catch((function(e){console.log("oauth2 login:",e);var a=window.localStorage.getItem("oauth_mode");if("focus"==a){var s=window.localStorage.getItem("oauth2_url");window.location.href=s+"&error="+encodeURIComponent(e.data)}else t.$message({showClose:!0,duration:2e3,type:"warning",message:e.data}),setTimeout((function(){t.loading=!1,t.$router.replace("/login")}),5e3)})):this.$router.replace("/login")}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"6c4f":function(t,e,a){"use strict";a("0487")},"6c72":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"sql-query-tabs flex"},[a("el-tabs",{staticClass:"flex-1",attrs:{type:"border-card"},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.runList,(function(e,s){return a("el-tab-pane",{key:e.tabId,attrs:{name:s+""}},[a("div",{staticClass:"tabs-xxxx tab-label",class:{"tab-pre":t.active==s+1,"tab-next":t.active==s-1},attrs:{slot:"label"},on:{dblclick:function(a){return t.onDblTabClick(e.tabId)}},slot:"label"},[a("span",{ref:"tabname-"+e.tabId,refInFor:!0,staticClass:"xxxxxx ignore",staticStyle:{"user-select":"none"},on:{click:function(e){return t.onTabClick(s)}}},[t._v(t._s(t.getTabName(e)))]),a("i",{staticClass:"sn-font rm",on:{click:function(a){return a.stopPropagation(),t.onRemove(e.tabId,s)}}},[t._v("")])]),a("sql-query-item",{ref:"queryItem"+s,refInFor:!0,attrs:{data:e,"tab-id":e.tabId,"data-index":s}})],1)})),1),a("node-info",{attrs:{data:t.nodeData}}),a("el-dialog",{attrs:{title:"修改标签页名称",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-input",{attrs:{placeholder:"请输入标签页名称",clearable:""},model:{value:t.workspaceTabParams.runName,callback:function(e){t.$set(t.workspaceTabParams,"runName",e)},expression:"workspaceTabParams.runName"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.savaTabName}},[t._v("保 存")])],1)],1)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("498a"),a("99af"),a("da6f")),r=a("2f62"),l=a("8546"),c=a("711d"),u=null,d={components:{SqlQueryItem:l["default"],NodeInfo:c["default"]},data:function(){return{nodeData:{},active:0,tabNames:[],workspaceTabParams:{runName:null,tabId:null},dialogVisible:!1}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(r["e"])(["runList","runNames","runner","service","runActive","sys","setting"])),Object(r["c"])(["run"])),{},{getTabName:function(){var t=this;return function(e){return t.runNames[e.tabId]}},keymap:function(){var t=this.onHotKeysChange();return t}}),watch:{active:{immediate:!0,handler:function(t){console.log("[tabs watch] active: ",t)}},run:function(t){var e=this;Boolean(t)&&Boolean(t.instance_id)&&(this.active=String(t.index),window.$log.dev("[tabs watch]#run: ",this.active,this.run),this.onActive(this.active),this.$nextTick((function(){var a=t.instance_id;e.$store.commit("getSelectedDB",a)})))}},methods:{onHotKeysChange:function(){var t={};if(this.setting.hotKeys){var e=this.setting.hotKeys;e.appendSearch&&(t[e.appendSearch.toLowerCase()]=this.queryAppendNext),e.closeWindow&&(t[e.closeWindow.toLowerCase()]=this.closeCur),e.newWindow&&(t[e.newWindow.toLowerCase()]=this.copyCur),e.preSearch&&(t[e.preSearch.toLowerCase()]=this.queryPrv),e.nextSearch&&(t[e.nextSearch.toLowerCase()]=this.queryNext),e.search&&(t[e.search.toLowerCase()]=this.onRun)}else t["alt+r"]=this.onRun,t["alt+,"]=this.queryPrv,t["alt+."]=this.queryNext,t["alt+a"]=this.queryAppendNext,t["alt+n"]=this.copyCur,t["alt+w"]=this.closeCur;return t},onTabClick:function(t){var e=this;console.log("单击："),clearTimeout(u),u=setTimeout((function(){console.log("[tabs methods] onTabClick:",e.active,t),e.$nextTick((function(){e.onActive(String(t))}))}),350)},onDblTabClick:function(t){clearTimeout(u),this.dialogVisible=!0,this.workspaceTabParams={runName:this.runNames[t],tabId:t},console.log("双击tabId: ",t,this.tabName)},savaTabName:function(){this.workspaceTabParams.runName&&String(this.workspaceTabParams.runName).trim()?(this.$store.commit("setWorkspaceTabName",this.workspaceTabParams),this.dialogVisible=!1):this.$message({message:"请输入标签名称",type:"warning"})},copyCur:function(t){t.preventDefault(),this.$store.commit("copyActiveRunner")},closeCur:function(t){console.log("e: ",t),t.preventDefault();var e=this.runList[this.runActive];console.log("run:",e),this.onRemove(e.tabId,e.index)},queryNext:function(t){t.preventDefault(),console.log("======queryNext====="),this.service.onNext(!1)},queryAppendNext:function(t){t.preventDefault(),console.log("======queryAppendNext====="),this.service.onNext(!0)},saveToLocalFile:function(t){t.preventDefault(),console.log("======saveToLocalFile====="),this.$bus.emit("saveToLocalFile")},queryPrv:function(t){t.preventDefault(),console.log("======queryPrv====="),this.service.onPre()},onRun:function(t){t.preventDefault(),this.service.encrypt_sql=this.sys.encrypt_sql,this.service.page=0,this.service.onRun(!1)},onCopy:function(t){this.clone=Object(o["a"])({},this.runList[t]),this.$store.commit("addRun",this.clone)},onRemove:function(t,e){console.log("销毁  on-selectdb-".concat(t,", ").concat(e)),this.$bus.off("on-selectdb-".concat(t)),this.$store.commit("delRun",{index:e,tabId:t}),console.log("[tabs methods] onRemove: ",String(this.runList.length-1)),this.onActive(String(this.runList.length-1))},onActive:function(t){var e=this;console.log("[tabs methods] onActive: ",t,this.active,this.runActive),this.$store.commit("updateRunActive",t),this.active=t,setTimeout((function(){e.$nextTick((function(){var t=e.$refs["queryItem".concat(e.active)];Boolean(t)&&Boolean(t[0])&&t[0].onActive()}))}),500)}},created:function(){console.log("....... tabs created")},beforeDestroy:function(){window.$log.dev("[tabs beforeDestroy]"),this.$bus.off("new-sql-window")},mounted:function(){var t=this;this.$bus.off("selected-tree-node"),this.$bus.on("selected-tree-node",(function(e){var a=e.source;t.nodeData=a})),this.$bus.off("new-sql-window"),window.$log.dev("[tabs mounted] ..."),this.$bus.on("new-sql-window",(function(){t.onActive(String(t.runList.length-1))}));var e="runNames";Object(i["b"])(e,{max:0}).then((function(e){e&&t.$store.commit("setAllRunNames",e)})).catch((function(t){console.error("[tabs.vue]#mounted#cacheGetIndexdb error: ",t)})),this.onActive(String(this.runActive)||"0"),this.onHotKeysChange()}},p=d,f=(a("b919"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},"6cc5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-mysql-edit"},[a("el-table",{attrs:{size:"mini",data:t.dataList}},[t._l(t.head,(function(e,s,n){return[-1==t.ignreColumns.indexOf(s)?a("el-table-column",{key:n,attrs:{label:s,prop:s},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[n.edit&&t.tableEdit[s]?a("div",["input"==t.tableEdit[s].type?a("el-input",{attrs:{size:"mini"},model:{value:n[s],callback:function(e){t.$set(n,s,e)},expression:"row[k]"}}):"select"==t.tableEdit[s].type?a("el-select",{attrs:{size:"mini"},model:{value:n[s],callback:function(e){t.$set(n,s,e)},expression:"row[k]"}},[t._l(t.tableEdit[s].item,(function(e){return[e.values?a("el-option-group",{key:e.group,attrs:{label:e.group}},t._l(e.values,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1):a("el-option",{key:e,attrs:{label:e,value:e}})]}))],2):t._e()],1):a("span",[t._v(t._s(n[s]))])]}}],null,!0)}):t._e()]})),a("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onSubmitField(e.row,e.$index)}}},[t._v("提交")]):a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.onEditField(e.row,e.$index)}}},[t._v("修改")]),e.row.edit?a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.onCancelField(e.row,e.$index)}}},[t._v("取消")]):a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.onDropField(e.row,e.$index)}}},[t._v("删除")])]}}])})],2),a("div",{staticStyle:{padding:"4px 8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onAddField()}}},[t._v("新增字段")])],1)],1)},n=[],o=a("5530"),i=(a("d81d"),a("f17c")),r={data:function(){return{ignreColumns:["edit","origin"],dataList:[]}},inject:["db","owner"],computed:{head:function(){return this.dataList[0]||{}},tableEdit:function(){return i["default"][this.db.dbType].table},tableEditSchema:function(){return i["default"][this.db.dbType]}},props:{table:{type:String,default:""},type:{type:String,default:""}},watch:{table:function(){this.dataList=[],this.refresh()}},methods:{refresh:function(){var t=this;this.$api.table.info(this.db,this.owner.id,this.table,"struct",this.type).then((function(e){t.dataList=e.map((function(t){return t.edit=!1,t}))}))},onSubmitField:function(t){this.$emit("submit",this.tableEditSchema.changeField(this.table,t),this.refresh)},onAddField:function(){var t=Object(o["a"])({},this.dataList[0]||{});for(var e in t)t[e]=null;this.onEditField(t),this.dataList.push(t)},onEditField:function(t,e){t.edit=!0,t.origin=Object(o["a"])({},t)},onCancelField:function(t,e){for(var a in t.origin)t[a]=t.origin[a];t.edit=!1},onDropField:function(t,e){this.$emit("submit",this.tableEditSchema.dropField(this.table,t),this.refresh)}},components:{},mounted:function(){this.refresh()}},l=r,c=(a("4887"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"6d5a":function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("2ef0")),o=a("6a71"),i=a.n(o),r=a("d68b"),l=a.n(r);e["default"]={namespaced:!0,state:{value:"#4CA2A4"},actions:{set:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,o,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,o=t.commit,i=s.value,s.value=e||"#4CA2A4",a.next=5,n("d2admin/db/set",{dbName:"sys",path:"color.value",value:s.value,user:!0},{root:!0});case 5:o("apply",{oldColor:i,newColor:s.value});case 6:case"end":return a.stop()}}),a)})))()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,n=t.commit,o=a.value,e.next=4,s("d2admin/db/get",{dbName:"sys",path:"color.value",defaultValue:"#4CA2A4",user:!0},{root:!0});case 4:a.value=e.sent,n("apply",{oldColor:o,newColor:a.value});case 6:case"end":return e.stop()}}),e)})))()}},mutations:{apply:function(t,e){var a=e.oldColor,s=e.newColor,o={oldColors:Object(n["cloneDeep"])(l.a.getElementUISeries(a)),newColors:Object(n["cloneDeep"])(l.a.getElementUISeries(s))};i.a.changer.changeColor(o)}}}},"6d65":function(t,e,a){},"6e7a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"权限申请",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"申请目标"}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:t.formData.source_type,callback:function(e){t.$set(t.formData,"source_type",e)},expression:"formData.source_type"}},[a("el-option",{attrs:{label:"权限组",value:"role"}}),a("el-option",{attrs:{label:"其他",value:"none"}})],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"role"==t.formData.source_type,expression:"formData.source_type=='role'"}],attrs:{label:"权限组"}},[a("el-select",{attrs:{placeholder:"请选择权限组"},model:{value:t.formData.role_id,callback:function(e){t.$set(t.formData,"role_id",e)},expression:"formData.role_id"}},t._l(t.roleList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.name))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.info))])])})),1)],1),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.opt_mark,callback:function(e){t.$set(t.formData,"opt_mark",e)},expression:"formData.opt_mark"}})],1),a("el-form-item",{attrs:{label:"审批人",prop:"auditor"}},[a("k-select",{attrs:{url:"/api/apply/manager/list"},model:{value:t.formData.auditor,callback:function(e){t.$set(t.formData,"auditor",e)},expression:"formData.auditor"}})],1),a("el-form-item",{attrs:{label:"抄送",prop:"copy_to"}},[a("k-select",{attrs:{url:"/api/apply/manager/list",multiple:!0},model:{value:t.formData.copy_to,callback:function(e){t.$set(t.formData,"copy_to",e)},expression:"formData.copy_to"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success",disabled:t.disabled},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{disabled:!1,role:{},isShow:!1,formData:{source_type:"none",source_id:"none"},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}],auditor:[{required:!0,message:"请选择审批人"}]},roleList:[]}},props:{},watch:{},computed:{},methods:{show:function(){this.isShow=!0},hide:function(t){this.isShow=!1},loadApplyRoleList:function(){var t=this;this.$api.my.myApplyRoleList().then((function(e){t.roleList=e}))},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.disabled=!0;var a=t.formData;"role"==a.source_type&&(a.source_id=a.role_id),t.$api.apply.applyAdd(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh"),t.disabled=!1}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a),t.disabled=!1}))}}))}},mounted:function(){this.loadApplyRoleList()},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"6f6e":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-message",use:"d2-message-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-message"><path d="M277.3 469.3m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5F6379" /><path d="M344.7 978.2c-5.2 0-10.4-0.8-15.5-2.5-13.8-4.5-24.8-14.8-30.4-28.1l-39.3-94.2H128.3C57.5 853.3 0 795.8 0 725.1V213.6C0 142.9 57.5 85.3 128.3 85.3h767.5c70.7 0 128.3 57.5 128.3 128.3v511.5c0 70.7-57.5 128.3-128.3 128.3H566.5L370.2 971.1c-7.7 4.7-16.6 7.1-25.5 7.1z m-18.3-80.3s-0.1 0 0 0zM128.3 170.7c-23.7 0-42.9 19.3-42.9 42.9v511.5c0 23.7 19.3 42.9 42.9 42.9h188.2l45.3 108.7L542.9 768h352.9c23.7 0 42.9-19.3 42.9-42.9V213.6c0-23.7-19.3-42.9-42.9-42.9H128.3z" fill="#3688FF" /><path d="M512 469.3m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5F6379" /><path d="M746.7 469.3m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},"6fae":function(t,e,a){"use strict";a("77ef")},"6fb5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{"custom-class":"database-edit",title:"同步设置",width:"1000px",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e},close:t.closeHandle}},[a("el-form",{attrs:{model:t.db,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"名称"}},[t._v(t._s(t.names))]),a("el-form-item",{attrs:{label:"自动同步"}},[a("el-switch",{attrs:{"active-value":2,"inactive-value":1},model:{value:t.db.cron_state,callback:function(e){t.$set(t.db,"cron_state",e)},expression:"db.cron_state"}},[t._v(">")])],1),2==t.db.cron_state?a("el-form-item",{attrs:{label:"同步设置"}},[a("div",{staticClass:"cron"},[a("el-popover",{model:{value:t.cronPopover,callback:function(e){t.cronPopover=e},expression:"cronPopover"}},[a("cron",{attrs:{i18n:"en"},on:{change:t.changeCron,close:function(e){t.cronPopover=!1}}}),a("el-input",{attrs:{slot:"reference",readonly:!0,placeholder:"请输入定时策略"},on:{click:function(e){t.cronPopover=!0}},slot:"reference",model:{value:t.db.cron_config,callback:function(e){t.$set(t.db,"cron_config",e)},expression:"db.cron_config"}})],1)],1)]):t._e(),2==t.db.cron_state?a("el-form-item",{attrs:{label:"同步设置"}},[t._v(" "+t._s(t.parserCron(t.db.cron_config))+" ")]):t._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)},n=[],o=a("b85c"),i=(a("d3b7"),a("25f0"),a("b0c0"),a("a15b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"pointVueCron"}},[a("div",{staticClass:"cron-el cron-select-box"},[a("span",{staticClass:"cron-title"},[t._v("定时计划")]),a("el-select",{staticClass:"cron-el-select",attrs:{size:"small",placeholder:"请选择"},on:{change:t.reset},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("div",{staticClass:"cron-el cron-content-box"},["1"===t.value?a("div",{staticClass:"cron-once"},[a("span",{staticClass:"cron-date-picker-text"},[t._v("日期")]),a("el-date-picker",{staticClass:"cron-el-date-picker",attrs:{size:"small",type:"datetime",placeholder:"选择日期时间"},on:{change:t.datetimeChange},model:{value:t.datetime,callback:function(e){t.datetime=e},expression:"datetime"}})],1):"2"===t.value?a("div",{staticClass:"cron-per-minute"},[a("span",{staticClass:"cron-text"},[t._v("每")]),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:1,max:59},model:{value:t.minute.incrementIncrement,callback:function(e){t.$set(t.minute,"incrementIncrement",e)},expression:"minute.incrementIncrement"}}),t._v(" 分，从 "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 分开始 ")],1):"3"===t.value?a("div",{staticClass:"cron-per-hour"},[a("span",{staticClass:"cron-text"},[t._v("每")]),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementIncrement,callback:function(e){t.$set(t.hour,"incrementIncrement",e)},expression:"hour.incrementIncrement"}}),t._v(" 时，从（时:分） "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementStart,callback:function(e){t.$set(t.hour,"incrementStart",e)},expression:"hour.incrementStart"}}),t._v(" : "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 开始 ")],1):"4"===t.value?a("div",{staticClass:"cron-per-day"},[a("span",{staticClass:"cron-text"},[t._v("每")]),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:1,max:31},model:{value:t.day.incrementIncrement,callback:function(e){t.$set(t.day,"incrementIncrement",e)},expression:"day.incrementIncrement"}}),t._v(" 日，从 "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:1,max:31},model:{value:t.day.incrementStart,callback:function(e){t.$set(t.day,"incrementStart",e)},expression:"day.incrementStart"}}),t._v(" 日的（时:分） "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementStart,callback:function(e){t.$set(t.hour,"incrementStart",e)},expression:"hour.incrementStart"}}),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 开始。 ")],1):"5"===t.value?a("div",{staticClass:"cron-per-week"},[a("span",{staticClass:"cron-text"},[t._v("每")]),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:1,max:5},model:{value:t.week.incrementIncrement,callback:function(e){t.$set(t.week,"incrementIncrement",e)},expression:"week.incrementIncrement"}}),t._v(" 周，从本周的 "),a("el-checkbox-group",{staticClass:"cron-el-checkbox-group",model:{value:t.week.dayOfWeek.specificSpecific,callback:function(e){t.$set(t.week.dayOfWeek,"specificSpecific",e)},expression:"week.dayOfWeek.specificSpecific"}},[a("el-checkbox",{attrs:{label:"1"}},[t._v("周一")]),a("el-checkbox",{attrs:{label:"2"}},[t._v("周二")]),a("el-checkbox",{attrs:{label:"3"}},[t._v("周三")]),a("el-checkbox",{attrs:{label:"4"}},[t._v("周四")]),a("el-checkbox",{attrs:{label:"5"}},[t._v("周五")]),a("br"),a("el-checkbox",{attrs:{label:"6"}},[t._v("周六")]),a("el-checkbox",{attrs:{label:"7"}},[t._v("周日")])],1),a("br"),t._v(" （时:分） "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementStart,callback:function(e){t.$set(t.hour,"incrementStart",e)},expression:"hour.incrementStart"}}),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 开始 ")],1):"6"===t.value?a("div",{staticClass:"cron-per-month"},[a("div",{staticClass:"cron-month-wrapper"},[a("span",{staticClass:"cron-text"},[t._v("月")]),a("el-checkbox-group",{staticClass:"cron-el-checkbox-group",model:{value:t.month.specificSpecific,callback:function(e){t.$set(t.month,"specificSpecific",e)},expression:"month.specificSpecific"}},[a("el-checkbox",{attrs:{label:"1"}},[t._v("01月")]),a("el-checkbox",{attrs:{label:"2"}},[t._v("02月")]),a("el-checkbox",{attrs:{label:"3"}},[t._v("03月")]),a("el-checkbox",{attrs:{label:"4"}},[t._v("04月")]),a("br"),a("el-checkbox",{attrs:{label:"5"}},[t._v("05月")]),a("el-checkbox",{attrs:{label:"6"}},[t._v("06月")]),a("el-checkbox",{attrs:{label:"7"}},[t._v("07月")]),a("el-checkbox",{attrs:{label:"8"}},[t._v("08月")]),a("br"),a("el-checkbox",{attrs:{label:"9"}},[t._v("09月")]),a("el-checkbox",{attrs:{label:"10"}},[t._v("10月")]),a("el-checkbox",{attrs:{label:"11"}},[t._v("11月")]),a("el-checkbox",{attrs:{label:"12"}},[t._v("12月")])],1)],1),a("div",{staticClass:"cron-date-wrapper"},[a("span",{staticClass:"cron-text"},[t._v("日期")]),a("div",{staticClass:"day-or-week-ctl"},[a("el-radio-group",{on:{change:t.dayOrWeekChange},model:{value:t.dayOrWeek,callback:function(e){t.dayOrWeek=e},expression:"dayOrWeek"}},[a("el-radio",{attrs:{label:"1"}},[t._v("日")]),a("el-radio",{attrs:{label:"2"}},[t._v("星期中的第几日")])],1)],1)]),a("div",{staticClass:"cron-day-or-week-con"},["1"===t.dayOrWeek?a("div",{staticClass:"cron-day-con"},[t._v(" 月中第 "),a("el-select",{key:t.dayOrWeek,staticClass:"cron-el-select",attrs:{size:"small",multiple:"",placeholder:"请选择"},model:{value:t.day.specificSpecific,callback:function(e){t.$set(t.day,"specificSpecific",e)},expression:"day.specificSpecific"}},t._l(31,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}},[t._v(t._s(e)+" ")])})),1),t._v(" 日（可多选），从（时：分） "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementStart,callback:function(e){t.$set(t.hour,"incrementStart",e)},expression:"hour.incrementStart"}}),t._v(" : "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 开始 ")],1):a("div",{staticClass:"cron-week-con"},[t._v(" 月中第几周 "),a("el-select",{key:t.dayOrWeek,staticClass:"cron-el-select",attrs:{size:"small",placeholder:"请选择"},model:{value:t.week.incrementStart,callback:function(e){t.$set(t.week,"incrementStart",e)},expression:"week.incrementStart"}},t._l(t.weekOrder,(function(t){return a("el-option",{key:t.label,attrs:{label:t.label,value:t.value}})})),1),a("br"),a("el-checkbox-group",{on:{change:t.test},model:{value:t.week.dayOfWeek.specificSpecific,callback:function(e){t.$set(t.week.dayOfWeek,"specificSpecific",e)},expression:"week.dayOfWeek.specificSpecific"}},[a("el-checkbox",{attrs:{label:"2"}},[t._v("周一")]),a("el-checkbox",{attrs:{label:"3"}},[t._v("周二")]),a("el-checkbox",{attrs:{label:"4"}},[t._v("周三")]),a("el-checkbox",{attrs:{label:"5"}},[t._v("周四")]),a("el-checkbox",{attrs:{label:"6"}},[t._v("周五")]),a("br"),a("el-checkbox",{attrs:{label:"7"}},[t._v("周六")]),a("el-checkbox",{attrs:{label:"1"}},[t._v("周日")])],1),a("br"),t._v(" 从（时:分） "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:23},model:{value:t.hour.incrementStart,callback:function(e){t.$set(t.hour,"incrementStart",e)},expression:"hour.incrementStart"}}),t._v(" : "),a("el-input-number",{staticClass:"cron-el-input-number",attrs:{size:"small",min:0,max:59},model:{value:t.minute.incrementStart,callback:function(e){t.$set(t.minute,"incrementStart",e)},expression:"minute.incrementStart"}}),t._v(" 开始 ")],1)])]):t._e()]),a("div",{staticClass:"cron-el cron-bottom"},[a("div",{staticClass:"cron-result"},[a("span",{staticClass:"value"},[t._v(t._s(this.cronTipText))])]),a("div",{staticClass:"cron-button-group"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.change}},[t._v("保存 ")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.close}},[t._v("关闭 ")])],1)])])}),r=[],l=(a("4e82"),a("d81d"),a("fb6a"),a("99af"),a("a9e3"),a("ac1f"),a("1276"),a("5319"),{name:"vueCron",props:["data"],data:function(){return{weekOrder:[{label:"第一周",value:"1"},{label:"第二周",value:"2"},{label:"第三周",value:"3"},{label:"第四周",value:"4"},{label:"第五周",value:"5"}],dayOrWeek:"1",datetime:"",minute:{incrementStart:"",incrementIncrement:""},hour:{incrementStart:"",incrementIncrement:""},day:{incrementStart:"",incrementIncrement:"",specificSpecific:[]},week:{incrementStart:"",incrementIncrement:"",specificSpecific:[],dayOfWeek:{incrementStart:"",specificSpecific:[]}},month:{incrementStart:"",incrementIncrement:"",specificSpecific:[]},options:[{value:"1",label:"一次性"},{value:"2",label:"每分"},{value:"3",label:"每时"},{value:"4",label:"每日"},{value:"5",label:"每周"},{value:"6",label:"每月"}],value:"1"}},watch:{data:function(){}},computed:{minutesText:function(){var t="";return t=0===this.minute.incrementStart||"0"===this.minute.incrementStart?"0":this.minute.incrementStart,this.minute.incrementIncrement&&(t=this.minute.incrementStart+"/"+this.minute.incrementIncrement),t},hoursText:function(){var t="";return t=0===this.hour.incrementStart||"0"===this.hour.incrementStart?"0":this.hour.incrementStart,this.hour.incrementIncrement&&(t=this.hour.incrementStart+"/"+this.hour.incrementIncrement),t},daysText:function(){var t="";return this.day.incrementStart&&(t=this.day.incrementStart),this.day.specificSpecific&&this.day.specificSpecific.length&&(this.day.specificSpecific=this.day.specificSpecific.sort(this.compare),this.day.specificSpecific.map((function(e){t+=e+","})),t=t.slice(0,-1)),this.day.incrementIncrement&&(t=this.day.incrementStart+"/"+this.day.incrementIncrement),(this.week.incrementStart&&"?"!==this.week.incrementStart||this.week.incrementIncrement)&&(t="?"),t},weeksText:function(){var t="";return this.week.specificSpecific&&(this.week.specificSpecific=this.week.specificSpecific.sort(this.compare),this.week.specificSpecific.map((function(e){t+=e+","})),t=t.slice(0,-1)),this.week.dayOfWeek.specificSpecific&&(this.week.dayOfWeek.specificSpecific=this.week.dayOfWeek.specificSpecific.sort(this.compare),this.week.dayOfWeek.specificSpecific.map((function(e){t+=e+","})),t=t.slice(0,-1)),"?"===this.week.incrementStart?t=this.week.incrementStart:this.week.incrementStart&&this.week.dayOfWeek.specificSpecific&&this.week.dayOfWeek.specificSpecific.length&&(t=t+"#"+this.week.incrementStart),t},monthsText:function(){var t="";return this.month.specificSpecific&&this.month.specificSpecific.length&&(this.month.specificSpecific=this.month.specificSpecific.sort(this.compare),this.month.specificSpecific.map((function(e){t+=e+","})),t=t.slice(0,-1)),this.month.incrementStart&&(t=this.month.incrementStart),t},cron:function(){return"0".concat(" ",this.minutesText||"*"," ").concat(this.hoursText||"*"," ").concat(this.daysText||"*"," ").concat(this.monthsText||"*"," ").concat(this.weeksText||"?"," ")},cronTipText:function(){return"0 * * * * ? *"===this.cron||"* * * * * ? *"===this.cron?"":(this.realTimeChange(),this.resultProcess(this.cron))}},methods:{compare:function(t,e){return Number(t)<Number(e)?-1:Number(t)>Number(e)?1:0},resultProcess:function(t){for(var e="",a=[],s=t.split(" "),n=0;n<s.length;n++){if(0===n&&(a[0]="0秒"),1===n)if(s[1].indexOf("*")>-1)a[1]="每分钟";else if(s[1].indexOf("/")>-1){var o=s[1].split("/");a[1]="每"+o[1]+"分钟，从"+o[0]+"分"}else a[1]=s[1]+"分";if(2===n)if(s[2].indexOf("*")>-1)a[2]="";else if(s[2].indexOf("/")>-1){var i=s[2].split("/");a[2]="每"+i[1]+"小时，从"+i[0]+"点"}else a[2]=s[2]+"点";if(3===n)if(s[3].indexOf("?")>-1)a[3]="";else if(s[3].indexOf("*")>-1)a[3]="";else if(s[3].indexOf("/")>-1){var r=s[3].split("/");a[3]="每"+r[1]+"天，从"+r[0]+"号的"}else s[3].indexOf(",")>-1?a[3]=s[3]+"日的":a[3]=s[3]+"日";if(4===n)if(s[4].indexOf("*")>-1)a[4]="";else if(s[4].indexOf("/")>-1){var l=s[4].split("/");a[4]="每"+l[1]+"个月执行，从"+l[0]+"月"}else s[4].indexOf(",")>-1?a[4]=s[4]+"月的":a[4]=s[4]+"月";if(5===n)if(s[5].indexOf("?")>-1)a[5]="";else if(s[5].indexOf("/")>-1){var c=s[5].split("/"),u=c[0].toString().replace(/1/,"周日").replace(/2/,"周一").replace(/3/,"周二").replace(/4/,"周三").replace(/5/,"周四").replace(/6/,"周五").replace(/7/,"周六");a[5]="每"+c[1]+"周，从"+u+"的"}else if(s[5].indexOf("#")>-1){var d=s[5].split("#"),p=d[0].toString().replace(/1/,"周日").replace(/2/,"周一").replace(/3/,"周二").replace(/4/,"周三").replace(/5/,"周四").replace(/6/,"周五").replace(/7/,"周六");a[5]="第"+d[1]+"周的"+p+"的"}else(0===s[5]||"0"===s[5]||s[5]&&-1===s[5].indexOf("#"))&&(a[5]="");6===n&&(a[6]="")}return s[5].indexOf("?")>-1?e=a.reverse().join(""):s[3].indexOf("?")>-1&&(e=a[4]+a[5]+a[3]+a[2]+a[1]+a[0]),e},dayOrWeekChange:function(){this.dayOrWeek="1"==this.dayOrWeek?"1":"2",1==this.dayOrWeek?(this.resetCronData(),this.minute.incrementStart="0",this.hour.incrementStart="0",this.day.specificSpecific=["1"],this.week.incrementStart="?",this.month.specificSpecific=[]):(this.resetCronData(),this.minute.incrementStart="0",this.hour.incrementStart="0",this.day.incrementStart="?",this.week.dayOfWeek.specificSpecific=["2"],this.month.specificSpecific=[])},realTimeChange:function(){this.$emit("change",this.cron)},change:function(){this.close()},test:function(){""==this.week.incrementStart&&this.$message.error("请先选择是第几周！")},close:function(){this.$emit("close")},datetimeChange:function(){this.datetime&&(this.month.incrementStart=this.datetime.getMonth()+1,this.day.incrementStart=this.datetime.getDate(),this.hour.incrementStart=this.datetime.getHours(),this.minute.incrementStart=this.datetime.getMinutes())},reset:function(){switch(this.value){case"1":this.resetCronData();break;case"2":this.resetCronData(),this.minute.incrementStart="0",this.minute.incrementIncrement="1";break;case"3":this.resetCronData(),this.minute.incrementStart="0",this.hour.incrementStart="0",this.hour.incrementIncrement="1";break;case"4":this.resetCronData(),this.minute.incrementStart="0",this.hour.incrementStart="0",this.day.incrementStart="1",this.day.incrementIncrement="1",this.day.specificSpecific=[],this.week.incrementStart="?";break;case"5":this.resetCronData(),this.minute.incrementStart="0",this.hour.incrementStart="0",this.day.incrementStart="?",this.week.incrementIncrement="1",this.week.dayOfWeek.specificSpecific=["2"];break;case"6":this.resetCronData(),this.dayOrWeek=1,this.minute.incrementStart="0",this.hour.incrementStart="0",this.day.specificSpecific=[],this.week.incrementStart="?",this.month.specificSpecific=[];break}},resetCronData:function(){this.minute.incrementStart="",this.minute.incrementIncrement="",this.hour.incrementStart="",this.hour.incrementIncrement="",this.day.incrementStart="",this.day.incrementIncrement="",this.day.specificSpecific="",this.week.incrementStart="",this.week.incrementIncrement="",this.week.specificSpecific="",this.week.dayOfWeek.specificSpecific="",this.month.incrementStart="",this.month.incrementIncrement="",this.month.specificSpecific=""}},mounted:function(){},created:function(){}}),c=l,u=(a("2517"),a("2877")),d=Object(u["a"])(c,i,r,!1,null,"c28ce1a4",null),p=d.exports,f=p,m={components:{cron:f},data:function(){return{flag:0,single:!0,input:"",chk_dbs:[],names:[],ids:[],db:{id:0,name:"",cron_state:1,cron_config:""},cronPopover:!1,isShow:!1}},methods:{changeCron:function(t){this.flag++,this.flag>1&&(this.db.cron_config=t)},parserCron:function(t){if(!t)return"";var e=a("7aa9");return e.toString(t,{locale:"zh_CN"})},show:function(t){this.chk_dbs=[],this.cronPopover=!1,this.chk_dbs=t,this.ids=[],this.names=[];var e,a=Object(o["a"])(this.chk_dbs);try{for(a.s();!(e=a.n()).done;){var s=e.value;this.ids.push(s.id),this.names.push(s.name)}}catch(n){a.e(n)}finally{a.f()}t&&1==t.length?(this.db.cron_config=t[0].cron_config,this.db.cron_state=t[0].cron_state):this.single=!1,this.isShow=!0},hide:function(){this.isShow=!1},closeHandle:function(){this.db={id:0,name:"",cron_state:1,cron_config:""},this.flag=0},onSubmit:function(){var t=this,e=2;this.single&&(e=this.db.cron_state),this.$api.db.cron_state(this.ids.join(","),e,this.db.cron_config).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("reload")}))}}},h=m,b=(a("82f9"),Object(u["a"])(h,s,n,!1,null,"2d719666",null));e["default"]=b.exports},"6fd9":function(t,e,a){"use strict";a("6bde")},"6fef":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("el-tooltip",{attrs:{content:"历史操作"}},[a("el-popover",{attrs:{"popper-class":"history",trigger:"click"},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}},[a("div",{staticClass:"inputs"},[a("el-input",{attrs:{size:"mini"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),a("div",{staticClass:"lists"},t._l(t.dataList,(function(e){return a("div",{key:e.id,staticClass:"item hbox hbox-center",on:{click:function(a){return t.onSelect(e)}}},[a("div",{staticClass:"sql"},[a("span",{staticClass:"time"},[t._v("["+t._s(t.showTime(e.start_time))+"]")]),a("span",{class:{"text-success":1==e.state,"text-error":1!=e.state}},[t._v(t._s(e.script))])])])})),0)])],1)],1)},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("2ef0")),l=a("2f62"),c=a("c1df"),u=a.n(c),d={data:function(){return{isShow:!1,keyword:"",dataList:[]}},computed:Object(i["a"])(Object(i["a"])({},Object(l["e"])(["runner","project"])),{},{db:function(){return this.runner&&this.runner.data?{id:this.runner.data.id}:{}},owner:function(){return this.runner&&this.runner.data?{id:this.runner.data.owner}:{}}}),props:{},watch:{isShow:function(t){t&&this.refresh()},owner:"refresh",keyword:Object(r["debounce"])((function(){this.refresh()}),300)},methods:{queryHistory:function(){console.log("history queryHistory ......"),this.refresh()},showTime:function(t){return u()(new Date(t)).format("MM-DD HH:mm")},refresh:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("history refresh ......"),e.next=3,t.$api.sql.history(t.project.id,t.db.id,t.owner.id,t.keyword);case 3:t.dataList=e.sent;case 4:case"end":return e.stop()}}),e)})))()},onSelect:function(t){this.runner.setSQL(t.script,!0)}},components:{},mounted:function(){console.log("history show ......"),this.refresh()}},p=d,f=(a("7b71"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},"704f":function(t,e,a){},"707c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page-project"},[a("div",{staticClass:"flex h-full"},[a("el-menu",{staticClass:"el-menu-vertical-demo page-aside",staticStyle:{width:"190px"},attrs:{"default-active":t.$route.fullPath,router:!0}},t._l(t.projectSubMenus,(function(e,s){return a("el-menu-item",{key:s,attrs:{index:t.getMenuPath(e.path)}},[a("k-icon",{attrs:{name:e.iconfont}}),a("span",{attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s("我的项目"==e.title?"工作台":e.title)+" ")])],1)})),1),a("div",{staticClass:" flex-1 flex flex-col"},[a("div",{staticClass:"project-header h-10"},[a("h3",{staticClass:"text-2xl p-2",staticStyle:{padding:"20px"}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:t.getMenuPath("/project/:id/dashboard")}}},[t._v(" "+t._s(t.dashboard_project.name)+" ")]),a("el-breadcrumb-item",[t._v(" "+t._s(t.$route.meta.alias)+" ")])],1)],1)]),a("div",{staticClass:"flex-1 relative"},[a("router-view")],1)])],1)])},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("caad"),a("2532"),a("a434"),a("b0c0"),a("2f62")),l=a("2ef0"),c=a("830e"),u=a("60fe");function d(t,e){for(var a=e.length-1;a>=0;a--){var s=e[a];s.role&&(s.role.includes(t)?s.children&&d(t,s.children):e.splice(a,1))}return e}var p={name:"project-index",computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(r["e"])(["dashboard_project","project_home","user"])),Object(r["e"])("d2admin",{keepAlive:function(t){return t.page.keepAlive},transitionActive:function(t){return t.transition.active}})),{},{getMenuPath:function(){var t=this;return function(e){return Object(l["replace"])(e,":id",t.dashboard_project.id)}},routerViewKey:function(){return console.log("this.$route.name: ",this.$route.name),this.$route.name}}),watch:{$route:function(t){}},data:function(){return{projectSubMenus:[]}},methods:{resetHeaderMenus:function(t){var e=t||this.user.role||0,a=Object(l["cloneDeep"])(c["a"]);this.dashboard_project.is_manager&&(e=u["g"]);var s=d(e,[a]);this.projectSubMenus=s[0].children||[]}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.project.info(t.dashboard_project.id,1);case 2:a=e.sent,t.formData=a,a.post="",t.$store.commit("project_home",a),t.$store.commit("dashboard_project",a),t.resetHeaderMenus(),s=t.$route.params.id,n=t.dashboard_project.id,n&&n!=s&&t.$router.push("/project/".concat(n,"/dashboard"));case 11:case"end":return e.stop()}}),e)})))()}},f=p,m=(a("d0d3"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,null,null);e["default"]=h.exports},"711d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"nodeInfoRef",staticClass:"node-info-component",staticStyle:{width:"24px","background-color":"#b7c2d3"},style:{width:t.nodeInfoVisble?"360px":"24px"}},[a("el-drawer",{staticStyle:{width:"360px"},style:{top:t.bound.top+"px"},attrs:{direction:"rtl",visible:t.visible,size:360,"modal-append-to-body":!1,modal:!1,"destroy-on-close":!0,wrapperClosable:!1},on:{"update:visible":function(e){t.visible=e},open:t.onOpen,opened:t.opened,close:t.close}},[a("div",{staticClass:"title flex items-center pl-5",attrs:{slot:"title"},slot:"title"},[a("k-icon",{staticClass:"mr-2",attrs:{name:"icon-FontAwesomeinfocircle"}}),t._v(" "+t._s(t.getTitle)+" ")],1),a("div",{staticClass:"p-5 node-info bg-gray-50",staticStyle:{"min-height":"100%"}},[t.nodeInfoData?t._l(t.getNodeInfoMap,(function(e,s){return a("div",{key:s,staticClass:"info-item mt-4"},[a("div",{staticClass:"info-item-key text-gray-500"},[t._v(t._s(s))]),a("div",{staticClass:"info-item-value"},[t._v(t._s(t.getValue(e)))])])})):a("div",[t._v(" 空 ")])],2)]),t.nodeInfoVisble?t._e():a("div",{staticClass:"flex flex-col cursor-pointer py-5 hover:opacity-70",staticStyle:{"min-height":"100px"},on:{click:function(e){t.visible=!0}}},[a("k-icon",{staticStyle:{margin:"5px"},attrs:{name:"icon-FontAwesomeinfocircle"}}),a("div",{staticClass:"flex ",class:{"whitespace-nowrap":!t.isHans(t.data.name||"未选择树节点")},style:t.getStyle(t.data.name||"未选择树节点")},[t._v(" "+t._s(t.data.name||"未选择树节点")+" ")])],1)],1)},n=[],o=a("5530"),i=(a("159b"),a("b64b"),a("4d63"),a("ac1f"),a("25f0"),a("b0c0"),a("99af"),{props:{data:{type:Object,default:function(){return{}}}},computed:{getNodeInfoMap:function(){if(this.nodeInfoData.info&&this.nodeInfoData.info instanceof Array){var t={};return this.nodeInfoData.info.forEach((function(e){e.Variable_name?t[e.Variable_name]=e.Value:Object.keys(e).forEach((function(a){t[a]=e[a]}))})),t}return this.nodeInfoData&&this.nodeInfoData.info},isHans:function(){return function(t){var e=new RegExp("[\\u4E00-\\u9FFF]+","g");return e.test(t)}},getTitle:function(){return this.nodeInfoData&&this.nodeInfoData.name?this.nodeInfoData.node_type?"".concat(this.nodeInfoData.name,"（").concat(this.nodeInfoData.node_type,"）"):this.nodeInfoData.sub_count?"".concat(this.nodeInfoData.name,"（").concat(this.nodeInfoData.sub_count,"）"):this.nodeInfoData.name:"详情"},getValue:function(){return function(t){return""==t?"空":t||0==t?t:null===t?"null":void 0===t?"undefined":void 0}},getStyle:function(){return function(t){var e=new RegExp("[\\u4E00-\\u9FFF]+","g"),a=e.test(t);return a?{transform:"rotate(0deg)",marginLeft:"5px"}:{transform:"rotate(90deg)",marginLeft:"0px",paddingLeft:"3px"}}}},watch:{data:function(t){this.nodeInfoVisble&&this.getNodeInfo()}},data:function(){return{visible:!1,nodeInfoVisble:!1,bound:{},nodeInfoData:null}},methods:{onOpen:function(){this.getNodeInfo()},getNodeInfo:function(){var t=this;if(this.data.name){var e=Object(o["a"])({},this.data._params);e.name||(e.name=this.data.name),this.$api.db.node_info(e).then((function(e){t.nodeInfoData=e}))}},opened:function(){this.nodeInfoVisble=!0},close:function(){this.nodeInfoVisble=!1}},mounted:function(){this.bound=this.$refs.nodeInfoRef.getBoundingClientRect(),console.log("nodeInfoRef; ")}}),r=i,l=(a("2ac3"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"55e58078",null);e["default"]=c.exports},7150:function(t,e,a){"use strict";a("5a6e")},"71a9":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[t._v(" 设置字体大小，字体 "),a("el-button",{attrs:{type:"primary",plain:"",round:""}},[a("d2-icon",{staticClass:"d2-mr-5",attrs:{name:"question-circle-o"}}),t._v(" 需要帮助吗 ")],1),a("br"),a("span",{staticClass:"text-success",staticStyle:{cursor:"default","font-size":"1rem"}},[t._v(" text-success ")]),a("br"),a("span",{staticClass:"text-error",staticStyle:{cursor:"default"}},[t._v(" text-error ")])],1)},n=[],o=a("2877"),i={},r=Object(o["a"])(i,s,n,!1,null,null,null);e["default"]=r.exports},7208:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-dashboard",use:"d2-dashboard-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-dashboard"><path d="M384 128h-170.666667c-46.933333 0-85.333333 38.4-85.333333 85.333333v170.666667c0 46.933333 38.4 85.333333 85.333333 85.333333h256V213.333333c0-46.933333-38.4-85.333333-85.333333-85.333333z m42.666667 298.666667H213.333333c-23.466667 0-42.666667-19.2-42.666666-42.666667v-170.666667c0-23.466667 19.2-42.666667 42.666666-42.666666h170.666667c23.466667 0 42.666667 19.2 42.666667 42.666666v213.333334zM810.666667 128h-170.666667c-46.933333 0-85.333333 38.4-85.333333 85.333333v256h256c46.933333 0 85.333333-38.4 85.333333-85.333333v-170.666667c0-46.933333-38.4-85.333333-85.333333-85.333333z m42.666666 256c0 23.466667-19.2 42.666667-42.666666 42.666667H597.333333V213.333333c0-23.466667 19.2-42.666667 42.666667-42.666666h170.666667c23.466667 0 42.666667 19.2 42.666666 42.666666v170.666667zM128 640v170.666667c0 46.933333 38.4 85.333333 85.333333 85.333333h170.666667c46.933333 0 85.333333-38.4 85.333333-85.333333V554.666667H213.333333c-46.933333 0-85.333333 38.4-85.333333 85.333333z m298.666667 170.666667c0 23.466667-19.2 42.666667-42.666667 42.666666h-170.666667c-23.466667 0-42.666667-19.2-42.666666-42.666666v-170.666667c0-23.466667 19.2-42.666667 42.666666-42.666667h213.333334v213.333334zM810.666667 554.666667H554.666667v256c0 46.933333 38.4 85.333333 85.333333 85.333333h170.666667c46.933333 0 85.333333-38.4 85.333333-85.333333v-170.666667c0-46.933333-38.4-85.333333-85.333333-85.333333z m42.666666 256c0 23.466667-19.2 42.666667-42.666666 42.666666h-170.666667c-23.466667 0-42.666667-19.2-42.666667-42.666666V597.333333h213.333334c23.466667 0 42.666667 19.2 42.666666 42.666667v170.666667z" p-id="20410" /></symbol>'});i.a.add(r);e["default"]=r},7213:function(t,e,a){var s={"./advlist":"0902","./advlist/":"0902","./advlist/index":"0902","./advlist/index.js":"0902","./advlist/plugin":"88b6","./advlist/plugin.js":"88b6","./advlist/plugin.min":"b2fc","./advlist/plugin.min.js":"b2fc","./anchor":"d2dc","./anchor/":"d2dc","./anchor/index":"d2dc","./anchor/index.js":"d2dc","./anchor/plugin":"169f","./anchor/plugin.js":"169f","./anchor/plugin.min":"f20d","./anchor/plugin.min.js":"f20d","./autolink":"2fec","./autolink/":"2fec","./autolink/index":"2fec","./autolink/index.js":"2fec","./autolink/plugin":"24e8","./autolink/plugin.js":"24e8","./autolink/plugin.min":"660b3","./autolink/plugin.min.js":"660b3","./autoresize":"7193","./autoresize/":"7193","./autoresize/index":"7193","./autoresize/index.js":"7193","./autoresize/plugin":"ae68","./autoresize/plugin.js":"ae68","./autoresize/plugin.min":"f43e","./autoresize/plugin.min.js":"f43e","./autosave":"ffbe","./autosave/":"ffbe","./autosave/index":"ffbe","./autosave/index.js":"ffbe","./autosave/plugin":"8ce1","./autosave/plugin.js":"8ce1","./autosave/plugin.min":"4cc3","./autosave/plugin.min.js":"4cc3","./bbcode":"a3db","./bbcode/":"a3db","./bbcode/index":"a3db","./bbcode/index.js":"a3db","./bbcode/plugin":"9b83","./bbcode/plugin.js":"9b83","./bbcode/plugin.min":"8440","./bbcode/plugin.min.js":"8440","./charmap":"c3d7","./charmap/":"c3d7","./charmap/index":"c3d7","./charmap/index.js":"c3d7","./charmap/plugin":"16f1","./charmap/plugin.js":"16f1","./charmap/plugin.min":"8887","./charmap/plugin.min.js":"8887","./code":"64d8","./code/":"64d8","./code/index":"64d8","./code/index.js":"64d8","./code/plugin":"ef1f","./code/plugin.js":"ef1f","./code/plugin.min":"a9d5","./code/plugin.min.js":"a9d5","./codesample":"07d7","./codesample/":"07d7","./codesample/index":"07d7","./codesample/index.js":"07d7","./codesample/plugin":"a8b8","./codesample/plugin.js":"a8b8","./codesample/plugin.min":"d096b","./codesample/plugin.min.js":"d096b","./colorpicker":"2d33","./colorpicker/":"2d33","./colorpicker/index":"2d33","./colorpicker/index.js":"2d33","./colorpicker/plugin":"303c","./colorpicker/plugin.js":"303c","./colorpicker/plugin.min":"4bae","./colorpicker/plugin.min.js":"4bae","./contextmenu":"f557","./contextmenu/":"f557","./contextmenu/index":"f557","./contextmenu/index.js":"f557","./contextmenu/plugin":"5e4c","./contextmenu/plugin.js":"5e4c","./contextmenu/plugin.min":"bd2d","./contextmenu/plugin.min.js":"bd2d","./directionality":"855b","./directionality/":"855b","./directionality/index":"855b","./directionality/index.js":"855b","./directionality/plugin":"e2d6","./directionality/plugin.js":"e2d6","./directionality/plugin.min":"6c49","./directionality/plugin.min.js":"6c49","./emoticons":"69e4","./emoticons/":"69e4","./emoticons/index":"69e4","./emoticons/index.js":"69e4","./emoticons/js/emojiimages":"bdc8","./emoticons/js/emojiimages.js":"bdc8","./emoticons/js/emojiimages.min":"64e4","./emoticons/js/emojiimages.min.js":"64e4","./emoticons/js/emojis":"4cb4","./emoticons/js/emojis.js":"4cb4","./emoticons/js/emojis.min":"67841","./emoticons/js/emojis.min.js":"67841","./emoticons/plugin":"d169","./emoticons/plugin.js":"d169","./emoticons/plugin.min":"58c3","./emoticons/plugin.min.js":"58c3","./fullpage":"e455","./fullpage/":"e455","./fullpage/index":"e455","./fullpage/index.js":"e455","./fullpage/plugin":"6b68","./fullpage/plugin.js":"6b68","./fullpage/plugin.min":"ce6f","./fullpage/plugin.min.js":"ce6f","./fullscreen":"3154","./fullscreen/":"3154","./fullscreen/index":"3154","./fullscreen/index.js":"3154","./fullscreen/plugin":"f034","./fullscreen/plugin.js":"f034","./fullscreen/plugin.min":"d32b","./fullscreen/plugin.min.js":"d32b","./help":"0aa0","./help/":"0aa0","./help/index":"0aa0","./help/index.js":"0aa0","./help/plugin":"3b47","./help/plugin.js":"3b47","./help/plugin.min":"b44e","./help/plugin.min.js":"b44e","./hr":"2b07","./hr/":"2b07","./hr/index":"2b07","./hr/index.js":"2b07","./hr/plugin":"dbbc","./hr/plugin.js":"dbbc","./hr/plugin.min":"d739","./hr/plugin.min.js":"d739","./image":"4ea8","./image/":"4ea8","./image/index":"4ea8","./image/index.js":"4ea8","./image/plugin":"cdd9","./image/plugin.js":"cdd9","./image/plugin.min":"0324","./image/plugin.min.js":"0324","./imagetools":"8863","./imagetools/":"8863","./imagetools/index":"8863","./imagetools/index.js":"8863","./imagetools/plugin":"9dd9","./imagetools/plugin.js":"9dd9","./imagetools/plugin.min":"5cd9","./imagetools/plugin.min.js":"5cd9","./importcss":"fbbd","./importcss/":"fbbd","./importcss/index":"fbbd","./importcss/index.js":"fbbd","./importcss/plugin":"3744","./importcss/plugin.js":"3744","./importcss/plugin.min":"3c08","./importcss/plugin.min.js":"3c08","./insertdatetime":"4bd0","./insertdatetime/":"4bd0","./insertdatetime/index":"4bd0","./insertdatetime/index.js":"4bd0","./insertdatetime/plugin":"a376","./insertdatetime/plugin.js":"a376","./insertdatetime/plugin.min":"bf42","./insertdatetime/plugin.min.js":"bf42","./legacyoutput":"4e6c","./legacyoutput/":"4e6c","./legacyoutput/index":"4e6c","./legacyoutput/index.js":"4e6c","./legacyoutput/plugin":"7028","./legacyoutput/plugin.js":"7028","./legacyoutput/plugin.min":"21d6","./legacyoutput/plugin.min.js":"21d6","./link":"4237","./link/":"4237","./link/index":"4237","./link/index.js":"4237","./link/plugin":"be7f","./link/plugin.js":"be7f","./link/plugin.min":"efc4","./link/plugin.min.js":"efc4","./lists":"84ec","./lists/":"84ec","./lists/index":"84ec","./lists/index.js":"84ec","./lists/plugin":"2401","./lists/plugin.js":"2401","./lists/plugin.min":"1d2d","./lists/plugin.min.js":"1d2d","./media":"3aea","./media/":"3aea","./media/index":"3aea","./media/index.js":"3aea","./media/plugin":"3699","./media/plugin.js":"3699","./media/plugin.min":"eba6","./media/plugin.min.js":"eba6","./nonbreaking":"eda9","./nonbreaking/":"eda9","./nonbreaking/index":"eda9","./nonbreaking/index.js":"eda9","./nonbreaking/plugin":"c361","./nonbreaking/plugin.js":"c361","./nonbreaking/plugin.min":"7146","./nonbreaking/plugin.min.js":"7146","./noneditable":"cfb0","./noneditable/":"cfb0","./noneditable/index":"cfb0","./noneditable/index.js":"cfb0","./noneditable/plugin":"43fc","./noneditable/plugin.js":"43fc","./noneditable/plugin.min":"ad62","./noneditable/plugin.min.js":"ad62","./pagebreak":"ebac","./pagebreak/":"ebac","./pagebreak/index":"ebac","./pagebreak/index.js":"ebac","./pagebreak/plugin":"080b","./pagebreak/plugin.js":"080b","./pagebreak/plugin.min":"41ad","./pagebreak/plugin.min.js":"41ad","./paste":"bc54","./paste/":"bc54","./paste/index":"bc54","./paste/index.js":"bc54","./paste/plugin":"7c4f","./paste/plugin.js":"7c4f","./paste/plugin.min":"1f55","./paste/plugin.min.js":"1f55","./preview":"0a9d","./preview/":"0a9d","./preview/index":"0a9d","./preview/index.js":"0a9d","./preview/plugin":"69a4","./preview/plugin.js":"69a4","./preview/plugin.min":"bfaf","./preview/plugin.min.js":"bfaf","./print":"840a","./print/":"840a","./print/index":"840a","./print/index.js":"840a","./print/plugin":"d4c3","./print/plugin.js":"d4c3","./print/plugin.min":"ef99","./print/plugin.min.js":"ef99","./quickbars":"90e7","./quickbars/":"90e7","./quickbars/index":"90e7","./quickbars/index.js":"90e7","./quickbars/plugin":"3c41","./quickbars/plugin.js":"3c41","./quickbars/plugin.min":"8322","./quickbars/plugin.min.js":"8322","./save":"6957","./save/":"6957","./save/index":"6957","./save/index.js":"6957","./save/plugin":"75b8","./save/plugin.js":"75b8","./save/plugin.min":"f8d0","./save/plugin.min.js":"f8d0","./searchreplace":"62e5","./searchreplace/":"62e5","./searchreplace/index":"62e5","./searchreplace/index.js":"62e5","./searchreplace/plugin":"2519","./searchreplace/plugin.js":"2519","./searchreplace/plugin.min":"cb54","./searchreplace/plugin.min.js":"cb54","./spellchecker":"dcb7","./spellchecker/":"dcb7","./spellchecker/index":"dcb7","./spellchecker/index.js":"dcb7","./spellchecker/plugin":"e704","./spellchecker/plugin.js":"e704","./spellchecker/plugin.min":"c0cd","./spellchecker/plugin.min.js":"c0cd","./tabfocus":"55a0","./tabfocus/":"55a0","./tabfocus/index":"55a0","./tabfocus/index.js":"55a0","./tabfocus/plugin":"f962","./tabfocus/plugin.js":"f962","./tabfocus/plugin.min":"81ed","./tabfocus/plugin.min.js":"81ed","./table":"07d1","./table/":"07d1","./table/index":"07d1","./table/index.js":"07d1","./table/plugin":"94ce","./table/plugin.js":"94ce","./table/plugin.min":"7012","./table/plugin.min.js":"7012","./template":"0335","./template/":"0335","./template/index":"0335","./template/index.js":"0335","./template/plugin":"0f58","./template/plugin.js":"0f58","./template/plugin.min":"51cb","./template/plugin.min.js":"51cb","./textcolor":"34de","./textcolor/":"34de","./textcolor/index":"34de","./textcolor/index.js":"34de","./textcolor/plugin":"09cf","./textcolor/plugin.js":"09cf","./textcolor/plugin.min":"529d","./textcolor/plugin.min.js":"529d","./textpattern":"78e4","./textpattern/":"78e4","./textpattern/index":"78e4","./textpattern/index.js":"78e4","./textpattern/plugin":"3ad8","./textpattern/plugin.js":"3ad8","./textpattern/plugin.min":"34a8","./textpattern/plugin.min.js":"34a8","./toc":"ef37","./toc/":"ef37","./toc/index":"ef37","./toc/index.js":"ef37","./toc/plugin":"fd06","./toc/plugin.js":"fd06","./toc/plugin.min":"d688","./toc/plugin.min.js":"d688","./visualblocks":"0efa","./visualblocks/":"0efa","./visualblocks/index":"0efa","./visualblocks/index.js":"0efa","./visualblocks/plugin":"4bdc","./visualblocks/plugin.js":"4bdc","./visualblocks/plugin.min":"1308","./visualblocks/plugin.min.js":"1308","./visualchars":"365e","./visualchars/":"365e","./visualchars/index":"365e","./visualchars/index.js":"365e","./visualchars/plugin":"cf08","./visualchars/plugin.js":"cf08","./visualchars/plugin.min":"8c23","./visualchars/plugin.min.js":"8c23","./wordcount":"9434","./wordcount/":"9434","./wordcount/index":"9434","./wordcount/index.js":"9434","./wordcount/plugin":"e8b0","./wordcount/plugin.js":"e8b0","./wordcount/plugin.min":"60a0","./wordcount/plugin.min.js":"60a0"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="7213"},"72ca":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"该角色["+t.project.data_role+"]的数据权限",visible:t.isShow,width:"800px",height:"600px","before-close":t.hide,"append-to-body":"",center:""},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticClass:"database"},[a("div",[a("span",{staticStyle:{padding:"20px"}},[t._v(" 项目："+t._s(t.project.name)+" ")]),a("div",{staticStyle:{padding:"20px","font-size":"12px"}},[t._v(" 图标: "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v(" 异步查询 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("异步导出/导出文件 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("导出Sql ")]),a("el-tree",{ref:"tree2",staticClass:"role-auth-tree",attrs:{data:t.list,"node-key":"id",props:t.defaultProps,indent:26,isLeaf:function(t){return"col"==t.node_type},"highlight-current":"",lazy:"",load:t.onNextLoad},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",["db"==n.node_type?a("span",[t._v(" ["+t._s(n.db_type)+"]"+t._s(s.label)+" ")]):"owner"==n.node_type?a("span",[t._v(" [实例]"+t._s(s.label)+" ")]):"table"==n.node_type?a("span",[t._v(" [表]"+t._s(s.label)+" ")]):a("span",[t._v("[字段]"+t._s(s.label))]),1==n.rw?a("i",{staticClass:"sn-font auth-read"},[t._v("读")]):2==n.rw?a("i",{staticClass:"sn-font auth-write"},[t._v("写")]):4==n.rw?a("i",{staticClass:"sn-font auth-manage"},[t._v("管")]):3==n.rw&&"col"!=n.node_type?a("i",{staticClass:"sn-font auth-disable"},[t._v("禁")]):t._e(),"col"!=n.node_type?a("span",[1==n.asyn_query?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_export?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_sql?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e()]):t._e(),3==n.rw&&"col"==n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("敏")]):t._e()])])}}])})],1)])])},n=[],o=(a("b0c0"),{data:function(){return{id:"",is_admin:!1,isShow:!1,defaultProps:{children:"children",label:"name"},role_name:"",project:{},list:[],expKeys:[]}},computed:{},props:{},watch:{},methods:{show:function(t){this.project=t,this.init(),this.isShow=!0},hide:function(){this.list=[],this.isShow=!1},reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(t,e){var a=t.data;a&&a.length>0&&e(a),a&&"col"==a.node_type&&e([]),a&&a.children?e(a.children):a&&a.id&&a.name?this.$api.my.myAuthChildren(a).then((function(t){t?(a.children=t,e(t)):e([])})):e([])},openApply:function(t){this.$refs.applyDialog.show(t)},init:function(){var t=this;this.$api.my.myAuth(this.project.id).then((function(e){if(t.list=e,e&&e.length)for(var a=0;a<e.length;a++)t.expKeys.push(e[a].id)}))}},components:{},mounted:function(){}}),i=o,r=(a("586b2"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},7308:function(t,e,a){"use strict";a.r(e);var s=a("a18c"),n=a("2ef0"),o=a("95a2");e["default"]={namespaced:!0,actions:{set:function(t,e){var a=e.dbName,s=void 0===a?"database":a,n=e.path,i=void 0===n?"":n,r=e.value,l=void 0===r?"":r,c=e.user,u=void 0!==c&&c,d=e.project,p=void 0!==d&&d;Object(o["c"])({dbName:s,path:i,value:l,user:u,project:p})},get:function(t,e){var a=e.dbName,s=void 0===a?"database":a,n=e.path,i=void 0===n?"":n,r=e.defaultValue,l=void 0===r?"":r,c=e.user,u=void 0!==c&&c,d=e.project,p=void 0!==d&&d;return Object(o["b"])({dbName:s,path:i,defaultValue:l,user:u,project:p})},database:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.user,s=void 0!==a&&a;return Object(o["a"])({user:s,defaultValue:{}})},databaseClear:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.user,s=void 0!==a&&a;return Object(o["a"])({user:s,validator:function(){return!1},defaultValue:{}})},databasePage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.basis,n=void 0===a?"fullPath":a,i=e.user,r=void 0!==i&&i;return Object(o["a"])({path:"$page.".concat(s["a"].app.$route[n]),user:r,defaultValue:{}})},databasePageClear:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.basis,n=void 0===a?"fullPath":a,i=e.user,r=void 0!==i&&i;return Object(o["a"])({path:"$page.".concat(s["a"].app.$route[n]),user:r,validator:function(){return!1},defaultValue:{}})},pageSet:function(t,e){var a=e.instance,i=e.basis,r=void 0===i?"fullPath":i,l=e.user,c=void 0!==l&&l;return Object(o["a"])({path:"$page.".concat(s["a"].app.$route[r],".$data"),user:c,validator:function(){return!1},defaultValue:Object(n["cloneDeep"])(a.$data)})},pageGet:function(t,e){var a=e.instance,i=e.basis,r=void 0===i?"fullPath":i,l=e.user,c=void 0!==l&&l;return Object(o["b"])({path:"$page.".concat(s["a"].app.$route[r],".$data"),user:c,defaultValue:Object(n["cloneDeep"])(a.$data)})},pageClear:function(t,e){var a=e.basis,n=void 0===a?"fullPath":a,i=e.user,r=void 0!==i&&i;return Object(o["a"])({path:"$page.".concat(s["a"].app.$route[n],".$data"),user:r,validator:function(){return!1},defaultValue:{}})}}}},"733b":function(t,e,a){},7363:function(t,e,a){},"736a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"ref-history",staticClass:"result-history"},[a("div",{staticClass:"inputs"},[a("el-input",{attrs:{size:"mini",placeholder:"筛选历史操作"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),a("span",{staticClass:"update-time"},[t._v("更新于："+t._s(t.updateTime))])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"overflow",style:{height:t.tabHeight}},[a("div",{staticClass:"lists"},t._l(t.dataList,(function(e){return a("div",{key:e.id,staticClass:"item hbox hbox-center"},[a("div",{staticClass:"sql"},[a("span",{staticClass:"time"},[t._v("["+t._s(t.showTime(e.start_time))+"]")]),a("span",{staticClass:"sql-code",class:{"text-primary":1==e.state,"text-error":1!=e.state},on:{click:function(a){return t.onSelect(e)}}},[t._v(t._s(e.script))])])])})),0),t.dataList&&0!=t.dataList.length?t._e():a("div",{staticClass:"empty"},[t._v(" 空数据 ")])])])},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("2ef0")),l=a("2f62"),c=a("c1df"),u=a.n(c),d=a("e31c"),p={data:function(){return{keyword:"",dataList:[],tabHeight:"150px",loading:!1,updateTime:""}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(l["e"])(["runner","project","service","runList","selecedDB"])),Object(l["c"])(["run"])),{},{db:function(){return this.service&&this.service.data?{id:this.service.data.id}:{}}}),props:{runTabId:{}},watch:{keyword:Object(r["debounce"])((function(){this.refresh()}),300)},methods:{resize:function(){var t=this.$refs["ref-history"];if(t){var e=t.offsetHeight;this.tabHeight=e-80+"px"}},showTime:function(t){return u()(new Date(t)).format("MM-DD HH:mm")},refresh:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$api.sql.history(t.project.id,t.db.id,t.run.owner,t.keyword);case 3:t.dataList=e.sent,t.updateTime=u()(new Date).format("MM-DD HH:mm:ss"),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},onSelect:function(t){var e=t.script,a={command:62,comment:!0,sql:e,dbType:t.db_type};this.selecedDB&&this.selecedDB.instance&&(a.dbName=this.selecedDB.instance.label),this.selecedDB&&this.selecedDB.source&&(a.sourceName=this.selecedDB.source.label),e=d["a"].generate(a),console.log("历史记录：",e),this.service.insertSQL(e)}},created:function(){},mounted:function(){},beforeDestroy:function(){this.$bus.off("runHistory")}},f=p,m=(a("2c28"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,"212eb5d2",null);e["default"]=h.exports},"73e6":function(t,e,a){"use strict";a("8647")},7481:function(t,e,a){"use strict";a("657c")},"74b8":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project"},[a("k-search-table",{ref:"st",attrs:{data:t.dataList,url:"/api/project/page","search-data":t.search},on:{reset:t.resetSearch}},["list"==t.type?a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1):t._e(),a("template",{slot:"buttons"},["list"==t.type?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("添加项目")]):t._e(),"list"==t.type?a("el-button",{attrs:{size:"mini"},on:{click:t.goto}},[t._v("回收站")]):t._e()],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),e.row.is_expire?a("el-tag",{attrs:{type:"danger"}},[t._v("已过期")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"是否启用",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 "),1==e.row.state?a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,2)}}},[t._v("[停用]")]):t._e()],1):a("span",{staticClass:"text-warn"},[t._v(" 否 "),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.onState(e.row,1)}}},[t._v("[启用]")])],1)]}}])}),a("el-table-column",{attrs:{label:"是否公开"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.public_state?a("el-tag",{attrs:{type:"success"}},[t._v("是")]):a("el-tag",{attrs:{type:"info"}},[t._v("否")])]}}])}),a("el-table-column",{attrs:{label:"成员",prop:"user_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除用户"},on:{click:function(a){return a.stopPropagation(),t.$refs.userDialog.show(e.row)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.user_count)+") ")])]}}])}),a("el-table-column",{attrs:{label:"数据源",prop:"db_count"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"pointer-active",attrs:{title:"单击关联/移除数据库"},on:{click:function(a){return a.stopPropagation(),t.$refs.dbDialog.show(e.row)}}},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v(" ("+t._s(e.row.db_count)+") ")])]}}])}),a("el-table-column",{attrs:{label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.createdAt)))]}}])}),"list"==t.type?a("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{title:"工单流程",size:"mini",type:"primary"},on:{click:function(a){return t.onWorkFlow(e.row)}}},[t._v("流程 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onRole(e.row)}}},[t._v(" 角色 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onShowInception(e.row)}}},[t._v(" 审计 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onWorkConfig(e.row)}}},[t._v(" 工单 ")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onEdit(e.row)}}},[t._v(" 修改 ")]),a("k-btn-tip",{attrs:{tip:"确定要将【"+e.row.name+"】项目删除吗?"},on:{click:function(a){return t.onDel(e.row,2)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除 ")])],1)]}}],null,!1,3562366640)}):t._e(),"trash"==t.type?a("el-table-column",{attrs:{label:"操作",width:"500px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onDel(e.row,1)}}},[t._v("恢复项目 ")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】项目吗,删除后不可在恢复?"},on:{click:function(a){return t.onDel(e.row,3)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("彻底删除 ")])],1)]}}],null,!1,2024109581)}):t._e()],1)],2),a("dialog-edit",{ref:"dialogEdit",on:{refresh:t.refresh}}),a("dialog-auth",{ref:"dialogAuth"}),a("dialog-user",{ref:"userDialog",on:{refresh:t.refresh}}),a("dialog-db",{ref:"dbDialog",on:{refresh:t.refresh}}),a("dialog-role",{ref:"roleDialog"}),a("dialog-work-setting",{ref:"dialogWorkSetting",on:{refresh:t.refresh}}),a("dialog-inception",{ref:"dialogInceptionSetting"}),a("dialog-work",{ref:"dialogWork"})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("a15b"),a("2f62")),r=a("dcb1"),l=a("1e99"),c=a("3867"),u=a("c116"),d=a("dd1f"),p=a("f983"),f=a("4eaf"),m=a("1bbd"),h=a("5c96"),b=a("c1df"),_=a.n(b),g={components:{DialogEdit:r["default"],DialogAuth:l["default"],DialogUser:d["default"],DialogDb:p["default"],DialogRole:u["default"],DialogWork:m["default"],DialogWorkSetting:c["default"],DialogInception:f["default"]},props:{type:{default:"list"}},computed:Object(o["a"])({},Object(i["e"])(["user"])),data:function(){return{no_role:!1,search:{has_del:"list"==this.type?1:2},dataList:[],roles:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},methods:{handleClick:function(t,e){"trash"==this.type?this.search.has_del=2:this.search.has_del=1,this.refresh()},onUserList:function(){},showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return _()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){e.onSuccess(t),e.refresh("操作成功")}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onWorkConfig:function(t){this.$refs.dialogWork.show(t)},onNew:function(){this.$refs.dialogEdit.show()},goto:function(){this.$router.push("/mgt/project/trash")},onRole:function(t){this.$refs.roleDialog.show(t,!0)},onWorkFlow:function(t){this.$refs.dialogWorkSetting.show(t)},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onShowInception:function(t){this.$refs.dialogInceptionSetting.show(t)},onEdit:function(t){this.$refs.dialogEdit.show(t)},onState:function(t,e){var a=this;this.$api.project.state(t.id,e).then((function(){a.onSuccess("操作成功"),a.refresh()}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t,e){var a=this;this.$api.project.delete(t.id,e).then((function(t){a.onSuccess(t),a.refresh()}),(function(t){h["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}}},v=g,y=(a("5647"),a("2877")),w=Object(y["a"])(v,s,n,!1,null,"41117f11",null);e["default"]=w.exports},7638:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("el-tooltip",{attrs:{content:"设置"}},[a("el-button",{staticClass:"query-tool-item text-primary",attrs:{size:"mini",type:"text"},on:{click:t.show}},[a("k-icon",{staticClass:"sn-font",attrs:{name:"icon-jijuweixiushenqing"}})],1)],1),a("div",{staticStyle:{"padding-right":"24px"}}),t.isShow?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:t.isShow,width:"600px","custom-class":"dialog-setting","show-close":!1},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[a("div",[t._v("设置")]),a("div",[a("el-button",{attrs:{size:"mini",round:"",icon:"el-icon-circle-close"},on:{click:t.hide}},[t._v("关闭")]),a("el-button",{attrs:{size:"mini",round:"",icon:"el-icon-upload",title:"保存到云端"},on:{click:t.onSaveSetting}},[t._v("保存")])],1)]),a("el-form",{attrs:{"label-position":"top",size:"mini","label-suffix":":"}},[a("el-tabs",{attrs:{type:"card"},model:{value:t.tabsActiveName,callback:function(e){t.tabsActiveName=e},expression:"tabsActiveName"}},[a("el-tab-pane",{attrs:{label:"主题",name:"theme"}},[a("el-radio-group",{on:{change:t.onThemeChange},model:{value:t.themeName,callback:function(e){t.themeName=e},expression:"themeName"}},t._l(t.themes,(function(e){return a("div",{key:e.name,staticClass:"mb-3"},[a("el-radio",{staticStyle:{width:"120px"},attrs:{border:"",label:e.name,title:e.description}},[t._v(" "+t._s(e.title)+" ")])],1)})),0)],1),a("el-tab-pane",{attrs:{label:"编辑器",name:"editor"}},[a("el-form-item",{attrs:{label:"字体大小(px)"}},[a("el-input-number",{attrs:{min:12,max:40,value:t.formData.editFontSize},on:{change:t.onEditFontSizeChange}})],1)],1),a("el-tab-pane",{attrs:{label:"快捷键",name:"hotkey"}},[a("el-form-item",{attrs:{label:"查询"}},[a("hot-key-input",{attrs:{hotkey:t.hotKeyData.search,verify:t.handleHotkeyVerify,max:1,type:"lowser",reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"search",e)}}})],1),a("el-form-item",{attrs:{label:"上一页"}},[a("hot-key-input",{attrs:{hotkey:t.hotKeyData.preSearch,verify:t.handleHotkeyVerify,max:1,type:"lowser",reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"preSearch",e)}}})],1),a("el-form-item",{attrs:{label:"下一页"}},[a("hot-key-input",{attrs:{type:"lowser",hotkey:t.hotKeyData.nextSearch,verify:t.handleHotkeyVerify,max:1,reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"nextSearch",e)}}})],1),a("el-form-item",{attrs:{label:"叠加查询"}},[a("hot-key-input",{attrs:{type:"lowser",hotkey:t.hotKeyData.appendSearch,verify:t.handleHotkeyVerify,max:1,reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"appendSearch",e)}}})],1),a("el-form-item",{attrs:{label:"复制窗口"}},[a("hot-key-input",{attrs:{type:"lowser",hotkey:t.hotKeyData.newWindow,verify:t.handleHotkeyVerify,max:1,reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"newWindow",e)}}})],1),a("el-form-item",{attrs:{label:"关闭窗口"}},[a("hot-key-input",{attrs:{type:"lowser",hotkey:t.hotKeyData.closeWindow,verify:t.handleHotkeyVerify,max:1,reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"closeWindow",e)}}})],1),a("el-form-item",{attrs:{label:"代码格式化"}},[a("hot-key-input",{attrs:{type:"lowser",hotkey:t.hotKeyData.format,verify:t.handleHotkeyVerify,max:1,reset:!1,shake:!0,range:null,placeholder:"请按需要绑定的按键，支持组合按键"},on:{"update:hotkey":function(e){return t.$set(t.hotKeyData,"format",e)}}})],1)],1)],1)],1)],1):t._e()],1)},n=[],o=a("5530"),i=(a("4de4"),a("b0c0"),a("d3b7"),a("caad"),a("2ca0"),a("2f62")),r=a("d708"),l=a("0582"),c=a("2ef0"),u=["ctrl+w","ctrl+shift+w","ctrl+shift+n","ctrl+t","ctrl+n","ctrl+shift+t","ctrl+tab","ctrl+pagedown","ctrl+shift+tab","ctrl+pageup","alt+f4","cmd+q"],d={computed:Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(i["e"])(["setting","user","service"])),Object(i["e"])("d2admin/theme",["activeName"])),Object(i["c"])("d2admin/theme",["activeSetting"])),{},{isHotKeyTab:function(){return"hotkey"===this.tabsActiveName}}),data:function(){return{themeName:"sqldev",themes:r["b"],tabsActiveName:"theme",isShow:!1,settingKey:Date.now(),hotKeyData:{},formData:{editFontSize:14}}},methods:{onThemeChange:function(t){var e=this.themes.filter((function(e){return e.name===t}));this.formData.theme=e[0],Object(l["a"])(e[0])},onEditFontSizeChange:function(t){this.formData.editFontSize=t,this.onSubmit()},onSaveSetting:function(){var t=this,e={};for(var a in this.hotKeyData)console.log("this.item[key]: ",this.hotKeyData[a]),e[a]=this.hotKeyData[a][0];var s=JSON.stringify(Object(o["a"])(Object(o["a"])({},this.formData),{},{hotKeys:e})),n=JSON.stringify(this.formData.hotKeys),i=JSON.stringify(e),r=n!==i;console.info("云端保存主题：",this.formData.theme),console.info("[tool.setting.vue]#onSaveSetting: 是否修改快捷键：",r),this.$api.post("/api/my/user/update",{setting:s}).then((function(e){t.$store.commit("user",e.user),r&&t.$confirm("快捷键刷新生效","刷新网页",{confirmButtonText:"刷新",cancelButtonText:"取消",type:"warning"}).then((function(){window.location.reload()}))})).finally((function(){t.isShow=!1}))},handleHotkeyVerify:function(t){var e=t.text.toLowerCase();return console.log("验证：",e,this.item),u.includes(e)?(this.$message.warning("该快捷键不允许使用： ".concat(e)),!1):this.isExist(e)?(this.$message.warning("".concat(e," 快捷键已设置")),!1):e.startsWith("ctrl")||e.startsWith("alt")||e.startsWith("meta")?e.indexOf("+")>0:(this.$message.warning("快捷键需要以ctrl、alt或meta开头的组合键：".concat(e)),!1)},isExist:function(t){for(var e in this.hotKeyData)if(this.hotKeyData[e]&&this.hotKeyData[e][0]&&this.hotKeyData[e][0].toLowerCase()==t.toLowerCase())return!0;return!1},refresh:function(){var t={};if(this.setting&&this.setting.hotKeys)for(var e in console.log("this.setting.hotKeys: ",this.setting.hotKeys),this.setting.hotKeys)"editFontSize"===e?this.formData.editFontSize!=this.setting.hotKeys[e]&&this.onEditFontSizeChange(this.setting.hotKeys[e]):(t[e]=[],t[e][0]=this.setting.hotKeys[e]);else t={search:["alt+r"],preSearch:["alt+,"],nextSearch:["alt+."],appendSearch:["alt+a"],newWindow:["alt+n"],closeWindow:["alt+w"],format:["ctrl+shift+f"]};this.hotKeyData=Object(o["a"])({},t)},show:function(t){this.refresh(),this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){var t=Object(o["a"])({},this.setting.hotKeys);this.formData.editFontSize&&(t.editFontSize=this.formData.editFontSize);var e=Object(o["a"])(Object(o["a"])({},this.setting),{},{hotKeys:t});this.$store.commit("onlySetting",e)}},mounted:function(){this.formData=Object(c["cloneDeep"])(this.setting),this.formData.theme?this.themeName=this.formData.theme.name:(this.formData.theme=this.activeSetting,this.themeName=this.activeName),this.formData.editFontSize||(this.formData.editFontSize=14),console.log("setting: ",this.setting,this.formData,this.themeName)}},p=d,f=(a("35bd"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},7648:function(t,e,a){"use strict";a("8bba")},7662:function(t,e,a){"use strict";a("0056")},"76e7":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"database"},[a("k-search-table",{ref:"st",attrs:{url:"/api/audit/list","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"申请人",prop:"user_name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"审核状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.status_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"编号",prop:"id"}}),a("el-table-column",{attrs:{label:"申请人",prop:"opt_user_name"}}),a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"申请理由",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过 ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.row.status,expression:"r.row.status == 1"}],attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.openApply(e.row)}}},[t._v("审核 ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1!=e.row.status,expression:"r.row.status != 1"}],attrs:{size:"mini",type:"info"},on:{click:function(a){return t.openApply(e.row,!0)}}},[t._v("查看 ")])]}}])})],1)],2),a("dialog-apply",{ref:"applyDialog",on:{refresh:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("fa4d")),i={data:function(){return{search:{db_type:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],status_types:[{k:"0",v:"全部"},{k:"1",v:"待审核"},{k:"2",v:"已通过"},{k:"3",v:"未通过"}]}},computed:{},props:{},watch:{},methods:{refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},openApply:function(t,e){this.$refs.applyDialog.show(t,e)}},components:{DialogApply:o["default"]},mounted:function(){}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"77e9":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("el-form-item",{attrs:{label:"邮件通知"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"多人用,分割"},model:{value:t.db.cron_config.email,callback:function(e){t.$set(t.db.cron_config,"email",e)},expression:"db.cron_config.email"}})],1),a("el-form-item",{attrs:{label:"连接线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.cron_config.alarm_connect_size,callback:function(e){t.$set(t.db.cron_config,"alarm_connect_size",e)},expression:"db.cron_config.alarm_connect_size"}})],1),a("el-form-item",{attrs:{label:"活动线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.cron_config.alarm_active_size,callback:function(e){t.$set(t.db.cron_config,"alarm_active_size",e)},expression:"db.cron_config.alarm_active_size"}})],1),a("el-form-item",{attrs:{label:"等待线程数"}},[a("el-input-number",{staticStyle:{width:"300px"},attrs:{size:"mini",placeholder:"达到多少告警,为空不告警"},model:{value:t.db.cron_config.alarm_wait_size,callback:function(e){t.$set(t.db.cron_config,"alarm_wait_size",e)},expression:"db.cron_config.alarm_wait_size"}})],1)],1)},n=[],o={data:function(){return{}},computed:{},props:{db:{default:{}}},watch:{},methods:{},components:{},mounted:function(){}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"77ef":function(t,e,a){},"782c":function(t,e,a){"use strict";a.r(e),e["default"]=[{name:"查询策略",id:"SELECT",leaf:!0,c:[{name:"查询并发",id:"query_count",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"用户并发查询",id:"user_count",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"number"},{name:"全局并发查询",id:"global_count",leaf:!0,tip:"所有用户同时可进行几条查询,0或者空代表不限制。",type:"number"}]},{name:"查询条件",id:"query_where",target:{mode:"table",manual:!1},dataStep:"table",c:[{name:"查询必带参数",id:"must_param",leaf:!0,tip:"查询必带参数,可设置多个组合",type:"params_select"}]}]},{name:"脱敏策略",id:"MASK",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"字段脱敏",id:"field_mask",leaf:!0,target:{mode:"*",manual:!1},c:[{name:"脱敏字段名",id:"field_mask",leaf:!0,tip:"可用*模糊匹配,多个字段使用逗号分隔",type:"string"},{name:"忽略的字段名",id:"field_ignore",leaf:!0,tip:"可以排除掉的字段名称,不支持模糊匹配，多个字段使用逗号分隔",type:"string"},{name:"脱敏策略",id:"mask_code",leaf:!0,tip:"脱敏方式",type:"mask_code"}]},{name:"内容脱敏",id:"val_mask",leaf:!0,target:{mode:"table",manual:!1},c:[{name:"匹配表达式",id:"val_regexp",leaf:!0,tip:"可选或自定义",type:"mask_val"},{name:"忽略大小写",id:"ignore_case",leaf:!0,tip:"忽略大小写",type:"checkbox"},{name:"多行匹配",id:"multi_line",leaf:!0,tip:"多行匹配",type:"checkbox"},{name:"替换规则",id:"mask_code",leaf:!0,tip:"单个用户同时可进行几条查询,0或者空代表不限制。",type:"mask_code"}]}]}]},7844:function(t,e,a){"use strict";a("eadd")},7957:function(t,e,a){},"7a3b":function(t,e,a){"use strict";a("4c7e")},"7a3f":function(t,e,a){},"7a96":function(t,e,a){},"7add":function(t,e,a){"use strict";a("b628")},"7af4":function(t,e,a){},"7b60":function(t,e,a){},"7b71":function(t,e,a){"use strict";a("370d")},"7b94":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-share",use:"d2-share-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-share"><path d="M811.3 938.7H217.5c-71.5 0-129.8-58.2-129.8-129.8V215.1c0-71.6 58.2-129.8 129.8-129.8h296.9c23.6 0 42.7 19.1 42.7 42.7s-19.1 42.7-42.7 42.7H217.5c-24.5 0-44.4 19.9-44.4 44.4v593.8c0 24.5 19.9 44.4 44.4 44.4h593.8c24.5 0 44.4-19.9 44.4-44.4V512c0-23.6 19.1-42.7 42.7-42.7S941 488.4 941 512v296.9c0 71.6-58.2 129.8-129.7 129.8z" fill="#3688FF" /><path d="M898.4 405.3c-23.6 0-42.7-19.1-42.7-42.7V212.9c0-23.3-19-42.3-42.3-42.3H663.7c-23.6 0-42.7-19.1-42.7-42.7s19.1-42.7 42.7-42.7h149.7c70.4 0 127.6 57.2 127.6 127.6v149.7c0 23.7-19.1 42.8-42.6 42.8z" fill="#5F6379" /><path d="M373.6 712.6c-10.9 0-21.8-4.2-30.2-12.5-16.7-16.7-16.7-43.7 0-60.3L851.2 132c16.7-16.7 43.7-16.7 60.3 0 16.7 16.7 16.7 43.7 0 60.3L403.8 700.1c-8.4 8.3-19.3 12.5-30.2 12.5z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},"7cf9":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-notice",use:"d2-notice-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-notice"><path d="M512 128c-23.6 0-42.7-19.1-42.7-42.7V42.7C469.3 19.1 488.4 0 512 0s42.7 19.1 42.7 42.7v42.7c0 23.5-19.1 42.6-42.7 42.6zM512 1024c-61.8 0-122.3-10.5-179.9-31.1-22.2-7.9-33.7-32.4-25.8-54.6 8-22.2 32.3-33.8 54.6-25.8 98.4 35.3 209.2 34.6 307.1-1.8 22.1-8.2 46.6 3 54.9 25.1 8.2 22.1-3 46.6-25.1 54.9-59.5 22.1-121.9 33.3-185.8 33.3z" /><path d="M845 874.7H179c-75.2 0-136.4-61.2-136.4-136.4v-4.6c0-57.1 34.7-106 85.3-126.1V426.7c0-211.7 172.3-384 384-384s384 172.3 384 384v180.9c50.6 20.1 85.3 69 85.3 126.1v4.6c0.1 75.2-61 136.4-136.2 136.4zM512 128c-164.7 0-298.7 134-298.7 298.7v253.2l-38.9 3.5c-26.5 2.4-46.5 24-46.5 50.3v4.6c0 28.1 22.9 51 51 51h666c28.1 0 51-22.9 51-51v-4.6c0-26.3-20-48-46.5-50.3l-38.9-3.5V426.7C810.7 262 676.7 128 512 128z" /></symbol>'});i.a.add(r);e["default"]=r},"7d3d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"project-home",attrs:{type:"ghost"}},[a("div",{staticClass:"container padding-x-24"},[a("el-row",[a("div",{staticClass:"lin-wrap"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],staticClass:"post-input",attrs:{name:"",id:"",rows:"30"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}})])]),a("el-row",{staticStyle:{padding:"20px"}},[a("el-button",{staticStyle:{width:"150px"},attrs:{type:"primary",round:""},on:{click:function(e){return t.save()}}},[t._v("保 存")])],1),a("div",{staticStyle:{height:"140px"}},[t._v(" ")])],1)])},n=[],o={data:function(){return{formData:{name:""},id:this.$route.params.id,is_admin:!1,isShow:!1,text:"",project:{name:"",post:""}}},methods:{init:function(){var t=this;this.$api.project.info(this.id,1).then((function(e){t.project=e,t.text=e.post}))},save:function(){var t=this;this.project.post=this.text,this.$api.project.post(this.project).then((function(e){t.onSuccess("保存成功")}))},reset:function(){return{state:0,roles:[],roles_str:""}}},mounted:function(){this.init()}},i=o,r=(a("492c"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"f9a43606",null);e["default"]=l.exports},"7d52":function(t,e,a){},"7db0":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(" "+t._s(t.formData.source_name)+"(权限组) ")]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[t._v(" "+t._s(t.formData.auditor_name)+" ")]),a("el-form-item",{attrs:{label:"审核抄送",prop:"copy_to"}},[t._v(" "+t._s(""==t.copyTo?"无":t.copyTo)+" ")]),a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t._v(" "+t._s(t.showStatus())+" ")]),1!=t.formData.status?a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):t._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!=t.formData.status,expression:"formData.status != 1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)],1)},n=[],o=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],s=0;s<t.copy_to.length;s++)a.push(t.copy_to[s].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this.formData;t.status=this.status}},mounted:function(){},components:{}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"7e57":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{attrs:{head:t.headText}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("label")]),a("div",{staticClass:"role-role-list"},[a("el-tree",{ref:"dbList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("div",{staticClass:"item hbox-between hbox-center",on:{click:function(e){return t.onClick(s,n)}}},[a("div",{staticClass:"left"},[a("span",[t._v(t._s(n.name))])])])}}])})],1)],2)},n=[],o=(a("4de4"),a("b0c0"),a("5c96")),i={data:function(){return{db:null,db_name:"",filterText:"",dataList:[],treeProps:{label:"name"}}},props:{headText:{type:String,default:"数据库"}},watch:{filterText:function(t){this.$refs.dbList.filter(t)}},methods:{onEdit:function(t){var e=this;t&&t.name==t.tname||this.$api.role.upd(t).then((function(t){e.onSuccess("更改成功！")}),(function(e){o["Message"].error({title:"请求",message:e&&e.data?e.data:e,type:"error",duration:2e3}),t.name=t.tname}))},filterNode:function(t,e){return!t||(e.name==this.role_name||-1!==e.name.toLowerCase().indexOf(t.toLowerCase()))},refresh:function(){var t=this;this.$api.db.group_all().then((function(e){t.dataList=e}))},onClick:function(t,e){t.isLeaf&&(console.log("xxx；",t),this.db=e,this.db_name=e.name,this.$emit("db",e))}},components:{},mounted:function(){this.refresh()}},r=i,l=(a("586f"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"4586ac74",null);e["default"]=c.exports},"7f36":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"database"},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/role/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"权限组",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"说明",prop:"info"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.info?e.row.info:"无"))])]}}])}),a("el-table-column",{attrs:{label:"成员数",prop:"userCount"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.userCount)+"人")])]}}])}),a("el-table-column",{attrs:{label:"是否已加入",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[e.row.hasCount?a("el-tag",{attrs:{type:"success"}},[t._v(" 是 ")]):a("el-tag",{attrs:{type:"info"}},[t._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.createdAt)))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.row.applyCount>0},on:{click:function(a){return t.openApply(e.row)}}},[t._v("申请加入 ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.$refs.applyPageDialog.show(e.row)}}},[t._v("申请记录 ")])]}}])})],1)],2),a("dialog-apply",{ref:"applyDialog",on:{refresh:t.refresh}}),a("dialog-apply-page",{ref:"applyPageDialog",on:{refresh:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("ccf4")),i=a("ff83"),r={data:function(){return{search2:{db_type:null},search:{db_type:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}]}},computed:{},props:{},watch:{},methods:{refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},openApply:function(t){this.$refs.applyDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogApply:o["default"],DialogApplyPage:i["default"]},mounted:function(){}},l=r,c=(a("ac37"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"7fe7":function(t,e,a){},8015:function(t,e,a){"use strict";a("836b")},"803d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"result-explain"},[t._v("敬请期待")])},n=[],o={name:"result-explain"},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},8082:function(t,e,a){},"812c":function(t,e,a){"use strict";(function(t){a("d3b7"),a("25f0");e["a"]={data:function(){return{isShow:!1,sourceRow:{},sourceRowKey:"",text:"",type:""}},props:{},watch:{},computed:{},methods:{onVisiable:function(t){this.$emit("action",{type:"visiable",data:t})},submit:function(){this.$emit("action",{type:"submit-effect",data:this.text,row:this.sourceRow,key:this.sourceRowKey}),this.isShow=!1},s2b:function(t){for(var e=atob(t),a="",s=0;s<e.length;s++){var n=e.charCodeAt(s).toString(16);a+=2===n.length?n:"0"+n}return a.toUpperCase()},getImage:function(t){},b2s:function(e){var a=new t(e,"base64"),s=a.toString();return s},show:function(t,e,a){this.sourceRow=t,this.sourceRowKey=e,this.text=t[e],this.type=a,this.isShow=!0},hide:function(t){this.isShow=!1},onOpened:function(){var t=this.$refs.focusRef;t&&t.focus()},onCopy:function(){var t=this;this.$copyText(this.sql).then((function(e){t.onSuccess("已复制")}),(function(t){this.onError("复制失败")}))}},mounted:function(){},components:{}}}).call(this,a("b639").Buffer)},"81c8":function(t,e,a){"use strict";a("3e35")},"81ee":function(t,e,a){},"81f5":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"append-to-body":"",title:"【"+t.role.name+"】-- 策略",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:"onSelect",url:"/api/role/strategy/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"策略类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},t._l(t.c_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:""==t.ids},on:{click:t.onBatchAdd}},[t._v("批量添加")]),a("el-button",{attrs:{type:"danger",size:"mini",disabled:""==t.ids},on:{click:t.onBatchRemove}},[t._v("批量移除")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"策略名称",prop:"name",width:"280"}}),a("el-table-column",{attrs:{label:"策略类型",prop:"c_type"}}),a("el-table-column",{attrs:{label:"创建时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.role_id?a("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(a){return t.onAdd(e.row.id)}}},[t._v("添加 ")]):t._e(),0!=e.row.role_id?a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{role:{},ids:"",isShow:!1,search:{db_types:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],c_types:[{k:"",v:"全部"},{k:"select",v:"查询"},{k:"update",v:"更新"}]}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.role=t,this.search.role_id=t.id,this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this;this.$api.role.relationStrategy(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kickStrategy(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"820a":function(t,e,a){},8218:function(t,e,a){"use strict";a("4f8b")},"82ba":function(t,e,a){},"82f9":function(t,e,a){"use strict";a("a99a")},"830e":function(t,e,a){"use strict";var s=a("60fe");e["a"]={path:"/project",title:"我的项目",role:s["i"],iconfont:"icon-icon-project",children:[{role:s["i"],path:"/project/:id/dashboard",title:"工作台",iconfont:"icon-weimingmingwenjianjia_gongzuotai"},{role:s["i"],path:"/project/:id/datasource",title:"项目数据源",iconfont:"icon-shujuyuan1"},{role:s["i"],path:"/project/:id/member",title:"项目成员",iconfont:"icon-chengyuanyonghuguanli"},{role:s["h"],path:"/project/:id/role",title:"数据权限",iconfont:"icon-jiaose"},{role:s["a"],path:"/project/:id/work",title:"项目工单",iconfont:"icon-order"},{role:s["a"],path:"/project/:id/log",title:"项目日志",iconfont:"icon-rizhi"},{role:s["h"],path:"/project/:id/post",title:"项目公告",iconfont:"icon-gonggao"}]}},8367:function(t,e,a){},"836b":function(t,e,a){},8537:function(t,e,a){"use strict";a("733b")},8546:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("split-pane",{staticClass:"sql-item",attrs:{"min-percent":5,"default-percent":t.defaultPercent,"max-percent":35,split:"vertical"}},[a("template",{slot:"paneL"},[a("sql-card-db",{key:t.tabId,ref:"left-"+t.tabId,attrs:{"tab-id":t.tabId,hasAsynSql:t.hasSql}})],1),a("template",{slot:"paneR"},[a("div",{staticClass:"right"},[a("sql-item",{key:t.tabId,attrs:{"run-tab-id":t.tabId}})],1)])],2)},n=[],o=a("5530"),i=(a("b0c0"),a("4de4"),a("fb22")),r=a("356b"),l=a("69e1"),c=a("19ab"),u=a.n(c),d=a("2f62"),p={data:function(){return{height:null,service:new l["default"](this.tabId,this.data,this.$bus),defaultPercent:15}},provide:function(){var t=this.data,e=t.id,a=t.dbType,s=t.name;return{db:{id:e,dbType:a},owner:{id:s,name:s,db:e},data:this.data,service:this.service,dataIndex:this.dataIndex}},computed:Object(o["a"])(Object(o["a"])({},Object(d["e"])(["sys","setting","runList","runActive"])),{},{hasSql:function(){return this.sys.asyn_sql&&this.data.hasAsynSql}}),props:{data:{},dataIndex:{},tabId:{}},watch:{setting:{deep:!0,handler:"onSetting"},data:function(t,e){console.log("tab/index: ",t.name,e.name)}},methods:{onSetting:function(t){this.service.setFontSize(t.hotKeys&&t.hotKeys.editFontSize||t.editFontSize)},onActive:function(){console.log("[tab index.vue methods] onActive: ",this.data,this.service);var t=this.service.data,e={hasAsynExport:this.data.hasAsynExport,hasAsynQuery:this.data.hasAsynQuery,hasAsynSql:this.data.hasAsynSql,hasRw:this.data.hasRw};this.service.data=Object(o["a"])(Object(o["a"])({},t),e),this.$store.commit("activeRunner",this.service),this.$store.commit("updateService",this.service),this.$store.commit("updateContext",{tabId:this.tabId,key:"service",data:this.service})},onResize:function(){var t=this.$el.getElementsByClassName("left")[0];console.log(t)},listenTab:function(){var t=this,e=t.runList.filter((function(e){return e.tabId==t.tabId})),a=e[0];console.log("tab/index.vue mounted: ",t.tabId,t.data),console.log("监听： on-selectdb-".concat(a.tabId)),this.$bus.off("on-selectdb-".concat(a.tabId)),this.$bus.on("on-selectdb-".concat(a.tabId),(function(e){console.log("执行 on-selectdb-".concat(a.tabId),t.tabId,e,t.service.data.index,t.service.editor.getModel().id),console.log("run: ",e),t.service.update(e)}))}},components:{SqlCardDb:i["default"],SqlItem:r["default"],SplitPane:u.a},created:function(){this.listenTab()},mounted:function(){this.defaultPercent=Math.floor(300/document.documentElement.clientWidth*100),this.onActive(),this.onResize(),this.onSetting(this.setting)},beforeDestroy:function(){}},f=p,m=(a("c6ca"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,null,null);e["default"]=h.exports},8563:function(t,e,a){},8647:function(t,e,a){},"883b":function(t,e,a){"use strict";a("6bf1")},8857:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-project-menber",use:"d2-project-menber-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-project-menber"><path d="M668.544896 503.514285a153.587603 153.587603 0 0 0 66.335217-126.234383C734.880113 290.100653 660.646105 219.450356 569.005502 219.450356s-165.801475 70.650298-165.801475 157.829546a153.587603 153.587603 0 0 0 66.26208 126.234383c-80.889471 37.299847-132.377887 115.190702-132.597297 200.760938a27.792042 27.792042 0 0 0 28.523412 27.13381 27.792042 27.792042 0 0 0 28.523412-27.13381c5.704682-88.934536 83.156717-158.268368 176.698881-158.268368 93.615301 0 171.067335 69.333832 176.772017 158.268368a27.792042 27.792042 0 0 0 28.523412 27.13381 27.792042 27.792042 0 0 0 28.523412-27.13381c-0.73137-86.301606-53.755661-164.411872-135.961597-200.760938zM460.250851 377.279902c0.73137-56.681139 49.513718-102.099188 108.974062-101.660366 59.606617 0.511959 107.511322 46.661377 107.291911 103.342516-0.292548 56.681139-48.562937 102.391736-108.096418 102.464873-59.752891 0-108.169555-46.076281-108.169555-102.903694v-1.243329zM173.773403 371.57522H28.523412A27.792042 27.792042 0 0 1 0 344.514547a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.13381 27.792042 27.792042 0 0 1-28.523412 27.13381z m0 131.939065H28.523412A27.792042 27.792042 0 0 1 0 476.380475a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.060673 27.792042 27.792042 0 0 1-28.523412 27.206947z m0 131.939065H28.523412A27.792042 27.792042 0 0 1 0 608.31954a27.792042 27.792042 0 0 1 28.523412-27.13381h145.249991a27.792042 27.792042 0 0 1 28.523412 27.060673 27.792042 27.792042 0 0 1-28.523412 27.206947z" p-id="13351" /><path d="M926.352659 1023.956849H170.701651a91.274919 91.274919 0 0 1-67.72482-27.13381 103.48879 103.48879 0 0 1-29.839877-70.211476V822.830226a29.986151 29.986151 0 0 1 8.630161-20.624621 26.40244 26.40244 0 0 1 19.966388-7.825654c15.212486-0.365685 27.938316 12.287008 28.523412 28.523412v103.781337a42.931392 42.931392 0 0 0 12.433282 29.108508 37.811805 37.811805 0 0 0 28.011454 11.263091h755.651008c10.385447 0.292548 20.478347-3.729985 28.08459-11.263091a42.931392 42.931392 0 0 0 12.287008-29.108508V97.311643a42.931392 42.931392 0 0 0-12.287008-29.108508 37.811805 37.811805 0 0 0-28.08459-11.263091H170.701651a37.811805 37.811805 0 0 0-28.084591 11.263091 42.931392 42.931392 0 0 0-12.287008 29.108508v103.854474c-0.73137 16.163267-13.384063 28.81596-28.596549 28.450275a26.40244 26.40244 0 0 1-19.966388-7.825654A29.986151 29.986151 0 0 1 73.136954 201.166117V97.311643c0.804506-26.694988 11.555639-51.927237 29.839877-70.138339 18.284238-18.284238 42.638844-27.938316 67.72482-27.060673h755.651008c25.085975-0.877643 49.440581 8.776434 67.724819 27.060673s29.035371 43.443351 29.839877 70.211476V926.6847c-0.804506 26.694988-11.555639 51.927237-29.839877 70.138339-18.284238 18.284238-42.638844 27.938316-67.724819 27.060673z" p-id="13352" /></symbol>'});i.a.add(r);e["default"]=r},8858:function(t,e,a){"use strict";a("9fcf")},8862:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"审核信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(' 加入"'+t._s(t.formData.source_name)+'"权限组 ')]):t._e(),"project"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(' 加入"'+t._s(t.formData.source_name)+'"项目 ')]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[t.readonly?a("span",[t._v(" "+t._s(t.showStatus())+" ")]):a("el-radio-group",{model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[a("el-radio",{attrs:{label:2}},[t._v("通过")]),a("el-radio",{attrs:{label:3}},[t._v("不通过")])],1)],1),a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t.readonly?a("span",[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):a("el-input",{attrs:{type:"textarea",placeholder:"请输入审核说明"},model:{value:t.formData.auditor_mark,callback:function(e){t.$set(t.formData,"auditor_mark",e)},expression:"formData.auditor_mark"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.readonly&&1!=t.formData.status,expression:"readonly&&formData.status!=1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.readonly,expression:"!readonly"}],attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)],1)},n=[],o=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],s=0;s<t.copy_to.length;s++)a.push(t.copy_to[s].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this,e=this.formData;e.status=this.status,this.$api.apply.auditExec(e).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}},mounted:function(){},components:{}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"88b1":function(t,e,a){"use strict";a("df8f")},"890c":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-cardx",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"file-table-list",attrs:{head:"数据表",types:t.types,"selected-type":t.selectedType,db_type:t.owner.db_type},on:{selected:t.onSelectedType}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字过滤数据表",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.refresh(null,!0,!0)}}},[t._v("刷新")])],1),a("div",{staticClass:"role-table-list"},[t.owner&&t.vnodeList&&t.vnodeList.length>0?a("div",{staticClass:"item hbox-between"},[a("div",{staticClass:"left"},[a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(e){return t.checkAllChangeHandler(e,!0)}},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("全选")])],1),a("div",{staticClass:"center",staticStyle:{"font-size":"12px"}},[t._v(" "+t._s(t.pages.nodeLength)+"/"+t._s(t.pages.total)+" ")]),t.owner.perm&&3!=t.owner.perm.rw?a("div",{staticClass:"right all pointer-active",attrs:{title:"批量设置"},on:{click:t.batchClickHandle}},[t._v(" 批量设置 ")]):t._e()]):t._e(),t._v("   "),t.filterDataList.length>0?a("virtual-list",{ref:"table-vlist",staticClass:"table-vlist",attrs:{"data-key":"name","estimate-size":t.itemHeight,keeps:t.vlistKeeps,"data-sources":t.filterDataList,"data-component":t.vlistTemplate,"extra-props":{selectedNodeList:t.selectedNodeList,selectedItemLabel:t.selectedItemLabel}},on:{tobottom:t.onScrollToBottom}},[a("div",{staticClass:"loading-spinner no-user-select",attrs:{slot:"footer"},slot:"footer"},[t._v("结束")])]):a("div",{ref:"table-vlist",staticClass:"empty"},[t._v(" "+t._s(t.emptyText)+" ")])],1),a("dialog-batchauth",{ref:"dialogBatchauthRef",attrs:{"confirm-loading":!0},on:{confirm:t.onBatchConfirm}})],2)},n=[],o=a("5530"),i=(a("498a"),a("b0c0"),a("d3b7"),a("159b"),a("99af"),a("3ca3"),a("ddb0"),a("4de4"),a("2ef0")),r=a("aa90"),l=a("89c1"),c=a.n(l),u=a("f13c"),d=a("ac9c"),p={name:"role-table-list",data:function(){return{selectedType:"空",types:[],vlistTemplate:u["default"],vlistKeeps:30,itemHeight:24,selectedNodeList:[],selectedItemLabel:"",pages:{no:0,size:200,total:0,nodeLength:0},vnodeList:[],emptyText:"请选择数据实例",isCheckAll:!1,isIndeterminate:!1,tooltipAsync:"",confirmAsync:!1,checked:{},check_rw:-1,type:"table",cur_name:"",filterText:"",loading:!1,def_checks:[],ids:[],dataList:[],treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},props:{role:{},owner:{},project:{}},computed:{filterDataList:function(){var t=this;return""==this.filterText.trim()?this.vnodeList:Object(i["filter"])(this.vnodeList,(function(e){return-1!=e.name.toUpperCase().indexOf(t.filterText.toUpperCase())}))}},watch:{owner:{handler:function(t){console.log("[table.list watch] owner:",t),this.emptyText="请选择数据实例",this.refresh(null,!0)}}},methods:{batchClickHandle:function(){this.selectedNodeList.length>0?(this.$refs.dialogBatchauthRef.show(this.selectedNodeList,this.owner),this.$refs.dialogBatchauthRef.setHeaders({title:"设置权限",targetText:"数据库："+(this.owner&&this.owner.name)})):this.$message({message:"请勾选数据表",type:"warning"})},onScrollToBottom:function(){this.loading?console.info("[table.list methods] onScrollToBottom() 防止多次查询"):this.pages.cursor?(this.pages.no=this.pages.cursor,console.log("[table.list methods] onScrollToBottom：",this.pages),this.refresh(null,!1)):this.loading=!1},checkAllChangeHandler:function(t,e){this.selectedNodeList=e&&t?this.vnodeList:[],this.setCheckAllBox()},onSelectedType:function(t){this.type=t.value||t,this.selectedType=t,this.refresh(null,!0,!0)},filterNode:function(t,e){return!t||(e.label==this.cur_name||-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))},vlistToTop:function(){this.$refs["table-vlist"]&&this.$refs["table-vlist"].scrollToIndex&&this.$refs["table-vlist"].scrollToIndex(0)},vlistReset:function(){this.$refs["table-vlist"]&&this.$refs["table-vlist"].reset&&this.$refs["table-vlist"].reset()},refresh:function(t,e){var a=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.role.id&&this.owner.name?(console.log("[table.list methods] refresh：",t,e),this.loading=!0,s?(this.getTableList(t,e,s),void console.log("selectedType")):void this.$api.db.schema.group({id:this.owner.perm.dbId}).then((function(t){var e=[];t.forEach((function(t){var a={label:t.name,value:t.sub_node_type};e.push(a)})),a.types=e,s||(a.selectedType=e[0]||{})})).finally((function(){a.getTableList(t,e,s)}))):(this.vnodeList=[],void console.warn("[table.list]#refresh(): ",this.role,this.owner))},getTableList:function(t,e,a){var s=this,n={id:this.owner.perm.dbId,db_type:this.owner.db_type,owner:this.owner.name,project:this.project.id,object_type:this.selectedType.value,node_type:this.selectedType.value,page_size:this.pages.size,role_id:this.role.id,page_no:this.pages.no,parentNode:this.owner};console.log("xxxx: ",this.owner),this.$api.permission.subNodes(n).then((function(t){e||n.f?(s.vlistReset(),s.vnodeList=t.List||[],s.selectedNodeList=[],s.isIndeterminate=!1):s.vnodeList=s.vnodeList.concat(t.List||[]),s.pages.cursor=t.has_cursor,s.pages.total=t.total,s.pages.nodeLength=s.vnodeList.length})).finally((function(){console.log("jieguox    xx"),s.loading=!1,s.selectedItemLabel="",0==s.vnodeList.length?s.emptyText="空数据":s.emptyText="请选择数据实例",s.$emit("table",{},s.selectedType.value)}))},onClick:function(t){this.cur_name=t.label,this.$emit("table",t,this.selectedType.value)},onAuthAsync:function(t,e){var a=this,s="",n="",o=0,i="";if(3!=this.owner.perm.rw&&""!=this.owner.perm.rw&&-1!=this.owner.perm.rw){if("asyn_export"==e){if(i="ae",n="文件导出",0==this.owner.perm.asyn_export&&0==t.perm.asyn_export)return void this.onError("该数据表所在实例不支持导出操作！");1==t.perm.asyn_export?(t.perm.asyn_export=0,s="取消"):(t.perm.asyn_export=1,s="设置"),o=t.perm.asyn_export}if("asyn_query"==e){if(i="aq",n="异步查询",0==this.owner.perm.asyn_query&&0==t.perm.asyn_query)return void this.onError("该数据表所在实例不支持异步查询操作！");1==t.perm.asyn_query?(t.perm.asyn_query=0,s="取消"):(t.perm.asyn_query=1,s="设置"),o=t.perm.asyn_query}if("asyn_sql"==e){if(i="as",n="导出Sql",0==this.owner.perm.asyn_sql&&0==t.perm.asyn_sql)return void this.onError("该数据表所在实例不支持导出Sql操作！");1==t.perm.asyn_sql?(t.perm.asyn_sql=0,s="取消"):(t.perm.asyn_sql=1,s="设置"),o=t.perm.asyn_sql}if("audit_work"==e){if(i="aw",n="工单流程",0==this.owner.perm.audit_work&&0==t.perm.audit_work)return void this.onError("该数据表所在实例不支持工单流程操作！");1==t.perm.audit_work?(t.perm.audit_work=0,s="取消"):(t.perm.audit_work=1,s="设置"),o=t.perm.audit_work}this.addTablePermAsync(t,i,o).then((function(){var e=s+n+"成功";a.onSuccess(e),a.this.onSelectRow(t)}))}else this.onError("该数据表所在实例不支持该操作！")},onAuth:function(t,e,a){var s=this;return console.log("[table.list.vue]#onAuth rw:",t,e),3!=this.owner.perm.rw&&this.owner.perm.rw&&(1!=this.owner.perm.rw||2!=e&&4!=e)?2==this.owner.perm.rw&&4==e?this.$message.error("父级权限不支持该操作！"):void this.addTablePerm(t.name,e).then((function(a){t.rw=e,t.perm.rw=e,t.rw&&-1!=t.rw?(t.perm.asyn_export=a.asyn_export,t.perm.asyn_query=a.asyn_query,t.perm.asyn_sql=a.asyn_sql,t.perm.audit_work=a.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0,t.perm.asyn_export=0,t.perm.asyn_query=0,t.perm.asyn_sql=0,t.perm.audit_work=0);var n="操作成功";3==e?n="设置禁用成功":4==e?n="设置管理成功":1==e?n="设置只读成功":2==e?n="设置读写成功":-1==e&&(n="取消设置成功"),console.log("刷新下级:"),s.$emit("refresh-next","table"),s.onSuccess(n),s.onSelectRow(t)})):this.$message.error("父级权限不支持该操作！")},onBatchConfirm:function(t){var e=this,a=!0;if(3==this.owner.perm.rw||""==this.owner.perm.rw||-1==this.owner.perm.rw?(console.warn("[table.list methods] 数据库被禁：",this.owner.perm.rw,this.owner),a=!1):1!=this.owner.perm.rw||2!=t.perm.rw&&4!=t.perm.rw?2==this.owner.perm.rw&&4==t.perm.rw?a=!1:-1==t.perm.rw&&(t.perm.rw=null,this.$message.warning("[warn-201] 没有选择读写权限")):a=!1,!a)return this.$message.error("[err-201] 权限选择错误"),this.loading=!1,void this.$refs.dialogBatchauthRef.hide();var s=this.selectedNodeList;this.loading=!0;var n=[];console.log("[table.list methods] onBatchaConfirm 设置后的权限:",t,this.owner),s.forEach((function(a){n.push(e.addTablePerm2(a.name,t.perm.rw,t.perm.asyn_query,t.perm.asyn_export,t.perm.asyn_sql))})),Promise.all(n).then((function(){for(var a="操作成功",n=0;n<s.length;n++)s[n].perm=Object(o["a"])(Object(o["a"])({},s[n].perm),t.perm);e.onSuccess(a)})).catch((function(){e.onError("操作失败"),e.refresh(null,!0)})).finally((function(){e.loading=!1,e.$refs.dialogBatchauthRef.hide()}))},addTablePerm2:function(t,e,a,s,n){var o={roleId:this.role.id,dbId:this.owner.perm.dbId,towner:this.owner.name,tname:t,rw:e,aq:a,ae:s,as:n,type:this.selectedType.value,project:this.project.id};return this.$api.permission.addPermission(o)},addTablePerm:function(t,e){return this.$api.permission.addTable(this.role.id,this.owner.perm.dbId,this.owner.name,t,e,this.selectedType.value,this.project.id)},addTablePermAsync:function(t,e,a){return this.$api.permission.addAsyncPermission(this.role.id,this.owner.perm.dbId,this.owner.name,t.name,t.perm.rw,e,a,this.project.id)},setCheckAllBox:function(){this.isCheckAll=this.selectedNodeList.length===this.vnodeList.length&&0!=this.selectedNodeList.length,this.isCheckAll?this.isIndeterminate=!1:this.selectedNodeList.length>0?this.isIndeterminate=!0:0==this.selectedNodeList.length&&(this.isCheckAll=!1,this.isIndeterminate=!1)},onSelectRow:function(t){this.selectedItemLabel=t.name,"redis"!=this.owner.db_type&&this.onClick(t)}},components:{"dialog-batchauth":r["default"],"virtual-list":c.a},mounted:function(){var t=this,e=Object(d["a"])(this.$refs["table-vlist"],this.itemHeight);this.vlistKeeps=e||this.vlistKeeps,this.$on("vnode-change",(function(e){var a=e.type,s=e.source,n=e.e,o=e.auth;"selected-line"==a?t.onSelectRow(s):"checked-item"==a?(n?(t.selectedNodeList.push(s),t.setCheckAllBox()):(t.selectedNodeList=t.selectedNodeList.filter((function(t){return s.name!=t.name})),t.setCheckAllBox()),console.log("checked-item: ",s,n?"选中":"取消")):"change-auth"==a?(console.log("change-auth: 读、写、管、禁",s,o),t.onAuth(s,o.value)):"change-auth2"==a&&t.onAuthAsync(s,o.key)}))}},f=p,m=(a("a16d"),a("5ddb"),a("2877")),h=Object(m["a"])(f,s,n,!1,null,"1c319a4d",null);e["default"]=h.exports},"891d":function(t,e,a){},8959:function(t,e,a){},"8a3b":function(t,e,a){},"8b20":function(t,e,a){},"8b37":function(t,e,a){},"8b53":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{ref:"personalNoticeRef",staticClass:"personal-notice-page",attrs:{type:"ghost"}},[t.userInfo?a("h2",{staticClass:"text-2xl"}):t._e(),t.userInfo?a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/personal/notice/personal"}}},[t._v("私信")]),a("el-breadcrumb-item",[t._v(t._s(t.userInfo.user_name))])],1):t._e(),a("SendView",{attrs:{"user-id":t.userId},on:{success:t.onSuccess}}),a("msg-list",{ref:"msgListRef",attrs:{config:{mod:"record",user_id:t.userId,msg_type:2,lazy:!0,avatar:!0}},on:{paged:t.onPaged}})],1)},n=[],o=a("18b0"),i=a("2109"),r={name:"personal-notice-personal-notice",components:{MsgList:o["a"],SendView:i["default"]},data:function(){return{userInfo:null,timer:null,loading:!1,msgContent2:"",userId:this.$route.params.id}},methods:{onSuccess:function(){this.$refs.msgListRef.refresh()},onPaged:function(){this.$refs.personalNoticeRef.scrollToTop(),this.intervalGetMsgList()},intervalGetMsgList:function(){var t=this;window.clearInterval(this.timer),this.timer=setInterval((function(){t.$refs.msgListRef.refresh({init:!0})}),3e4)},getUserInfo:function(t){var e=this;this.$api.project.user_info(t).then((function(t){e.userInfo=t}))}},mounted:function(){this.getUserInfo(this.userId),this.intervalGetMsgList()},beforeDestroy:function(){window.clearInterval(this.timer)}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},"8bba":function(t,e,a){},"8c1b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-drawer",{attrs:{title:t.data.instanceInfo.name,visible:t.drawerVisiable,size:"75%"},on:{"update:visible":function(e){t.drawerVisiable=e},close:t.onClose}},[a("div",{staticClass:"component-intance-info"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("label",[t._v("类型：")]),t._v(t._s(t.data.instanceInfo.db_type)+" ")]),a("el-col",{attrs:{span:4}},[a("label",[t._v("权限：")]),t._v(t._s(t.formatRw(t.data.instanceInfo.oper_type))+" ")]),a("el-col",{attrs:{span:4}},[a("label",[t._v("允许异步：")]),t._v(t._s(t.formatAsyn(t.data.instanceInfo.asyn_query))+" ")]),a("el-col",{attrs:{span:4}},[a("label",[t._v("允许导出文件：")]),t._v(t._s(t.formatAsyn(t.data.instanceInfo.asyn_export))+" ")]),a("el-col",{attrs:{span:4}},[a("label",[t._v("允许导出SQL：")]),t._v(t._s(t.formatAsyn(t.data.instanceInfo.asyn_sql))+" ")])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("地址：")]),t._v(" "+t._s(t.data.instanceInfo.ip)+":"+t._s(t.data.instanceInfo.port)+" ")]),a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("字符集：")]),t._v(" "+t._s(t.data.instanceInfo.char_set)+" ")])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("用户名：")]),t._v(t._s(t.data.instanceInfo.name))]),a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("密码：")]),t._v(t._s(t.data.instanceInfo.pass))])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("连接数：")]),t._v(t._s(t.data.instanceInfo.pool_min)+" ~ "+t._s(t.data.instanceInfo.pool_max)+" ")]),a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("最大查询数：")]),t._v(t._s(t.data.instanceInfo.max_row))])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("已绑定项目：")]),t._v(t._s(t.data.instanceInfo.project_names))])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,offset:0}},[a("label",[t._v("开启自动审核：")]),t._v(t._s(t.formatAsyn(t.data.instanceInfo.auto_audit)))])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24,offset:0}},[a("label",[t._v("描述：")]),a("pre",[t._v(t._s(t.data.instanceInfo.db_desc))])])],1),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.onTabClick},model:{value:t.selectTab,callback:function(e){t.selectTab=e},expression:"selectTab"}},[a("el-tab-pane",{attrs:{label:"库信息",name:"dbinfo"}},[a("h3",{staticClass:"padding-y-12 margin-top-20"},[t._v("数据库列表")]),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24,offset:0}},[a("div",{staticClass:"db-or-table-list"},t._l(t.data.dbList,(function(e,s){return a("div",{key:s,staticClass:"db-or-table-item",class:{"db-or-table-item-seleced":e==t.data.selectedDb},on:{click:function(a){return t.onClick(e,"db")}}},[t._v(t._s(e))])})),0)])],1),a("h3",{staticClass:"padding-y-12 margin-top-20"},[t._v("数据表列表")]),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24,offset:0}},[a("div",{staticClass:"db-or-table-list"},t._l(t.data.tableList,(function(e,s){return a("div",{key:s,staticClass:"db-or-table-item",class:{"db-or-table-item-seleced":e==t.data.selectedTable},on:{click:function(a){return t.onClick(e,"table")}}},[t._v(t._s(e))])})),0)])],1),"redis"!=t.data.instanceInfo.db_type?[a("h3",{staticClass:"padding-y-12 margin-top-20"},[t._v("数据表详情")]),a("table-info",{ref:"tableInfoRef"})]:t._e()],2)],1)],1)])},n=[],o=a("5530"),i=(a("b0c0"),a("159b"),a("3eff")),r=a("2f62"),l={name:"instance-info-drawer",components:{tableInfo:i["default"]},data:function(){return{drawerVisiable:!1,conState:!1,selectTab:"dbinfo",data:{instanceInfo:{},dbList:[],selectedDb:"",tableList:[],selectedTable:"",tableInfo:{}}}},computed:Object(o["a"])(Object(o["a"])({},Object(r["e"])(["rwMap"])),{},{formatRw:function(){var t=this;return function(e){var a=t.rwMap[e];return a||"未知"}},formatAsyn:function(){return function(t){return 1==t?"是":"否"}}}),methods:{onTabClick:function(t){"statistics"==t||"statistics"==t.name||"dbinfo"!=t&&"dbinfo"!=t.name||!this.conState||(console.log("查询统计信息："),this.getInstanceInfo(this.data.instanceInfo.id))},onClick:function(t,e){if("db"==e)this.data.selectedDb=t,this.hideTable(),this.getTableList(this.data.instanceInfo.id,t,"table");else if("table"==e){this.data.selectedTable=t,this.hideTable();var a={iid:this.data.instanceInfo.id,dbName:this.data.selectedDb,dbType:this.data.instanceInfo.db_type,tableName:t,tableType:"table"};this.getTableInfo(a)}},show:function(t){this.conState=t.con_state=2,this.data.instanceInfo=t,this.drawerVisiable=!0,this.onTabClick("dbinfo")},getInstanceInfo:function(t){var e=this;this.$api.db.info(t).then((function(a){console.log("getInstanceInfo: ",a),e.data.instanceInfo=a,e.getDbList(t,"table")}))},getDbList:function(t,e){var a=this;this.$api.db.dataBaseList(t).then((function(s){if(s&&s.List&&s.List.length>0){var n=[];s.List.forEach((function(t){n.push(t.name)})),a.data.selectedDb=n[0],a.getTableList(t,n[0],e),a.data.dbList=n}else a.data.dbList=[]}))},getTableList:function(t,e,a){var s=this;this.$api.db.tableList(t,e).then((function(n){if(n&&n.List&&n.List.length>0){var o=[];n.List.forEach((function(t){o.push(t.name)})),s.data.selectedTable=o[0],s.data.tableList=o;var i={iid:t,dbName:e,dbType:s.data.instanceInfo.db_type,tableName:o[0],tableType:a};s.getTableInfo(i)}else s.data.tableList=[]}))},getTableInfo:function(t){"redis"!=t.dbType&&this.$refs.tableInfoRef.init(t)},hideTable:function(){this.$refs.tableInfoRef&&this.$refs.tableInfoRef.hide()},onClose:function(){this.selectTab="dbinfo",this.conState=!1,this.data={instanceInfo:{},dbList:[],selectedDb:"",tableList:[],selectedTable:"",tableInfo:{}},this.hideTable()}}},c=l,u=(a("6649"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"57dff73e",null);e["default"]=d.exports},"8c66":function(t,e,a){"use strict";a.r(e),a.d(e,"init",(function(){return r}));a("ac1f"),a("1276"),a("159b"),a("b64b"),a("841c");var s=a("b982"),n=a("4360"),o=a("2b0e");function i(t){var e=t.split("+");if(1==e.length)return s["KeyCode"][e[0]]||0;var a=0,n=e.length-1;return e.forEach((function(t,e){if(t=t.toLowerCase(),n>e&&s["KeyMod"][t])a|=s["KeyMod"][t];else{if(n!=e||!s["KeyCode"][t])return null;a|=s["KeyCode"][t]}})),a}var r=function(t,e){if(n["a"].state.setting&&n["a"].state.setting.hotKeys&&Object.keys(n["a"].state.setting.hotKeys).length>0){var a=n["a"].state.setting.hotKeys;if(a.appendSearch)i(a.appendSearch);if(a.closeWindow)i(a.closeWindow);if(a.newWindow)i(a.newWindow);if(a.nextSearch)i(a.nextSearch);if(a.preSearch)i(a.preSearch);if(a.search){var s=i(a.search);s&&e.addAction({id:"exec-run-sql",label:"执行SQL",keybindings:[s],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){return t.onRun(),null}})}if(a.format){var r=i(a.format);r&&e.addAction({id:"exec-sql-format",label:"格式化",keybindings:[r],precondition:null,keybindingContext:null,contextMenuGroupId:"bottom",contextMenuOrder:2,run:function(){return o["default"].bus.emit("exec-sql-format"),null}})}}else e.addAction({id:"exec-run-sql",label:"执行SQL",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){return t.onRun(),null}}),e.addAction({id:"exec-sql-format",label:"格式化",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KEY_F],precondition:null,keybindingContext:null,contextMenuGroupId:"bottom",contextMenuOrder:2,run:function(){return o["default"].bus.emit("exec-sql-format"),null}}),e.addAction({id:"exec-new-work",label:"创建工单",keybindings:[monaco.KeyMod.Alt|monaco.KeyCode.KEY_W],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:2,run:function(t){return o["default"].bus.emit("add-new-work"),null}}),e.addAction({id:"exec-run-save",label:"保存",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],contextMenuGroupId:"9_cutcopypaste",run:function(){o["default"].bus.emit("saveToLocalFile")}})}},"8c6a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"database"},[a("div",[a("span",{staticStyle:{padding:"20px"}},[t._v(" 权限组:"),t._l(t.role_names,(function(e){return a("el-tag",{key:e,staticStyle:{margin:"5px"},attrs:{type:"success"}},[t._v(t._s(e))])}))],2),t._m(0),a("el-tree",{ref:"tree2",attrs:{data:t.list,"node-key":"id",props:t.defaultProps,indent:26,isLeaf:function(t){return"col"==t.node_type},"highlight-current":"",lazy:"","default-expanded-keys":t.expKeys,load:t.onNextLoad},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",["db"==n.node_type?a("span",[t._v("["+t._s(n.db_type)+"]"+t._s(s.label)+" ")]):"owner"==n.node_type?a("span",[t._v("[实例]"+t._s(s.label)+" ")]):"table"==n.node_type?a("span",[t._v("[表]"+t._s(s.label)+" ")]):a("span",[t._v("[字段]"+t._s(s.label))]),1==n.rw?a("i",{staticClass:"sn-font text-success"},[t._v("读")]):t._e(),2==n.rw?a("i",{staticClass:"sn-font text-primary"},[t._v("写")]):t._e(),3==n.rw&&"col"!=n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("禁")]):t._e(),"col"!=n.node_type?a("span",[1==n.asyn_query?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_export?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_sql?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e()]):t._e(),3==n.rw&&"col"==n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("敏")]):t._e()])])}}])})],1),a("dialog-apply",{ref:"applyDialog",on:{refresh:t.refresh}})],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"20px","font-size":"12px"}},[t._v(" 图标: "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v(" 异步查询 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("异步导出/导出文件 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("导出Sql ")])}],o=(a("ac1f"),a("841c"),a("b0c0"),a("ccf4")),i={data:function(){return{defaultProps:{children:"children",label:"name"},role_names:[],isShow:!1,doc:{},list:[],expKeys:[]}},computed:{},props:{},watch:{},methods:{refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(t,e){var a=t.data;a&&a.length>0&&e(a),a&&"col"==a.node_type&&e([]),a&&a.children?e(a.children):a&&a.id&&a.name?this.$api.my.myAuthChildren(a).then((function(t){t?(a.children=t,e(t)):e([])})):e([])},openApply:function(t){this.$refs.applyDialog.show(t)},onLoad:function(){var t=this;this.$api.my.info().then((function(e){t.role_names=e.role_names})),this.$api.my.myAuth().then((function(e){if(t.list=e,e&&e.length)for(var a=0;a<e.length;a++)t.expKeys.push(e[a].id)}))}},components:{DialogApply:o["default"]},mounted:function(){this.onLoad()}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"8d5a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{directives:[{name:"loading",rawName:"v-loading",value:t.workpaceLoading,expression:"workpaceLoading"}],staticClass:"query query-page",attrs:{direction:"vertical"}},[a("tools"),a("sql-tabs")],1)},n=[],o=a("5530"),i=(a("caad"),a("2f62")),r=a("f7a1"),l=a("6c72"),c={name:"query",data:function(){return{workpaceLoading:!1,sql:this.$route.params.sql,db_id:this.$route.params.db_id,owner:this.$route.params.owner}},computed:Object(o["a"])({},Object(i["e"])(["sys","setting","isMaxLine","MAX_LINE","user"])),props:{},watch:{isMaxLine:function(t){t&&this.onError("SQL行数超过了最大值限制(max = ".concat(this.MAX_LINE,"行)，删除多余行！"),"错误",3500)}},methods:{goBack:function(){console.log("don't go back;")},updateData:function(){try{var t=window.localStorage.getItem("loc_update");if(!t){console.log("==========本地升级开始=========="),window.localStorage.setItem("loc_update",1);var e=window.localStorage.getItem("runList"),a=window.localStorage.getItem("runActive"),s=window.localStorage.getItem("runner");e&&window.localStorage.setItem("1_runList",e),a&&window.localStorage.setItem("1_runActive",a),s&&window.localStorage.setItem("1_runner",s),console.log("==========本地升级结束==========")}}catch(n){console.log("==========本地升级出错=========="),console.error(n)}}},components:{Tools:r["default"],SqlTabs:l["default"]},mounted:function(){var t=this;this.$bus.on("change-theme",(function(t){["vs","vs-dark","hc-black"].includes(t.code)?monaco.editor.setTheme(t.code):console.error("设置主题失败：",t)})),this.$bus.off("workpace-loading"),this.$bus.on("workpace-loading",(function(e){t.workpaceLoading=e})),this.updateData(),window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1))},created:function(){this.$store.dispatch("initStore")},beforeDestroy:function(){this.$bus.off("change-theme")},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1)}},u=c,d=(a("ffde"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},"8d9d":function(t,e,a){},"8ded":function(t,e,a){"use strict";a("2ad4")},"8e68":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-oracle-status"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/oracle/status","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:60},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"基本信息"}},[a("el-table-column",{attrs:{label:"连接",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.connect?a("div",{staticClass:"text-error"},[t._v("失败")]):a("div",{staticClass:"text-success"},[t._v("成功")]),0==e.row.connect?a("div",[t._v("("+t._s(e.row.error)+")")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"运行时间",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.uptime))]}}])}),a("el-table-column",{attrs:{label:"版本",prop:"version"}})],1),a("el-table-column",{attrs:{label:"会话"}},[a("el-table-column",{attrs:{label:"连接会话数",prop:"session_total"}}),a("el-table-column",{attrs:{label:"活动会话数",prop:"session_actives"}}),a("el-table-column",{attrs:{label:"等待会话数",prop:"session_waits"}})],1),a("el-table-column",{attrs:{label:"事务"}},[a("el-table-column",{attrs:{label:"每秒提交",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.user_commits_persecond)+"次")]}}])}),a("el-table-column",{attrs:{label:"每秒回滚",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.user_rollbacks_persecond)+"次")]}}])})],1)],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{dateRange:[]}}},computed:{},props:{},watch:{},methods:{onData:function(t){t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("c2b3"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"8e92":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-setting-password",use:"d2-setting-password-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-setting-password"><path d="M329.33 786.16A95 95 0 1 1 396.5 624a95 95 0 0 1-67.18 162.13z m0-141.93A47 47 0 1 0 362.56 658a46.86 46.86 0 0 0-33.23-13.77z" p-id="31582" /><path d="M329.33 901.47a210.32 210.32 0 1 1 93-399l53.83-53.83-40.96-40.93L530.94 312l40.94 40.94 76.23-76.23-71.55-71.56 95.73-95.73L743.85 181l60.57-60.58 95.74 95.73-382.11 382.07a210.26 210.26 0 0 1-188.72 303.25z m-0.18-372.61a162.8 162.8 0 0 0-18 1A162.36 162.36 0 0 0 214.52 806c63.31 63.31 166.31 63.31 229.61 0a160.62 160.62 0 0 0 46.54-96.59 163.15 163.15 0 0 0-22.79-102.91L458 590.38l374.27-374.27-27.85-27.85-60.57 60.58-71.56-71.56-27.85 27.85L716 276.69 571.88 420.8l-40.94-40.94-27.86 27.85L544 448.65 430.15 562.53 414 552.65a163 163 0 0 0-84.85-23.79z" p-id="31583" /></symbol>'});i.a.add(r);e["default"]=r},"8f44":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.table_name+" 表修改",visible:t.isShow,width:"1248px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-tabs",{staticClass:"table-info",attrs:{type:"border-card"},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[a("el-tab-pane",{attrs:{label:"字段定义",name:"struct"}},[a("edit-field",{attrs:{type:t.type,table:t.table_name},on:{submit:t.onDDL}})],1),a("el-tab-pane",{attrs:{label:"索引定义",name:"index",lazy:!0}},[a("edit-index",{attrs:{type:t.type,table:t.table_name},on:{submit:t.onDDL}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")])],1)],1)},n=[],o=a("6cc5"),i=a("29bf"),r={data:function(){return{type:"",isShow:!1,active:"struct",table_name:""}},inject:["db","owner"],props:{},watch:{},computed:{},methods:{show:function(t,e){this.type=e,this.table_name=t,this.active="struct",this.isShow=!0},onClose:function(){this.type=""},hide:function(t){this.isShow=!1,this.data={constraint:[{}],indexs:[{}],info:null,struct:[{}]}},onDDL:function(t,e){var a=this;console.log(t),this.$api.sql.ddl(this.db,this.owner,t).then((function(){a.onSuccess("修改成功"),e&&e()}))}},mounted:function(){},components:{EditField:o["default"],EditIndex:i["default"]}},l=r,c=(a("3925"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"0a451d78",null);e["default"]=u.exports},"8f54":function(t,e,a){"use strict";a.d(e,"a",(function(){return u})),a.d(e,"b",(function(){return d}));var s=a("2909"),n=a("5530"),o=(a("d81d"),a("99af"),a("2ef0")),i=a("dcf2"),r=a("60fe"),l=[{role:r["i"],path:"/query",title:"数据查询",iconfont:"icon-daima2"},{path:"/mgt",title:"应用管理",role:r["b"],iconfont:"icon-yonghufenzuyingyong1",children:[{role:r["b"],path:"/mgt/dashboard",title:"统计",iconfont:"icon-gongzuoqu"},{role:r["b"],path:"/mgt/database",title:"数据源",iconfont:"icon-shujuyuan1"},{role:r["b"],path:"/mgt/project",title:"项目列表",iconfont:"icon-xiangmuliebiao"},{role:r["b"],path:"/mgt/account",title:"用户管理",iconfont:"icon-chengyuanyonghuguanli"},{role:r["b"],path:"/mgt/strategy",title:"策略管理",iconfont:"icon-celve"},{role:r["b"],path:"/mgt/audit-setting",title:"审计设置",iconfont:"icon-shezhi"},{role:r["b"],path:"/mgt/setting/func",title:"功能设置",iconfont:"icon-gongnengshezhi1"}]},{role:r["b"],title:"审计管理",iconfont:"icon-shenjirizhi",children:[{role:r["b"],path:"/mgt/act",title:"审计日志",iconfont:"icon-shenji"},{role:r["b"],path:"/mgt/act/log",title:"操作日志",iconfont:"icon-rizhi2"},{role:r["b"],path:"/mgt/act/report",title:"统计报表",iconfont:"icon-baobiaofenxi"}]},{role:r["b"],title:"系统设置",iconfont:"icon-shezhi",children:[{role:r["b"],path:"/mgt/setting",title:"系统重启",iconfont:"icon-zhongqi"},{role:r["b"],path:"/mgt/monitor",title:"监控",iconfont:"icon-yibiaopan"},{role:r["b"],path:"/mgt/setting/update",title:"软件升级",iconfont:"icon-banbenshengji-05"},{role:r["b"],path:"/mgt/setting/policy",title:"访问规则",iconfont:"icon-shezhi-anquanxing"},{role:r["b"],path:"/mgt/setting/notice",title:"通知设置",iconfont:"icon-tongzhi"},{role:r["b"],path:"/mgt/setting/login",title:"登录设置",iconfont:"icon-denglu"},{role:r["b"],path:"/mgt/setting/backup",title:"备份设置",iconfont:"icon-beifen"},{role:r["b"],path:"/mgt/setting/license",title:"许可信息",iconfont:"icon-xukezheng"}]}];function c(t){return t.map((function(t){return Object(n["a"])(Object(n["a"])({},t),{},{path:t.path||Object(o["uniqueId"])("d2-menu-empty-")},t.children?{children:c(t.children)}:{})}))}var u=c([{path:"/",title:"首页",icon:"home"}].concat(Object(s["a"])(l),[i["a"]])),d=c(Object(s["a"])(l))},"8f9d":function(t,e,a){},"900e":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-logoff",use:"d2-logoff-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-logoff"><path d="M792.2 153.6c-25.6-22.4-57.6-22.4-80-6.4-25.6 16-35.2 41.6-28.8 70.4 0 25.6 19.2 38.4 38.4 51.2C856.2 374.4 894.6 550.4 814.6 704 744.2 838.4 584.2 912 437 880c-150.4-32-265.6-169.6-268.8-323.2-3.2-118.4 41.6-214.4 137.6-288 35.2-28.8 41.6-70.4 16-99.2-25.6-32-64-35.2-102.4-6.4C59.4 288-7.8 505.6 56.2 691.2c64 198.4 246.4 332.8 454.4 332.8 262.4 0 480-211.2 480-476.8 3.2-163.2-67.2-294.4-198.4-393.6" p-id="37892" /><path d="M488.2 540.8c48 16 89.6-16 89.6-70.4V76.8C581 28.8 552.2 0 510.6 0c-38.4 0-67.2 28.8-70.4 70.4v403.2c3.2 35.2 22.5 57.6 48 67.2" p-id="37893" /></symbol>'});i.a.add(r);e["default"]=r},"903b":function(t,e,a){},"910a":function(t,e,a){"use strict";a("6699")},"939f":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"system-notice-list-page",attrs:{type:"ghost"}},[a("div",{staticClass:"tools mb-4"},[a("el-button",{staticClass:"ignore active:opacity-80",attrs:{icon:"el-icon-refresh-right",size:"small"},nativeOn:{click:function(e){return t.onRefresh.apply(null,arguments)}}},[t._v(" 刷新 ")]),a("el-button",{staticClass:"ignore active:opacity-80",attrs:{size:"small",type:"primary"},nativeOn:{click:function(e){return t.onRead.apply(null,arguments)}}},[t._v(" 标记当前已读 ")])],1),a("msg-list",{ref:"msgListRef",attrs:{config:{msg_type:1}}})],1)},n=[],o=(a("d3b7"),a("18b0")),i={name:"personal-notice-system-notice-list",components:{MsgList:o["a"]},methods:{onRead:function(){var t=this;this.$refs.msgListRef.readAll().finally((function(){t.$refs.msgListRef.refresh()}))},onRefresh:function(){this.$refs.msgListRef.refresh()}}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},"93ba":function(t,e,a){},"940d":function(t,e,a){},"944a":function(t,e,a){},9461:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{center:"",modal:!1,"destroy-on-close":!0,fullscreen:"","custom-class":"felix-dialog"}},[a("div",{ref:"terminal",staticClass:"felix-xterm"})])},n=[],o=(a("b0c0"),a("99af"),a("fcf3")),i=a("47d0"),r=a("27ae"),l=a("d1f9"),c=a("408b"),u=(a("f9ab"),a("4ad9")),d=new i["FitAddon"],p=new c["WebLinksAddon"],f=new l["SearchAddon"],m=function(t,e){var a=function(t){e.send(JSON.stringify({type:"resize",rows:t.rows,cols:t.cols}))};t.onResize(a),e.addEventListener("close",(function(){}))},h=function(t,e,a,s){t.write("\r\nWelcome to SqlDEV Web Ssh Terminal\n\r\n"),t.socket=e;var n=null,o=function(e){s&&s>0?n?n+=e.data:(n=e.data,setTimeout((function(){t.write(n)}),s)):t.write(e.data)},i=function(t){e.send(JSON.stringify({type:"cmd",cmd:r["Base64"].encode(t)}))};e.onmessage=o,a&&t.onData(i);var l=setInterval((function(){e.send(JSON.stringify({type:"heartbeat",data:""}))}),2e4);e.addEventListener("close",(function(){e.removeEventListener("message",o),delete t.socket,clearInterval(l)}))},b={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompTerm",data:function(){return{m:{},id:0,isFullScreen:!1,searchKey:"",isShow:!1,ws:null,term:null,fitAddon:null,thisV:this.visible}},watch:{visible:function(t){this.v=t}},computed:{termTitle:function(){return this.m?"@".concat(this.m.name):""},wsUrl:function(){var t=localStorage.getItem("token");return"".concat(u["a"].wsBase(),"/api/ws/ssh/").concat(this.id,"?cols=").concat(this.term.cols,"&rows=").concat(this.term.rows,"&access_token=").concat(t)}},mounted:function(){this.doOpened()},methods:{reset:function(){this.ws=null,this.term=null},show:function(t){this.m=t,this.id=t.id,this.isShow=!0},onWindowResize:function(){console.log("resize"),d.fit()},doLink:function(t,e){"click"===t.type&&window.open(e)},doClose:function(){window.removeEventListener("resize",this.onWindowResize),this.ws&&this.ws.close(),this.term&&this.term.dispose(),this.m={},this.id=0,this.isShow=!1},doOpen:function(){},doOpened:function(){var t=this;this.term=new o["Terminal"]({fontSize:12,rows:60,convertEol:!0,cursorBlink:!0,cursorStyle:"underline",bellStyle:"sound"}),this.term.loadAddon(d),this.term.loadAddon(p),this.term.loadAddon(f),this.term.open(this.$refs.terminal),d.fit(),window.addEventListener("resize",this.onWindowResize),console.log("this.wsUrl:",this.wsUrl),this.ws=new WebSocket(this.wsUrl),this.ws.onerror=function(e){console.log(e),t.$message.error("登陆失败,请检查你的配置")},this.ws.onclose=function(e){console.log(e),t.term.setOption("cursorBlink",!1),1005!==e.code&&(t.$notify.error({title:"code ".concat(e.code),message:e.reason}),t.doClose())},h(this.term,this.ws,!0,-1),m(this.term,this.ws)}}},_=b,g=a("2877"),v=Object(g["a"])(_,s,n,!1,null,null,null);e["default"]=v.exports},"946c":function(t,e,a){"use strict";a("e2d62")},"947f":function(t,e,a){},9579:function(t,e,a){},9583:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请加入项目",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"项目"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.source_id,callback:function(e){t.$set(t.formData,"source_id",e)},expression:"formData.source_id"}},t._l(t.projectList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,disabled:t.in_flag>0}})})),1)],1),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.auditor,callback:function(e){t.$set(t.formData,"auditor",e)},expression:"formData.auditor"}},t._l(t.managerList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"申请理由",prop:"opt_mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.opt_mark,callback:function(e){t.$set(t.formData,"opt_mark",e)},expression:"formData.opt_mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{project_id:0,isShow:!1,projectList:[],managerList:[],formData:{source_id:"",auditor:"",opt_mark:"",source_type:"project"},rules:{source_id:[{required:!0,message:"请选择项目",trigger:"change"}],auditor:[{required:!0,message:"请选择审核人",trigger:"change"}]}}},watch:{"formData.source_id":function(t){this.loadManagerList(t)}},methods:{show:function(t){var e=this;this.formData={source_id:t||"",auditor:"",opt_mark:"",source_type:"project"},this.$api.my.myApplyProjectList().then((function(t){e.projectList=t})),this.isShow=!0},hide:function(t){this.formData={source_id:"",auditor:"",opt_mark:"",source_type:"project"},this.projectList=[],this.isShow=!1},loadManagerList:function(t){var e=this;t?this.$api.project.managerList(t).then((function(t){e.managerList=t})):this.managerList=[]},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.formData;t.$api.apply.applyAdd(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}}))}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"95a2":function(t,e,a){"use strict";a.d(e,"c",(function(){return f})),a.d(e,"b",(function(){return m})),a.d(e,"a",(function(){return h}));a("99af");var s=a("7074"),n=a.n(s),o=a("fd77"),i=a.n(o),r=a("c276"),l=a("2ef0"),c=new i.a("d2admin-".concat("3.4.0")),u=n()(c);function d(){try{var t=window.localStorage.getItem("project"),e=JSON.parse(t);return e.id}catch(a){return console.warn(a),"none"}}function p(t){var e=t.dbName,a=void 0===e?"database":e,s=t.path,n=void 0===s?"":s,o=t.user,i=void 0===o||o,l=t.project,c=void 0!==l&&l,p=t.validator,f=void 0===p?function(){return!0}:p,m=t.defaultValue,h=void 0===m?"":m,b=r["a"].cookies.get("uuid")||"ghost-uuid",_=null,g=c?d():"_false";_="".concat(a,".").concat(i?"user.".concat(b,"_p").concat(g):"public").concat(n?".".concat(n):"");var v=u.get(_).value();return void 0!==v&&f(v)||u.set(_,h).write(),_}function f(t){var e=t.dbName,a=void 0===e?"database":e,s=t.path,n=void 0===s?"":s,o=t.value,i=void 0===o?"":o,r=t.user,l=void 0!==r&&r,c=t.project,d=void 0===c||c,f=p({dbName:a,path:n,user:l,project:d});u.set(f,i).write()}function m(t){var e=t.dbName,a=void 0===e?"database":e,s=t.path,n=void 0===s?"":s,o=t.defaultValue,i=void 0===o?"":o,r=t.user,c=void 0!==r&&r,d=t.project,f=void 0!==d&&d,m=p({dbName:a,path:n,user:c,project:f,defaultValue:i}),h=Object(l["cloneDeep"])(u.get(m).value());return h}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dbName,a=void 0===e?"database":e,s=t.path,n=void 0===s?"":s,o=t.user,i=void 0!==o&&o,r=t.validator,l=void 0===r?function(){return!0}:r,c=t.defaultValue,d=void 0===c?"":c;return u.get(p({dbName:a,path:n,user:i,validator:l,defaultValue:d}))}u.defaults({sys:{},database:{}}).write(),e["d"]=u},"95b4":function(t,e,a){"use strict";a("bb52")},"960e":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:"监控设置",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.db,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"名称"}},[t._v(t._s(t.db.name))]),a("el-form-item",{attrs:{label:"开启监控"}},[a("el-switch",{attrs:{"active-value":2,"inactive-value":1},model:{value:t.db.monitor_state,callback:function(e){t.$set(t.db,"monitor_state",e)},expression:"db.monitor_state"}},[t._v(">")])],1),a("el-form-item",{attrs:{label:"告警"}},[a(t.component,{tag:"component",attrs:{db:t.db}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.isSubmit,expression:"isSubmit"}],attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=a("5530"),i=a("0f37"),r=a("77e9"),l={data:function(){return{isSubmit:!1,db:{monitor_state:1,monitor_config:{}},cronPopover:!1,isShow:!1}},computed:{component:function(){switch(this.db.db_type){case"mysql":return i["default"];case"oracle":return r["default"];default:return null}}},methods:{show:function(t){this.db=Object(o["a"])({},t),this.db.monitor_state=this.db.monitor_state?this.db.monitor_state:1;try{this.db.monitor_config=this.db.monitor_config?JSON.parse(this.db.monitor_config):{}}catch(e){this.db.monitor_config={}}this.isShow=!0},hide:function(){this.isShow=!1},onSubmit:function(){var t=this;this.isSubmit=!0,this.$api.db.monitor_state(this.db.id,this.db.monitor_state,this.db.monitor_config).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh"),t.isSubmit=!1})).catch((function(){t.isSubmit=!1}))}}},c=l,u=(a("a016"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"f74a0728",null);e["default"]=d.exports},9672:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.logData,border:!0}},[a("el-table-column",{attrs:{prop:"opt_desc",label:"操作",width:"180"}}),a("el-table-column",{attrs:{prop:"create_name",label:"操作人",width:"300"}}),a("el-table-column",{attrs:{prop:"opt_ip",label:"操作IP",width:"330"}}),a("el-table-column",{attrs:{prop:"db_name",label:"操作时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"opt_info",label:"操作信息"}})],1)],1)},n=[],o={data:function(){return{}},props:{logData:Array},watch:{},computed:{},methods:{},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"9686e":function(t,e,a){},"968f":function(t,e,a){"use strict";a("be97")},"96fa":function(t,e,a){"use strict";a.d(e,"a",(function(){return c})),a.d(e,"b",(function(){return u}));var s=a("5530"),n=(a("d3b7"),a("ac1f"),a("365c")),o=a("ff60"),i={iid:null,sql:null,project:null,encrypt_flag:!1,owner:null,db_type:null,token:null},r={item_type:null,atk:null,iid:null,project:null,sql:null,encrypt_flag:!1,owner:null,db_type:null,token:null,page_index:0,page_size:10,explain:!1},l=function(t){return t=n["default"].util.aesEncrypted(t),t},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object(s["a"])(Object(s["a"])({},i),t),t.encrypt_flag&&(t.sql=l(t.sql)),t.token||(t.token=Object(o["a"])());var e=Date.now();return new Promise((function(a,s){n["default"].sql.audit(t).then((function(t){var s=Date.now();return a({spend:s-e,data:t})})).catch((function(t){var a=Date.now();return s(new Error({spend:a-e,event:t}))}))}))},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object(s["a"])(Object(s["a"])({},r),t),t.encrypt_flag&&(t.sql=l(t.sql));var e=Date.now();return new Promise((function(a,s){n["default"].sql.exec(t).then((function(s){s.ok,s.head,s.type;var n=s.data,o=s.count,i=s.error,r=s.sql_type,l=s.work,c=s.table_name,u=Date.now(),d={spend:u-e,table_name:c,sql_type:r,error:i,work:l,hasNext:n.length>=t.page_size,affected_rows:11==r?o:o||n.length,data:n};return a(d)})).catch((function(t){var a=Date.now();return s(new Error({spend:a-e,event:t}))}))}))}},"972a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("div",{staticClass:"personal h-full"},[a("el-row",{staticClass:"h-full"},[a("el-col",{attrs:{span:4}},[a("el-aside",{attrs:{width:"200px"}},[a("el-menu",{attrs:{"default-active":t.$route.fullPath,router:!0},on:{select:t.onSelect}},[a("el-menu-item",{attrs:{index:"/personal",disabled:t.getDisableStatus("/personal")}},[t._v(" 用户资料 ")]),a("el-menu-item",{attrs:{index:"/personal/password",disabled:!t.disablePwd||t.getDisableStatus("/personal/password")}},[t._v("修改密码")]),a("el-menu-item",{attrs:{index:"/personal/security",disabled:t.getDisableStatus("/personal/security")}},[t._v("安全设定")])],1)],1)],1),a("el-col",{staticClass:"h-full px-7",attrs:{span:20}},[a("router-view")],1)],1)],1)])},n=[],o=a("5530"),i=a("2f62"),r={name:"personal-index",data:function(){return{active:"/personal"}},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user","forcePwd","forceTfa"])),{},{disablePwd:function(){return"focus"!=this.user.source&&"ldap"!=this.user.source},getDisableStatus:function(){var t=this;return function(e){return!(!t.forceTfa||t.$route.path==e)||!(!t.forcePwd||t.$route.path==e)}}}),methods:{onSelect:function(t){this.active=t}}},l=r,c=(a("0aad"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"335d388a",null);e["default"]=u.exports},9741:function(t,e,a){},9766:function(t,e,a){},9844:function(t,e,a){},"98ed":function(t,e,a){"use strict";a("db37")},"991a":function(t,e,a){},"993f":function(t,e,a){t.exports=function(t){return a("4b3b")("./"+t).default}},9992:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(" "+t._s(t.formData.source_name)+"(权限组) ")]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[t._v(" "+t._s(t.formData.auditor_name)+" ")]),a("el-form-item",{attrs:{label:"审核抄送",prop:"copy_to"}},[t._v(" "+t._s(""==t.copyTo?"无":t.copyTo)+" ")]),a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[t._v(" "+t._s(t.showStatus())+" ")]),1!=t.formData.status?a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):t._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!=t.formData.status,expression:"formData.status!=1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)],1)},n=[],o=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],s=0;s<t.copy_to.length;s++)a.push(t.copy_to[s].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this.formData;t.status=this.status}},mounted:function(){},components:{}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"99ca":function(t,e,a){},"99cf":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vlist-item-template item",class:{"item-selected":t.selectedItemLabel==t.source.label}},[a("div",{staticClass:"left"},[a("el-checkbox",{staticClass:"check-box",attrs:{value:t.isSelected},on:{change:t.checkboxChangeHandle}}),a("el-tooltip",{attrs:{content:t.nodeData.label}},[a("i",{staticClass:"sn-font",class:[t.clazz]},[t._v("")])]),a("span",{staticClass:"source-label",class:[t.clazz],on:{click:t.onItemClick}},[t._v(t._s(t.nodeData.label))])],1),a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font",class:{"auth-read":1==t.nodeData.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",1)}}},[t._v(" 读"+t._s(t.nodeData.rw)+t._s(t.nodeData.parent.rw)+" ")]),a("i",{staticClass:"sn-font",class:{"auth-write":2==t.nodeData.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",2)}}},[t._v("写")]),a("i",{staticClass:"sn-font",class:{"auth-manage":4==t.nodeData.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",4)}}},[t._v("管")]),a("i",{staticClass:"sn-font",class:{"text-error":3==t.nodeData.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",3)}}},[t._v("禁")]),[t._v(" ( "),a("i",{staticClass:"sn-font",class:[t.getAuth2("aq")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","aq")}}},[t._v("")]),a("i",{staticClass:"sn-font",class:[t.getAuth2("ae")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","ae")}}},[t._v("")]),a("i",{staticClass:"sn-font",class:[t.getAuth2("as")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","as")}}},[t._v("")]),t._v(" ) ")]],2)])},n=[],o=a("2708"),i={name:"vlist-template",mixins:[o["a"]],props:{selectedItemLabel:{},selectedNodeList:{type:Array,default:function(){return[]}},source:{type:Object,default:function(){return{}}}},computed:{getAuth2:function(){var t=this;return function(e){return 1==t.nodeData[e]?"auth-read":""}},isSelected:function(){var t=!1;for(var e in this.selectedNodeList){var a=this.selectedNodeList[e];if(a.label==this.nodeData.label){t=!0;break}}return t},clazz:function(){return this.getAuth()}},data:function(){return{nodeData:this.source}},methods:{authClickHandle:function(t,e){if("auth"==t)console.log(this.nodeData,this.source),this.dispatch("role-table-list","vnode-change",{type:"change-auth",source:this.nodeData,auth:{key:"rw",value:e}});else if("auth2"==t){var a=1==this.nodeData[e]?0:1;this.dispatch("role-table-list","vnode-change",{type:"change-auth2",source:this.nodeData,auth:{key:e,value:a}})}},getAuth:function(){var t="";switch(this.nodeData.rw){case 1:t="auth-read";break;case 2:t="auth-write";break;case 3:t="text-error";break;case 4:t="auth-manage";break}return t},checkboxChangeHandle:function(t){this.dispatch("role-table-list","vnode-change",{type:"checked-item",source:this.nodeData,e:t})},onItemClick:function(){this.dispatch("role-table-list","vnode-change",{type:"selected-line",source:this.nodeData})}}},r=i,l=(a("f940"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"19d8012f",null);e["default"]=c.exports},"9a1d":function(t,e,a){},"9a32":function(t,e,a){"use strict";a("f6aa")},"9a91":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page-dashboard apps",attrs:{type:"ghost"}},[a("div",{staticStyle:{height:"130px"}},[a("div",{staticClass:"h-full el-col el-col-8 el-col-xs-12 ",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"h-full demo-color-box bg-info flex ",staticStyle:{"background-color":"#bc8f8f"}},[a("div",{staticClass:"ml-3 flex flex-col justify-between w-full"},[a("div",[a("label",[t._v("欢迎您，")]),a("span",{staticClass:"ignore"},[t._v(t._s(t.user.user_name))])]),a("div",{staticClass:"flex  justify-between"},[a("div",[a("label",[t._v("账号：")]),a("span",{staticClass:"ignore"},[t._v(t._s(t.user.name))])]),a("div",[a("label",[t._v("角色：")]),a("span",{staticClass:"ignore"},[t._v(t._s(t.getRoleTextProxy(t.user.role)))])])]),a("div",[a("label",[t._v("上次登录IP：")]),a("span",{staticClass:"ignore"},[t._v(t._s(t.user.last_ip))])]),a("div",[a("label",{staticClass:"value"},[t._v("上次登录时间：")]),a("span",{staticClass:"ignore"},[t._v(t._s(t._f("dateTime")(t.user.last_time)))])])])])]),a("div",{staticClass:"h-full el-col el-col-8 el-col-xs-12 ",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"h-full demo-color-box bg-danger ",staticStyle:{"background-color":"#6d9a9b"}},[t._v(" 今日访问数 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.today_count))])])]),a("div",{staticClass:"h-full el-col el-col-8 el-col-xs-12  ",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"h-full demo-color-box bg-warning ",staticStyle:{"background-color":"#8f6446"}},[t._v(" 执行失败数 "),a("div",{staticClass:"value"},[t._v(t._s(t.stat.fail_count))])])])]),a("el-row",{staticClass:"mt-10",attrs:{gutter:12}},[a("el-col",{staticClass:"chart",attrs:{span:12}},[a("el-card",{staticClass:"box-card pro_man"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("项目广场")])]),a("div",{staticStyle:{"min-height":"350px","max-height":"350px","overflow-y":"scroll"}},[a("div",{staticClass:"pro_man_list no-user-select "},[a("div",{staticClass:"w-full grid grid-cols-1 md:grid-cols-2 2xl:grid-cols-3 gap-4"},t._l(t.projectList,(function(e,s){return a("div",{key:s,staticClass:"project-item   flex flex-col justify-between px-5 pt-5 pb-3 project-item-bg-color shadow-sm hover:shadow-lg",class:{"cursor-pointer text-gray-100 inproject-item-bg-color":""!=e.in_flag},staticStyle:{"min-height":"80px"},attrs:{title:""!=e.in_flag?"已加入，点击进入项目":"未加入"},on:{click:function(a){return t.goProjectHome(e)}}},[a("div",{staticClass:"flex justify-between"},[a("div",[t._v(" "+t._s(e.name)+" ")]),""!=e.in_flag?a("button",{attrs:{title:"已加入"}},[t._v(" 已加入 ")]):a("button",{staticClass:"px-3 rounded-full h-7 w-7 bg-yellow-500 hover:bg-yellow-600  active:bg-yellow-700 flex items-center justify-center",attrs:{title:"加入项目"},on:{click:function(a){return t.onAddProject(e.id)}}},[a("i",{staticClass:"el-icon-plus text-white"})])]),a("hr"),a("div",[a("k-icon",{attrs:{name:"icon-chuangjianshijian"}}),t._v(" "+t._s(t._f("date")(e.createdAt))+" ")],1)])})),0)])])])],1),a("el-col",{attrs:{span:12}},[a("el-card",{staticClass:"box-card pro_man notice-section"},[a("div",{staticClass:"clearfix flex items-center justify-between",attrs:{slot:"header"},slot:"header"},[a("div",[a("el-link",{attrs:{title:"更多消息",type:"text"},on:{click:function(){t.$router.push("/personal/notice")}}},[t._v("消息>>")])],1),a("el-link",{attrs:{type:"primary"},on:{click:t.onRefresh}},[t._v("刷新")])],1),a("div",{staticClass:"overflow-x-auto flex flex-col",staticStyle:{"min-height":"350px","max-height":"350px"}},[a("msg-list",{ref:"msgListRef",staticClass:"flex-1",attrs:{config:{msg_type:1,open_page:!1}}})],1)])],1)],1),a("el-row",{staticClass:"mt-10",attrs:{gutter:12}},[a("el-col",{staticClass:"chart",attrs:{span:24}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("一周访问量")])]),a("div",[a("ve-line",t._b({attrs:{data:t.logTimeStat,title:t.logTimeTitle}},"ve-line",t.pubSetting1,!1))],1)])],1)],1),a("dialog-project-apply",{ref:"dialogProjectApply",on:{refresh:t.init}})],1)},n=[],o=a("b85c"),i=a("5530"),r=(a("b0c0"),a("18b0")),l=a("5743"),c=a("2f62"),u=(a("d3b7"),a("ddb0"),a("99af"),{1:"超级管理员",2:"安全管理员",3:"审计管理员",4:"系统管理员",9:"普通用户"}),d=function(t){return u[t]},p=a("9583"),f=a("2819"),m={components:{VeLine:f["VeLine"],DialogProjectApply:p["default"],MsgList:r["a"]},computed:Object(i["a"])({},Object(c["e"])(["user","project"])),data:function(){return{isCommunity:!1,projectList:[],query:{start:"",end:"",start2:"",end2:""},stat:{db_count:0,app_count:0,user_count:0,today_count:0,fail_count:0},dbTypeStat:{columns:["类型","数量"],rows:[]},dbTypeTitle:{text:"数据源类型"},typeTitle:{text:"当日执行类型统计",default:10},logTimeTitle:{text:""},logStat:{columns:["类型","数量"],rows:[]},logTitle:{text:"当日失败率统计"},logTimeStat:{columns:["时间","访问量"],rows:[]},dbStat:{columns:["数据源","访问量"],rows:[]},dbTitle:{text:"当日数据库使用量"},dbStatSettings:{dataOrder:{label:"访问量",order:"desc"}},exportStat:{columns:["应用","访问量"],rows:[]},appTitle:{text:"当日数据导出量"},userStat:{columns:["用户名","访问量"],rows:[]},typeStat:{columns:["操作","数量"],rows:[]},userTitle:{text:"当日用户访问量"},appStatSettings:{dataOrder:{label:"访问量",order:"desc"}},pubSetting1:{height:"350px",width:"100%"},pubSetting:{height:"400px",width:"100%"},chartData1:{columns:["数据源","次数"],rows:[{"次数":1393,"数据源":"查询库"},{"次数":3530,"数据源":"用户中心"},{"次数":2923,"数据源":"订单库"},{"次数":1723,"数据源":"淘宝api"},{"次数":3792,"数据源":"日志"},{"次数":4593,"数据源":"eslog"}]},chartData:{columns:["日期","访问用户","下单用户","下单率"],rows:[{"日期":"1/1","访问用户":1393,"下单用户":1093,"下单率":.32},{"日期":"1/2","访问用户":3530,"下单用户":3230,"下单率":.26},{"日期":"1/3","访问用户":2923,"下单用户":2623,"下单率":.76},{"日期":"1/4","访问用户":1723,"下单用户":1423,"下单率":.49},{"日期":"1/5","访问用户":3792,"下单用户":3492,"下单率":.323},{"日期":"1/6","访问用户":4593,"下单用户":4293,"下单率":.78}]}}},methods:{onRefresh:function(){this.$refs.msgListRef.refresh()},getRoleTextProxy:function(t){return d(t)},getTagType:function(t){return t?"success":"info"},goProjectHome:function(t){""!=t.in_flag&&(this.$store.commit("dashboard_project",t),this.$router.push({path:"/project/".concat(t.id,"/dashboard")}))},onAddProject:function(t){this.$refs.dialogProjectApply.show(t)},init:function(){var t=this;this.$api.project.publicList().then((function(e){t.projectList=e})),this.$api.post("/api/user/stat",{type:"total_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.today_count=e.hits})),this.$api.post("/api/user/stat",{type:"total_fail_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.fail_count=e.hits})),this.$api.post("/api/user/stat",{type:"log_time_stat",start:this.query.start2,end:this.query.end2}).then((function(e){var a=[];if(e&&0==e.length)a.push({"时间":"今天","访问量":0});else{var s,n=Object(o["a"])(e);try{for(n.s();!(s=n.n()).done;){var i=s.value;a.push({"时间":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}}t.logTimeStat.rows=a}))}},mounted:function(){var t=this,e=l["a"].timeRange("now/d to now/d");e&&e.length>1&&(this.query.start=l["a"].utc2date(e[0]),this.query.end=l["a"].utc2date(e[1]));var a=l["a"].timeRange("now-7d to now");a&&a.length>1&&(this.query.start2=l["a"].utc2date(a[0]),this.query.end2=l["a"].utc2date(a[1])),this.$nextTick((function(){t.init()}))}},h=m,b=(a("2711"),a("2877")),_=Object(b["a"])(h,s,n,!1,null,null,null);e["default"]=_.exports},"9ab4":function(t,e,a){"use strict";a("2cc9")},"9bc0":function(t,e,a){"use strict";a("f61f")},"9c01":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("el-tooltip",{attrs:{content:"收藏代码"}},[a("el-popover",{ref:"fav_popover",attrs:{"popper-class":"favorite"},model:{value:t.is_show,callback:function(e){t.is_show=e},expression:"is_show"}},[a("el-button",{ref:"fav_btn",staticClass:"query-tool-item",attrs:{slot:"reference",type:"text",size:"mini",id:"fav_btn",trigger:"click"},slot:"reference"},[a("i",{staticClass:"sn-font text-primary"},[t._v("")])]),a("el-table",{attrs:{data:t.dataList,width:"100%",height:"350",border:""}},[a("el-table-column",{attrs:{type:"expand",width:"80",property:"content",label:"脚本"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{cursor:"pointer"}},[t._v(t._s(e.row.content))])]}}])}),a("el-table-column",{attrs:{width:"300",property:"name",label:"标题"}}),a("el-table-column",{attrs:{width:"200",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{width:"200",property:"createdAt",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"tools"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.onSelect(e.row)}}},[t._v("使用")]),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return a.stopPropagation(),t.$refs.favoriteDialog.show(e.row)}}},[t._v("修改")]),a("k-btn-tip",{on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{staticClass:"text-error",attrs:{type:"text",size:"mini"}},[t._v("删除")])],1)],1)]}}])})],1),a("div",{staticClass:"lists"},[a("div",{staticClass:"add"},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:t.onAdd}},[t._v("收藏该SQL")])],1)])],1)],1),a("dialog-favorite",{ref:"favoriteDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("1da1"),i=a("5530"),r=(a("2ca0"),a("ac1f"),a("1276"),a("96cf"),a("2f62")),l=a("d024"),c=a("365c"),u={data:function(){return{is_show:!1,dataList:[]}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(r["e"])(["runner","sys"])),Object(r["c"])(["context"])),{},{db:function(){return this.context.service&&this.context.service.data?{id:this.context.service.data.id}:{}},owner:function(){return this.context.service&&this.context.service.data?{id:this.context.service.data.owner}:{}}}),props:{},watch:{is_show:function(t){console.log("is_show:",t),t&&this.refresh()}},methods:{showSelf:function(t){t&&this.refresh(),this.show=t},deleteRow:function(t){},refresh:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("[tool.favorite methods] refresh: ",t.db,t.owner),e.next=3,t.$api.favorite.all(t.db.id,t.owner.id);case 3:t.dataList=e.sent;case 4:case"end":return e.stop()}}),e)})))()},onSelect:function(t){this.context.service.setSQL(t.content,!0),document.getElementById("fav_btn").click()},onAdd:function(){var t=this;this.$prompt("请输入名称").then((function(e){var a=e.value,s=t.context.service.getFullSQL();if(console.log("value:",a," sql:",s),!a)return"e:名称不能为空！";if(!s)return"e:收藏脚本不能为空！";var n=s;return t.sys.encrypt_sql&&(n=c["default"].util.aesEncrypted(n)),t.$api.favorite.add({name:a,instance:t.db.id,owner:t.owner.id,content:n,pid:0})})).then((function(e){e&&e.startsWith("e:")?t.onError(e.split(":")[1]):(t.onSuccess("收藏成功"),t.refresh())}))},onDel:function(t){var e=this;console.log(t),this.$api.favorite.del(t.id).then((function(){e.onSuccess("删除成功"),e.refresh()}))}},components:{DialogFavorite:l["default"]},mounted:function(){this.refresh()}},d=u,p=(a("582b"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},"9c0c":function(t,e,a){},"9c16":function(t,e,a){"use strict";a("652d")},"9c25":function(t,e,a){},"9ca2":function(t,e,a){"use strict";a("903b")},"9cd8":function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-history",use:"d2-history-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-history"><path d="M512 1024C229.7 1024 0 794.3 0 512S229.7 0 512 0s512 229.7 512 512-229.7 512-512 512z m0-938.7C276.7 85.3 85.3 276.7 85.3 512S276.7 938.7 512 938.7 938.7 747.3 938.7 512 747.3 85.3 512 85.3z" fill="#3688FF" /><path d="M640 682.7c-9.6 0-19.3-3.2-27.3-9.9l-128-106.7c-9.7-8.1-15.4-20.1-15.4-32.8V384c0-23.6 19.1-42.7 42.7-42.7s42.7 19.1 42.7 42.7v129.4l112.6 93.9c18.1 15.1 20.5 42 5.5 60.1-8.5 10-20.6 15.3-32.8 15.3z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},"9d75":function(t,e,a){"use strict";a("3d4f")},"9dac":function(t,e,a){var s={"./login":["9ed6",9],"./login/":["9ed6",9],"./login/cas":["2c11",9],"./login/cas.vue":["2c11",9],"./login/focus":["ea6f",9],"./login/focus.vue":["ea6f",9],"./login/index":["9ed6",9],"./login/index.vue":["9ed6",9],"./login/new-login":["668d",9],"./login/new-login.vue":["668d",9],"./login/oauth2":["6c4d",9],"./login/oauth2.vue":["6c4d",9],"./login/reg.license":["c041",9],"./login/reg.license.vue":["c041",9],"./mgt/account":["c774",9],"./mgt/account/":["c774",9],"./mgt/account/dialog.auth":["a299",9],"./mgt/account/dialog.auth.vue":["a299",9],"./mgt/account/dialog.edit":["be4f",9],"./mgt/account/dialog.edit.vue":["be4f",9],"./mgt/account/index":["c774",9],"./mgt/account/index.vue":["c774",9],"./mgt/act":["2506",9],"./mgt/act-log":["082f",9],"./mgt/act-log/":["082f",9],"./mgt/act-log/index":["082f",9],"./mgt/act-log/index.vue":["082f",9],"./mgt/act/":["2506",9],"./mgt/act/index":["2506",9],"./mgt/act/index.vue":["2506",9],"./mgt/act/operat-log":["fa69",9],"./mgt/act/operat-log.vue":["fa69",9],"./mgt/apply":["c464",9],"./mgt/apply/":["c464",9],"./mgt/apply/dialog.apply":["6e7a",9],"./mgt/apply/dialog.apply.info":["7db0",9],"./mgt/apply/dialog.apply.info.vue":["7db0",9],"./mgt/apply/dialog.apply.page":["b1a1",9],"./mgt/apply/dialog.apply.page.vue":["b1a1",9],"./mgt/apply/dialog.apply.vue":["6e7a",9],"./mgt/apply/index":["c464",9],"./mgt/apply/index.vue":["c464",9],"./mgt/audit":["76e7",9],"./mgt/audit-setting":["0395",9],"./mgt/audit-setting/":["0395",9],"./mgt/audit-setting/comonents/inception":["ef64",9],"./mgt/audit-setting/comonents/inception.vue":["ef64",9],"./mgt/audit-setting/comonents/setting.inception":["5cbd",9],"./mgt/audit-setting/comonents/setting.inception.vue":["5cbd",9],"./mgt/audit-setting/comonents/work_config":["4bf5",9],"./mgt/audit-setting/comonents/work_config.vue":["4bf5",9],"./mgt/audit-setting/index":["0395",9],"./mgt/audit-setting/index.vue":["0395",9],"./mgt/audit/":["76e7",9],"./mgt/audit/dialog.apply":["fa4d",9],"./mgt/audit/dialog.apply.page":["18df",9],"./mgt/audit/dialog.apply.page.vue":["18df",9],"./mgt/audit/dialog.apply.vue":["fa4d",9],"./mgt/audit/index":["76e7",9],"./mgt/audit/index.vue":["76e7",9],"./mgt/auth":["8c6a",9],"./mgt/auth/":["8c6a",9],"./mgt/auth/dialog.apply":["ccf4",9],"./mgt/auth/dialog.apply.page":["ff83",9],"./mgt/auth/dialog.apply.page.vue":["ff83",9],"./mgt/auth/dialog.apply.vue":["ccf4",9],"./mgt/auth/index":["8c6a",9],"./mgt/auth/index.vue":["8c6a",9],"./mgt/auth/my.index":["7f36",9],"./mgt/auth/my.index.vue":["7f36",9],"./mgt/database":["0003",9],"./mgt/database/":["0003",9],"./mgt/database/components/instance.info":["8c1b",9],"./mgt/database/components/instance.info.vue":["8c1b",9],"./mgt/database/components/monitor.mysql":["0f37",9],"./mgt/database/components/monitor.mysql.vue":["0f37",9],"./mgt/database/components/monitor.oracle":["77e9",9],"./mgt/database/components/monitor.oracle.vue":["77e9",9],"./mgt/database/dialog.cron":["6fb5",9],"./mgt/database/dialog.cron.vue":["6fb5",9],"./mgt/database/dialog.edit":["e7a8",9],"./mgt/database/dialog.edit.vue":["e7a8",9],"./mgt/database/dialog.monitor":["960e",9],"./mgt/database/dialog.monitor.vue":["960e",9],"./mgt/database/dialog.sddp.task":["f928",9],"./mgt/database/dialog.sddp.task.vue":["f928",9],"./mgt/database/index":["0003",9],"./mgt/database/index.vue":["0003",9],"./mgt/error":["6745",9],"./mgt/error/":["6745",9],"./mgt/error/index":["6745",9],"./mgt/error/index.vue":["6745",9],"./mgt/error/license":["b4ae",9],"./mgt/error/license.vue":["b4ae",9],"./mgt/find-pwd":["c14c",9],"./mgt/find-pwd/":["c14c",9],"./mgt/find-pwd/index":["c14c",9],"./mgt/find-pwd/index.less":["351c",7],"./mgt/find-pwd/index.vue":["c14c",9],"./mgt/framework":["aa82",9],"./mgt/framework/":["aa82",9],"./mgt/framework/index":["aa82",9],"./mgt/framework/index.vue":["aa82",9],"./mgt/license":["0f4d",9],"./mgt/license/":["0f4d",9],"./mgt/license/index":["0f4d",9],"./mgt/license/index.vue":["0f4d",9],"./mgt/log":["03a4",9],"./mgt/log/":["03a4",9],"./mgt/log/index":["03a4",9],"./mgt/log/index.vue":["03a4",9],"./mgt/mask":["c6d4",9],"./mgt/mask/":["c6d4",9],"./mgt/mask/dialog.edit":["6150",9],"./mgt/mask/dialog.edit.vue":["6150",9],"./mgt/mask/index":["c6d4",9],"./mgt/mask/index.vue":["c6d4",9],"./mgt/monitor":["4175",9],"./mgt/monitor/":["4175",9],"./mgt/monitor/index":["4175",9],"./mgt/monitor/index.vue":["4175",9],"./mgt/monitor/mysql/mysql.health":["1f8a",9],"./mgt/monitor/mysql/mysql.health.vue":["1f8a",9],"./mgt/monitor/mysql/mysql.innodb":["a707",9],"./mgt/monitor/mysql/mysql.innodb.vue":["a707",9],"./mgt/monitor/mysql/mysql.key_cache":["cf8f",9],"./mgt/monitor/mysql/mysql.key_cache.vue":["cf8f",9],"./mgt/monitor/mysql/mysql.process":["f306",9],"./mgt/monitor/mysql/mysql.process.vue":["f306",9],"./mgt/monitor/mysql/mysql.resource":["0060",9],"./mgt/monitor/mysql/mysql.resource.vue":["0060",9],"./mgt/monitor/oracle/oracle.status":["8e68",9],"./mgt/monitor/oracle/oracle.status.vue":["8e68",9],"./mgt/monitor/system":["a7f1",9],"./mgt/monitor/system.vue":["a7f1",9],"./mgt/project":["4811",9],"./mgt/project/":["4811",9],"./mgt/project/dialog.auth":["1e99",9],"./mgt/project/dialog.auth.vue":["1e99",9],"./mgt/project/dialog.edit":["dcb1",9],"./mgt/project/dialog.edit.vue":["dcb1",9],"./mgt/project/dialog.project.db":["f983",9],"./mgt/project/dialog.project.db.vue":["f983",9],"./mgt/project/dialog.project.inception":["4eaf",9],"./mgt/project/dialog.project.inception.vue":["4eaf",9],"./mgt/project/dialog.project.role":["e34f",9],"./mgt/project/dialog.project.role.vue":["e34f",9],"./mgt/project/dialog.project.user":["dd1f",9],"./mgt/project/dialog.project.user.vue":["dd1f",9],"./mgt/project/dialog.project.work":["1bbd",9],"./mgt/project/dialog.project.work.vue":["1bbd",9],"./mgt/project/dialog.work.setting":["3867",9],"./mgt/project/dialog.work.setting.vue":["3867",9],"./mgt/project/index":["4811",9],"./mgt/project/index copy":["07ec",9],"./mgt/project/index copy.vue":["07ec",9],"./mgt/project/index.vue":["4811",9],"./mgt/project/project.list":["74b8",9],"./mgt/project/project.list.vue":["74b8",9],"./mgt/project/trash":["4d3a",9],"./mgt/project/trash.vue":["4d3a",9],"./mgt/report":["16d6",9],"./mgt/report/":["16d6",9],"./mgt/report/comonents/report.db":["5298",9],"./mgt/report/comonents/report.db.vue":["5298",9],"./mgt/report/comonents/report.stat":["20a4",9],"./mgt/report/comonents/report.stat.vue":["20a4",9],"./mgt/report/comonents/report.user":["c029",9],"./mgt/report/comonents/report.user.vue":["c029",9],"./mgt/report/index":["16d6",9],"./mgt/report/index.vue":["16d6",9],"./mgt/role":["c116",9],"./mgt/role/":["c116",9],"./mgt/role/components/column.list":["b267",9],"./mgt/role/components/column.list.vue":["b267",9],"./mgt/role/components/dialog.batchauth":["aa90",9],"./mgt/role/components/dialog.batchauth.vue":["aa90",9],"./mgt/role/components/dialog.mask":["5bf4",9],"./mgt/role/components/dialog.mask.vue":["5bf4",9],"./mgt/role/components/dialog.role.db":["4cc5",9],"./mgt/role/components/dialog.role.db.vue":["4cc5",9],"./mgt/role/components/dialog.role.form":["9f6e",9],"./mgt/role/components/dialog.role.form.vue":["9f6e",9],"./mgt/role/components/dialog.role.strategy":["81f5",9],"./mgt/role/components/dialog.role.strategy.vue":["81f5",9],"./mgt/role/components/dialog.role.user":["48e9",9],"./mgt/role/components/dialog.role.user.vue":["48e9",9],"./mgt/role/components/dialog.role.user2":["5e49",9],"./mgt/role/components/dialog.role.user2.vue":["5e49",9],"./mgt/role/components/dialog.table":["3372",9],"./mgt/role/components/dialog.table.vue":["3372",9],"./mgt/role/components/instance.list":["d23f",9],"./mgt/role/components/instance.list copy":["40c3",9],"./mgt/role/components/instance.list copy.vue":["40c3",9],"./mgt/role/components/instance.list.vue":["d23f",9],"./mgt/role/components/permission.list":["23f3",9],"./mgt/role/components/permission.list.vue":["23f3",9],"./mgt/role/components/role.list":["3ea6",9],"./mgt/role/components/role.list.vue":["3ea6",9],"./mgt/role/components/table.info":["eaf8",9],"./mgt/role/components/table.info.vue":["eaf8",9],"./mgt/role/components/table.list":["890c",9],"./mgt/role/components/table.list copy":["4cd4",9],"./mgt/role/components/table.list copy.vue":["4cd4",9],"./mgt/role/components/table.list.vue":["890c",9],"./mgt/role/components/table.tip":["a694",9],"./mgt/role/components/table.tip.vue":["a694",9],"./mgt/role/components/vlist.template":["f13c",9],"./mgt/role/components/vlist.template.vue":["f13c",9],"./mgt/role/components/备份vlist.template":["99cf",9],"./mgt/role/components/备份vlist.template.vue":["99cf",9],"./mgt/role/index":["c116",9],"./mgt/role/index.vue":["c116",9],"./mgt/rule":["f73c",9],"./mgt/rule/":["f73c",9],"./mgt/rule/dialog.edit":["1607",9],"./mgt/rule/dialog.edit.vue":["1607",9],"./mgt/rule/index":["f73c",9],"./mgt/rule/index.vue":["f73c",9],"./mgt/sddp":["3660",9],"./mgt/sddp/":["3660",9],"./mgt/sddp/com/audit.form":["ee0c",9],"./mgt/sddp/com/audit.form.vue":["ee0c",9],"./mgt/sddp/com/audit.log":["db2c",9],"./mgt/sddp/com/audit.log.vue":["db2c",9],"./mgt/sddp/com/sql.audit.log":["3d21",9],"./mgt/sddp/com/sql.audit.log.vue":["3d21",9],"./mgt/sddp/com/work.sql":["b591",9],"./mgt/sddp/com/work.sql.vue":["b591",9],"./mgt/sddp/dialog.edit":["c892",9],"./mgt/sddp/dialog.edit.exec.time":["4023",9],"./mgt/sddp/dialog.edit.exec.time.vue":["4023",9],"./mgt/sddp/dialog.edit.vue":["c892",9],"./mgt/sddp/index":["3660",9],"./mgt/sddp/index.vue":["3660",9],"./mgt/setting":["d70f",9],"./mgt/setting/":["d70f",9],"./mgt/setting/backup":["4140",9],"./mgt/setting/backup.vue":["4140",9],"./mgt/setting/comonents/setting.backup":["cf60",9],"./mgt/setting/comonents/setting.backup.vue":["cf60",9],"./mgt/setting/comonents/setting.notify":["4183",9],"./mgt/setting/comonents/setting.notify.vue":["4183",9],"./mgt/setting/comonents/setting.policy":["d75b",9],"./mgt/setting/comonents/setting.policy.vue":["d75b",9],"./mgt/setting/comonents/setting.warning":["2ab5",9],"./mgt/setting/comonents/setting.warning.vue":["2ab5",9],"./mgt/setting/func":["3551",9],"./mgt/setting/func.vue":["3551",9],"./mgt/setting/index":["d70f",9],"./mgt/setting/index.vue":["d70f",9],"./mgt/setting/license":["c5c5",9],"./mgt/setting/license.vue":["c5c5",9],"./mgt/setting/login":["affe",9],"./mgt/setting/login.vue":["affe",9],"./mgt/setting/notice":["d2ec",9],"./mgt/setting/notice.vue":["d2ec",9],"./mgt/setting/policy":["e2cb",9],"./mgt/setting/policy.vue":["e2cb",9],"./mgt/setting/update":["f8be",9],"./mgt/setting/update.vue":["f8be",9],"./mgt/ssh":["5292",9],"./mgt/ssh/":["5292",9],"./mgt/ssh/dialog.edit":["3ae7",9],"./mgt/ssh/dialog.edit.vue":["3ae7",9],"./mgt/ssh/dialog.trem":["ad1b",9],"./mgt/ssh/dialog.trem.vue":["ad1b",9],"./mgt/ssh/dialog.user":["2ab6",9],"./mgt/ssh/dialog.user.vue":["2ab6",9],"./mgt/ssh/index":["5292",9],"./mgt/ssh/index.vue":["5292",9],"./mgt/ssh/new-terminal":["fb1d",9],"./mgt/ssh/new-terminal.vue":["fb1d",9],"./mgt/ssh/ssh.trem.page":["9461",9],"./mgt/ssh/ssh.trem.page.vue":["9461",9],"./mgt/ssh_log":["bc16",9],"./mgt/ssh_log/":["bc16",9],"./mgt/ssh_log/dialog.trem.log":["5fc3",9],"./mgt/ssh_log/dialog.trem.log.vue":["5fc3",9],"./mgt/ssh_log/index":["bc16",9],"./mgt/ssh_log/index.vue":["bc16",9],"./mgt/ssh_strategy":["feca",9],"./mgt/ssh_strategy/":["feca",9],"./mgt/ssh_strategy/dialog.edit":["cb22",9],"./mgt/ssh_strategy/dialog.edit.vue":["cb22",9],"./mgt/ssh_strategy/index":["feca",9],"./mgt/ssh_strategy/index.vue":["feca",9],"./mgt/stat":["60c3",9],"./mgt/stat/":["60c3",9],"./mgt/stat/index":["60c3",9],"./mgt/stat/index.vue":["60c3",9],"./mgt/strategy":["02ae",9],"./mgt/strategy/":["02ae",9],"./mgt/strategy/components/column.list":["c7ed",9],"./mgt/strategy/components/column.list.vue":["c7ed",9],"./mgt/strategy/components/db.list":["7e57",9],"./mgt/strategy/components/db.list.vue":["7e57",9],"./mgt/strategy/components/mask.strategy":["1eec",9],"./mgt/strategy/components/mask.strategy.vue":["1eec",9],"./mgt/strategy/components/owner.list":["660b",9],"./mgt/strategy/components/owner.list.vue":["660b",9],"./mgt/strategy/components/query.strategy":["39ce",9],"./mgt/strategy/components/query.strategy.vue":["39ce",9],"./mgt/strategy/components/table.list":["2971",9],"./mgt/strategy/components/table.list.vue":["2971",9],"./mgt/strategy/dialog.edit":["2a76",9],"./mgt/strategy/dialog.edit.vue":["2a76",9],"./mgt/strategy/dialog.test":["1ae3",9],"./mgt/strategy/dialog.test.vue":["1ae3",9],"./mgt/strategy/index":["02ae",9],"./mgt/strategy/index.vue":["02ae",9],"./mgt/strategy/strategy":["782c",9],"./mgt/strategy/strategy.js":["782c",9],"./mgt/work":["cda8",9],"./mgt/work/":["cda8",9],"./mgt/work/com/audit.form":["da6fe",9],"./mgt/work/com/audit.form.vue":["da6fe",9],"./mgt/work/com/audit.log":["9672",9],"./mgt/work/com/audit.log.vue":["9672",9],"./mgt/work/com/sql.audit.log":["39e7",9],"./mgt/work/com/sql.audit.log.vue":["39e7",9],"./mgt/work/com/work.sql":["e649",9],"./mgt/work/com/work.sql.vue":["e649",9],"./mgt/work/dialog.backup":["096f",9],"./mgt/work/dialog.backup.vue":["096f",9],"./mgt/work/dialog.detail":["cdac",9],"./mgt/work/dialog.detail.vue":["cdac",9],"./mgt/work/dialog.edit":["da46",9],"./mgt/work/dialog.edit.exec.time":["4683",9],"./mgt/work/dialog.edit.exec.time.vue":["4683",9],"./mgt/work/dialog.edit.vue":["da46",9],"./mgt/work/dialog.exec.scheduler":["344a",9],"./mgt/work/dialog.exec.scheduler.vue":["344a",9],"./mgt/work/dialog.work":["9fae",9],"./mgt/work/dialog.work.info":["9992",9],"./mgt/work/dialog.work.info.vue":["9992",9],"./mgt/work/dialog.work.page":["34bb",9],"./mgt/work/dialog.work.page.vue":["34bb",9],"./mgt/work/dialog.work.vue":["9fae",9],"./mgt/work/index":["cda8",9],"./mgt/work/index.vue":["cda8",9],"./personal":["972a",9],"./personal/":["972a",9],"./personal/index":["972a",9],"./personal/index.vue":["972a",9],"./personal/info":["3392",9],"./personal/info.vue":["3392",9],"./personal/notice":["0423",9],"./personal/notice/":["0423",9],"./personal/notice/components/send-view":["2109",9],"./personal/notice/components/send-view.vue":["2109",9],"./personal/notice/index":["0423",9],"./personal/notice/index.vue":["0423",9],"./personal/notice/personal-notice":["8b53",9],"./personal/notice/personal-notice-list":["fabe",9],"./personal/notice/personal-notice-list.vue":["fabe",9],"./personal/notice/personal-notice.vue":["8b53",9],"./personal/notice/system-notice-list":["939f",9],"./personal/notice/system-notice-list.vue":["939f",9],"./personal/password":["1eed",9],"./personal/password.vue":["1eed",9],"./personal/security":["5db0",9],"./personal/security.vue":["5db0",9],"./project":["707c",9],"./project/":["707c",9],"./project/components/dialog.apply":["33e4",9],"./project/components/dialog.apply.audit":["8862",9],"./project/components/dialog.apply.audit.vue":["8862",9],"./project/components/dialog.apply.info":["3bf0",9],"./project/components/dialog.apply.info.vue":["3bf0",9],"./project/components/dialog.apply.vue":["33e4",9],"./project/components/dialog.project.apply":["e802",9],"./project/components/dialog.project.apply.vue":["e802",9],"./project/components/dialog.project.post":["9ef2",9],"./project/components/dialog.project.post.vue":["9ef2",9],"./project/components/dialog.role.auth":["72ca",9],"./project/components/dialog.role.auth.vue":["72ca",9],"./project/dashboard":["0778",9],"./project/dashboard.vue":["0778",9],"./project/datasource":["26dd",9],"./project/datasource.vue":["26dd",9],"./project/index":["707c",9],"./project/index.vue":["707c",9],"./project/log":["5818",9],"./project/log.vue":["5818",9],"./project/member":["aa8f",9],"./project/member.vue":["aa8f",9],"./project/notice":["0798",9],"./project/notice.vue":["0798",9],"./project/post":["7d3d",9],"./project/post.vue":["7d3d",9],"./project/query":["8d5a",9],"./project/query/":["8d5a",9],"./project/query/components/node-info":["711d",9],"./project/query/components/node-info.vue":["711d",9],"./project/query/components/tab":["8546",9],"./project/query/components/tab/":["8546",9],"./project/query/components/tab/index":["8546",9],"./project/query/components/tab/index.vue":["8546",9],"./project/query/components/tab/left/card.db":["fb22",9],"./project/query/components/tab/left/card.db.item.template":["43d3",9],"./project/query/components/tab/left/card.db.item.template.vue":["43d3",9],"./project/query/components/tab/left/card.db.vue":["fb22",9],"./project/query/components/tab/left/table/dialog.redis.info":["bda3",9],"./project/query/components/tab/left/table/dialog.redis.info.vue":["bda3",9],"./project/query/components/tab/left/table/dialog.table":["092b",9],"./project/query/components/tab/left/table/dialog.table.edit":["8f44",9],"./project/query/components/tab/left/table/dialog.table.edit.vue":["8f44",9],"./project/query/components/tab/left/table/dialog.table.vue":["092b",9],"./project/query/components/tab/left/table/edit.field":["6cc5",9],"./project/query/components/tab/left/table/edit.field.vue":["6cc5",9],"./project/query/components/tab/left/table/edit.index":["29bf",9],"./project/query/components/tab/left/table/edit.index.vue":["29bf",9],"./project/query/components/tab/left/table/edit.schema":["f17c",9],"./project/query/components/tab/left/table/edit.schema.js":["f17c",9],"./project/query/components/tab/left/table/table.info":["3eff",9],"./project/query/components/tab/left/table/table.info.vue":["3eff",9],"./project/query/components/tab/monaco/functions.ext":["c890",7],"./project/query/components/tab/monaco/functions.ext.js":["c890",7],"./project/query/components/tab/monaco/languages/mongodb":["acc0",7],"./project/query/components/tab/monaco/languages/mongodb.js":["acc0",7],"./project/query/components/tab/monaco/languages/oracle":["18f5",7],"./project/query/components/tab/monaco/languages/oracle.js":["18f5",7],"./project/query/components/tab/monaco/mysql":["3bff",7],"./project/query/components/tab/monaco/mysql.js":["3bff",7],"./project/query/components/tab/monaco/oracle":["2ca1",7],"./project/query/components/tab/monaco/oracle.js":["2ca1",7],"./project/query/components/tab/monaco/pgsql":["0470",7],"./project/query/components/tab/monaco/pgsql.js":["0470",7],"./project/query/components/tab/monaco/regexps":["3f97",7],"./project/query/components/tab/monaco/regexps.js":["3f97",7],"./project/query/components/tab/monaco/sql":["60ba",7],"./project/query/components/tab/monaco/sql.js":["60ba",7],"./project/query/components/tab/right":["356b",9],"./project/query/components/tab/right/":["356b",9],"./project/query/components/tab/right/card.async":["a31e",9],"./project/query/components/tab/right/card.async.vue":["a31e",9],"./project/query/components/tab/right/dialog.async":["dcb4",9],"./project/query/components/tab/right/dialog.async.vue":["dcb4",9],"./project/query/components/tab/right/dialog.diff":["f9b1",9],"./project/query/components/tab/right/dialog.diff.vue":["f9b1",9],"./project/query/components/tab/right/dialog.effect":["4ea6",9],"./project/query/components/tab/right/dialog.effect.vue":["4ea6",9],"./project/query/components/tab/right/dialog.error":["d7dc",9],"./project/query/components/tab/right/dialog.error.vue":["d7dc",9],"./project/query/components/tab/right/dialog.export":["43f9",9],"./project/query/components/tab/right/dialog.export.vue":["43f9",9],"./project/query/components/tab/right/dialog.favorite":["5de3",9],"./project/query/components/tab/right/dialog.favorite.vue":["5de3",9],"./project/query/components/tab/right/dialog.longtext":["270c",9],"./project/query/components/tab/right/dialog.longtext.vue":["270c",9],"./project/query/components/tab/right/dialog.sql.export":["c9ff",9],"./project/query/components/tab/right/dialog.sql.export.vue":["c9ff",9],"./project/query/components/tab/right/index":["356b",9],"./project/query/components/tab/right/index.vue":["356b",9],"./project/query/components/tab/right/result.explain":["803d",9],"./project/query/components/tab/right/result.explain.vue":["803d",9],"./project/query/components/tab/right/result.export":["4826",9],"./project/query/components/tab/right/result.export.vue":["4826",9],"./project/query/components/tab/right/result.history":["736a",9],"./project/query/components/tab/right/result.history.vue":["736a",9],"./project/query/components/tab/right/result.info":["adc8",9],"./project/query/components/tab/right/result.info.vue":["adc8",9],"./project/query/components/tab/right/result.result":["23b2",9],"./project/query/components/tab/right/result.result.vue":["23b2",9],"./project/query/components/tab/right/result.work":["a887",9],"./project/query/components/tab/right/result.work.vue":["a887",9],"./project/query/components/tab/right/tool":["a414",9],"./project/query/components/tab/right/tool.column":["1c01",9],"./project/query/components/tab/right/tool.column.vue":["1c01",9],"./project/query/components/tab/right/tool.table":["b61e",9],"./project/query/components/tab/right/tool.table.vue":["b61e",9],"./project/query/components/tab/right/tool.vue":["a414",9],"./project/query/components/tab/service":["69e1",9],"./project/query/components/tab/service.auto.db":["d18d",9],"./project/query/components/tab/service.auto.db.dbsuggest":["232e",9],"./project/query/components/tab/service.auto.db.dbsuggest.js":["232e",9],"./project/query/components/tab/service.auto.db.js":["d18d",9],"./project/query/components/tab/service.condition":["fad0",9],"./project/query/components/tab/service.condition.js":["fad0",9],"./project/query/components/tab/service.js":["69e1",9],"./project/query/components/tab/service.remove":["034e",9],"./project/query/components/tab/service.remove.js":["034e",9],"./project/query/components/tab/service.rightkey":["8c66",9],"./project/query/components/tab/service.rightkey.js":["8c66",9],"./project/query/components/tab/service.rightkey.keymap":["b982",9],"./project/query/components/tab/service.rightkey.keymap.js":["b982",9],"./project/query/components/table":["ff86",9],"./project/query/components/table/":["ff86",9],"./project/query/components/table/index":["ff86",9],"./project/query/components/table/index.vue":["ff86",9],"./project/query/components/tabs":["6c72",9],"./project/query/components/tabs.vue":["6c72",9],"./project/query/components/top":["f7a1",9],"./project/query/components/top/":["f7a1",9],"./project/query/components/top/dialog.apply":["4cca",9],"./project/query/components/top/dialog.apply.vue":["4cca",9],"./project/query/components/top/dialog.audit.log":["ccad",9],"./project/query/components/top/dialog.audit.log.vue":["ccad",9],"./project/query/components/top/dialog.exec":["4706",9],"./project/query/components/top/dialog.exec.vue":["4706",9],"./project/query/components/top/dialog.favorite":["d024",9],"./project/query/components/top/dialog.favorite.vue":["d024",9],"./project/query/components/top/dialog.new-work":["d0e2",9],"./project/query/components/top/dialog.new-work.vue":["d0e2",9],"./project/query/components/top/dialog.work":["4db0",9],"./project/query/components/top/dialog.work.vue":["4db0",9],"./project/query/components/top/dialog.workList":["435c",9],"./project/query/components/top/dialog.workList.vue":["435c",9],"./project/query/components/top/index":["f7a1",9],"./project/query/components/top/index.vue":["f7a1",9],"./project/query/components/top/monaco-lite":["cb68",9],"./project/query/components/top/monaco-lite/":["cb68",9],"./project/query/components/top/monaco-lite/index":["cb68",9],"./project/query/components/top/monaco-lite/index.vue":["cb68",9],"./project/query/components/top/select-database":["0c52",9],"./project/query/components/top/select-database/":["0c52",9],"./project/query/components/top/select-database/index":["0c52",9],"./project/query/components/top/select-database/index.vue":["0c52",9],"./project/query/components/top/tool":["a463",9],"./project/query/components/top/tool.db":["c8e5",9],"./project/query/components/top/tool.db.vue":["c8e5",9],"./project/query/components/top/tool.favorite":["9c01",9],"./project/query/components/top/tool.favorite.vue":["9c01",9],"./project/query/components/top/tool.history":["6fef",9],"./project/query/components/top/tool.history.vue":["6fef",9],"./project/query/components/top/tool.setting":["7638",9],"./project/query/components/top/tool.setting.vue":["7638",9],"./project/query/components/top/tool.vue":["a463",9],"./project/query/index":["8d5a",9],"./project/query/index.vue":["8d5a",9],"./project/query/new-work":["a9c4",9],"./project/query/new-work.vue":["a9c4",9],"./project/role":["3955",9],"./project/role.vue":["3955",9],"./project/temp-member":["ddbc",9],"./project/temp-member.vue":["ddbc",9],"./project/work":["bdf1",9],"./project/work.vue":["bdf1",9],"./system/error/404":["e29a",9],"./system/error/404/":["e29a",9],"./system/error/404/index":["e29a",9],"./system/error/404/index.vue":["e29a",9],"./system/function/redirect":["f271",9],"./system/function/redirect/":["f271",9],"./system/function/redirect/index":["f271",9],"./system/function/redirect/index.js":["f271",9],"./system/function/refresh":["0284",9],"./system/function/refresh/":["0284",9],"./system/function/refresh/index":["0284",9],"./system/function/refresh/index.js":["0284",9],"./system/index":["4398",9],"./system/index/":["4398",9],"./system/index/components/dialog.project.apply":["9583",9],"./system/index/components/dialog.project.apply.vue":["9583",9],"./system/index/components/monitor":["4865",9],"./system/index/components/monitor.vue":["4865",9],"./system/index/components/normal.page":["9a91",9],"./system/index/components/normal.page.vue":["9a91",9],"./system/index/components/system.page":["e18d",9],"./system/index/components/system.page.vue":["e18d",9],"./system/index/components/unknow.page":["4edf",9],"./system/index/components/unknow.page.vue":["4edf",9],"./system/index/index":["4398",9],"./system/index/index.vue":["4398",9],"./system/log":["b380",9],"./system/log/":["b380",9],"./system/log/index":["b380",9],"./system/log/index.vue":["b380",9],"./system/setting/font":["71a9",9],"./system/setting/font.vue":["71a9",9]};function n(t){return Promise.resolve().then((function(){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}var n=s[t],o=n[0];return a.t(o,n[1])}))}n.keys=function(){return Object.keys(s)},n.id="9dac",t.exports=n},"9e3a":function(t,e,a){"use strict";a("175d")},"9ea5":function(t,e,a){"use strict";a("1e1e")},"9ed6":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"loginPage",staticClass:"login-page"},[a("div",{staticClass:"main-box"},[a("div",{staticClass:"sidebox"},[a("div",{staticClass:"sidebox-content"},[a("div",{staticClass:"logo"},[a("img",{attrs:{src:t.ENV_DATA.LOGIN_LOGO}}),a("h2",[t._v(t._s(t.ENV_DATA.NAME))])]),a("h4",[t._v(t._s(t.ENV_DATA.INTRODUCTION))]),a("div",{staticClass:"section-description"},[a("div",{staticClass:"description"},[t._v(t._s(t.ENV_DATA.DESCRIPSTION))])]),a("div",{staticClass:"website"},[a("a",{attrs:{href:t.ENV_DATA.WEBSITE,target:"_blank"}},[t._v(t._s(t.ENV_DATA.COMPANY))])])])]),a("div",{staticClass:"login-container shadow"},[a("div",{staticClass:"body"},[t.isChrome?t._e():a("el-alert",{attrs:{title:"本产品标准运行环境为Chrome 48.0.2564 及以上版本，请使用Chrome浏览器进行访问，以便获得最佳体验。",type:"warning"}}),"normal"==t.mode||"ldap"==t.mode?a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formRules}},[a("el-form-item",{attrs:{label:"账号",prop:"name"}},[a("el-input",{attrs:{"auto-complete":"on",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"pwd"}},[a("el-input",{attrs:{type:"password",clearable:"","show-password":!0,"auto-complete":"new-password"},model:{value:t.formData.pwd,callback:function(e){t.$set(t.formData,"pwd",e)},expression:"formData.pwd"}})],1),a("el-form-item",{attrs:{label:"验证码",prop:"code"}},[a("el-input",{attrs:{clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSubmit.apply(null,arguments)}},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}})],1),a("el-form-item",[a("div",{staticClass:"identifybox"},[a("div",{on:{click:t.getCaptcha}},[a("img",{staticStyle:{width:"100px",height:"50px",border:"1px"},attrs:{src:t.formData.captcha}})]),a("el-button",{staticClass:"textbtn",attrs:{type:"text"},on:{click:t.getCaptcha}},[t._v("看不清，换一张")])],1)]),a("el-form-item",[a("button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"el-button el-button--primary btn-login",attrs:{type:"button"},on:{click:t.onSubmit}},[t._v("登录")])])],1):t._e(),a("div",{staticClass:"casSpan"},["cas"==t.mode?a("el-button",{staticStyle:{align:"center",width:"300px","margin-top":"140px"},attrs:{type:"primary"},on:{click:t.goCasLogin}},[t._v("点击cas登录")]):t._e()],1)],1)])])])},n=[],o=a("1da1"),i=a("5530"),r=(a("b0c0"),a("96cf"),a("2f62")),l=a("c276"),c={data:function(){var t=this.$route.query;return{loading:!1,ENV_DATA:{LOGIN_LOGO:"/image/logo-white.png",NAME:"SQLDEV",DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",INTRODUCTION:"企业数据安全治理工具",VERSION:"3.4.0",TITLE:"SQLDEV",COMPANY:"南京树安信息技术有限公司",WEBSITE:"http://www.shuaninfo.com/"},isChrome:!1,path:"",mode:"normal",back_url:t.url,url:"",formData:{name:"",pwd:"",captcha:"",captcha_id:"",code:""},formRules:{name:[{required:!0,message:"请输入账号"}],pwd:[{required:!0,message:"请输入密码"}],code:[{type:"string",len:4,message:"请输入4位验证码",required:!0}]}}},computed:Object(i["a"])({},Object(r["e"])(["user"])),methods:{getCaptcha:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.formData.code="",e.next=3,t.$api.get("/api/captcha");case 3:a=e.sent,s=a.id,n=a.img,t.formData.captcha=n,t.formData.captcha_id=s;case 8:case"end":return e.stop()}}),e)})))()},checkBrowser:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1;return e?"Opera":t.indexOf("Firefox")>-1?"FF":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!e?"IE":void 0},goCasLogin:function(){this.url&&(window.location.href=this.url)},onSubmit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,t.isValidate();case 4:return e.next=6,t.$api.post("/api/login",t.formData);case 6:return a=e.sent,s=a.token,n=a.user,t.$store.commit("user",n),l["a"].cookies.set("uuid","u7".concat(n.id,"81")),window.localStorage.setItem("name",t.formData.name),window.localStorage.setItem("token",s),t.$store.commit("setForceTfa",0),e.next=16,t.$store.dispatch("d2admin/account/load");case 16:n.must_tfa?(t.onError("管理员已强制开启二次验证，请设置！ 正在跳转(2秒)..."),setTimeout((function(){t.$router.push("/personal/security"),t.$store.commit("setForceTfa",1),t.loading=!1,t.showLoginMessage(n)}),2e3)):2===n.account_level?(t.$bus.emit("tfa-show","emit"),t.$bus.off("tfa-emit"),t.$bus.on("tfa-emit",(function(){t.loginSuccessHandler(s,n)&&t.showLoginMessage(n)})),t.loading=!1):(t.loginSuccessHandler(s,n)&&t.showLoginMessage(n),t.loading=!1),e.next=23;break;case 19:e.prev=19,e.t0=e["catch"](1),t.loading=!1,t.getCaptcha();case 23:case"end":return e.stop()}}),e,null,[[1,19]])})))()},showLoginMessage:function(t){},loginSuccessHandler:function(t,e){var a=this;if(this.$store.commit("setForcePwd",0),e.pw_score<2)return this.onError("你的密码过于简单，登录后请修改密码！正在跳转(2秒)..."),setTimeout((function(){a.$store.commit("setForcePwd",1),a.$router.push("/personal/password")}),1500),!1;if(this.$route.query.url){var s=Object(i["a"])({},this.$route.query);return delete s.url,this.$router.push({path:this.$route.query.url,query:s}),!0}return this.$router.push("/"),!0}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$loading().close(),"Chrome"===t.checkBrowser()&&(t.isChrome=!0),t.getCaptcha(),e.next=5,t.$api.post("/api/setting",{});case 5:a=e.sent,s=a.login_mode,n=a.url,t.$store.commit("sysSetting",a),t.mode=s,e.t0=s,e.next="cas"===e.t0?12:"ldap"===e.t0?14:"normal"===e.t0?15:17;break;case 12:return t.url=n,e.abrupt("break",17);case 14:return e.abrupt("break",17);case 15:return t.formData.name=window.localStorage.getItem("name")||"",e.abrupt("break",17);case 17:case"end":return e.stop()}}),e)})))()}},u=c,d=(a("f6be"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,"362f5dee",null);e["default"]=p.exports},"9ef2":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isShow?a("el-dialog",{attrs:{title:"["+t.project.name+"]项目公告",visible:t.isShow,width:"800px",height:"600px","before-close":t.hide,"append-to-body":"",center:""},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticClass:"lin-wrap"},[a("tinymce",{attrs:{defaultContent:t.text,upload_url:"http://dev.lin.colorful3.com/cms/file/"},on:{change:t.change}})],1)]):t._e()},n=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("editor",{key:t.tinymceFlag,attrs:{id:"tinymceEditor",init:t.tinymceInit},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)},i=[],r=a("1da1"),l=(a("96cf"),a("a9e3"),a("e562"),a("ca72")),c=(a("0d68"),a("566b"),a("ec27"),{name:"TinymceEditor",props:{defaultContent:{type:String,default:""},height:{type:Number,default:500},width:{type:Number,default:void 0},upload_url:{type:String,default:""},showMenubar:{type:Boolean,default:!0},toolbar:{type:String,default:" undo redo\n      | formatselect\n      | bold italic strikethrough forecolor backcolor formatpainter\n      | link image | alignleft aligncenter alignright alignjustify\n      | numlist bullist outdent indent\n      | removeformat\n      | preview fullscreen code"},baseUrl:{type:String,default:""}},components:{Editor:l["a"]},data:function(){return{tinymceFlag:1,tinymceInit:{},content:""}},created:function(){var t=this;this.tinymceInit={language_url:"/static/js/tinymce/langs/zh_CN.js",skin_url:"/static/js/tinymce/skins/ui/oxide",content_css:"/static/js/tinymce/skins/content/default/content.css",language:"zh_CN",selector:"textarea",height:this.height,width:void 0,browser_spellcheck:!0,branding:!1,elementpath:!1,statusbar:!1,paste_data_images:!0,menubar:this.showMenubar,plugins:"print fullpage searchreplace autolink directionality visualblocks\n        visualchars template codesample charmap hr pagebreak nonbreaking anchor toc insertdatetime\n        wordcount textpattern help advlist table lists paste preview fullscreen image imagetools code link",toolbar:this.toolbar,images_upload_handler:function(e,a,s){return Object(r["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=new File([e.blob()],e.filename(),{type:"image/*"}),t.$api.project.upload(o).then((function(t){t[0]&&t[0].url&&a(t[0].url)})).catch((function(t){return s(t)}));case 2:case"end":return n.stop()}}),n)})))()}}},mounted:function(){this.defaultContent&&(this.content=this.defaultContent)},watch:{content:{handler:function(){this.$emit("change",this.content)}},defaultContent:{handler:function(){this.content=this.defaultContent},immediate:!0}},activated:function(){this.tinymceFlag++}}),u=c,d=a("2877"),p=Object(d["a"])(u,o,i,!1,null,null,null),f=p.exports,m={data:function(){return{id:"",is_admin:!1,isShow:!1,text:"",project:{name:"",post:""}}},computed:{},props:{},watch:{},methods:{change:function(t){console.log(t),this.project.post=t},show:function(t){this.project=t,this.init(),this.text=t.post,this.isShow=!0},hide:function(){this.list=[],this.isShow=!1,this.$api.project.post(this.project),this.$emit("refresh"),console.log("hide.......")},reset:function(){return{state:0,roles:[],roles_str:""}},init:function(){}},components:{Tinymce:f},mounted:function(){}},h=m,b=(a("64da"),Object(d["a"])(h,s,n,!1,null,null,null));e["default"]=b.exports},"9f6e":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"before-close":t.hide,"append-to-body":"","custom-class":"database-edit",title:t.id?"编辑角色":"新建角色",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"所属项目"}},[a("h3",[t._v(t._s(t.p.name))])]),a("el-form-item",{attrs:{label:"角色名"}},[a("el-tooltip",{attrs:{placement:"top",content:"角色名称，项目内不可重复"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),a("el-form-item",{attrs:{label:"说明"}},[a("el-tooltip",{attrs:{placement:"top",content:"角色说明"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.info,callback:function(e){t.$set(t.formData,"info",e)},expression:"formData.info"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("k-btn-tip",{directives:[{name:"show",rawName:"v-show",value:t.formData.id,expression:"formData.id"}],attrs:{tip:"确定要删除该项目角色【"+t.formData.name+"】?"},on:{click:function(e){return t.onRemove(t.formData.id)}}},[a("el-button",{attrs:{type:"danger"}},[t._v("删除")])],1),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("2ef0")),r=a("2f62"),l={data:function(){return{id:"",isShow:!1,formData:this.reset(),p:{}}},props:{},watch:{},computed:Object(o["a"])({},Object(r["e"])(["user"])),methods:{reset:function(){return{id:"",name:"",info:"",role_type:1}},show:function(t){this.formData=this.reset(),t.r&&t.r.id&&(this.id=t.r.id,this.formData=t.r),t.p&&t.p.id&&(this.p=t.p,this.formData.project=t.p.id),this.isShow=!0},hide:function(t){this.formData=this.reset(),this.id="",this.isShow=!1},onRemove:function(t){var e=this;this.$api.role.remove(t).then((function(t){e.onSuccess("删除成功"),e.hide(),e.$emit("refresh")}))},onSubmit:function(){var t=this,e=Object(i["cloneDeep"])(this.formData);if(!e.name)return this.$message({message:"角色名称不能为空",type:"warning"}),!1;this.$api.role.save(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}))}},mounted:function(){},components:{}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},"9fae":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"提交工单",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"工单SQL",prop:"sql"}}),a("el-form-item",{attrs:{label:"工单名称",prop:"name"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"申请说明",prop:"name"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1),a("el-form-item",{attrs:{label:"数据源",prop:"db_id"}},[a("el-input",{attrs:{type:"input",placeholder:""},model:{value:t.formData.db_id,callback:function(e){t.$set(t.formData,"db_id",e)},expression:"formData.db_id"}})],1),a("el-form-item",{attrs:{label:"数据库",prop:"owner"}},[a("el-input",{attrs:{type:"input",placeholder:""},model:{value:t.formData.owner,callback:function(e){t.$set(t.formData,"owner",e)},expression:"formData.owner"}})],1),a("el-form-item",{attrs:{label:"执行脚本",prop:"sql"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入执行的脚本"},model:{value:t.formData.sql,callback:function(e){t.$set(t.formData,"sql",e)},expression:"formData.sql"}})],1),a("el-form-item",{attrs:{label:"审批人",prop:"audit_id"}},[a("k-select",{attrs:{url:"/api/apply/manager/list"},model:{value:t.formData.audit_id,callback:function(e){t.$set(t.formData,"audit_id",e)},expression:"formData.audit_id"}})],1),a("el-form-item",{attrs:{label:"抄送",prop:"copy_to"}},[a("k-select",{attrs:{url:"/api/apply/manager/list",multiple:!0},model:{value:t.formData.copy_to,callback:function(e){t.$set(t.formData,"copy_to",e)},expression:"formData.copy_to"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success",disabled:t.disabled},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{disabled:!1,role:{},isShow:!1,config:{lang:"sql"},formData:{source_type:"none",source_id:"none",sql:""},formRule:{mark:[{required:!1,message:"请输入描述"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},props:{},watch:{},computed:{},methods:{show:function(){this.isShow=!0},hide:function(t){this.isShow=!1},editorInit:function(){a("2099"),a("8882"),a("8ef6"),a("1d29")},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.disabled=!0;var a=t.formData;t.$api.work.add(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh"),t.disabled=!1}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a),t.disabled=!1}))}}))}},mounted:function(){}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},"9fcf":function(t,e,a){},a016:function(t,e,a){"use strict";a("460c")},a06c:function(t,e,a){"use strict";a("47e1")},a092:function(t,e,a){},a16d:function(t,e,a){"use strict";a("5f51")},a17b:function(t,e,a){"use strict";a("12a3")},a18c:function(t,e,a){"use strict";var s=a("1da1"),n=(a("96cf"),a("ac1f"),a("2b0e")),o=a("8c4f"),i=a("2ef0"),r=a("323e"),l=a.n(r),c=(a("a5d8"),a("4360")),u=a("c276"),d=a("d046"),p=o["a"].prototype.push;o["a"].prototype.push=function(t){return p.call(this,t).catch((function(t){return t}))};var f=o["a"].prototype.replace;o["a"].prototype.replace=function(t){return f.call(this,t).catch((function(t){return t}))},n["default"].use(o["a"]);var m=new o["a"]({routes:d["a"]}),h="/personal/password",b="/personal/security";m.beforeEach(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e,a,s){var n,o,r,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c["a"].commit("timer/clearTimeoutPath",a.path),t.next=3,c["a"].dispatch("d2admin/page/isLoaded");case 3:return t.next=5,c["a"].dispatch("d2admin/size/isLoaded");case 5:l.a.start(),c["a"].commit("d2admin/search/set",!1),e.matched.some((function(t){return t.meta.auth}))?(n=c["a"].state.forcePwd,o=c["a"].state.forceTfa,r=window.localStorage.getItem("token"),r&&"undefined"!==r?n&&e.path!==h?(s(h),l.a.done()):o&&e.path!==b?(s(b),l.a.done()):(s(),l.a.done()):(s({name:"login",query:{redirect:e.fullPath}}),l.a.done())):(u=Object(i["get"])(c["a"],"state.sysSetting.reg"),!0===u&&"/reg-license"===e.path&&s({path:"/"}),s(),l.a.done());case 8:case"end":return t.stop()}}),t)})));return function(e,a,s){return t.apply(this,arguments)}}()),m.afterEach((function(t){l.a.done(),c["a"].dispatch("d2admin/page/open",t),u["a"].title(t.meta.title)})),e["a"]=m},a1fe:function(t,e,a){},a299:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.doc.name+"("+t.doc.user_name+")【权限预览】",visible:t.isShow,width:"800px",center:""},on:{"update:visible":function(e){t.isShow=e}}},[a("span",{staticStyle:{padding:"20px"}},[t._v(" 权限组:"),t._l(t.role_names,(function(e){return a("el-tag",{key:e,staticStyle:{margin:"5px"},attrs:{type:"success"}},[t._v(t._s(e))])}))],2),a("div",{staticStyle:{padding:"20px"}},[t._v(" 图标: "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v(" 异步查询 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("异步导出/导出文件 "),a("i",{staticClass:"sn-font text-success"},[t._v("")]),t._v("导出Sql ")]),a("el-tree",{ref:"tree2",attrs:{data:t.list,"node-key":"id",props:t.defaultProps,indent:26,isLeaf:function(t){return"col"==t.node_type},"highlight-current":"",lazy:"","default-expanded-keys":t.expKeys,load:t.onNextLoad},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",["db"==n.node_type?a("span",[t._v("["+t._s(n.db_type)+"]"+t._s(s.label)+" ")]):"owner"==n.node_type?a("span",[t._v("[实例]"+t._s(s.label)+" ")]):"table"==n.node_type?a("span",[t._v("[表]"+t._s(s.label)+" ")]):a("span",[t._v("[字段]"+t._s(s.label))]),1==n.rw?a("i",{staticClass:"sn-font text-success"},[t._v("读")]):t._e(),2==n.rw?a("i",{staticClass:"sn-font text-primary"},[t._v("写")]):t._e(),3==n.rw&&"col"!=n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("禁")]):t._e(),"col"!=n.node_type?a("span",[1==n.asyn_query?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_export?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e(),1==n.asyn_sql?a("i",{staticClass:"sn-font text-success"},[t._v("")]):t._e()]):t._e(),3==n.rw&&"col"==n.node_type?a("i",{staticClass:"sn-font text-error"},[t._v("敏")]):t._e()])])}}])})],1)],1)},n=[],o=a("5530"),i=(a("b0c0"),a("2f62")),r=(a("5c96"),{data:function(){return{defaultProps:{children:"children",label:"name"},role_names:[],isShow:!1,doc:{},list:[],expKeys:[]}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{reset:function(){return{state:0,roles:[],roles_str:""}},onNextLoad:function(t,e){var a=t.data;a&&a.length>0&&e(a),a&&"col"==a.node_type&&e([]),a&&a.children?e(a.children):a&&a.id&&a.name?(a.uid=this.doc.id,this.$api.user.permissionChildren(a).then((function(t){t?(a.children=t,e(t)):e([])}))):e([])},show:function(t){var e=this;this.$api.user.info(t.id).then((function(t){e.doc=t,e.role_names=t.role_names})),this.$api.user.permissionAll(t.id).then((function(t){if(e.isShow=!0,e.list=t,t&&t.length)for(var a=0;a<t.length;a++)e.expKeys.push(t[a].id)}))},hide:function(t){this.isShow=!1}},mounted:function(){},components:{}}),l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},a31e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sql-query-card-async"},[a("div",{staticClass:"inputs"},[a("el-input",{attrs:{size:"mini",placeholder:"筛选导出及异步"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),a("span",{staticClass:"update-time"},[t._v("更新于："+t._s(t.updateTime))])],1),a("div",{staticClass:"overflow"},[t.dataList&&t.dataList.length>0?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],staticClass:"list-items",style:{height:t.height}},t._l(t.filterDataList,(function(e){return a("div",{key:e.id,staticClass:"item",class:{"text-primary":0==e.state,"text-success":1==e.state,"text-error":2==e.state}},[a("div",{staticClass:"hbox-between"},[a("div",{staticClass:"name pointer",attrs:{title:1==e.type?"查看SQL语句、查询异步结果，并显示":"查看SQL语句"},on:{click:function(a){return t.onRun(e)}}},[a("span",[t._v(t._s(t.showFileName(e)))]),0==e.state?a("span",[t._v(" [查询中]")]):t._e(),1==e.state?a("span",[t._v(" [完成]")]):t._e(),2==e.state?a("span",[a("el-tooltip",{attrs:{content:e.result,placement:"bottom"}},[a("span",{staticClass:"name-error"},[t._v(" [失败]")])])],1):t._e()]),a("div"),a("div",{staticClass:"images hbox hbox-center no-user-select"},[1==e.state&&e.data_count>0?a("i",{staticClass:"sn-font pointer click-active",attrs:{title:"下载文件"},on:{click:function(a){return a.stopPropagation(),t.onDownload(e)}}},[t._v("")]):t._e(),a("k-btn-tip",{on:{click:function(a){return t.onDelete(e)}}},[a("i",{staticClass:"pointer sn-font text-error click-active",attrs:{title:"删除"}},[t._v("")])])],1)]),a("div",{staticClass:"time hbox-between"},[a("span",[t._v(t._s(t._f("dateTime")(e.start_time,"MM/DD HH:mm")))]),a("span",[t._v("共"+t._s(e.data_count)+"条/耗时 "+t._s(t.showExecTime(e.exec_time)))])])])})),0):a("div",{staticClass:"empty-body"},[a("span",[t._v("空数据")])])])])},n=[],o=a("5530"),i=(a("4de4"),a("a9e3"),a("ac1f"),a("1276"),a("d3b7"),a("3ca3"),a("ddb0"),a("2ef0")),r=a("2f62"),l=a("e31c"),c=a("c1df"),u=a.n(c),d={data:function(){return{isLoading:!1,dataList:[],filter:"",updateTime:""}},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(r["e"])(["selecedDB","runner","service","runList","runActive"])),Object(r["c"])(["run","context"])),{},{filterDataList:function(){var t=this,e=Object(i["filter"])(this.dataList,(function(e){return-1!=e.mark.indexOf(t.filter)}));return e},db:function(){return this.service&&this.service.data?{id:this.service.data.id}:{}},owner:function(){return this.service&&this.service.data?{id:this.service.data.owner}:{}}}),props:{height:{default:"150px"},title:{},type:{},index:{type:Number,default:function(){return 0}},hasAsynExport:{type:Boolean,default:function(){return!1}},hasAsynQuery:{type:Boolean,default:function(){return!1}},hasAsynSql:{type:Boolean,default:function(){return!1}},runTabId:{}},watch:{},methods:{showExecTime:function(t){if(!t)return"0毫秒";if(t<1e3)return t+"毫秒";var e=Math.floor(t/1e3/3600%24),a=Math.floor(t/1e3/60%60),s=Math.floor(t/1e3%60),n=s+"秒";return a>0&&(n=a+"分"+n),e>0&&(n=e+"小时"+n),n},canDownloads:function(t){var e=1==t.state&&t.data_count>0;return 1==t.type||2==t.type?e&&this.hasAsynExport:e&&this.hasAsynSql},showFileName:function(t){var e="";if(t.file_name){var a=t.file_name.split(".");a.length>1&&(e="."+a[1])}var s="";return s=1==t.type?"[异步] ":3==t.type?"[SQL] ":"[导出] ",s+t.mark+e},onRun:function(t){var e=this;this.$store.commit("resultJumpLoading",!0),this.service.clean();var a={hasAsynQuery:this.hasAsynExport,hasAsynExport:this.hasAsynExport,index:this.runList[this.runActive].index,id:t.db_id,db_id:t.db_id,name:t.mark,db_type:t.db_type,dbType:t.db_type,script:t.script,async:t.id,owner:t.owner},s=1==t.type?11:3==t.type?13:-1;console.log("item: ",t);var n={mode:"查询-异步",sql:a.script,id:t.id,name:t.mark,comment:!0,command:s,dbName:a.owner};this.selecedDB&&this.selecedDB.instance&&(n.dbName=this.selecedDB.instance.label,n.dbType=this.selecedDB.instance.db_type,n.rw=this.selecedDB.instance.rw),this.selecedDB&&this.selecedDB.source&&(n.sourceName=this.selecedDB.source.label),a.script=l["a"].generate(n);var o=l["a"].parserComments(a.script);if(console.log("[card.async methods] onRun: ",a,t),this.service.setData(a,!0),1==t.type){var i=this.service.onRunAsyncData(null,null,{mode:o});Promise.all([i]).then((function(t){console.log("[coard.async methods] onRun - 1：",e.runTabId),e.$bus.emit("index-result-change-tab_".concat(e.runTabId),"result")})).catch((function(){e.$store.commit("resultJumpLoading",!1)}))}else this.$store.commit("resultJumpLoading",!1)},onAsync:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(console.log("[card.async.vue]#onAsync 获取导出及异步列表: ",this.run),!this.run&&!e)return!1;var a=this.run||e;this.isLoading=!0,clearTimeout(this.timeId),this.$api.task.asyncList(a.id,a.dbType,a.owner).then((function(e){var s=e.dataList,n=e.isComplete;t.dataList=s,n?clearTimeout(t.timeId):t.timeId=setTimeout((function(){t.onAsync(a)}),5e3)})).finally((function(){t.isLoading=!1,t.updateTime=u()(new Date).format("MM-DD HH:mm:ss")}))},onChangeDB:function(){var t=this,e=this.runList.filter((function(e){return t.runTabId==e.tabId})),a=e[0];console.log("[card.async.vue]#onChangeDB",this.runTabId,a),this.onAsync(a)},onDownload:function(t){var e=window.localStorage.getItem("token");1==t.type?this.$api.download("/api/sql/task/async/downloads",{id:t.id,access_token:e}):2!=t.type&&3!=t.type||this.$api.download("/api/sql/task/export/downloads",{id:t.id,access_token:e})},onDelete:function(t){var e=this;this.$api.task.asyncRemove(t).then((function(){e.onSuccess("删除成功"),e.onChangeDB()}))}},created:function(){var t=this;this.$bus.on("on-selectdb-".concat(this.runTabId),(function(e){t.onChangeDB()}))},mounted:function(){this.onChangeDB(),this.$bus.on("runExport",this.onAsync)},beforeDestroy:function(){this.$bus.off("runExport")}},p=d,f=(a("a729"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},a38f:function(t,e,a){},a3ee:function(t,e,a){"use strict";a("f331")},a414:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tooltip",{attrs:{content:t.text}},[a("el-button",{staticClass:"sql-query-tool",attrs:{size:"mini",type:t.type,disabled:t.disabled},on:{click:function(e){return t.$emit("click")}}},[a("div",{staticClass:"hbox-center"},[a("i",{staticClass:"sn-font",domProps:{innerHTML:t._s(t.icon)}})])])],1)},n=[],o={data:function(){return{}},computed:{},props:{text:{},icon:{},type:{default:"text"},disabled:{}},watch:{},methods:{},components:{},mounted:function(){}},i=o,r=(a("355c"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},a41f:function(t,e,a){"use strict";a("52dd")},a463:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tooltip",{attrs:{content:t.text}},[a("el-button",{class:[t.disabled?"disabled-item":"query-tool-item"],attrs:{size:"mini",type:t.type},on:{click:t.onClick}},["iconfont"==t.iconType?a("i",{staticClass:"sn-font",domProps:{innerHTML:t._s(t.icon)}}):"elementui"==t.iconType?a("i",{staticClass:"sn-font sn-font-elementui",class:t.icon}):t._e()])],1)},n=[],o={data:function(){return{}},computed:{},props:{text:{},icon:{},iconType:{default:"iconfont"},type:{default:"text"},disabled:{},event:{}},watch:{},methods:{onClick:function(){if(this.disabled)return!1;this.event?this.$bus.emit(this.event):this.$emit("click")}},components:{},mounted:function(){}},i=o,r=(a("fcbd"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"5fb0eec1",null);e["default"]=l.exports},a4a1:function(t,e,a){"use strict";a("25a0")},a619:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-alarm",use:"d2-alarm-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-alarm"><path d="M512 896c-223.5 0-405.3-181.8-405.3-405.3S288.5 85.3 512 85.3s405.3 181.8 405.3 405.3S735.5 896 512 896z m0-725.3c-176.4 0-320 143.5-320 320s143.6 320 320 320 320-143.5 320-320-143.6-320-320-320z" fill="#3688FF" /><path d="M922.6 249.6c-13.7 0-27.1-6.6-35.4-18.8-15.3-22.6-32.8-43.9-52.1-63.2-19.3-19.3-40.6-36.9-63.2-52.1-19.5-13.2-24.6-39.7-11.5-59.2 13.2-19.5 39.7-24.6 59.2-11.5 27.1 18.3 52.6 39.4 75.7 62.5s44.2 48.6 62.5 75.7c13.2 19.5 8.1 46.1-11.5 59.2-7.2 5-15.5 7.4-23.7 7.4zM101.4 249.6c-8.2 0-16.5-2.4-23.8-7.3-19.5-13.2-24.7-39.7-11.5-59.2 18.3-27.1 39.4-52.6 62.5-75.7s48.6-44.1 75.7-62.5c19.5-13.2 46.1-8 59.3 11.5 13.2 19.5 8.1 46-11.5 59.2-22.6 15.3-43.9 32.8-63.2 52.1-19.3 19.3-36.8 40.5-52.1 63.2-8.2 12.1-21.7 18.7-35.4 18.7zM138.6 970.7c-8.6 0-17.3-2.6-24.8-7.9-19.2-13.7-23.6-40.4-9.9-59.5l53.3-74.7c13.7-19.2 40.3-23.6 59.5-9.9 19.2 13.7 23.6 40.4 9.9 59.5l-53.3 74.7c-8.2 11.6-21.4 17.8-34.7 17.8zM885.4 970.7c-13.3 0-26.4-6.2-34.8-17.9l-53.3-74.7c-13.7-19.2-9.3-45.8 9.9-59.5 19.2-13.7 45.8-9.2 59.5 9.9l53.3 74.7c13.7 19.2 9.3 45.8-9.9 59.5-7.5 5.4-16.2 8-24.7 8zM512 554.7c-7.2 0-14.5-1.8-21-5.5-13.4-7.6-21.6-21.8-21.6-37.1V384c0-23.6 19.1-42.7 42.7-42.7s42.7 19.1 42.7 42.7v52.6l42.1-25.2c20.2-12.1 46.4-5.6 58.5 14.6 12.1 20.2 5.6 46.4-14.6 58.5l-106.7 64c-6.9 4.1-14.5 6.2-22.1 6.2z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},a694:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-popover",{ref:"popover1",attrs:{placement:"top"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("div",{staticClass:"tip"},[t._v(t._s(t.tip))]),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.clickHandler(!1)}}},[t._v(t._s(t.cancelText))]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.clickHandler(!0)}}},[t._v(t._s(t.confirmText))])],1)]),a("span",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}]},[t._t("default")],2)],1)},n=[],o={data:function(){return{visible:!1}},props:{tip:{},cancelText:{type:String,default:function(){return"取消"}},confirmText:{type:String,default:function(){return"确定"}}},methods:{clickHandler:function(t){this.visible=!1,this.$emit("submit",t)}}},i=o,r=(a("3345"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},a704:function(t,e,a){},a704c:function(t,e,a){"use strict";a("82ba")},a707:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-mysql-key-cache"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/mysql/status","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:60},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"innodb_buffer_pool"}},[a("el-table-column",{attrs:{label:"instances",prop:"innodb_buffer_pool_instances"}}),a("el-table-column",{attrs:{label:"size",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("kb")(e.row.innodb_buffer_pool_size,"m")))]}}])})],1),a("el-table-column",{attrs:{label:"pages"}},[a("el-table-column",{attrs:{label:"total",prop:"innodb_buffer_pool_pages_total"}}),a("el-table-column",{attrs:{label:"data",prop:"innodb_buffer_pool_pages_data"}}),a("el-table-column",{attrs:{label:"dirty",prop:"innodb_buffer_pool_pages_dirty"}}),a("el-table-column",{attrs:{label:"flushed",prop:"innodb_buffer_pool_pages_flushed"}}),a("el-table-column",{attrs:{label:"free",prop:"innodb_buffer_pool_pages_free"}})],1),a("el-table-column",{attrs:{label:"io"}},[a("el-table-column",{attrs:{label:"capacity",prop:"innodb_io_capacity"}}),a("el-table-column",{attrs:{label:"read_thread",prop:"innodb_read_io_threads"}}),a("el-table-column",{attrs:{label:"write_thread",prop:"innodb_write_io_threads"}})],1),a("el-table-column",{attrs:{label:"innodb_rows"}},[a("el-table-column",{attrs:{label:"read",prop:"innodb_rows_read_persecond"}}),a("el-table-column",{attrs:{label:"insert",prop:"innodb_rows_inserted_persecond"}}),a("el-table-column",{attrs:{label:"update",prop:"innodb_rows_updated_persecond"}}),a("el-table-column",{attrs:{label:"delete",prop:"innodb_rows_deleted_persecond"}})],1)],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{}}},computed:{},props:{},watch:{},methods:{onData:function(t){t&&t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("3206"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},a729:function(t,e,a){"use strict";a("6736")},a72a:function(t,e,a){"use strict";a("5d45")},a766:function(t,e,a){"use strict";a("bd88")},a780:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-datasource",use:"d2-datasource-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-datasource"><path d="M941.5 196c0-29.428-59.372-153.2-434.4-153.2s-426.8 131.2-426.8 161.34C80.288-21.092 80 844 80 844s72.76 135.352 426.768 135.352S940 848 940 848s1.5-727.6 1.5-652zM892 196c0 57.692-181.2 120-384 120S128 259.728 128 200s239.868-112.8 380.208-113.708C678.88 85.2 892 138.308 892 196zM128 832l-0.504-137.144s77.024 88 380.064 88 385.44-88 385.44-88L892 832s-48.428 98.312-387.92 98.312S128 832 128 832z m764-404s-68.548 100-384 100-380-100-380-100V284s151.2 80 380 80 384-76 384-76v140zM128 492s100.988 84 380.596 84S892 492 892 492v132s-82.62 112-383.096 112S128 632 128 632v-140z" p-id="7714" /></symbol>'});i.a.add(r);e["default"]=r},a7b5:function(t,e,a){"use strict";a("bfc9")},a7f1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page-system apps",attrs:{type:"ghost"}},[a("el-row",{staticStyle:{"margin-left":"-6px","margin-right":"-6px"},attrs:{type:"flex"}},[a("div",{staticClass:"el-col el-col-8 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-info"},[t._v("CPU ")]),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text"},[a("div",{staticClass:"item"},[a("span",[t._v("CPU使用:")]),a("div",{staticClass:"bar"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":28,percentage:t.round(t.cpu_percent),color:"rgba(142, 113, 199, 0.7)"}})],1)]),a("div",{staticClass:"item"},[a("span",[t._v("CPU:")]),a("div",{staticClass:"bar"},[a("span",{staticStyle:{"font-size":"8px"}},[t._v(t._s(t.cpu.modelName))])])]),a("div",{staticClass:"item"},[a("span",[t._v("核心数:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.cpu.cores)+" ")])]),a("div",{staticClass:"item"})])])],1),a("div",{staticClass:"el-col el-col-8 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-warning"},[t._v("内存 ")]),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text"},[a("div",{staticClass:"item"},[a("span",[t._v("内存使用:")]),a("div",{staticClass:"bar"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":28,percentage:t.round(t.mem.usedPercent),color:"rgba(142, 113, 199, 0.7)"}})],1)]),a("div",{staticClass:"item"},[a("span",[t._v("内存大小:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.mem.total/1024/1024/1024)+" GB")+" ")])]),a("div",{staticClass:"item"},[a("span",[t._v("已使用内存:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.mem.used/1024/1024/1024)+" GB")+" ")])]),a("div",{staticClass:"item"},[a("span",[t._v("可用内存:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.mem.available/1024/1024/1024)+" GB")+" ")])])])])],1),a("div",{staticClass:"el-col el-col-8 el-col-xs-12",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("div",{staticClass:"demo-color-box bg-blue"},[t._v("磁盘 ")]),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"text"},[a("div",{staticClass:"item"},[a("span",[t._v("磁盘使用:")]),a("div",{staticClass:"bar"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":28,percentage:t.round(t.disk.usedPercent),color:"rgba(142, 113, 199, 0.7)"}})],1)]),a("div",{staticClass:"item"},[a("span",[t._v("磁盘大小:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.disk.total/1024/1024/1024)+" GB")+" ")])]),a("div",{staticClass:"item"},[a("span",[t._v("已使用磁盘:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.disk.used/1024/1024/1024)+" GB")+" ")])]),a("div",{staticClass:"item"},[a("span",[t._v("可用磁盘空间:")]),a("div",{staticClass:"bar"},[t._v(" "+t._s(t.round(t.disk.free/1024/1024/1024)+" GB")+" ")])])])])],1)]),a("el-row",{staticStyle:{"margin-left":"-6px","margin-right":"-6px"},attrs:{type:"flex"}},[a("el-col",{staticClass:"el-col el-col-24 el-col-xs-24",staticStyle:{"padding-left":"6px","padding-right":"6px"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("网络IO")])]),a("div",[a("el-table",{attrs:{sortable:"true",sortBy:"bytesSent",data:t.io_data,size:"small"}},[a("el-table-column",{attrs:{prop:"name",label:"网卡名称"}}),a("el-table-column",{attrs:{prop:"bytesSent",label:"发送字节",formatter:t.dataFormat}}),a("el-table-column",{attrs:{prop:"bytesRecv",label:"接受字节",formatter:t.dataFormat}}),a("el-table-column",{attrs:{prop:"packetsSent",label:"发送数据包",formatter:t.dataFormat}}),a("el-table-column",{attrs:{prop:"packetsRecv",label:"接受数据包",formatter:t.dataFormat}})],1)],1)])],1)],1)],1)},n=[],o=a("2e0b"),i=a("1f82"),r={data:function(){return{h1:null,h2:null,n3:null,h4:null,mem:{usedPercent:0},cpu:{},cpu_percent:0,disk:{usedPercent:0},io_data:[],net_data:[],network:{},query:{start:"",end:"",start2:"",end2:""},stat:{db_count:0,app_count:0,user_count:0,today_count:0},dbTypeStat:{columns:["类型","数量"],rows:[]},dbTypeTitle:{text:"数据源类型"},typeTitle:{text:"当日执行类型统计",default:10},logTimeTitle:{text:"一周访问量"},logStat:{columns:["类型","数量"],rows:[]},logTitle:{text:"当日失败率统计"},logTimeStat:{columns:["时间","访问量"],rows:[]},dbStat:{columns:["数据源","访问量"],rows:[]},dbTitle:{text:"当日数据库使用量"},dbStatSettings:{dataOrder:{label:"访问量",order:"desc"}},exportStat:{columns:["应用","访问量"],rows:[]},appTitle:{text:"当日数据导出量"},userStat:{columns:["用户名","访问量"],rows:[]},typeStat:{columns:["操作","数量"],rows:[]},userTitle:{text:"当日用户访问量"},appStatSettings:{dataOrder:{label:"访问量",order:"desc"}},pubSetting1:{height:"350px",width:"100%"},pubSetting:{height:"400px",width:"100%"},chartData1:{columns:["数据源","次数"],rows:[{"次数":1393,"数据源":"查询库"},{"次数":3530,"数据源":"用户中心"},{"次数":2923,"数据源":"订单库"},{"次数":1723,"数据源":"淘宝api"},{"次数":3792,"数据源":"日志"},{"次数":4593,"数据源":"eslog"}]},chartData:{columns:["日期","访问用户","下单用户","下单率"],rows:[{"日期":"1/1","访问用户":1393,"下单用户":1093,"下单率":.32},{"日期":"1/2","访问用户":3530,"下单用户":3230,"下单率":.26},{"日期":"1/3","访问用户":2923,"下单用户":2623,"下单率":.76},{"日期":"1/4","访问用户":1723,"下单用户":1423,"下单率":.49},{"日期":"1/5","访问用户":3792,"下单用户":3492,"下单率":.323},{"日期":"1/6","访问用户":4593,"下单用户":4293,"下单率":.78}]}}},methods:{stopTimer:function(){console.log("this.h1: ",this.h1),clearTimeout(this.h1),clearTimeout(this.h2),clearTimeout(this.h3),clearTimeout(this.h4)},dataFormat:function(t,e){var a=t[e.property];return a&&a>1024?this.round(a/1024)+" KB":a},do_cpu_stat:function(){var t=this;this.$api.post("/api/system/stat",{type:"cpu"}).then((function(e){e.info.length>0&&(t.cpu=e.info[0])}))},do_cpu_percent:function(){var t=this;clearTimeout(this.h1),this.$api.post("/api/system/stat",{type:"cpu_percent"}).then((function(e){t.cpu_percent=e,t.h1=setTimeout((function(){t.do_cpu_percent()}),1e3)}))},do_mem_stat:function(){var t=this;clearTimeout(this.h2),this.$api.post("/api/system/stat",{type:"mem"}).then((function(e){t.mem=e,t.h2=setTimeout((function(){t.do_mem_stat()}),3e3)}))},do_disk_stat:function(){var t=this;clearTimeout(this.h3),this.$api.post("/api/system/stat",{type:"disk"}).then((function(e){t.disk=e,t.h3=setTimeout((function(){t.do_disk_stat()}),6e4)}))},do_network_stat:function(){var t=this;clearTimeout(this.h4),this.$api.post("/api/system/stat",{type:"network"}).then((function(e){t.io_data=e.io,t.net_data=e.con,t.h4=setTimeout((function(){t.do_network_stat()}),2e3)}))},round:function(t){return Math.round(100*t)/100},init:function(){this.do_cpu_stat(),this.do_cpu_percent(),this.do_mem_stat(),this.do_disk_stat(),this.do_network_stat()}},components:{ElCol:i["a"],ElRow:o["a"]},mounted:function(){var t=this;this.$nextTick((function(){t.init()}))},beforeDestroy:function(){window.$log.dev("[system/index beforeDestroy] 销毁监控定时器"),this.stopTimer(),setTimeout((function(){window.$log.dev("[system/index beforeDestroy] 再次销毁定时器")}),4500)}},l=r,c=(a("4372"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},a887:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"ref-work",staticClass:"result-work"},[a("el-form",{ref:"searchForm",staticClass:"search-container",attrs:{size:"small",inline:!0}},[a("div",{staticStyle:{"margin-left":"15px"}},[a("el-form-item",{attrs:{label:"项目:",prop:"project",size:"mini"}},[a("el-select",{staticStyle:{"margin-right":"15px","max-width":"150px"},attrs:{size:"small",placeholder:"请选择项目"},on:{change:t.selProject},model:{value:t.projectId,callback:function(e){t.projectId=e},expression:"projectId"}},[a("el-option",{attrs:{label:"全部",value:0}}),t._l(t.projectList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1),a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"工单名称:",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{staticStyle:{float:"right"}},[t._t("searchs-right"),a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onSearch}},[t._v("搜索")]),a("el-button",{staticClass:"add-btn",on:{click:t.onReset}},[t._v("重置")])],2),a("div",{staticClass:"clearfix"})],1)]),a("div",{style:{height:t.tabHeight}},[a("vxe-table",{attrs:{border:"",stripe:"",resizable:"",height:"auto",width:"auto","highlight-hover-row":"","auto-resize":"","show-header-overflow":"title","show-overflow":"title",data:t.dataList,loading:t.loading}},[a("vxe-table-column",{attrs:{type:"expand",width:"40"},scopedSlots:t._u([{key:"content",fn:function(e){var s=e.row;return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"数据源类型"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(s.db_type))])],1),a("el-form-item",{attrs:{label:"数据源/数据库"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(s.db_name+"/"+s.owner))])],1),a("el-form-item",{attrs:{label:"SQL"}},[s.sql&&s.sql.length>3e3?a("strong",{staticClass:"sql"},[t._v(" SQL语句过长，请在详情查看 ")]):a("pre",{staticClass:"sql"},[t._v(t._s(s.sql))])])],1)]}}])}),a("vxe-table-column",{attrs:{field:"name",title:"工单名称"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(e){return t.goWorkDetail(s)}}},[t._v(t._s(s.name))])]}}])}),a("vxe-table-column",{attrs:{field:"type",title:"工单类型"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{attrs:{title:t.showWorkType(s.type)}},[t._v(t._s(t.showWorkType(s.type)))])]}}])}),a("vxe-table-column",{attrs:{field:"created_at",title:"申请时间"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("dateTime")(a.created_at))+" ")]}}])}),a("vxe-table-column",{attrs:{field:"status",title:"工单状态"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{class:t.showTagType(s.status)},[t._v(" "+t._s(t.showStatus(s.status))+" ")])]}}])}),a("vxe-table-column",{attrs:{field:"back_up",title:"是否备份",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[1==s.back_up?a("span",[t._v("是")]):a("span",[t._v("否")])]}}])}),a("vxe-table-column",{attrs:{title:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-button",{attrs:{size:"mini",type:"info",title:"详情"},on:{click:function(e){return t.goWorkDetail(s)}}},[t._v(" 详情 ")]),6!=s.status||3!=s.type&&4!=s.type&&5!=s.type?t._e():[4==s.type?a("el-button",{attrs:{title:"下载",size:"mini",type:"info"},on:{click:function(e){return t.moreHandler(s.type,s)}}},[t._v(" 下载 ")]):a("el-button",{attrs:{title:"查询",size:"mini",type:"info"},on:{click:function(e){return t.moreHandler(s.type,s)}}},[t._v(" 查询 ")])],6==s.status&&1==s.back_up?a("el-button",{attrs:{title:"备份",size:"mini",type:"info"},on:{click:function(e){return t.goWorkBackUp(s)}}},[t._v(" 备份 ")]):t._e()]}}])})],1)],1),a("vxe-pager",{attrs:{background:"",size:"small",loading:t.loading,"current-page":t.pageNo,"page-size":t.pageSize,total:t.total,"page-sizes":[10,20,100],layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":t.onPageChange}}),a("dialog-backup",{ref:"backupDialog",on:{hide:t.hide}}),a("dialog-detail",{ref:"detailDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("d3b7"),a("b0c0"),a("3ca3"),a("ddb0"),a("2f62")),r=a("ff60"),l=a("cdac"),c=a("096f"),u=a("e31c"),d=a("c1df"),p=a.n(d),f=a("2ef0"),m={components:{DialogDetail:l["default"],DialogBackup:c["default"]},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(i["e"])(["runner","project","sqlTypes","service","runActive","runList"])),Object(i["c"])(["showWorkType"])),{},{searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&t.dateRange.length>=2&&(t.start=p()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=p()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}}),data:function(){return{projectId:0,projectList:[],loading:!1,pageNo:0,pageSize:10,dataList:[],total:0,tabHeight:"200px",isShow:!1,search2:{db_type:null},dateRange:[p()().startOf("d").toDate(),p()().endOf("d").toDate()],search:{dateRange:null,db_type:null,project:0,name:"",status:-1},status_types:[{k:"0",v:"全部"},{k:"1",v:"待审核"},{k:"2",v:"已通过"},{k:"3",v:"未通过"}]}},props:{runTabId:{}},watch:{searchAdvance:{handler:Object(f["debounce"])((function(){this.load(this.searchAdvance)}),500,{leading:!0})}},mounted:function(){this.getProjectList()},created:function(){this.load(this.searchAdvance)},methods:{getProjectList:function(){var t=this;this.$api.my.myProjectList().then((function(e){t.projectList=e||[]}))},selProject:function(){this.onSearch()},showTagType:function(t){return this.$api.work.showTagType(t)},onTableRowClassName:function(t,e){return 1===e?"info-row":3===e?"positive-row":""},onPageChange:function(t){this.pageSize=t.pageSize,this.pageNo=t.currentPage,this.load(this.searchAdvance)},onSizeChange:function(t){this.size=t,this.search()},onSearch:function(){this.load(this.searchAdvance)},onReset:function(){console.log("onReset: ")},load:function(t){var e=this;this.loading=!0,t=t||this.searchAdvance||{},t.page_no=this.pageNo>=1?this.pageNo-1:this.pageNo,t.page_size=this.pageSize,t.project=this.projectId,this.$api.page("/api/my/work/list",t).then((function(t){t.length?(e.dataList=t,e.total=t.length):(e.dataList=t.data||t.list,e.total=t.total||t.count),e.$emit("total",e.total),e.$emit("data",e.dataList)})).finally((function(){e.loading=!1}))},resize:function(){var t=this.$refs["ref-work"];if(t){var e=t.offsetHeight;this.tabHeight=e-30-51-32+"px"}},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!1)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},moreHandler:function(t,e){var a=this,s={db_id:e.db_id,owner:e.owner,db:e.db_name,dbType:e.db_type,script:e.sql,token:Object(r["a"])()},n=u["a"].generate({sql:e.sql,comment:!0,mode:3==t?"在线查询-工单":"快照查询-工单",id:e.id,name:e.name,src:e.db_name,db:e.owner,db_type:e.db_type});s.script=n;var o=u["a"].parserComments(s.script);if(3==t){this.$store.commit("resultJumpLoading",!0),this.service.assignData(s,!0);var i=this.service.onRunNormal(!1,null,{single_script:n,mode:o});Promise.all([i]).then((function(){console.log("[result.work methods] 在线查询：",a.service.data),a.$bus.emit("index-result-change-tab_".concat(a.runTabId),"result")})).catch((function(t){console.log("[result.work methods] #moreHandler(请求错误)",t),a.$store.commit("resultJumpLoading",!1)})).finally((function(){a.$store.commit("resultJumpLoading",!1)}))}else if(4==t){var l=window.localStorage.getItem("token");this.$api.download("/api/sql/task/export/downloads",{id:e.id,access_token:l})}else 5==t&&(this.$store.commit("resultJumpLoading",!0),this.service.assignData(s,!0),this.onShowAsyncData(e,o));console.log("moreHandler: ",t,e)},onShowAsyncData:function(t,e){var a=this,s=this.service.onRunAsyncData(null,null,{mode:e,async:t.id});Promise.all([s]).then((function(){console.log("[result.work methods] 快照查询：",a.service.data),a.$bus.emit("index-result-change-tab_".concat(a.runTabId),"result")})).catch((function(){a.$store.commit("resultJumpLoading",!1)}))},onExportFile:function(){},onDownload:function(t){var e=window.localStorage.getItem("token");4==t.type?this.$api.download("/api/sql/task/export/downloads",{id:t.id,access_token:e}):t.type},onCancel:function(t){var e=this;this.$api.work.cancel({id:t.id,cancel_remark:t.cancel_remark,flag:2}).then((function(t){e.onSuccess("取消成功"),e.init()}),(function(t){var a="参数错误！";"301"!=t.result&&(a=t.data),e.onError(a)}))},showStatus:function(t){return this.$api.work.showStatus(t)},show:function(){var t=this;console.log("==================================== start"),console.dir(this.runner),console.log("==================================== end"),this.isShow=!0,this.$nextTick((function(){t.refresh()}))},hide:function(){this.drawer=!1},refresh:function(){this.project?this.search.project=this.project.id:this.search.project=0},resetSearch:function(){console.log("========resetSearch========="),this.search={project:this.project.id}},reload:function(){this.$refs.st.reload()},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}}},h=m,b=(a("1046"),a("c823"),a("2877")),_=Object(b["a"])(h,s,n,!1,null,"08dbf2cd",null);e["default"]=_.exports},a901:function(t,e,a){},a99a:function(t,e,a){},a9c4:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-new-work"},[t.isEmpty?t._e():[a("h3",{staticStyle:{"margin-bottom":"10px"}},[t._v("项目："+t._s(t.project.name))]),a("el-form",{ref:"form",staticClass:"dialog-work-form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("div",{staticClass:"left-section"},[a("monaco-lite",{ref:"monacoLite",staticClass:"work-sql",attrs:{"sql-data":t.sql},on:{change:t.monacoListChangeHandler}})],1),a("div",{staticClass:"right-section"},[a("div",{staticClass:"right-section-top"},[a("el-form-item",{attrs:{label:"导入文件"}},[a("el-input",{attrs:{readonly:!0,placeholder:"仅支持5M内的SQL文件"}},[a("el-button",{staticClass:"open-file",attrs:{slot:"append"},on:{click:t.loadFile},slot:"append"},[t._v("打开文件")])],1)],1),a("el-form-item",{staticClass:"work-name",attrs:{label:"工单名称",prop:"name"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入工单名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"数据库",prop:"db_id"}},[a("div",{staticClass:"flex justify-between"},[a("select-database",{ref:"selectDatabse",staticClass:"flex-1",attrs:{dataBaseList:t.workSqlParams.dataBaseList},on:{"select-change":t.onSelectDatabseChangeHandler}}),a("el-tooltip",{attrs:{content:"刷新数据库列表"}},[a("el-button",{staticClass:"query-tool-item",staticStyle:{"padding-left":"10px"},attrs:{type:"text",size:"mini",loading:t.refreshLoading},nativeOn:{click:function(e){return t.onRefresh.apply(null,arguments)}}},[a("k-icon",{staticClass:"text-primary   sn-font active:opacity-75",attrs:{name:"icon-shuaxin1"}})],1)],1)],1)]),a("el-form-item",{attrs:{label:"类型",prop:"type"}},[t.has_au?a("span",[t._v(t._s(t.currentSqlTypeText))]):t.has_au?a("el-tag",[t._v("未知")]):a("el-tag",[t._v("未审计")])],1),t.isAuditDQL?[a("el-form-item",{attrs:{label:"查询条数"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:t.formData.fetch_size,callback:function(e){t.$set(t.formData,"fetch_size",e)},expression:"formData.fetch_size"}})],1),a("el-form-item",{attrs:{label:"查询类型"}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",disabled:!t.sqlTypeToolTip,content:t.sqlTypeToolTip,placement:"top"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.formData2TypeHandler},model:{value:t.formData2.type,callback:function(e){t.$set(t.formData2,"type",e)},expression:"formData2.type"}},[a("el-option",{attrs:{title:t.sqlTypeToolTips[5],label:"快照查询(异步)",value:"5"}}),a("el-option",{attrs:{title:t.sqlTypeToolTips[3],label:"在线查询",value:"3"}}),a("el-option",{attrs:{title:t.sqlTypeToolTips[4],label:"文件导出",value:"4"}})],1)],1)],1),4==t.formData2.type?a("el-form-item",{attrs:{label:"导出方式"}},[a("el-select",{attrs:{placeholder:"文件类型"},model:{value:t.formData.file_type,callback:function(e){t.$set(t.formData,"file_type",e)},expression:"formData.file_type"}},t._l(t.fileTypes,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1):t._e()]:t._e(),t.isAuditDQL?a("el-form-item",{attrs:{label:"忽略脱敏的字段"}},[a("el-tooltip",{attrs:{content:"越过脱敏策略，查询源数据"}},[a("el-input",{attrs:{placeholder:"请使用 , 号(英文逗号)分割"},model:{value:t.formData.no_mask_field,callback:function(e){t.$set(t.formData,"no_mask_field",e)},expression:"formData.no_mask_field"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:"审计状态"}},[t.has_au?99==t.formData.sql_type?a("el-tag",{attrs:{type:"warning"}},[t._v("不支持审计")]):0==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"success"}},[t._v("通过")]):1==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"warning"}},[t._v("警告")]):2==t.level&&"0"==t.stage_status?a("el-tag",{attrs:{type:"danger"}},[t._v("错误")]):-1==t.level?a("el-tag",{attrs:{type:"info"}},[t._v("未审计")]):a("el-tag",[t._v("未知")]):a("el-tag",[t._v("未审计")])],1),"0"==t.stage_status?a("el-form-item",{attrs:{label:"预估影响行数"}},[a("h3",{staticStyle:{color:"red","font-weight":"blod"}},[t._v(t._s(t.affected_rows))])]):t._e(),a("el-form-item",{attrs:{label:"审批流程"}},[a("el-tag",[t._v(t._s(t.project.sql_audit_auth_str))])],1),a("el-form-item",{attrs:{label:"执行时间"}},[a("el-checkbox",{attrs:{disabled:t.isAuditDQL,"true-label":1,"false-label":2},on:{change:t.onExecFlagHandler},model:{value:t.formData.exec_flag,callback:function(e){t.$set(t.formData,"exec_flag",e)},expression:"formData.exec_flag"}},[t._v("不限 ")])],1),2==t.formData.exec_flag?a("el-form-item",{staticClass:"work-exec-time",attrs:{label:"时间范围",prop:"execTimes"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.formData.execTimes,callback:function(e){t.$set(t.formData,"execTimes",e)},expression:"formData.execTimes"}})],1):t._e(),a("el-form-item",{attrs:{label:"是否备份"}},[a("el-checkbox",{attrs:{disabled:!t.can_back_up,"true-label":1,"false-label":0},model:{value:t.formData.back_up,callback:function(e){t.$set(t.formData,"back_up",e)},expression:"formData.back_up"}},[a("el-tooltip",{attrs:{content:"仅支持mysql数据库进行备份，需要开启binlog。",placement:"top"}},[t._v("是否备份")])],1)],1),a("el-form-item",{attrs:{label:"工单描述",prop:"mark"}},[a("el-input",{attrs:{rows:4,type:"textarea",placeholder:"请输入工单描述"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1)],2),a("div",{staticClass:"dialog-footer"},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loadings.audit,expression:"loadings.audit"}],attrs:{disabled:t.loadings.audit,type:"danger"},on:{click:t.handAudit}},[t._v("SQL 检测 ")]),a("el-button",{attrs:{disabled:!t.has_au,title:t.has_au?"单击提交":"请检测SQL后提交",type:"success"},on:{click:t.onSubmit}},[t._v("提 交 ")])],1)])]),a("h3",{staticStyle:{margin:"10px 0"}},[t._v("审计结果：")]),a("div",{staticStyle:{height:"400px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadings.logList,expression:"loadings.logList"}],staticStyle:{width:"100%"},attrs:{data:t.sqlAuditLogData,border:!0,height:"400"}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.sql))])]}}],null,!1,4287002527)}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sql_no)+" ")]}}],null,!1,70425741)}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"sql",label:"SQL语句"}}),a("el-table-column",{attrs:{prop:"level",width:"120",label:"审核/执行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showLevelTagType(e.row.level)}},[t._v(" "+t._s(t.showLevel(e.row.level))+" ")])]}}],null,!1,4223825722)}),a("el-table-column",{attrs:{prop:"result",width:"200",label:"审核/执行信息"}}),a("el-table-column",{attrs:{prop:"affected_rows",label:"扫描/影响行数",width:"120"}}),a("el-table-column",{attrs:{prop:"execute_time",width:"100",label:"执行耗时"}}),a("el-table-column",{attrs:{prop:"stage_status",width:"200",label:"当前阶段"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showStageStatus(e.row.stage_status))+" ")]}}],null,!1,3280092576)})],1),a("el-pagination",{attrs:{"current-page":t.auditLogPages.pageNo,"page-sizes":[10,50,200,800],"page-size":t.auditLogPages.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.auditLogPages.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("dialog-audit-log",{ref:"sqlAuditLog"})],t.isEmpty?a("div",{staticClass:"page-empty"},[a("i",{staticClass:"sn-font"},[t._v("")]),t._m(0)]):t._e(),a("div",{attrs:{hidden:""}},[a("input",{ref:"openFile",staticClass:"file",attrs:{name:"sql-upload",accept:".sql",type:"file"},on:{change:t.getFile}})])],2)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b",[t._v("当前页面可能已经销毁，请从工作区创建工单！！")])])}],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("b0c0"),a("d3b7"),a("498a"),a("2f62")),l=a("c1df"),c=a.n(l),u=a("da6f"),d=a("cb68"),p=a("0c52"),f=a("ccad"),m=a("e31c"),h=a("ff60"),b="production";"production"==b&&(window.onbeforeunload=function(){return"Your work will be lost."});var _={props:{pageData:{type:Object,default:function(){return null}}},components:{DialogAuditLog:f["default"],MonacoLite:d["default"],"select-database":p["default"]},computed:Object(i["a"])(Object(i["a"])({},Object(r["e"])(["sys","service","sqlTypes","fileTypes","isMaxLine","MAX_LINE"])),{},{isAuditDQL:function(){var t=this.has_au&&(3==this.formData.type||4==this.formData.type||5==this.formData.type);return t&&(this.formData.exec_flag=2),t},sqlTypeToolTip:function(){var t=this.sqlTypeToolTips[this.formData.type];return t||!1},currentSqlTypeText:function(){return this.sqlTypes[this.formData.type]}}),watch:{isMaxLine:function(t){t&&this.onError("SQL行数超过了最大值限制(max = ".concat(this.MAX_LINE,"行)，删除多余行！"),"错误",3500)}},data:function(){return{refreshLoading:!1,isEmpty:!1,workSqlParams:{},workId:null,workKey:null,loadings:{audit:!1,logList:!1},sqlAuditLogData:[],auditLogPages:{pageNo:1,pageSize:10,total:0},sqlTypeToolTips:{3:"在线查询：审批通过后，在工单执行时间范围内可多次查询实时数据",4:"文件导出：工单执行时根据查询结果生成文件，在工单执行时间范围内可重复下载",5:"查询快照：（同异步查询）工单执行时根据结果生成数据快照，在工单执行时间范围内可多次查询数据快照"},has_au:!1,activeName:"工单详情",sql:"",workType:"auto",disabled:!1,disabled_backup:!0,typeText:null,role:{},level:-1,affected_rows:0,stage_status:"",execTimes:[],isShow:!1,config:{lang:"sql"},data:{},db:{can_backup:1},can_back_up:!1,formData2:{type:"3"},project:{},formData:this.resetFormData(),formRule:{execTimes:[{required:!0,message:"请选择时间范围"}],db_id:[{required:!0}],name:[{required:!0,message:"请输入工单名称"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},methods:{handleSizeChange:function(t){console.log(t),this.auditLogPages.pageNo=1,this.auditLogPages.pageSize=t,this.sqlAuditLogList()},handleCurrentChange:function(t){console.log(t),this.auditLogPages.pageNo=t,this.sqlAuditLogList()},showStageStatus:function(t){return this.$api.work.showStageStatus(t)},showStage:function(t){return this.$api.work.showStage(t)},showLevel:function(t){return this.$api.work.showLevelStyle(t)},showLevelTagType:function(t){return this.$api.work.showLevelTagType(t)},showStatus:function(t){return this.$api.work.showStatus(t)},loadFile:function(t){console.log("打开文件：",t),this.openFileEncode=t,this.$refs.openFile.click()},addContent:function(t){this.$refs.monacoLite.setSql(t)},getFile:function(t){if(window.FileReader){var e=t.target.files[0],a=e.size;if(a>1048576)this.$message({showClose:!0,type:"error",message:"打开失败，文件过大！（max=1M）"});else if(-1!=e.name.indexOf(".sql")){var s=new FileReader,n=this;s.onload=function(){n.addContent(this.result),t.target.value=""},s.readAsText(e,this.openFileEncode)}else this.$message.error("不支持该类型的文件上传")}},onExecFlagHandler:function(t){console.log(t),1==t&&(this.execTimes=[])},formData2TypeHandler:function(t){this.formData.exec_flag=3==t?2:1,this.formData.type=t},onSelectDatabseChangeHandler:function(t){var e=t.source,a=t.instance;console.log("触发数据库... ..."),this.formData.dbType=a.db_type,this.formData.db_id=a.db_id,this.formData.owner=a.label,this.formData.db=e.label,this.has_au=!1,this.workSqlParams.selecedDB={source:e,instance:a}},monacoListChangeHandler:function(t){this.formData.sql=t,this.has_au=!1},sqlAuditLogList:function(){var t=this;this.loadings.logList=!0,this.$api.work.sqlAuditList(this.workId,this.auditLogPages.pageNo-1,this.auditLogPages.pageSize).then((function(e){t.auditLogPages=Object(i["a"])(Object(i["a"])({},t.auditLogPages),{},{total:e.count}),t.sqlAuditLogData=e.list})).finally((function(){setTimeout((function(){t.loadings.logList=!1}),200)}))},handAudit:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.formData.sql&&e.formData.sql.trim()){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,e.onAudit(e.formData.sql);case 4:s=a.sent,t&&(s.async=t.async||!1,s.export=t.export||!1),console.log("手动审计： ",e.formData.db_id,s.db_id),e.show(null,Object(i["a"])(Object(i["a"])({},s),{},{owner:e.formData.owner}),"hand-audit");case 8:case"end":return a.stop()}}),a)})))()},onAudit:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.loadings.audit=!0,s=null,a.prev=2,n=Object(i["a"])(Object(i["a"])({},e.formData),{},{script:null,sql:t}),n.project=e.project.id,n.iid=n.db_id,n.db_type=n.dbType,n.token=Object(h["a"])(),e.workId=n.token,a.next=11,e.$api.work.work_audit(n);case 11:s=a.sent,e.has_au=!0,a.next=20;break;case 15:a.prev=15,a.t0=a["catch"](2),console.error("dialg.work ==========   e:",a.t0),s=a.t0,e.onError(s,"审计错误");case 20:return a.prev=20,setTimeout((function(){e.loadings.audit=!1}),200),a.finish(20);case 23:return s.error&&e.onError(s.error,"审计错误"),e.sqlAuditLogList(),a.abrupt("return",s);case 26:case"end":return a.stop()}}),a,null,[[2,15,20,23]])})))()},show:function(t,e,a){var s=this,n=Object(i["a"])({},this.formData);e?(console.log("au: ",e),this.has_au=!0,12==e.sql_type||13==e.sql_type||14==e.sql_type?n.type=1:15==e.sql_type?n.type=2:11==e.sql_type?(console.log("xx==: formTempData",n),n.type=3,console.log("xx==: au",e),e&&!0===e.async?(this.formData2.type="5",n.type=5):e&&!0===e.export&&(this.formData2.type="4",n.type=4)):n.type=9,this.can_back_up=e.can_back_up):e={};var o=this.workSqlParams.data;console.log("serviceData: ",o),n.id=e.token||Object(h["a"])(),n.exec_flag=1,n.sql_type=e.sql_type||99,n.exec_start=null,n.exec_end=null,"hand-audit"!=a&&(o.script=m["a"].removeSoftRoute(o.script),this.sql=o.script,console.log("serviceData.script: ",o.script),n.sql=o.script,n.mark="",n.name=""),n.dbType=e.db_type||o.dbType,n.db_id=e.db_id||o.db_id,n.owner=e.owner||o.owner,n.audit_id=0,this.level=e.level,this.affected_rows=e.affected_rows,this.stage_status=e.stage_status,this.formData=Object(i["a"])({},n),this.isShow=!0,this.$nextTick((function(){s.$refs.monacoLite&&(s.$refs.monacoLite.setCount(0),s.$refs.monacoLite.init(s.formData.sql),console.log("instance.label this.workSqlParams.selecedDBxxx",s.workSqlParams),s.$refs.selectDatabse.init({db_id:s.formData.db_id,owner:s.formData.owner,selecedDB:s.workSqlParams.selecedDB},!0))}))},onRefresh:function(){var t=this;this.$api.db.dbAll(this.workSqlParams.project.id,!0,!0).then((function(e){t.workSqlParams.dataBaseList=e}))},tabHandleClick:function(t,e){console.log(t,e)},showLog:function(){this.$refs.sqlAuditLog.show(this.formData.id)},resetFormData:function(){return{id:"",exec_flag:1,exec_start:null,exec_end:null,source_type:"none",source_id:"none",sql:"",type:"",no_mask_field:"",fetch_size:500,file_type:"5",name:"",mark:"",audit_id:0,back_up:0,execTimes:[]}},hide:function(t){this.disabled=!1,this.isShow=!1,this.has_au=!1,this.level=0,this.affected_rows=0,this.formData=this.resetFormData(),this.formData2.type="3",this.sqlAuditLogData=[],this.$refs.monacoLite.setCount(0)},editorInit:function(){a("2099"),a("8882"),a("8ef6"),a("1d29")},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=Object(i["a"])({},t.formData);if(delete a.execTimes,2==a.exec_flag){if(t.formData.execTimes<2)return void t.onError("时间范围出错，请重新选择！！");a.exec_start=c()(t.formData.execTimes[0]).format("YYYY-MM-DD HH:mm:ss"),a.exec_end=c()(t.formData.execTimes[1]).format("YYYY-MM-DD HH:mm:ss")}a.project=t.project.id,t.$api.work.add(a).then((function(){t.onSuccess("提交成功"),t.has_au=!1,t.$emit("submit",!0)})).catch((function(e){t.onError("提交失败"),t.$emit("submit",!1)}))}}))},deleteWokSQLAndClosPage:function(){Object(u["e"])(this.workKey),window.opener=null,window.open("","_self"),window.close()},init:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(console.log("pageData: ",t),t)this.workSqlParams=t,this.project=t.project,this.show(t,a,null),this.handAudit(a);else{var s=this.$route.query.time;this.workKey="work-sql-".concat(s),Object(u["c"])(this.workKey,null).then((function(t){t?(e.workSqlParams=t,e.show(null,null,null),e.project=t.project,"production"==b&&Object(u["e"])(e.workKey)):e.isEmpty=!0}))}}}},g=_,v=(a("382e"),a("2705"),a("2877")),y=Object(v["a"])(g,s,n,!1,null,null,null);e["default"]=y.exports},aa61:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-user",use:"d2-user-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-user"><path d="M512 661.3c-117.6 0-213.3-95.7-213.3-213.3S394.4 234.7 512 234.7 725.3 330.4 725.3 448 629.6 661.3 512 661.3z m0-341.3c-70.6 0-128 57.4-128 128s57.4 128 128 128 128-57.4 128-128-57.4-128-128-128z" fill="#5F6379" /><path d="M837 862.9c-15.7 0-30.8-8.7-38.2-23.7C744.3 729.5 634.4 661.3 512 661.3s-232.3 68.1-286.8 177.9c-10.5 21.1-36.1 29.7-57.2 19.2s-29.7-36.1-19.2-57.2C217.8 662.3 357 576 512 576s294.2 86.3 363.2 225.2c10.5 21.1 1.9 46.7-19.2 57.2-6.1 3-12.6 4.5-19 4.5z" fill="#5F6379" /><path d="M512 1002.7c-270.6 0-490.7-220.1-490.7-490.7S241.4 21.3 512 21.3s490.7 220.1 490.7 490.7-220.1 490.7-490.7 490.7z m0-896c-223.5 0-405.3 181.8-405.3 405.3S288.5 917.3 512 917.3 917.3 735.5 917.3 512 735.5 106.7 512 106.7z" fill="#3688FF" /></symbol>'});i.a.add(r);e["default"]=r},aa82:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{height:"100%"}},[a("router-view")],1)},n=[],o={data:function(){return{}},components:{},watch:{},methods:{},mounted:function(){}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},aa8f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"employee padding-x-24",attrs:{type:"ghost"}},[a("div",{staticClass:"grid grid-flow-row grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4"},t._l(t.memberList,(function(e){return a("div",{key:e.id,staticClass:"project-member border border-gray-100  p-6 ",class:e.state?"shadow-sm hover:shadow-lg":"disabled:opacity-50 border-red-500"},[a("div",{staticClass:"flex"},[a("el-avatar",{staticStyle:{"font-size":"24px !important"},attrs:{size:48,src:e.user_avatar}},[t._v(" "+t._s(e.user_name.charAt(0))+" ")]),a("div",{staticClass:"flex-1 ml-4"},[a("div",{staticClass:"flex justify-between "},[a("div",{staticClass:"text-lg"},[t._v(" "+t._s(e.user_name)+" "),1==e.project_role?a("el-tag",{attrs:{size:"small",effect:"plain"}},[t._v(" 有管理权限 ")]):t._e(),0==e.state?a("el-tag",{attrs:{type:"danger",size:"small",effect:"plain"}},[t._v(" 冻结 ")]):t._e()],1),t.project_home.is_manager&&t.user.id!==e.id&&1!=e.is_create?a("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("el-button",{staticClass:"btn-border-0",attrs:{icon:"el-icon-more",circle:"",size:"mini"}})],1),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.user.id!==e.id?a("el-dropdown-item",{attrs:{command:e,icon:"el-icon-remove-outline"}},[t._v("移除成员")]):t._e()],1)],1):t._e()],1),a("span",{staticClass:"ignore text-gray-400"},[t._v(" "+t._s(e.email)+" ")])])],1),a("div",{staticClass:"py-3 flex justify-between "},[a("div",[t._v(" 角色： "),e.role_name?a("el-tag",{attrs:{size:"small",type:"success",effect:"plain"}},[t._v(" "+t._s(e.role_name)+" ")]):a("el-tag",{attrs:{size:"small",type:"info",effect:"plain"}},[t._v(" 空 ")])],1),e.id!=t.user.id?a("button",{staticClass:"border rounded-sm bg-gray-50  hover:bg-gray-200 active:bg-gray-300 py-1 px-4",on:{click:function(a){return t.onSend(e)}}},[a("k-icon",{attrs:{name:"icon-buoumaotubiao12"}}),t._v(" 私信 ")],1):t._e()])])})),0),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"发送消息","destroy-on-close":!0,visible:t.dialogTableVisible,close:t.onClose},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("SendView",{attrs:{"user-id":t.toUserId,"user-info":t.msgUserInfo},on:{success:t.onSendSuccess}})],1)],1)},n=[],o=a("5530"),i=(a("4de4"),a("b0c0"),a("a15b"),a("ac1f"),a("841c"),a("2f62")),r=a("2109"),l=a("c1df"),c=a.n(l),u=a("5c96"),d={components:{SendView:r["default"]},name:"project-members",computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user","project_home"])),{},{filter:function(){var t=this;return function(e){var a=t.memberList.filter((function(t){return t.state==e}));return a}}}),data:function(){return{msgUserInfo:null,toUserId:null,dialogTableVisible:!1,memberList:[],formData:{name:""},id:this.$route.params.id,cp:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMPANY,no_role:!1,search:{id:this.$route.params.id,rel_type:1},dataList:[],roles:[],projects:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},methods:{onClose:function(){this.msgUserInfo=null},onSend:function(t){console.log("发送私信：",t),this.toUserId=t.id,this.dialogTableVisible=!0,this.msgUserInfo={user_name:t.user_name,name:t.name,id:t.id}},onSendSuccess:function(){var t=this;this.$message.success("发送成功"),setTimeout((function(){t.dialogTableVisible=!1}),500)},handleCommand:function(t){var e=this;this.$confirm("确定要把【".concat(t.user_name,"】用户移除项目吗?"),"移除成员",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((function(){e.onRemove(t.id)})).catch((function(){}))},onRemove:function(t){var e=this;this.$api.project.kick(this.id,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},init:function(){var t=this;this.$api.project.userAll({id:this.$route.params.id,rel_type:1}).then((function(e){t.memberList=e.data||[]}))},showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return c()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){e.onSuccess(t),e.refresh("操作成功")}),(function(t){u["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.init()},onNew:function(){this.$refs.dialogEdit.show()},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onEdit:function(t){this.$refs.dialogEdit.show(t)},onState:function(t,e){var a=this;this.$api.user.state(t.id,e).then((function(){a.onSuccess("操作成功"),a.refresh()}),(function(t){u["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t){var e=this;this.$api.user.delete(t.id).then((function(){e.onSuccess("操作成功"),e.refresh()}),(function(t){u["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){this.init()}},p=d,f=(a("9c16"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,"48040cd4",null);e["default"]=m.exports},aa90:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"},{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"dialog-labels",attrs:{"destroy-on-close":!0,"append-to-body":!0,visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.closeHandle}},[a("div",{staticClass:"headers",attrs:{slot:"title"},slot:"title"},[a("div",[t._v(t._s(t.headers.title))]),a("div",{staticClass:"target-text"},[t._v(t._s(t.headers.targetText))]),a("div",[t._v("    ")])]),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5,offset:0}},[t._v(" 读/写/管/禁： ")]),a("el-col",{attrs:{span:19,offset:0}},[a("el-radio-group",{model:{value:t.authObj.perm.rw,callback:function(e){t.$set(t.authObj.perm,"rw",e)},expression:"authObj.perm.rw"}},[a("el-radio",{staticClass:"auth-1",attrs:{label:1}},[t._v("读")]),a("el-radio",{staticClass:"auth-2",attrs:{label:2}},[t._v("写")]),a("el-radio",{staticClass:"auth-4",attrs:{label:4}},[t._v("管")]),a("el-radio",{staticClass:"auth-3",attrs:{label:3}},[t._v("禁")])],1)],1)],1),a("hr",{staticClass:"hr margin-y-12"}),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5,offset:0}},[t._v(" 异步查询 "),a("i",{staticClass:"sn-font",class:{"auth-icon-set":1===t.authObj.perm.asyn_query,"auth-icon-ignore":-1==t.authObj.perm.asyn_query}},[t._v("")])]),a("el-col",{attrs:{span:19,offset:0}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.authObj.perm.asyn_query,callback:function(e){t.$set(t.authObj.perm,"asyn_query",e)},expression:"authObj.perm.asyn_query"}})],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5,offset:0}},[t._v(" 数据导出 "),a("i",{staticClass:"sn-font",class:{"auth-icon-set":1===t.authObj.perm.asyn_export,"auth-icon-ignore":-1==t.authObj.perm.asyn_export}},[t._v("")])]),a("el-col",{attrs:{span:19,offset:0}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.authObj.perm.asyn_export,callback:function(e){t.$set(t.authObj.perm,"asyn_export",e)},expression:"authObj.perm.asyn_export"}})],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5,offset:0}},[t._v(" SQL导出 "),a("i",{staticClass:"sn-font",class:{"auth-icon-set":1===t.authObj.perm.asyn_sql,"auth-icon-ignore":-1==t.authObj.perm.asyn_sql}},[t._v("")])]),a("el-col",{attrs:{span:19,offset:0}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.authObj.perm.asyn_sql,callback:function(e){t.$set(t.authObj.perm,"asyn_sql",e)},expression:"authObj.perm.asyn_sql"}})],1)],1),a("el-row",{staticClass:"margin-top-12",attrs:{gutter:20}},[a("el-col",{attrs:{span:24,offset:0}},[t._v(" 共选择 "+t._s(t.nodeList.length)+" 条数据 ")])],1),a("el-row",{staticClass:"label-list ",attrs:{gutter:20}},t._l(t.nodeList,(function(e,s){return a("el-col",{key:s,attrs:{span:24,offset:0}},[t._v(" "+t._s(e.name)+" ")])})),1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确定")])],1)],1)},n=[],o=(a("b0c0"),a("2ef0")),i={props:{confirmLoading:{type:Boolean,default:function(){return!1}}},data:function(){return{headers:{title:"设置权限",targetText:""},visible2:!1,visible:!1,loading:!1,owner:{perm:{}},authObj:{rw:1,aq:0,ae:0,as:0,aw:0,perm:{}},nodeList:[]}},methods:{setHeaders:function(t){this.headers=t},getRwInfo:function(t){var e=[1,2,3,4];3==this.owner.rw||""==this.owner.rw||-1==this.owner.rw?e=[]:1==this.owner.rw?e=[1,3]:2==this.owner.rw&&(e=[1,2,3]);var a=-1==e.indexOf(t);return{disable:a,title:a?"上级权限导致不可用":""}},confirm:function(){this.loading=this.confirmLoading,this.authObj.ae=this.authObj.perm.asyn_export,this.authObj.aq=this.authObj.perm.asyn_query,this.authObj.as=this.authObj.perm.asyn_sql,this.authObj.aw=this.authObj.perm.audit_work,this.authObj.rw=this.authObj.perm.rw,this.$emit("confirm",this.authObj)},setLoading:function(t){this.loading=Boolean(t)},hide:function(){this.loading=!1,this.visible=!1},cancel:function(){this.visible=!1},closeHandle:function(){this.nodeList=[],this.authObj={rw:1,aq:0,ae:0,as:0,aw:0,perm:{}},console.log("关闭： ",this.authObj)},show:function(t,e){this.owner={aq:e.perm.asyn_query,ae:e.perm.asyn_export,as:e.perm.asyn_sql,aw:e.perm.audit_work,rw:e.perm.rw,label:e.label||e.name,name:e.name,leaf:e.leaf,perm:Object(o["cloneDeep"])(e.perm)},this.authObj={rw:e.perm.rw,aq:e.perm.asyn_query,ae:e.perm.asyn_export,as:e.perm.asyn_sql,aw:e.perm.audit_work,perm:Object(o["cloneDeep"])(e.perm)},this.visible=!0,this.nodeList=Object(o["cloneDeep"])(t)},trigger:function(){this.visible=!this.visible}}},r=i,l=(a("a17b"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},ac37:function(t,e,a){"use strict";a("bbaa")},ac9c:function(t,e,a){"use strict";function s(t,e){if(t&&(t.$el||t.offsetHeight)&&e)return Math.floor((t.offsetHeight||t.$el.offsetHeight)/2/e*3);console.warn("[vlist.js] getKeeps参数错误 - [ref, itemHeight]：",t,e)}a.d(e,"a",(function(){return s}))},acc0:function(t,e){},ad1b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:t.isShow,title:t.termTitle,center:"",modal:!1,"destroy-on-close":!0,fullscreen:"","custom-class":"felix-dialog"},on:{"update:visible":function(e){t.isShow=e},opened:t.doOpened,open:t.doOpen,close:t.doClose}},[a("div",{ref:"terminal",staticClass:"felix-xterm"})])},n=[],o=(a("b0c0"),a("99af"),a("fcf3")),i=a("47d0"),r=a("27ae"),l=a("d1f9"),c=a("408b"),u=(a("f9ab"),a("4ad9")),d=new i["FitAddon"],p=new c["WebLinksAddon"],f=new l["SearchAddon"],m=function(t,e){var a=function(t){e.send(JSON.stringify({type:"resize",rows:t.rows,cols:t.cols}))};t.onResize(a),e.addEventListener("close",(function(){}))},h=function(t,e,a,s){t.write("\r\nWelcome to SqlDEV Web Ssh Terminal\n\r\n"),t.socket=e;var n=null,o=function(e){s&&s>0?n?n+=e.data:(n=e.data,setTimeout((function(){t.write(n)}),s)):t.write(e.data)},i=function(t){e.send(JSON.stringify({type:"cmd",cmd:r["Base64"].encode(t)}))};e.onmessage=o,a&&t.onData(i);var l=setInterval((function(){e.send(JSON.stringify({type:"heartbeat",data:""}))}),2e4);e.addEventListener("close",(function(){e.removeEventListener("message",o),delete t.socket,clearInterval(l)}))},b={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompTerm",data:function(){return{m:{},id:0,isFullScreen:!1,searchKey:"",isShow:!1,ws:null,term:null,fitAddon:null,thisV:this.visible}},watch:{visible:function(t){this.v=t}},computed:{termTitle:function(){return this.m?"@".concat(this.m.name):""},wsUrl:function(){var t=localStorage.getItem("token");return"".concat(u["a"].wsBase(),"/api/ws/ssh/").concat(this.id,"?cols=").concat(this.term.cols,"&rows=").concat(this.term.rows,"&access_token=").concat(t)}},methods:{reset:function(){this.ws=null,this.term=null},show:function(t){this.m=t,this.id=t.id,this.isShow=!0},onWindowResize:function(){console.log("resize"),d.fit()},doLink:function(t,e){"click"===t.type&&window.open(e)},doClose:function(){window.removeEventListener("resize",this.onWindowResize),this.ws&&this.ws.close(),this.term&&this.term.dispose(),this.m={},this.id=0,this.isShow=!1},doOpen:function(){},doOpened:function(){var t=this;this.term=new o["Terminal"]({fontSize:12,rows:60,convertEol:!0,cursorBlink:!0,cursorStyle:"underline",bellStyle:"sound"}),this.term.loadAddon(d),this.term.loadAddon(p),this.term.loadAddon(f),this.term.open(this.$refs.terminal),d.fit(),window.addEventListener("resize",this.onWindowResize),console.log("this.wsUrl:",this.wsUrl),this.ws=new WebSocket(this.wsUrl),this.ws.onerror=function(e){console.log("event:",e),t.$message.error("登陆失败,请检查你的配置")},this.ws.onclose=function(e){console.log("ws close:",e),t.term.setOption("cursorBlink",!1),1005!==e.code&&(t.$notify.error({title:"code ".concat(e.code),message:e.reason}),t.doClose())},h(this.term,this.ws,!0,-1),m(this.term,this.ws)}}},_=b,g=a("2877"),v=Object(g["a"])(_,s,n,!1,null,null,null);e["default"]=v.exports},ad22:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-star",use:"d2-star-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-star"><path fill="#333333" d="M761.2 942.8c-8.9 0-17.9-1.8-26.5-5.4l-220.7-93-220.7 93c-22.1 9.3-46.8 6.4-66.2-7.6-19.4-14.1-29.8-36.7-27.7-60.6l20.2-238.7L62.9 449.2c-15.7-18.1-20.6-42.5-13.2-65.3 7.4-22.8 25.7-39.6 49.1-45.1L332 284.3l123.9-205c12.4-20.5 34.1-32.7 58-32.7 24 0 45.7 12.2 58.1 32.7l123.9 205 233.2 54.5c23.3 5.5 41.7 22.3 49.1 45.1 7.4 22.8 2.5 47.2-13.2 65.3L808.4 630.4l20.2 238.7c2 23.9-8.3 46.5-27.7 60.6-11.8 8.6-25.7 13-39.7 13.1zM146.4 415.3L289 580.2c11.9 13.7 17.8 32 16.3 50.1l-18.4 217.2 200.8-84.6c16.8-7 35.9-7 52.6 0l200.9 84.6-18.4-217.2c-1.5-18.1 4.4-36.4 16.3-50.1l142.5-164.9-212.2-49.6c-17.7-4.1-33.2-15.4-42.6-31L514 148.3 401.2 334.8c-9.4 15.6-24.9 26.8-42.6 31l-212.2 49.5z m553.3-124.7h0.2-0.2z" /></symbol>'});i.a.add(r);e["default"]=r},ad3a:function(t,e,a){"use strict";a("6618")},adc8:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"ref-info",staticClass:"result-info"},[a("div",{staticClass:"overflow"},[a("div",{staticClass:"info-item result"},[a("span",[t._v("操作结果：")]),a("i",{staticClass:"icon",class:t.service.result?"el-icon-success icon-success":"el-icon-error icon-error",attrs:{title:t.service.result?"成功":"错误"}})]),a("div",{staticClass:"info-item explain"},[a("span",[t._v("执行计划：")]),a("i",{staticClass:"el-icon-success icon",class:t.service.explain?"icon-success":"el-icon-error icon-disable",attrs:{title:t.service.explain?"执行成功":"未执行"}})]),a("div",{staticClass:"margin-top-20 info-item page-no"},[a("span",[t._v("页码：")]),a("span",[t._v("第 "+t._s(t.service.page+1)+" 页")])]),a("div",{staticClass:"info-item page-size"},[a("span",[t._v("分页大小：")]),a("span",[t._v(t._s(t.service.size)+"条")])]),a("div",{staticClass:"margin-top-20 info-item exc"},[a("span",[t._v("执行： ")]),a("span",{staticClass:"run-sql",attrs:{title:t.service.runSql}},[t._v(t._s(t.service.runSql)+" ")])]),t.service.result?a("div",{staticClass:"exc-sucess"},[t._v(" 共查询 "),a("span",{staticClass:"text-info"},[t._v(t._s(t.service.affected_rows))]),t._v(" 条记录，"+t._s(t.service.resultText)+" ")]):a("div",{staticClass:"info-item exec-error error"},[t._v(" "+t._s(t.service.resultText)+" ")])])])},n=[],o={name:"result-info",inject:["service","data"],data:function(){return{tabHeight:"150px"}},methods:{resize:function(){var t=this.$refs["ref-info"];if(t){var e=t.offsetHeight;this.tabHeight=e-80+"px"}}},mounted:function(){console.log("this.service",this.service,this.data)}},i=o,r=(a("5a3d"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"5c4709e7",null);e["default"]=l.exports},ae5c:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-d2-admin-text",use:"d2-d2-admin-text-usage",viewBox:"0 0 88 84",content:'<symbol viewBox="0 0 88 84" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="d2-d2-admin-text">\n    \x3c!-- Generator: Sketch 49.3 (51167) - http://www.bohemiancoding.com/sketch --\x3e\n    <desc>Created with Sketch.</desc>\n    <defs></defs>\n    <g id="d2-d2-admin-text_page" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="d2-d2-admin-text_Tablet" transform="translate(-1077.000000, -135.000000)">\n            <g id="d2-d2-admin-text_Group" transform="translate(1077.000000, 132.000000)">\n                <path d="M0.74,85.8 L0.74,71.44 L3.72,71.44 C5.7600102,71.44 7.2566619,71.5899985 8.21,71.89 C9.1633381,72.1900015 9.9866632,72.6633301 10.68,73.31 C11.3733368,73.9566699 11.9066648,74.746662 12.28,75.68 C12.6533352,76.613338 12.84,77.7033271 12.84,78.95 C12.84,80.1966729 12.5500029,81.3699945 11.97,82.47 C11.3899971,83.5700055 10.6033383,84.3999972 9.61,84.96 C8.6166617,85.5200028 7.186676,85.8 5.32,85.8 L0.74,85.8 Z M2.12,84.44 L3.78,84.44 C5.513342,84.44 6.7699961,84.3533342 7.55,84.18 C8.3300039,84.0066658 9.0133304,83.6633359 9.6,83.15 C10.1866696,82.6366641 10.6333318,82.013337 10.94,81.28 C11.2466682,80.546663 11.4,79.7066714 11.4,78.76 C11.4,77.8133286 11.2233351,76.940004 10.87,76.14 C10.5166649,75.339996 10.0133366,74.6800026 9.36,74.16 C8.7066634,73.6399974 7.9366711,73.2900009 7.05,73.11 C6.1633289,72.9299991 4.8600086,72.84 3.14,72.84 L2.12,72.84 L2.12,84.44 Z M16.2,75.94 L14.82,75.94 C14.886667,74.473326 15.3733288,73.2966711 16.28,72.41 C17.1866712,71.5233289 18.2833269,71.08 19.57,71.08 C20.8566731,71.08 21.9233291,71.4966625 22.77,72.33 C23.6166709,73.1633375 24.04,74.179994 24.04,75.38 C24.04,76.2733378 23.8033357,77.0999962 23.33,77.86 C22.8566643,78.6200038 22.1400048,79.5199948 21.18,80.56 L17.6,84.42 L24.24,84.42 L24.24,85.8 L14.48,85.8 L19.96,79.88 C20.9200048,78.8399948 21.6066646,78.020003 22.02,77.42 C22.4333354,76.819997 22.64,76.1333372 22.64,75.36 C22.64,74.5866628 22.3366697,73.9066696 21.73,73.32 C21.1233303,72.7333304 20.3700045,72.44 19.47,72.44 C18.5699955,72.44 17.8233363,72.7433303 17.23,73.35 C16.6366637,73.9566697 16.2933338,74.8199944 16.2,75.94 Z M32.58,70.86 L39.28,85.8 L37.74,85.8 L35.48,80.9 L29.28,80.9 L27.04,85.8 L25.44,85.8 L32.22,70.86 L32.58,70.86 Z M32.4,74.04 L29.94,79.44 L34.84,79.44 L32.4,74.04 Z M51.88,71.08 L51.88,85.8 L50.54,85.8 L50.54,83.98 C49.3266606,85.4333406 47.9366745,86.16 46.37,86.16 C44.8033255,86.16 43.486672,85.6066722 42.42,84.5 C41.353328,83.3933278 40.82,82.0666744 40.82,80.52 C40.82,78.9733256 41.3599946,77.6500055 42.44,76.55 C43.5200054,75.4499945 44.8133258,74.9 46.32,74.9 C48.053342,74.9 49.4599946,75.6399926 50.54,77.12 L50.54,71.08 L51.88,71.08 Z M50.62,80.56 C50.62,79.3466606 50.220004,78.3200042 49.42,77.48 C48.619996,76.6399958 47.620006,76.22 46.42,76.22 C45.219994,76.22 44.2166707,76.6499957 43.41,77.51 C42.6033293,78.3700043 42.2,79.3833275 42.2,80.55 C42.2,81.7166725 42.6133292,82.733329 43.44,83.6 C44.2666708,84.466671 45.2433277,84.9 46.37,84.9 C47.4966723,84.9 48.4866624,84.4900041 49.34,83.67 C50.1933376,82.8499959 50.62,81.8133396 50.62,80.56 Z M54.98,75.18 L56.34,75.18 L56.34,77.02 C57.2866714,75.6066596 58.4999926,74.9 59.98,74.9 C60.7666706,74.9 61.4699969,75.1233311 62.09,75.57 C62.7100031,76.0166689 63.1266656,76.6466626 63.34,77.46 C63.7800022,76.6333292 64.3399966,76.0000022 65.02,75.56 C65.7000034,75.1199978 66.4833289,74.9 67.37,74.9 C68.2566711,74.9 69.0599964,75.2433299 69.78,75.93 C70.5000036,76.6166701 70.86,77.9733232 70.86,80 L70.86,85.8 L69.46,85.8 L69.46,80 C69.46,79.0266618 69.4000006,78.3100023 69.28,77.85 C69.1599994,77.3899977 68.900002,77.0033349 68.5,76.69 C68.099998,76.3766651 67.5700033,76.22 66.91,76.22 C66.2499967,76.22 65.6333362,76.4399978 65.06,76.88 C64.4866638,77.3200022 64.0933344,77.8799966 63.88,78.56 C63.6666656,79.2400034 63.56,80.2666598 63.56,81.64 L63.56,85.8 L62.22,85.8 L62.22,80.36 C62.22,79.226661 62.1600006,78.4166691 62.04,77.93 C61.9199994,77.4433309 61.6533354,77.0366683 61.24,76.71 C60.8266646,76.3833317 60.320003,76.22 59.72,76.22 C59.119997,76.22 58.5566693,76.3966649 58.03,76.75 C57.5033307,77.1033351 57.0900015,77.5866636 56.79,78.2 C56.4899985,78.8133364 56.34,79.8466594 56.34,81.3 L56.34,85.8 L54.98,85.8 L54.98,75.18 Z M73.1,72.22 C73.1,71.9133318 73.2099989,71.6466678 73.43,71.42 C73.6500011,71.1933322 73.9166651,71.08 74.23,71.08 C74.5433349,71.08 74.8099989,71.1899989 75.03,71.41 C75.2500011,71.6300011 75.36,71.8966651 75.36,72.21 C75.36,72.5233349 75.2500011,72.7899989 75.03,73.01 C74.8099989,73.2300011 74.5433349,73.34 74.23,73.34 C73.9166651,73.34 73.6500011,73.2266678 73.43,73 C73.2099989,72.7733322 73.1,72.5133348 73.1,72.22 Z M73.54,75.18 L74.92,75.18 L74.92,85.8 L73.54,85.8 L73.54,75.18 Z M77.74,75.18 L79.12,75.18 L79.12,77.08 C80.2133388,75.6266594 81.5399922,74.9 83.1,74.9 C83.900004,74.9 84.6199968,75.1166645 85.26,75.55 C85.9000032,75.9833355 86.353332,76.5499965 86.62,77.25 C86.886668,77.9500035 87.02,78.9799932 87.02,80.34 L87.02,85.8 L85.66,85.8 L85.66,80.74 C85.66,79.4999938 85.6033339,78.6600022 85.49,78.22 C85.3766661,77.7799978 85.2033345,77.4066682 84.97,77.1 C84.7366655,76.7933318 84.4400018,76.5600008 84.08,76.4 C83.7199982,76.2399992 83.2833359,76.16 82.77,76.16 C82.2566641,76.16 81.7533358,76.2866654 81.26,76.54 C80.7666642,76.7933346 80.3466684,77.1466644 80,77.6 C79.6533316,78.0533356 79.4200006,78.5199976 79.3,79 C79.1799994,79.4800024 79.12,80.4466594 79.12,81.9 L79.12,85.8 L77.74,85.8 L77.74,75.18 Z" id="d2-d2-admin-text_D2Admin" fill="#409EFF" />\n                <g id="d2-d2-admin-text_logo-no-shadow" transform="translate(11.000000, 0.000000)">\n                    <path d="M44.2833805,33.4299717 L6.05798302,56.3652102 C4.16366196,57.5018028 1.70662094,56.8875426 0.570028297,54.9932215 C0.197031333,54.3715599 8.87839274e-17,53.6602143 0,52.9352385 L-4.4408921e-16,7.06476152 C-7.1463071e-16,4.85562252 1.790861,3.06476152 4,3.06476152 C4.72497578,3.06476152 5.43632142,3.26179285 6.05798302,3.63478981 L44.2833805,26.5700283 C46.1777016,27.7066209 46.7919618,30.163662 45.6553692,32.057983 C45.3175701,32.6209814 44.8463789,33.0921727 44.2833805,33.4299717 Z" id="d2-d2-admin-text_Triangle-Copy" fill="#35495E" transform="translate(25.000000, 30.000000) rotate(-180.000000) translate(-25.000000, -30.000000) " />\n                    <path d="M60.2833805,33.4299717 L22.057983,56.3652102 C20.163662,57.5018028 17.7066209,56.8875426 16.5700283,54.9932215 C16.1970313,54.3715599 16,53.6602143 16,52.9352385 L16,7.06476152 C16,4.85562252 17.790861,3.06476152 20,3.06476152 C20.7249758,3.06476152 21.4363214,3.26179285 22.057983,3.63478981 L60.2833805,26.5700283 C62.1777016,27.7066209 62.7919618,30.163662 61.6553692,32.057983 C61.3175701,32.6209814 60.8463789,33.0921727 60.2833805,33.4299717 Z" id="d2-d2-admin-text_Triangle" fill="#409EFF" />\n                    <path d="M42.4688663,31.7973091 L24.0289915,42.8612339 C23.081831,43.4295303 21.8533105,43.1224001 21.2850141,42.1752396 C21.0985157,41.8644088 21,41.508736 21,41.1462481 L21,19.0183984 C21,17.9138289 21.8954305,17.0183984 23,17.0183984 C23.3624879,17.0183984 23.7181607,17.116914 24.0289915,17.3034125 L42.4688663,28.3673374 C43.4160268,28.9356337 43.7231569,30.1641542 43.1548606,31.1113147 C42.9859611,31.3928139 42.7503655,31.6284096 42.4688663,31.7973091 Z" id="d2-d2-admin-text_Triangle-Copy" fill="#FFFFFF" transform="translate(31.000000, 30.082670) rotate(-180.000000) translate(-31.000000, -30.082670) " />\n                    <path d="M37.5708451,30.8574929 L30.5144958,35.0913025 C30.0409155,35.3754507 29.4266552,35.2218856 29.1425071,34.7483054 C29.0492578,34.59289 29,34.4150536 29,34.2338096 L29,25.7661904 C29,25.2139056 29.4477153,24.7661904 30,24.7661904 C30.1812439,24.7661904 30.3590804,24.8154482 30.5144958,24.9086975 L37.5708451,29.1425071 C38.0444254,29.4266552 38.1979905,30.0409155 37.9138423,30.5144958 C37.8293925,30.6552454 37.7115947,30.7730432 37.5708451,30.8574929 Z" id="d2-d2-admin-text_Triangle" fill="#409EFF" />\n                </g>\n            </g>\n        </g>\n    </g>\n</symbol>'});i.a.add(r);e["default"]=r},ae81:function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("7db09"),a("b0c0"),a("2ef0")),o=a("d708");e["default"]={namespaced:!0,state:{list:Object(n["get"])(o["a"],"theme.list",[]),activeName:Object(n["get"])(o["a"],"theme.list[0].name","sqldev")},getters:{activeSetting:function(t){return t.list.find((function(e){return e.name===t.activeName}))}},actions:{set:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.commit,o=t.dispatch,s.activeName="string"===typeof e?e:s.list.find((function(t){return t.name===e.name}))?e.name:s.list[0].name,n("dom"),a.next=5,o("d2admin/db/set",{dbName:"sys",path:"theme.activeName",value:s.activeName,user:!0},{root:!0});case 5:case"end":return a.stop()}}),a)})))()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s,o,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.rootState,s=t.state,o=t.commit,i=t.dispatch,r=Object(n["get"])(a,"setting.theme.name"),r){e.next=6;break}return e.next=5,i("d2admin/db/get",{dbName:"sys",path:"theme.activeName",defaultValue:s.list[0].name,user:!0},{root:!0});case 5:r=e.sent;case 6:if(!s.list.find((function(t){return t.name===r}))){e.next=10;break}s.activeName=r,e.next=13;break;case 10:return s.activeName=s.list[0].name,e.next=13,i("d2admin/db/set",{dbName:"sys",path:"theme.activeName",value:s.activeName,user:!0},{root:!0});case 13:o("dom");case 14:case"end":return e.stop()}}),e)})))()}},mutations:{dom:function(t){document.body.className="theme-".concat(t.activeName)}}}},aeb0:function(t,e,a){"use strict";a("fefb")},af13:function(t,e,a){"use strict";a("36ff")},af4a:function(t,e,a){"use strict";a("1151")},af6c:function(t,e,a){"use strict";a("f79b")},affe:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("LDAP设置")])]),a("div",{staticClass:"text item"},[a("el-form",{ref:"ldapForm",staticStyle:{width:"600px"},attrs:{"label-suffix":":","label-width":"auto",model:t.ldapForm,rules:t.mailRules}},[a("el-form-item",{attrs:{label:"LDAP_URL",prop:"url"}},[a("el-input",{attrs:{placeholder:"域名 / ip:port",size:"mini"},model:{value:t.ldapForm.url,callback:function(e){t.$set(t.ldapForm,"url",e)},expression:"ldapForm.url"}})],1),a("el-form-item",{attrs:{label:"USE_LDAPS",prop:"ldaps"}},[a("el-checkbox",{staticClass:"ignore",attrs:{size:"mini"},model:{value:t.ldapForm.ldaps,callback:function(e){t.$set(t.ldapForm,"ldaps",e)},expression:"ldapForm.ldaps"}},[t._v(" 是 ")])],1),a("el-form-item",{attrs:{label:"LDAP_BASE_DN",prop:"user"}},[a("el-input",{attrs:{placeholder:"",size:"mini"},model:{value:t.ldapForm.user,callback:function(e){t.$set(t.ldapForm,"user",e)},expression:"ldapForm.user"}})],1),a("el-form-item",{attrs:{label:"LDAP_ADMIN_PASSWORD",prop:"password"}},[a("el-input",{attrs:{"show-password":"",size:"mini"},model:{value:t.ldapForm.password,callback:function(e){t.$set(t.ldapForm,"password",e)},expression:"ldapForm.password"}})],1),a("el-form-item",{attrs:{label:"LDAP_ACCOUNT_PATTERN",prop:"account_pattern"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.ldapForm.account_pattern,callback:function(e){t.$set(t.ldapForm,"account_pattern",e)},expression:"ldapForm.account_pattern"}})],1),a("el-form-item",{attrs:{label:"LDAP_ACCOUNT_BASE",prop:"account_base"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.ldapForm.account_base,callback:function(e){t.$set(t.ldapForm,"account_base",e)},expression:"ldapForm.account_base"}})],1),a("el-form-item",{attrs:{label:"ACCOUNT_FULL_NAME",prop:"account_full_name"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.ldapForm.account_full_name,callback:function(e){t.$set(t.ldapForm,"account_full_name",e)},expression:"ldapForm.account_full_name"}})],1),a("el-form-item",{attrs:{label:"ACCOUNT_EMAIL",prop:"account_email"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.ldapForm.account_email,callback:function(e){t.$set(t.ldapForm,"account_email",e)},expression:"ldapForm.account_email"}})],1),a("el-form-item",[a("el-button",{on:{click:t.onTestLdap}},[t._v("ldap测试")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmitLdap}},[t._v("保存")])],1)],1)],1)])],1)])],1)],1)},n=[],o={data:function(){return{form:{},filterText:"",ldapForm:{},smsForm:{},mailRules:{url:[{required:!0,message:"url不可为空!",trigger:"blur"}],user:[{required:!0,message:"账号不可为空!",trigger:"blur"}],password:[{required:!0,message:"密码不能为空!",trigger:"blur"}],account_pattern:[{required:!0,message:"LDAP_Search filter不能为空!",trigger:"blur"}],account_base:[{required:!0,message:"LDAP_SCBASE不能为空!",trigger:"blur"}]}}},methods:{onSubmitLdap:function(){var t=this;this.$refs.ldapForm.validate((function(e){if(console.log("........",e,t.ldapForm),!e)return!1;t.$api.post("/api/system/setting/ldap/update",t.ldapForm).then((function(){t.onSuccess("保存成功")}))}))},onTestLdap:function(){var t=this;this.$refs.ldapForm.validate((function(e){if(!e)return!1;t.$api.post("/api/system/setting/ldap/test",t.ldapForm).then((function(e){"fail"==e?t.$message.error("ldap测试失败"):t.$message.success("ldap测试成功")}))}))}},components:{},mounted:function(){var t=this;this.$api.setting.get().then((function(e){t.ldapForm=e.lcap_conf||{}}))}},i=o,r=(a("a06c"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},b02d:function(t,e,a){"use strict";a("0139")},b168:function(t,e,a){"use strict";a("ee5b")},b198:function(t,e,a){},b1a1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"权限组["+t.role.name+"]的申请记录",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/list","search-data":t.search,manual:!0},on:{reset:t.resetSearch}},[a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"}}),a("el-table-column",{attrs:{label:"申请理由",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核人",prop:"user_name"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过,原因:"+t._s(e.row.auditor_mark)+" ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{ids:"",role:{},isShow:!1,search:{source_type:"role"}}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search()},show:function(t){var e=this;this.role=t,this.search.source_id=t.id,this.search.source_type="role",this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onAdd:function(t){var e=this;this.$api.role.relation(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kick(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},b1b9:function(t,e,a){},b267:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据字段"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字过滤字段",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新 ")])],1),a("div",{staticClass:"role-column-list"},[t.dataList&&t.dataList.length>0?a("div",{staticClass:"item hbox-between no-user-select"},[a("div",{staticClass:"left"},[a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(e){return t.checkAllChangeHandler(e,!0)}},model:{value:t.isCheckAll,callback:function(e){t.isCheckAll=e},expression:"isCheckAll"}},[t._v("全选")])],1),a("div",{staticClass:"right"},[a("span",{staticClass:"pointer-active sn-font",attrs:{title:"批量读"},on:{click:function(e){return t.onAuth({id:"全部"},1)}}},[t._v("读")]),a("span",{staticClass:"pointer-active sn-font",attrs:{title:"批量写"},on:{click:function(e){(2==t.table.perm.rw||4==t.table.perm.rw)&&t.onAuth({id:"全部"},2)}}},[t._v("写")]),a("span",{staticClass:"pointer-active sn-font",attrs:{title:"批量管"},on:{click:function(e){e.stopPropagation(),4==t.owner.perm.rw&&t.onAuth({id:"全部"},4)}}},[t._v("管")]),a("span",{staticClass:"pointer-active sn-font",attrs:{title:"批量敏"},on:{click:function(e){return t.onAuth({id:"全部"},3)}}},[t._v("敏")])])]):t._e(),a("el-tree",{ref:"colList",attrs:{data:t.dataList,"node-key":"name","show-checkbox":!0,"default-checked-keys":t.def_checks,props:t.treeProps,"highlight-current":"","empty-text":"redis"==t.owner.db_type?"[redis] 没有字段":"请选择数据表","filter-node-method":t.filterNode},on:{"check-change":t.handleCheckChange},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("div",{staticClass:"item hbox-between"},[a("div",{staticClass:"left flex-over"},[a("span",{staticClass:"pointer-default",class:{"auth-read":1==n.perm.rw,"auth-write":2==n.perm.rw,"auth-disable":3==n.perm.rw,"auth-manage":4==n.perm.rw},attrs:{title:n.name}},[t._v(t._s(n.name))])]),a("div",{staticClass:"right no-user-select"},[a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==n.perm.rw},attrs:{title:"读"},on:{click:function(e){return t.onAuth(n,1)}}},[t._v("读")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-write":2==n.perm.rw},attrs:{title:"写"},on:{click:function(e){return t.onAuth(n,2)}}},[t._v("写")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-manage":4==n.perm.rw},attrs:{title:"管"},on:{click:function(e){return e.stopPropagation(),t.onAuth(n,4)}}},[t._v("管")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-disable":3==n.perm.rw},attrs:{title:"敏"},on:{click:function(e){return t.onAuth(n,3,s)}}},[t._v("敏")])])])}}])})],1),a("dialog-mask",{ref:"maskDialog",attrs:{role:t.role,owner:t.owner,table:t.table},on:{"refresh-column":t.onRefreshColumn}})],2)},n=[],o=(a("4de4"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2ef0")),i=a("5bf4"),r={data:function(){return{isCheckAll:!1,isIndeterminate:!1,filterText:"",loading:!1,dataList:[],def_checks:[],nodeAllKeys:[],treeProps:{id:"name",label:"name",isLeaf:"leaf"}}},props:{role:{},owner:{},table:{},type:{type:String,default:""},project_id:{}},computed:{isShowRw:function(){return function(t,e){var a=Object(o["get"])(t,"parentNode.perm.rw");return 4==a||a==e||3===a&&3==e||(2==a&&e<=2||"敏"==e&&3!=a)}}},watch:{table:{handler:function(t){console.log("[column.list watch] table 刷新",t),this.refresh()}},filterText:function(t){this.$refs.colList.filter(t)}},methods:{checkAllChangeHandler:function(t,e){if(console.log("触发全选、反选",t,e),e)t?this.$refs.colList.setCheckedKeys(this.nodeAllKeys):this.$refs.colList.setCheckedKeys([]);else{var a=this.$refs.colList.getCheckedKeys(),s=this.nodeAllKeys.filter((function(t){return-1==a.indexOf(t)}));if(console.log("反选差集：",s),this.$refs.colList.setCheckedKeys(s),s.length==this.nodeAllKeys.length)return void(this.isCheckAll=!0);this.isCheckAll=!1}},handleCheckChange:function(t,e){console.log(t,e);var a=this.$refs.colList.getCheckedKeys();console.log("id:",t,a.length,this.nodeAllKeys.length),this.isCheckAll=0!==a.length&&a.length===this.nodeAllKeys.length,this.isIndeterminate=a.length>0&&a.length<this.nodeAllKeys.length},filterNode:function(t,e){return!t||(console.log("data.label:",e.label,"  value:",t),-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))},onRefreshColumn:function(){this.refresh()},refresh:function(){var t=this;if(this.def_checks=[],this.role.id&&this.owner.name&&this.type&&this.table&&this.table.name){this.loading=!0;var e={id:this.owner.perm.dbId,db_type:this.owner.db_type,owner:this.owner.name,table:this.table.name,project:this.project_id,object_type:this.type,node_type:"column",role_id:this.role.id,parentNode:this.table};this.$api.permission.subNodes(e).then((function(e){t.dataList=e.List||[];var a=[];if(t.dataList)for(var s=0;s<t.dataList.length;s++)a.push(t.dataList[s].name);t.nodeAllKeys=a,t.isCheckAll=!1})).finally((function(){t.loading=!1,console.log("this.dataList: 数据字段",t.dataList)}))}else this.dataList=[]},addColPerm:function(t,e,a){return this.$api.permission.addColumn(this.role.id,this.owner.perm.dbId,this.owner.name,this.table.name,t,{},e,"","",a)},onAuth:function(t,e){var a=this;if((3==this.owner.perm.rw||1==this.table.perm.rw)&&3!=e)return this.$message.error("父级权限不支持该操作！");if(!(1!=this.owner.perm.rw&&1!=this.table.perm.rw||2!=e&&4!=e))return this.$message.error("父级权限不支持该操作！");if(-1==this.owner.perm.rw)return this.$message.error("父级权限不支持该操作！");if((2==this.owner.perm.rw||2==this.table.perm.rw)&&4==e)return this.$message.error("父级权限不支持该操作！");var s=this.$refs.colList.getCheckedKeys(),n=!1;if("全部"==t.id&&(n=!0),0==s.length&&n)this.$message({message:"请勾选数据字段",type:"warning"});else if(3!=e)if(s.length>1&&n){for(var o=[],i=0;i<s.length;i++)"全部"!=s[i]&&o.push(this.addColPerm(s[i],e,this.project_id));Promise.all(o).then((function(){var t="操作成功";3==e?t="设置禁用成功":1==e?t="设置只读成功":2==e?t="设置读写成功":-1==e&&(t="取消设置成功");for(var s=a.$refs.colList.getCheckedNodes(),n=0;n<s.length;n++)s[n].perm.rw=e,console.log("node:",s[n]);a.onSuccess(t)}))}else this.addColPerm(t.name,e,this.project_id).then((function(){t.perm.rw=e;var s="操作成功";3==e?s="设置禁用成功":1==e?s="设置只读成功":2==e?s="设置读写成功":-1==e&&(s="取消设置成功"),a.onSuccess(s)}));else this.$refs.maskDialog.show(this.dataList,t,s,n,this.project_id,this.type)}},components:{DialogMask:i["default"]},mounted:function(){this.def_checks=[]}},l=r,c=(a("3e9e"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},b380:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.log,size:"mini","empty-text":"暂无日志信息",stripe:""}},[a("el-table-column",{attrs:{prop:"time",label:"Time",width:"140"}}),a("el-table-column",{attrs:{prop:"message",label:"Message"}}),a("el-table-column",{attrs:{label:"Url",align:"center","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.get(e.row,"meta.url"))+" ")]}}])}),a("el-table-column",{attrs:{label:"Tag",align:"center","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.get(e.row,"meta.instance.$vnode.componentOptions.tag")?a("el-tag",{attrs:{type:"info",size:"mini"}},[t._v(" <"+t._s(t.get(e.row,"meta.instance.$vnode.componentOptions.tag"))+"> ")]):t._e()]}}])}),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"More",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handleShowMore(e.row)}}},[a("d2-icon",{attrs:{name:"eye"}})],1)]}}])})],1)],1)},n=[],o=a("5530"),i=a("2f62"),r=a("2ef0"),l={data:function(){return{uploading:!1}},computed:Object(o["a"])({},Object(i["e"])("d2admin/log",["log"])),methods:{get:r["get"],handleShowMore:function(t){this.$notify({type:"info",title:"日志详情",message:"完整的日志内容已经打印到控制台"}),this.$log.capsule("SQLDEV","handleShowMore","primary"),console.group(t.message),console.log("time: ",t.time),console.log("type: ",t.type),console.log(t.meta),console.groupEnd()},handleUpload:function(){var t=this;this.uploading=!0,this.$notify({type:"info",title:"日志上传",message:"开始上传".concat(this.log.length,"条日志")}),setTimeout((function(){t.uploading=!1,t.$notify({type:"success",title:"日志上传",message:"上传成功"})}),3e3)}}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},b3e3:function(t,e,a){"use strict";a("7a96")},b4ae:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container shadow"},[t._m(0),a("div",{staticClass:"body"},[a("h3",{staticClass:"error-msg"},[t._v(t._s(t.msg))]),t._m(1)])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ali-center"},[a("img",{staticClass:"logo",attrs:{src:"/static/image/sqldev.png"}}),a("h4",[t._v("企业数据安全访问系统")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"site-link"},[a("a",{attrs:{href:"http://www.shuaninfo.com",target:"_blank"}},[t._v("树安官网")])])}],o=a("5530"),i=a("2f62"),r={data:function(){var t=this.$route.query;return{msg:t.msg||""}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getCaptcha:function(){var t=this;this.$api.get("/api/captcha").then((function(e){var a=e.id,s=e.img;t.formData.captcha=s,t.formData.captcha_id=a}))},onSubmit:function(){}},mounted:function(){window.parent&&(window.parent.location.href=window.location.href)}},l=r,c=(a("43ca"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},b4c7:function(t,e,a){"use strict";a("5514")},b4f2:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-work",use:"d2-work-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-work"><path d="M907.4 133.9H702V70.1H322v63.8H114.9v820H909.2v-820h-1.8zM362 110.1h300v120H362v-120z m507.2 803.8H154.8v-740H322v96.2h380v-96.2h167.2v740zM762 401v40H262v-40h500zM262 537.2h500v40H262v-40z m0 136.2h500v40H262v-40z" fill="" p-id="16449" /></symbol>'});i.a.add(r);e["default"]=r},b55f:function(t,e,a){"use strict";var s=a("c276");e["a"]={methods:{handleMenuSelect:function(t,e){/^d2-menu-empty-\d+$/.test(t)||void 0===t?this.$message.warning("临时菜单"):/^https:\/\/|http:\/\//.test(t)?s["a"].open(t):this.$router.push({path:t})}}}},b58b:function(t,e,a){"use strict";a("8563")},b591:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editor-container"},[a("pre",{staticClass:"editor monaco-editor work-sql-monaco-x1",staticStyle:{"min-height":"200px"}}),a("span",{staticStyle:{float:"right","fonst-size":".8rem",color:"red"}},[t._v("这里可拖动大小↑")])])}],o={data:function(){return{editor:null}},props:{formData:{}},watch:{formData:function(t){t&&(console.log("==============22222========================="),this.init(t.sql))}},computed:{},methods:{refresh:function(t){this.init(t)},init:function(t){if(this.editor)this.editor.setValue(t);else{var e=this.$el.getElementsByClassName("work-sql-monaco-x1")[0];this.editor=monaco.editor.create(e,{value:t,language:"sql",theme:"vs",automaticLayout:!0,selectionHighlight:!0,wordWrap:"on",readOnly:!0,scrollbar:{useShadows:!1,verticalHasArrows:!0,horizontalHasArrows:!0,vertical:"hidden",horizontal:"hidden",verticalScrollbarSize:0,horizontalScrollbarSize:17,arrowSize:30}})}}},mounted:function(){console.log("mounted:"),this.init(this.formData.sql)},components:{}},i=o,r=(a("a3ee"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"12dc5df4",null);e["default"]=l.exports},b5a4:function(t,e,a){"use strict";a("5973")},b61e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sql-query-tool-table"},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.isShow=!0}}},[t._v("表格设置")]),a("el-dialog",{attrs:{title:"表格设置",visible:t.isShow,width:"400px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.config,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"锁表头"}},[a("el-checkbox",{model:{value:t.config.lockHead,callback:function(e){t.$set(t.config,"lockHead",e)},expression:"config.lockHead"}})],1),a("el-form-item",{attrs:{label:"表高度"}},[a("el-input-number",{attrs:{min:150},model:{value:t.config.height,callback:function(e){t.$set(t.config,"height",e)},expression:"config.height"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.isShow=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){var t=window.localStorage.getItem("tableConfig");return{isShow:!1,config:t?JSON.parse(t):{lockHead:!1,height:150}}},computed:{},props:{},watch:{config:function(t){window.localStorage.setItem("tableConfig",JSON.stringify(t))}},methods:{onSubmit:function(){}},components:{},mounted:function(){}},i=o,r=(a("d3ee"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},b628:function(t,e,a){},b758:function(t,e,a){},b85b:function(t,e,a){},b8a6:function(t,e,a){},b919:function(t,e,a){"use strict";a("ceeb")},b93e:function(t,e,a){"use strict";a("3000")},b982:function(t,e,a){"use strict";a.r(e),a.d(e,"KeyMod",(function(){return s})),a.d(e,"KeyCode",(function(){return n}));var s={CtrlCmd:2048,ctrlcmd:2048,meta:2048,Meta:2048,ctrl:2048,command:2048,cmd:2048,Shift:1024,shift:1024,Alt:512,alt:512,WinCtrl:256,winctrl:256},n={unknown:0,backspace:1,tab:2,enter:3,shift:4,ctrl:5,alt:6,pauseBreak:7,pause:7,capsLock:8,escape:9,space:10,end:13,home:14,arrowleft:15,arrowup:16,arrowright:17,arrowdown:18,insert:19,delete:20,0:21,1:22,2:23,3:24,4:25,5:26,6:27,7:28,8:29,9:30,a:31,b:32,c:33,d:34,e:35,f:36,g:37,h:38,i:39,j:40,k:41,l:42,m:43,n:44,o:45,p:46,q:47,r:48,s:49,t:50,u:51,v:52,w:53,x:54,y:55,z:56,meta:57,contextMenu:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:69,f12:70,f13:71,f14:72,f15:73,f16:74,f17:75,f18:76,f19:77,numLock:78,scrollLock:79,US_SEMICOLON:80,";":80,":":80,US_EQUAL:81,"=":81,"+":81,US_COMMA:82,",":82,"<":82,US_MINUS:83,"-":83,_:83,US_DOT:84,".":84,">":84,US_SLASH:85,"/":85,"?":85,US_BACKTICK:86,"~":86,"`":86,US_OPEN_SQUARE_BRACKET:87,"[":87,"{":87,US_BACKSLASH:88,"\\":"88","|":"88",US_CLOSE_SQUARE_BRACKET:89,"]":"89","}":"89",US_QUOTE:90,"'":90,'"':90,OEM_8:91,OEM_102:92,NUMPAD_0:93,NUMPAD_1:94,NUMPAD_2:95,NUMPAD_3:96,NUMPAD_4:97,NUMPAD_5:98,NUMPAD_6:99,NUMPAD_7:100,NUMPAD_8:101,NUMPAD_9:102,NUMPAD_MULTIPLY:103,NUMPAD_ADD:104,NUMPAD_SEPARATOR:105,NUMPAD_SUBTRACT:106,NUMPAD_DECIMAL:107,NUMPAD_DIVIDE:108,KEY_IN_COMPOSITION:109,ABNT_C1:110,ABNT_C2:111,MAX_VALUE:112}},b99b:function(t,e,a){},b9c0:function(t,e,a){"use strict";a("37f8")},b9f3:function(t,e,a){var s={"./account.js":"e7e2","./color.js":"6d5a","./db.js":"7308","./fullscreen.js":"3b3e","./gray.js":"69a2","./log.js":"391b","./menu.js":"39fd","./page.js":"64c0","./releases.js":"4948","./search.js":"3ec1","./size.js":"6894","./theme.js":"ae81","./transition.js":"09ec","./ua.js":"f19a","./user.js":"fda1"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="b9f3"},ba5d:function(t,e,a){"use strict";a("dc74")},ba8c:function(t,e,a){},bb03:function(t,e,a){"use strict";a("fb78")},bb12:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-d2-admin",use:"d2-d2-admin-usage",viewBox:"0 0 60 54",content:'<symbol viewBox="0 0 60 54" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="d2-d2-admin">\n    <desc>D2Admin</desc>\n    <defs></defs>\n    <g id="d2-d2-admin_Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="d2-d2-admin_logo-no-shadow" transform="translate(-3.000000, -3.000000)">\n            <path d="M44.2833805,33.4299717 L6.05798302,56.3652102 C4.16366196,57.5018028 1.70662094,56.8875426 0.570028297,54.9932215 C0.197031333,54.3715599 8.87839274e-17,53.6602143 0,52.9352385 L-4.4408921e-16,7.06476152 C-7.1463071e-16,4.85562252 1.790861,3.06476152 4,3.06476152 C4.72497578,3.06476152 5.43632142,3.26179285 6.05798302,3.63478981 L44.2833805,26.5700283 C46.1777016,27.7066209 46.7919618,30.163662 45.6553692,32.057983 C45.3175701,32.6209814 44.8463789,33.0921727 44.2833805,33.4299717 Z" id="d2-d2-admin_Triangle-Copy" fill="#35495E" transform="translate(25.000000, 30.000000) rotate(-180.000000) translate(-25.000000, -30.000000) " />\n            <path d="M60.2833805,33.4299717 L22.057983,56.3652102 C20.163662,57.5018028 17.7066209,56.8875426 16.5700283,54.9932215 C16.1970313,54.3715599 16,53.6602143 16,52.9352385 L16,7.06476152 C16,4.85562252 17.790861,3.06476152 20,3.06476152 C20.7249758,3.06476152 21.4363214,3.26179285 22.057983,3.63478981 L60.2833805,26.5700283 C62.1777016,27.7066209 62.7919618,30.163662 61.6553692,32.057983 C61.3175701,32.6209814 60.8463789,33.0921727 60.2833805,33.4299717 Z" id="d2-d2-admin_Triangle" fill="#409EFF" />\n            <path d="M42.4688663,31.7973091 L24.0289915,42.8612339 C23.081831,43.4295303 21.8533105,43.1224001 21.2850141,42.1752396 C21.0985157,41.8644088 21,41.508736 21,41.1462481 L21,19.0183984 C21,17.9138289 21.8954305,17.0183984 23,17.0183984 C23.3624879,17.0183984 23.7181607,17.116914 24.0289915,17.3034125 L42.4688663,28.3673374 C43.4160268,28.9356337 43.7231569,30.1641542 43.1548606,31.1113147 C42.9859611,31.3928139 42.7503655,31.6284096 42.4688663,31.7973091 Z" id="d2-d2-admin_Triangle-Copy" fill="#FFFFFF" transform="translate(31.000000, 30.082670) rotate(-180.000000) translate(-31.000000, -30.082670) " />\n            <path d="M37.5708451,30.8574929 L30.5144958,35.0913025 C30.0409155,35.3754507 29.4266552,35.2218856 29.1425071,34.7483054 C29.0492578,34.59289 29,34.4150536 29,34.2338096 L29,25.7661904 C29,25.2139056 29.4477153,24.7661904 30,24.7661904 C30.1812439,24.7661904 30.3590804,24.8154482 30.5144958,24.9086975 L37.5708451,29.1425071 C38.0444254,29.4266552 38.1979905,30.0409155 37.9138423,30.5144958 C37.8293925,30.6552454 37.7115947,30.7730432 37.5708451,30.8574929 Z" id="d2-d2-admin_Triangle" fill="#409EFF" />\n        </g>\n    </g>\n</symbol>'});i.a.add(r);e["default"]=r},bb52:function(t,e,a){},bbaa:function(t,e,a){},bbaa5:function(t,e,a){},bbba:function(t,e,a){"use strict";a("704f")},bbbb:function(t,e,a){"use strict";a("faad")},bc16:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/ssh/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"来访ip",prop:"client_ip"}},[a("el-input",{model:{value:t.search.client_ip,callback:function(e){t.$set(t.search,"client_ip",e)},expression:"search.client_ip"}})],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"machine_id",label:"主机id"}}),a("el-table-column",{attrs:{prop:"machine_name",label:"主机名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.machine_name?e.row.machine_name:"主机信息已删除")+" ")]}}])}),a("el-table-column",{attrs:{prop:"user_id",label:"用户id"}}),a("el-table-column",{attrs:{prop:"client_ip",label:"来访ip"}}),a("el-table-column",{attrs:{prop:"started_at",label:"开始时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.started_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"end_at",label:"结束时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.end_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"会话时长"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{textContent:t._s(t.sessionDuration(e.row))}})]}}])}),a("el-table-column",{attrs:{label:"审计状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{textContent:t._s(t.showStatus(e.row.status))}})]}}])}),a("el-table-column",{attrs:{label:"是否编辑文件"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{textContent:t._s(e.row.has_editor?"是":"否")}})]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{title:"open terminal",type:"primary",size:"mini"},on:{click:function(a){return t.onViewTermLog(e.row)}}},[t._v("日志详情 ")])]}}])})],1)],2),a("dialog-term-log",{ref:"logDialog"})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("1276"),a("5fc3")),r=a("c1df"),l=a.n(r),c={components:{DialogTermLog:i["default"]},name:"ViewSshLog",data:function(){return{search:{client_ip:"",start:"",end:"",dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]},form:{log:""},range:[],q:{client_ip:""},termVisible:!1,formTitle:"机器添加",total:0,page:1,size:10,tableData:[]}},computed:{user:function(){return this.$store.state.user},email:function(){return this.$store.getters.userEmail},isAdmin:function(){return this.$store.getters.userIsAdmin},user_id:function(){return parseInt(this.$route.query.user_id)||0},machine_id:function(){return parseInt(this.$route.query.machine_id)||0},searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},mounted:function(){},created:function(){},methods:{onDel:function(t){var e=this;this.$api.ssh.deleteLog({id:t}).then((function(){e.refresh()}))},onViewTermLog:function(t){this.$refs.logDialog.show(t)},resetSearch:function(){console.log("========resetSearch========="),this.search={}},refresh:function(){this.$refs.st.search()},showStatus:function(t){console.log("status:",t);var e="未标记";switch(t){case 1:e="失败";break;case 2:e="正常";break;case 4:e="警告";break;case 8:e="危险";break;case 16:e="致命";break;case 32:e="Editor";break}return e},sessionDuration:function(t){var e=Date.parse(t.started_at),a=Date.parse(t.end_at),s=a-e;return"".concat(Math.round(s/1e3),"s")},countLogLineCount:function(t){return t.log.split("\n").length},doCreate:function(){this.form={id:0,cate:2,ssh_port:22},this.formTitle=this.$t("machineAddTitle")},pageChange:function(t){this.page=t,this.fetchAllSshLog()},sizeChange:function(t){this.page=1,this.size=t,this.fetchAllSshLog()},fetchAllSshLog:function(){var t=this,e=this.q;2===this.range.length&&(e.from_time=this.range[0],e.to_time=this.range[1]),e.page=this.page,e.size=this.size,e.user_id=this.user_id,e.machine_id=this.machine_id,this.$http.get("/api/ssh-log",{params:e}).then((function(e){e&&(t.total=e.total,t.size=e.size,t.page=e.page,t.tableData=e.data)}))},doDelete:function(t){var e=this;this.$http.delete("/api/ssh-log/".concat(t.id)).then((function(t){t&&(e.fetchAllSshLog(),e.$message.success(t.msg))}))}}},u=c,d=a("2877"),p=Object(d["a"])(u,s,n,!1,null,"472ba4c6",null);e["default"]=p.exports},bd1d:function(t,e,a){"use strict";a("9766")},bd88:function(t,e,a){},bd95:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-setting-security",use:"d2-setting-security-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-setting-security"><path d="M502.88 251.84a135.52 135.52 0 0 0-29.92 267.52v156.8a29.76 29.76 0 1 0 59.52 0v-156.8a135.52 135.52 0 0 0-29.44-267.52z m0 211.2a75.84 75.84 0 1 1 75.84-75.84 76 76 0 0 1-75.84 75.84z" p-id="31729" /><path d="M869.12 148.16a896 896 0 0 1-92-9.12A655.04 655.04 0 0 1 530.56 32a46.08 46.08 0 0 0-27.52-8.96h-8.96A48 48 0 0 0 466.56 32 652.48 652.48 0 0 1 220 139.04a889.6 889.6 0 0 1-92 9.12 48 48 0 0 0-44.8 48V528c0 46.88 22.72 110.72 64 180v0.96a747.68 747.68 0 0 0 153.28 185.6c68 58.56 136 89.44 196.8 89.44h1.28c60.48 0 128-30.88 196.64-89.44a759.36 759.36 0 0 0 153.12-185.44v-1.28c41.44-69.12 64-133.28 64-180V195.52a48 48 0 0 0-43.2-47.36zM201.28 679.52a21.12 21.12 0 0 0-2.56-4v-0.96l-2.72-4.48c-30.88-53.28-48-101.28-48-131.52V209.6a638.24 638.24 0 0 0 85.28-11.36c80-12.48 191.04-40.8 266.4-105.76 75.36 64.8 185.92 93.28 266.24 105.76a695.52 695.52 0 0 0 85.28 11.52v328.96c0 30.24-17.6 78.08-48 131.36l-2.72 4.64v0.96a21.6 21.6 0 0 0-2.4 4.16l-2.88 4.48a776.16 776.16 0 0 1-81.76 109.12v0.8c-74.88 80-153.92 128-211.2 128s-136.8-48-211.68-128v-0.8l-3.04-2.88a762.08 762.08 0 0 1-78.4-104.96l-3.68-6.4z" p-id="31730" /></symbol>'});i.a.add(r);e["default"]=r},bda3:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-redis-info",attrs:{title:"提示",visible:t.visible,"min-width":"600px",width:"90%"},on:{"update:visible":function(e){t.visible=e},close:t.closeHandle}},[a("div",{staticClass:"main"},[a("header",[a("span",{staticClass:"item type"},[t._v(t._s(t.tableData.type))]),t._v(": "),a("span",{staticClass:"item key"},[t._v(t._s(t.tableData.key))]),t._v(" "),a("span",{staticClass:"item ttl"},[t._v("TTL: "+t._s(t.tableData.ttl))])]),a("el-table",{ref:"tables",staticClass:"margin-top-12 dialog-redis-info-table",staticStyle:{width:"100%"},attrs:{border:"","header-cell-style":{background:"#f0f0f0"},data:t.tableData.list||[],stripe:!0,"default-sort":{prop:"index",order:"descending"},"highlight-current-row":""},on:{"row-click":t.rowClickHandle}},[t.tableData.headList&&t.tableData.headList.length>0?[a("el-table-column",{attrs:{sortable:"",type:"index",label:"序号",width:"60"}}),t._l(t.tableData.headList,(function(t,e){return[a("el-table-column",{key:e,attrs:{sortable:"",prop:t,label:t}})]}))]:t._e()],2),a("footer",{staticClass:"margin-top-12"},[t.currentRow.key?a("div",[t._v("key")]):t.currentRow.score?a("div",[t._v("score")]):t.currentRow.id?a("div",[t._v("id")]):t._e(),t.currentRow.key||t.currentRow.score||t.currentRow.id?a("div",{staticClass:"key"},[t._v(" "+t._s(t.currentRow.key||t.currentRow.score||t.currentRow.id)+" ")]):t._e(),a("div",{staticClass:"margin-top-12"},[t._v("值")]),a("el-input",{staticClass:"value",attrs:{type:"textarea",rows:10,placeholder:"请输入内容"},model:{value:t.currentRow.value,callback:function(e){t.$set(t.currentRow,"value",e)},expression:"currentRow.value"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取 消")])],1)])},n=[],o=a("5530"),i=(a("b0c0"),a("163b")),r=a("2f62"),l={computed:Object(o["a"])({},Object(r["e"])(["runList","runActive"])),data:function(){return{visible:!1,tableName:"",dbType:"redis",tableData:{},currentRow:{key:"未选择",value:""}}},methods:{closeHandle:function(){this.tableData={},this.currentRow={key:"未选择",value:""},this.tableName=""},rowClickHandle:function(t){this.$refs.tables.setCurrentRow(t),this.currentRow=t},show:function(t){this.tableName=t,this.visible=!0,this.load()},load:function(){var t=this,e=this.runList[this.runActive],a={id:e.id,dbType:e.dbType};console.log("[dialog.table methods] info 表定义：",e.name,a),this.$api.table.info(a,e.name,this.tableName,"struct").then((function(e){t.convart(e.info)}))},convart:function(t){if(i["a"].contains(t,["KEY","TTL","TYPE","VALUE"])){var e=this.convartResult(t);console.log("转换： ",e),this.tableData={key:t.KEY,ttl:t.TTL,type:t.TYPE,list:e.list,headList:e.headList}}else console.error("[dialog.redis.info methods] _convart：",t)},convartResult:function(t){var e=[],a=[],s=t.VALUE&&t.VALUE.length>0&&t.VALUE[0].Result;if("hash"==t.TYPE||"zset"==t.TYPE){if(a="hash"==t.TYPE?["key","value"]:["value","score"],s)for(var n=t.VALUE[0].Result,o=0;o<n.length;o+=2){var i=null;i="hash"==t.TYPE?{key:n[o],value:n[o+1]}:{value:n[o],score:n[o+1]},e.push(i)}}else if(s)if(a=["value"],"set"==t.TYPE){var r=t.VALUE[0].Result;for(var l in r)e.push({value:r[l]})}else{var c=t.VALUE;for(var u in c)e.push({value:c[u].Result})}return{list:e,headList:a}}}},c=l,u=(a("6fae"),a("9bc0"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"214d545b",null);e["default"]=d.exports},bdf1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"pages-funs-work padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/project/work/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"工单状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.work_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{type:"expand",width:"40"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{attrs:{"label-position":"left","label-width":"50px"}},[a("el-form-item",{attrs:{label:"SQL"}},[e.row.sql&&e.row.sql.length>3e3?a("strong",{staticClass:"sql"},[t._v(" SQL语句过长，请在详情查看 ")]):a("pre",{staticClass:"sql"},[t._v("                 "+t._s(e.row.sql)+"\n              ")])])],1)]}}])}),a("el-table-column",{attrs:{label:"编号",prop:"id",width:"120"}}),a("el-table-column",{attrs:{label:"工单名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{"font-weight":"bold"},attrs:{size:"mini",type:"text",title:e.row.name},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v(" "+t._s(e.row.name)+" ")])]}}])}),a("el-table-column",{attrs:{label:"类型",prop:"type","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{title:t.showWorkType(e.row.type)}},[t._v(t._s(t.showWorkType(e.row.type)))])]}}])}),a("el-table-column",{attrs:{label:"发起人",prop:"create_name"}}),a("el-table-column",{attrs:{label:"发起项目",prop:"project_name"}}),a("el-table-column",{attrs:{label:"工单状态",prop:"status","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showTagType(e.row.status)}},[t._v(t._s(t.showStatus(e.row.status)))])]}}])}),a("el-table-column",{attrs:{label:"发起时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"目标数据源",prop:"db_name"}}),a("el-table-column",{attrs:{label:"目标数据库",prop:"owner"}}),a("el-table-column",{attrs:{label:"是否备份"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.back_up?a("span",{attrs:{type:"success"}},[t._v("是")]):a("span",{attrs:{type:"info"}},[t._v("否")])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v("详情 ")]),1==e.row.back_up&&6==e.row.status?a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkBackUp(e.row)}}},[t._v("备份 ")]):t._e()]}}])})],1)],2),a("div",{staticStyle:{height:"150px"}}),a("dialog-backup",{ref:"backupDialog"})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("096f"),l={components:{DialogBackup:r["default"]},computed:Object(o["a"])({},Object(i["c"])(["showWorkType"])),data:function(){return{formData:{name:""},id:this.$route.params.id,search2:{db_type:null,project:this.$route.params.id,status:-1},search:{db_type:null,project:this.$route.params.id,status:-1},work_states:[{k:-1,v:"全部"},{k:0,v:"待审核"},{k:1,v:"审核通过"},{k:2,v:"审核不通过"},{k:3,v:"人工终止流程"},{k:4,v:"定时执行"},{k:5,v:"执行中"},{k:68,v:"执行成功"},{k:7,v:"执行失败"}],status_types:[{k:"0",v:"全部"},{k:"1",v:"待审核"},{k:"2",v:"已通过"},{k:"3",v:"未通过"}]}},props:{},watch:{},methods:{showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$bus.emit("work-detail-show",t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={status:-1,project:this.id}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},openWork:function(t){this.$refs.workDialog.show(t)},init:function(){},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}}},c=l,u=(a("6a2f"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},be29:function(t,e,a){"use strict";a("4bd03")},be4f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.formData.id?"修改用户":"新增用户",visible:t.isShow,width:"700px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"90px"}},[a("el-form-item",{attrs:{label:"账号",rules:[{required:!0}]}},[a("el-input",{attrs:{disabled:!!t.formData.id,placeholder:"登录账号（必填）"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"姓名",rules:[{required:!0}]}},[a("el-input",{attrs:{placeholder:"姓名（必填）"},model:{value:t.formData.user_name,callback:function(e){t.$set(t.formData,"user_name",e)},expression:"formData.user_name"}})],1),a("el-form-item",{attrs:{label:"性别",prop:"sex"}},[a("el-radio-group",{model:{value:t.formData.sex,callback:function(e){t.$set(t.formData,"sex",e)},expression:"formData.sex"}},[a("el-radio",{attrs:{label:1}},[t._v("男")]),a("el-radio",{attrs:{label:2}},[t._v("女")])],1)],1),a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{attrs:{type:"email",placeholder:"邮箱地址"},model:{value:t.formData.email,callback:function(e){t.$set(t.formData,"email",e)},expression:"formData.email"}})],1),a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{attrs:{text:"tel",maxlength:"11",placeholder:"手机号码"},model:{value:t.formData.telno,callback:function(e){t.$set(t.formData,"telno",e)},expression:"formData.telno"}})],1),t.formData.id?t._e():a("el-form-item",{attrs:{label:"密码",rules:[{required:!0}]}},[a("el-input",{attrs:{type:"password",placeholder:"密码（必填）"},model:{value:t.formData.pwd,callback:function(e){t.$set(t.formData,"pwd",e)},expression:"formData.pwd"}})],1),a("el-form-item",{attrs:{label:"系统角色",rules:[{required:!0}]}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:t.formData.role,callback:function(e){t.$set(t.formData,"role",e)},expression:"formData.role"}},[1==t.user.role?[a("el-option",{attrs:{label:"安全管理员 | 审计日志、统计信息、报表等",value:2}}),a("el-option",{attrs:{label:"审计管理员 | 查看操作日志",value:3}}),a("el-option",{attrs:{label:"系统管理员 | 许可证书、系统维护、通知、警告等",value:4}}),a("el-option",{attrs:{label:"普通用户",value:9}})]:2==t.user.role?[a("el-option",{attrs:{label:"普通用户",value:9}})]:t._e()],2)],1),a("el-form-item",{attrs:{label:"有效期"}},[a("el-checkbox",{model:{value:t.expire_flag,callback:function(e){t.expire_flag=e},expression:"expire_flag"}},[t._v("永久")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.expire_flag,expression:"!expire_flag"}],attrs:{label:"到期时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择到期时间"},model:{value:t.expire_time,callback:function(e){t.expire_time=e},expression:"expire_time"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o=a("5530"),i=a("c1df"),r=a.n(i),l=a("2f62"),c=a("5c96"),u={data:function(){return{isShow:!1,expire_flag:!0,expire_time:null,formData:{roles:""},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["e"])(["user"])),methods:{showTime:function(t){return r()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:"",roles_str:""}},show:function(t){var e=this;this.id=t?t.id:null,this.id?this.$api.user.info(t.id).then((function(t){e.formData=t,-1==t.expire?e.expire_flag=!0:(e.expire_flag=!1,e.expire_time=e.showTime(t.expire)),e.isShow=!0})):(this.formData=this.reset(),this.isShow=!0)},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;if(!this.formData.role)return this.$message.error("系统角色为空，请选择！"),!1;if(console.log("this.formData: ",this.formData),this.expire_flag)this.formData.expire=-1;else{if(!this.expire_time)return void c["Message"].error({title:"提示",message:"请输入失效时间。",type:"error",duration:2e3});this.formData.expire=this.expire_time.getTime()}if(!this.formData.telno||11==this.formData.telno.length&&/^(13|14|15|16|17|18|19)\d{9}$/g.test(this.formData.telno)){var e=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;!this.formData.email||e.test(this.formData.email)?this.$api.user.edit(this.formData).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")})):c["Message"].error({title:"提示",message:"邮箱地址格式不正确。",type:"error",duration:2e3})}else c["Message"].error({title:"提示",message:"手机号码格式不正确。",type:"error",duration:2e3})}},mounted:function(){},components:{}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},be97:function(t,e,a){},bf56:function(t,e,a){},bfc9:function(t,e,a){},c029:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"log"},[a("k-search-table",{ref:"st",attrs:{url:"/api/sys/report/stat","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"执行状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.state,callback:function(e){t.$set(t.search,"state",e)},expression:"search.state"}},t._l(t.states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"操作类型:"}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.task_type,callback:function(e){t.$set(t.search,"task_type",e)},expression:"search.task_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{label:"排序规则:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.order_by,callback:function(e){t.$set(t.search,"order_by",e)},expression:"search.order_by"}},t._l(t.orderbys,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{staticClass:"add-btn",attrs:{type:"primary"},on:{click:t.onExport}},[t._v("导出")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"user_name",label:"用户名"}}),a("el-table-column",{attrs:{prop:"hits",label:"执行次数"}}),a("el-table-column",{attrs:{label:"数据行数",prop:"data_count"}})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{instances:[],states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],orderbys:[{k:0,v:"按执行次数排序"},{k:1,v:"按数据总量顺序"}],types:[{k:1,v:"异步"},{k:2,v:"导出文件"},{k:3,v:"导出SQL"},{k:11,v:"查询"},{k:12,v:"更新"},{k:13,v:"插入"},{k:14,v:"删除"},{k:99,v:"其他"}],search:{ip:"",start:"",end:"",type:this.defaultType,owner:"",order_by:0,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}}},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),props:{defaultType:{}},watch:{},methods:{onDownload:function(t){var e=window.localStorage.getItem("token");this.$api.download("/api/download/export/excel",{id:t,access_token:e})},onExport:function(){var t=this,e=Object(o["a"])({},this.search);e.dateRange&&(e.start=l()(e.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),e.end=l()(e.dateRange[1]).format("YYYY-MM-DD HH:mm:ss")),this.$api.post("/api/sys/report/stat/export",e).then((function(e){console.log("ret:",e),t.onDownload(e)}))},quickSearch:function(t,e){this.search[t]=e,this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={start:"",end:"",task_type:0,type:this.defaultType,db_id:null,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},refresh:function(){this.$refs.st.search()},toType:function(t,e){return 1==t?"异步":2==t?"导出":11==t?"查询":12==t?"更新":13==t?"插入":14==t?"删除":"其他"},toState:function(t){return 1==t?"成功":2==t?"失败":0==t?"执行中":"不明"}},components:{},mounted:function(){var t=this;this.$api.post("/api/instance/all").then((function(e){t.instances=e}))}},u=c,d=(a("eebe"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},c041:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-container shadow"},[t._m(0),a("div",{staticClass:"body"},[a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"请输入注册码"}},[a("el-input",{model:{value:t.formData.license,callback:function(e){t.$set(t.formData,"license",e)},expression:"formData.license"}})],1),a("el-form-item",{attrs:{label:"验证码"}},[a("el-input",{model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}})],1),a("el-form-item",[a("div",{staticClass:"identifybox"},[a("div",{on:{click:t.getCaptcha}},[a("img",{staticStyle:{width:"100px",height:"50px",border:"1px"},attrs:{src:t.formData.captcha}})]),a("el-button",{staticClass:"textbtn",attrs:{type:"text"},on:{click:t.getCaptcha}},[t._v("看不清，换一张")])],1)]),a("el-form-item",[a("el-button",{staticClass:"btn-login",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("激活注册码")])],1)],1)],1)])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ali-center"},[a("img",{staticClass:"logo",attrs:{src:"/static/image/sqldev.png"}}),a("h4",[t._v("企业数据库安全访问系统")])])}],o=a("5530"),i=a("2f62"),r=a("5743"),l={data:function(){var t=this.$route.query;return{msg:t.msg||"",formData:{license:"",captcha:"",captcha_id:"",code:"",max_user:0,level:"",max_instance:0,expire_time:0,expire:""}}},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{getCaptcha:function(){var t=this;this.$api.get("/api/captcha").then((function(e){var a=e.id,s=e.img;t.formData.captcha=s,t.formData.captcha_id=a}))},getLicenseInfo:function(){var t=this;this.$api.get("/api/system/license").then((function(e){t.formData=e,-1==t.formData.expire_time?t.formData.expire="永久":t.formData.expire_time&&(t.formData.expire=r["a"].showTime(1e3*t.formData.expire_time))}))},goCasLogin:function(){this.url&&(window.location.href=this.url)},onSubmit:function(){var t=this;this.$api.post("/api/system/license/register",this.formData).then((function(){t.onSuccess("激活成功"),t.$router.push("/mgt/setting/license")})).catch((function(e){t.onError(e.data?e.data:e)}))}},mounted:function(){this.getCaptcha()}},c=l,u=(a("968f"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},c116:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isShow?a("el-dialog",{attrs:{title:t.title,visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide,center:""},on:{"update:visible":function(e){t.isShow=e},open:t.showHandle}},[a("div",{staticClass:"role"},[a("el-row",{staticClass:"el-row",attrs:{gutter:12}},[a("el-col",{attrs:{span:5}},[a("role-list",{ref:"roleList",attrs:{project_id:t.projectId,project:t.selectProject},on:{role:t.onRole,"on-project":t.onProject}})],1),a("el-col",{attrs:{span:7}},[a("instance-list",{ref:"dbList",attrs:{project_id:t.projectId,project:t.selectProject},on:{owner:t.onOwner,"refresh-next":t.onRefreshNext}})],1),a("el-col",{staticClass:"col-table-list",attrs:{span:7}},[a("table-list",{ref:"tabList",attrs:{role:t.selectRole,project_id:t.projectId,project:t.selectProject,owner:t.selectOwner},on:{"refresh-next":t.onRefreshNext,table:t.onTable}})],1),a("el-col",{attrs:{span:5}},[a("column-list",{ref:"colList",attrs:{role:t.selectRole,project_id:t.projectId,owner:t.selectOwner,table:t.selectTable,type:t.selectType}})],1)],1)],1)]):t._e()},n=[],o=(a("b0c0"),a("b64b"),a("3ea6")),i=a("d23f"),r=a("890c"),l=a("b267"),c={data:function(){return{is_admin:!1,isShow:!1,title:"项目权限设置",projectId:"",selectProject:{id:""},selectRole:{},selectDbLink:"*",selectOwner:{},selectTable:{},selectType:"table"}},methods:{showHandle:function(){},show:function(t,e){var a=this;console.log("[role.index methods] show: ",t),this.projectId=t.id,this.$api.project.info(t.id).then((function(s){a.selectProject=s,""==s.other_config?a.configForm=s.other_config_po:a.configForm=JSON.parse(s.other_config),a.title="项目【"+t.name+"】权限设置(ESC退出)",a.is_admin=e,a.isShow=!0}))},hide:function(){this.is_admin=!1,this.id="",this.selectProject={id:""},this.selectRole={},this.selectOwner={},this.selectDbLink="",this.selectTable={},this.isShow=!1},onProject:function(t){this.selectProject=t,console.log("[role.index methods] onProject: ",t),this.projectId=t.id,this.selectRole={},this.selectOwner={},this.selectDbLink="",this.selectTable={},console.log("this.$refs.roleList:",this.$refs.roleList),this.$refs.roleList.refresh(t.id)},onRole:function(t){console.log("onRole......",t),this.selectRole=t,this.selectOwner={},this.selectDbLink="",this.selectTable={},this.$refs.dbList.doRefresh(t)},onOwner:function(t){var e=Object.keys(this.selectTable);e.length>0&&this.selectOwner!=t&&(this.selectTable={}),this.selectOwner=t},onRefreshNext:function(t){console.log("刷新。。。。",t),"owner"==t?(this.$refs.tabList.refresh(null,!0),this.selectTable={}):"table"==t&&this.$refs.colList.refresh()},onTable:function(t,e){this.selectTable=t,this.selectType=e}},components:{RoleList:o["default"],InstanceList:i["default"],ColumnList:l["default"],TableList:r["default"]}},u=c,d=(a("3837"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,"6c3ea55e",null);e["default"]=p.exports},c14c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"login-wrap"},[a("div",{staticClass:"login"},[a("div",{staticClass:"login-title"}),a("div",{staticClass:"login-body"},[a("div",{staticClass:"body-title"},[t._v("忘记密码")]),a("el-form",{ref:"formData",attrs:{model:t.formData,rules:t.formDataRules,"label-width":"0px"}},[a("el-form-item",{attrs:{prop:"mobile"}},[a("el-input",{staticClass:"login-input",attrs:{placeholder:"请输入账号名"},model:{value:t.formData.mobile,callback:function(e){t.$set(t.formData,"mobile",e)},expression:"formData.mobile"}})],1),a("el-form-item",{attrs:{prop:"captcha"}},[a("el-row",{staticStyle:{position:"relative"},attrs:{gutter:15}},[a("el-col",{attrs:{span:16}},[a("el-input",{staticClass:"login-input",attrs:{placeholder:"图形验证码"},model:{value:t.formData.captcha,callback:function(e){t.$set(t.formData,"captcha",e)},expression:"formData.captcha"}})],1),a("el-col",{attrs:{span:8}},[a("img",{staticStyle:{height:"36px",width:"100%",float:"left"},attrs:{src:t.captchaUrl},on:{click:function(e){return t.onCaptcha()}}})])],1)],1),a("el-form-item",{attrs:{prop:"code"}},[a("el-input",{staticClass:"login-input",attrs:{placeholder:"请输入短信验证码"},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==t.time,expression:"time == 0"}],attrs:{slot:"append"},on:{click:t.onSend},slot:"append"},[t._v("获取验证码")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0!=t.time,expression:"time != 0"}],attrs:{slot:"append"},slot:"append"},[t._v(t._s(t.time)+"秒后可发送")])],1)],1),a("el-form-item",{attrs:{prop:"password"}},[a("el-input",{staticClass:"login-input",attrs:{type:"password",placeholder:"请输入6位以上密码"},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1),a("el-button",{staticClass:"login-btn",attrs:{type:"primary"},on:{click:function(e){return t.onSubmit()}}},[t._v("确定")])],1)],1),a("div",{staticClass:"login-footer"},[a("router-link",{staticClass:"jump-link",attrs:{to:"/login"}},[t._v("返回登录")])],1)])])},n=[],o=(a("99af"),a("365c")),i={data:function(){return{formData:{mobile:"",password:"",captcha:"",code:""},formDataRules:{mobile:[{required:"true",message:"[请输入账号名称]",trigger:"blur"}],password:[{required:"true",message:"[请输入密码]",trigger:"blur"},{min:6,max:32,message:"[请输入6位以上密码]",trigger:"blur"}],captcha:[{required:"true",message:"[请输入图片验证码]",trigger:"blur"}],code:[{required:"true",message:"[请输入短信验证码]",trigger:"blur"}]},time:0,captchaUrl:""}},methods:{onTime:function(){var t=this;this.time=60;var e=setInterval((function(){t.time--,0==t.time&&clearInterval(e)}),1e3)},onSend:function(){var t=this;o["default"].post("/find/pwd/send",this.formData).then((function(){t.success("发送成功"),t.onTime()})).catch((function(){t.onCaptcha()}))},onCaptcha:function(){this.captchaUrl="".concat(o["default"].API_HOST,"/captcha?t=").concat((new Date).getTime())},onSubmit:function(){var t=this,e=this;o["default"].post("/find/pwd",this.formData).then((function(){t.onSuccess("修改成功"),e.$router.push("/login")})).catch((function(){t.onCaptcha()}))}},mounted:function(){this.onCaptcha()}},r=i,l=(a("c605"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"2d6392e2",null);e["default"]=c.exports},c228:function(t,e,a){"use strict";a("0ed8")},c276:function(t,e,a){"use strict";a("99af");var s={get:function(){var t;return(t=localStorage).getItem.apply(t,arguments)},set:function(){var t;(t=localStorage).setItem.apply(t,arguments)},remove:function(){var t;(t=localStorage).removeItem.apply(t,arguments)}},n={set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";s.set("d2admin-".concat("3.4.0","-").concat(t),e)},get:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return s.get("d2admin-".concat("3.4.0","-").concat(t))},getAll:function(){return s.get()},remove:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return s.remove("d2admin-".concat("3.4.0","-").concat(t))}},o=n,i=a("95a2"),r=a("3dbf"),l={cookies:o,db:i["d"],log:r["a"],title:function(t){var e="SQLDEV";window.document.title="".concat(e).concat(t?" | ".concat(t):"")},open:function(t){console.log("打开xxxxx");var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank"),e.setAttribute("id","d2admin-link-temp"),document.body.appendChild(e),e.click(),document.body.removeChild(document.getElementById("d2admin-link-temp"))}};e["a"]=l},c2b3:function(t,e,a){"use strict";a("60e9")},c2e4:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-add",use:"d2-add-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-add"><path d="M512 1024C229.7 1024 0 794.3 0 512S229.7 0 512 0s512 229.7 512 512-229.7 512-512 512z m0-938.7C276.7 85.3 85.3 276.7 85.3 512S276.7 938.7 512 938.7 938.7 747.3 938.7 512 747.3 85.3 512 85.3z" fill="#3688FF" /><path d="M682.7 554.7H341.3c-23.6 0-42.7-19.1-42.7-42.7s19.1-42.7 42.7-42.7h341.3c23.6 0 42.7 19.1 42.7 42.7s-19.1 42.7-42.6 42.7z" fill="#5F6379" /><path d="M512 725.3c-23.6 0-42.7-19.1-42.7-42.7V341.3c0-23.6 19.1-42.7 42.7-42.7s42.7 19.1 42.7 42.7v341.3c0 23.6-19.1 42.7-42.7 42.7z" fill="#5F6379" /></symbol>'});i.a.add(r);e["default"]=r},c3d0:function(t,e,a){"use strict";a("cfcd")},c3db:function(t,e,a){},c464:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"apply padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/list","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"审核人",prop:"user_name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"审核状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.status_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"编号",prop:"id",width:"100"}}),a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"申请类型",prop:"source_type"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s("role"==e.row.source_type?"权限组":"其他"))]}}])}),a("el-table-column",{attrs:{label:"申请说明",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核人",prop:"auditor_name"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过 ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.openApplyInfo(e.row,!0)}}},[t._v("查看详情 ")])]}}])})],1)],2),a("dialog-apply",{ref:"applyDialog",on:{refresh:t.refresh}}),a("dialog-apply-info",{ref:"applyInfoDialog",on:{refresh:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("6e7a")),i=a("7db0"),r={data:function(){return{search2:{db_type:null},search:{db_type:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],status_types:[{k:"0",v:"全部"},{k:"1",v:"待审核"},{k:"2",v:"已通过"},{k:"3",v:"未通过"}]}},computed:{},props:{},watch:{},methods:{refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},openApply:function(t){this.$refs.applyDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogApply:o["default"],DialogApplyInfo:i["default"]},mounted:function(){}},l=r,c=(a("0325"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},c4d8:function(t,e,a){"use strict";a("7d52")},c5c5:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("div",{staticClass:"flex justify-center"},[a("div",{staticClass:"page-mgt-setting-license flex flex-col shadow-md p-20"},[a("div",{staticClass:"flex flex-col items-center"},[a("img",{staticClass:"logo",attrs:{src:"/static/image/sqldev.png"}}),a("h3",{staticClass:"text-3xl mb-2"},[t._v(t._s(t.sysSetting.version))]),a("h4",[t._v("企业数据安全访问系统")])]),a("div",{staticClass:"body"},[a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"版本类型"}},[t._v(" "+t._s(t.formData.level)+" ")]),a("el-form-item",{attrs:{label:"支持最大用户数"}},[t._v(" "+t._s(t.formData.max_user)+" ")]),a("el-form-item",{attrs:{label:"支持最大实例数"}},[t._v(" "+t._s(t.formData.max_instance)+" ")]),a("el-form-item",{attrs:{label:"到期时间"}},[t._v(" "+t._s(t.formData.expire)+" ")])],1)],1)])])])},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("2f62")),l=a("5743"),c={computed:Object(i["a"])({},Object(r["e"])(["user","sysSetting"])),data:function(){var t=this.$route.query;return{msg:t.msg||"",formData:{max_user:0,level:"",max_instance:0,expire_time:0,expire:"",code:""}}},methods:{getLicenseInfo:function(){var t=this;this.$api.get("/api/system/license").then((function(e){t.formData=e,-1==t.formData.expire_time?t.formData.expire="永久":t.formData.expire_time&&(t.formData.expire=l["a"].showTime(1e3*t.formData.expire_time))}))}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.getLicenseInfo(),e.next=3,t.$api.post("/api/setting",{});case 3:a=e.sent,t.$store.commit("sysSetting",a);case 5:case"end":return e.stop()}}),e)})))()}},u=c,d=(a("88b1"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},c605:function(t,e,a){"use strict";a("ccb0")},c6ca:function(t,e,a){"use strict";a("e531")},c6d4:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mask"},[a("k-search-table",{ref:"st",attrs:{title:"脱敏模板列表",url:"/api/mask/page","search-data":t.search}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{prop:"dataType",label:"模板类型"}},[a("k-select",{attrs:{url:"",placeholder:"请选择模板类型"},model:{value:t.search.dataType,callback:function(e){t.$set(t.search,"dataType",e)},expression:"search.dataType"}})],1)],1),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"id",label:"编号"}}),a("el-table-column",{attrs:{prop:"name",label:"名称"}}),a("el-table-column",{attrs:{prop:"dataType",label:"模板类型"}}),a("el-table-column",{attrs:{prop:"maskCode",label:"模板编号"}}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.createTime))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.$refs.editDialog.show(e.row.id)}}},[t._v("编辑 ")]),1==e.row.dataType?a("k-btn-tip",{attrs:{size:"mini"},on:{click:function(a){return t.onDel(e.row.id)}}},[t._v("删除")]):t._e()]}}])})],1)],2),a("dialog-edit",{ref:"editDialog",on:{success:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("99af"),a("6150")),i={data:function(){return{search:{}}},props:{},watch:{},computed:{},methods:{refresh:function(){this.$refs.st.search()},onDel:function(t){var e=this;this.$api.post("/mask/delete",{ids:[].concat(t)}).then((function(){e.refresh()}))},onDels:function(){var t=this.$refs.st.selectValues;t&&t.length>0&&this.onDel(t)}},mounted:function(){},components:{DialogEdit:o["default"]}},r=i,l=(a("c6d5"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},c6d5:function(t,e,a){"use strict";a("587d")},c6fd:function(t,e,a){},c774:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("div",{staticClass:"employee padding-x-24"},[a("k-search-table",{ref:"st",attrs:{data:t.dataList,url:"/api/user/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"账号：",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"姓名：",prop:"user_name"}},[a("el-input",{model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"邮箱：",prop:"email"}},[a("el-input",{model:{value:t.search.email,callback:function(e){t.$set(t.search,"email",e)},expression:"search.email"}})],1),a("el-form-item",{attrs:{prop:"source",label:"来源："}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.source,callback:function(e){t.$set(t.search,"source",e)},expression:"search.source"}},t._l(t.sources,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),t.isSysUser?a("el-form-item",{attrs:{prop:"role",label:"角色："}},[a("el-select",{model:{value:t.search.role,callback:function(e){t.$set(t.search,"role",e)},expression:"search.role"}},t._l(t.sys_roles,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1):t._e(),a("el-form-item",{attrs:{label:"项目："}},[a("el-select",{attrs:{multiple:"",clearable:!0},model:{value:t.search.projects,callback:function(e){t.$set(t.search,"projects",e)},expression:"search.projects"}},t._l(t.projects,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("添加账户")]),t.cp&&"focus"==t.cp?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:t.onFocusSync}},[t._v("全量同步")]):t._e()],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id",width:"90px"}}),a("el-table-column",{attrs:{label:"账号",prop:"name",width:"100px"}}),a("el-table-column",{attrs:{label:"姓名",prop:"user_name",width:"100px"}}),a("el-table-column",{attrs:{label:"邮箱",prop:"email",width:"120px"}}),a("el-table-column",{attrs:{label:"项目",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showRoleNames(e.row.project_names))+" ")]}}])}),a("el-table-column",{attrs:{label:"注册时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.createdAt)))]}}])}),a("el-table-column",{attrs:{label:"登录IP/时间",width:"240px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.last_ip?a("span",[t._v(t._s(e.row.last_ip)+" / "+t._s(t._f("dateTime")(e.row.last_time)))]):a("span",[t._v("尚未登录")])]}}])}),a("el-table-column",{attrs:{label:"有效时间",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[-1==e.row.expire?a("span",{staticClass:"text-success"},[t._v("永久")]):a("span",{staticClass:"text-error"},[t._v(t._s(t.showTime(e.row.expire)))])]}}])}),a("el-table-column",{attrs:{label:"状态",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-success"},[t._v("正常")]):0==e.row.state?a("span",{staticClass:"text-error"},[t._v("冻结")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"MFA状态",width:"120px",title:"开启双因子认证"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.tfa_state?a("span",{staticClass:"text-info"},[t._v(" 开启 "),1==e.row.tfa_state?a("el-button",{attrs:{size:"mini",type:"text",disabled:t.user.id==e.row.id},on:{click:function(a){return t.dialogOpenHandler(e.row)}}},[t._v("[关闭]")]):t._e(),a("k-btn-tip",{attrs:{tip:"是否关闭当前用户【"+e.row.user_name+"】的双因子认证？"},on:{click:function(a){return t.onCloseAuthState(e.row)}}})],1):a("span",[t._v(" 关闭 ")])]}}])}),a("el-table-column",{attrs:{label:"来源",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return["focus"==e.row.source?a("span",{staticClass:"text-success"},[t._v("focus")]):a("span",{staticClass:"text-info"},[t._v("add")])]}}])}),a("el-table-column",{attrs:{label:"角色",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getRoleTypeText(e.row.role))+" ")]}}])}),a("el-table-column",{attrs:{"min-width":"300px",fixed:"right",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",disabled:t.user.id==e.row.id},on:{click:function(a){return t.onSend(e.row)}}},[t._v(" 私信 ")]),a("el-button",{attrs:{size:"mini",type:"primary",disabled:t.user.id==e.row.id},on:{click:function(a){return t.onEdit(e.row)}}},[t._v("修改 ")]),1==e.row.state?a("el-button",{attrs:{size:"mini",type:"danger",disabled:t.user.id==e.row.id},on:{click:function(a){return t.onState(e.row,0)}}},[t._v("冻结 ")]):a("el-button",{attrs:{size:"mini",type:"success",disabled:t.user.id==e.row.id},on:{click:function(a){return t.onState(e.row,1)}}},[t._v("恢复 ")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】用户吗?"},on:{click:function(a){return t.onDel(e.row)}}},[a("el-button",{attrs:{size:"mini",type:"danger",disabled:t.user.id==e.row.id}},[t._v("删除 ")])],1),a("el-button",{attrs:{size:"mini",disabled:t.user.id==e.row.id||"focus"==e.row.source},on:{click:function(a){return t.onReset(e.row)}}},[t._v("重置密码 ")])]}}])})],1)],2),a("dialog-edit",{ref:"dialogEdit",on:{refresh:t.refresh}}),a("dialog-auth",{ref:"dialogAuth"}),a("el-dialog",{attrs:{title:"是否关闭双因子认证？",visible:t.MFACloseVisible,width:"60%","before-close":t.dialogCloseHandler},on:{"update:visible":function(e){t.MFACloseVisible=e}}},[a("el-form",{ref:"formRef",attrs:{model:t.formData,rules:t.formRule,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"MFA",prop:"mark"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入关闭原因"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.dialogCloseHandler}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onCloseAuthState}},[t._v("确 定")])],1)],1)],1),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"发送消息","destroy-on-close":!0,visible:t.dialogTableVisible},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("SendView",{attrs:{"user-id":t.toUserId},on:{success:t.onSendSuccess}})],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("d3b7"),a("2f62")),r=a("be4f"),l=a("a299"),c=a("5c96"),u=a("c1df"),d=a.n(u),p=a("2109"),f={components:{DialogEdit:r["default"],DialogAuth:l["default"],SendView:p["default"]},data:function(){return{toUserId:null,dialogTableVisible:!1,MFACloseVisible:!1,currentMFAItem:null,formData:{mark:""},formRule:{mark:[{required:!0,message:"请输入关闭原因"}]},cp:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMPANY,no_role:!1,search:{},dataList:[],roles:[],projects:[],sys_roles:[{k:0,v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"安全管理员"},{k:3,v:"审计管理员"},{k:4,v:"系统管理员"},{k:9,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}],roleMap:{1:"超级管理员",2:"安全管理员",3:"审计管理员",4:"系统管理员",9:"普通用户"}}},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user"])),{},{getRoleTypeText:function(){var t=this;return function(e){var a=t.roleMap[e];return a||"未知身份"}},isSysUser:function(){return this.user&&1==this.user.role}}),methods:{showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return d()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){console.log("重置密码：",t),e.onSuccess(t,"重置后的密码：",0),e.refresh("操作成功")}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onFocusSync:function(){var t=this,e=c["Loading"].service({fullscreen:!1,text:"正在同步中..."});this.$api.user.focusSync().then((function(a){e.close(),t.onSuccess("新增同步 "+a.count+" 条账户信息"),t.refresh()}),(function(t){e.close(),c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onNew:function(){this.$refs.dialogEdit.show()},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onSend:function(t){console.log("发送私信：",t),this.toUserId=t.id,this.dialogTableVisible=!0},onSendSuccess:function(){var t=this;this.$message.success("发送成功"),setTimeout((function(){t.dialogTableVisible=!1}),500)},onEdit:function(t){this.$refs.dialogEdit.show(t)},dialogOpenHandler:function(t){this.MFACloseVisible=!0,this.currentMFAItem=t},dialogCloseHandler:function(){this.MFACloseVisible=!1,this.currentMFAItem=null,this.formData.mark=""},onCloseAuthState:function(){var t=this;this.$refs.formRef.validate((function(e){if(!e)return!1;t.$api.user.closeTfa(t.currentMFAItem.id,t.formData.mark).then((function(){t.onSuccess("操作成功"),t.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})})).finally((function(){t.dialogCloseHandler()}))}))},onState:function(t,e){var a=this;this.$api.user.state(t.id,e).then((function(){a.onSuccess("操作成功"),a.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t){var e=this;this.$api.user.delete(t.id).then((function(){e.onSuccess("操作成功"),e.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){var t=this;this.$api.post("/api/project/all").then((function(e){t.projects=e}))}},m=f,h=(a("d4d8"),a("2877")),b=Object(h["a"])(m,s,n,!1,null,null,null);e["default"]=b.exports},c7ed:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据字段"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新 ")])],1),a("div",{staticClass:"role-column-list"},[a("el-tree",{ref:"colList",attrs:{data:t.dataList,props:t.treeProps,"highlight-current":"","empty-text":"请选择数据表","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.data;return a("div",{staticClass:"item hbox-between"},[a("div",{staticClass:"left flex-over"},[a("el-tooltip",{attrs:{content:s.label}},[a("i",{staticClass:"sn-font",class:{"text-success":1==s.rw,"text-primary":2==s.rw,"text-error":3==s.rw}},[t._v("")])]),a("span",{class:{"text-success":1==s.rw,"text-primary":2==s.rw,"text-error":3==s.rw}},[t._v(t._s(s.label))])],1),a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font",class:{"text-success":1==s.rw},on:{click:function(e){return t.onAuth(s,1)}}},[t._v("读")]),a("i",{staticClass:"sn-font",class:{"text-primary":2==s.rw},on:{click:function(e){2==t.table.rw&&t.onAuth(s,2)}}},[t._v("写")]),a("i",{staticClass:"sn-font",class:{"text-error":3==s.rw},on:{click:function(e){return t.onAuth(s,3)}}},[t._v("敏")])])])}}])})],1)],2)},n=[],o=(a("4de4"),a("d3b7"),{data:function(){return{filterText:"",loading:!1,dataList:[],treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},computed:{},props:{role:{},owner:{},table:{}},watch:{role:"refresh",owner:"refresh",table:{deep:!0,handler:"refresh"},filterText:function(t){this.$refs.colList.filter(t)}},methods:{filterNode:function(t,e){return!t||(console.log("data.label:",e.label,"  value:",t),-1!==e.label.toLowerCase().indexOf(t.toLowerCase()))},refresh:function(){var t=this;this.role.id&&this.owner.id&&this.table.id?(this.loading=!0,this.$api.permission.allColumn(this.role.id,this.owner.db.id,this.owner.label,this.table.label,this.table).then((function(e){t.dataList=e})).finally((function(){t.loading=!1}))):this.dataList=[]},onAuth:function(t,e){var a=this;(3!=this.owner.rw&&1!=this.table.rw||3==e)&&(1!=this.owner.rw&&1!=this.table.rw||2!=e)&&-1!=this.owner.rw&&(3!=e?this.$api.permission.addColumn(this.role.id,this.owner.db.id,this.owner.label,this.table.label,t.label,{},e).then((function(){t.rw=e;var s="操作成功";3==e?s="设置禁用成功":1==e?s="设置只读成功":2==e?s="设置读写成功":-1==e&&(s="取消设置成功"),a.onSuccess(s)})):this.$refs.maskDialog.show(this.dataList,t))}},components:{},mounted:function(){}}),i=o,r=(a("4a22"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},c823:function(t,e,a){"use strict";a("2a1d")},c890:function(t,e){var a={EXPRESS:"(${1:expre}) ",STRNG:"(${1:s}) ",XY:"(${1:x}, ${2:y}) ",S_ASTERISK:"(${1:*}) "};t.exports={ABS:a.EXPRESS,ASCII:a.STRNG,COUNT:a.S_ASTERISK,CHAR_LENGTH:a.STRNG,POWER:a.XY,POW:a.XY,TRUNCATE:a.XY,VARCHAR:a.EXPRESS,VARCHAR2:a.EXPRESS}},c892:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:t.id?"修改工单":"新增工单",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"数据源:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_id,callback:function(e){t.$set(t.search,"db_id",e)},expression:"search.db_id"}},t._l(t.instances,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"数据采集数"}},[a("el-tooltip",{attrs:{placement:"top",content:"数据采集数"}},[a("el-input-number",{model:{value:t.formData.fetch_size,callback:function(e){t.$set(t.formData,"fetch_size",e)},expression:"formData.fetch_size"}})],1)],1),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"查询最大笔数"}},[a("el-input-number",{model:{value:t.formData.max_row,callback:function(e){t.$set(t.formData,"max_row",e)},expression:"formData.max_row"}})],1):t._e(),"es5"==t.formData.db_type?a("el-form-item",{attrs:{label:"详细设定"}},[t.formData.config?a("el-row",{attrs:{gutter:4}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.esConfigList}},[a("el-table-column",{attrs:{label:"Index name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row,n=e.$index;return[a("el-input",{attrs:{placeholder:"索引名称,不带后缀,示例 logstash  *代表全局配置",disabled:0==n},model:{value:s["index_name"],callback:function(e){t.$set(s,"index_name",e)},expression:"row['index_name']"}})]}}],null,!1,2141746515)}),a("el-table-column",{attrs:{prop:"tfn",label:"Time field name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{attrs:{placeholder:"Time field name,默认@timestamp"},model:{value:s["time_field"],callback:function(e){t.$set(s,"time_field",e)},expression:"row['time_field']"}})]}}],null,!1,1664101124)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.esConfigList)}}},[t._v("移除 ")]):t._e()]}}],null,!1,3801071846)})],1),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addEsRow()}}},[t._v("添加")])],1):t._e()],1):t._e(),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.db_desc,callback:function(e){t.$set(t.formData,"db_desc",e)},expression:"formData.db_desc"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=(a("a434"),a("b0c0"),a("2ef0")),i=a("2e0b"),r={data:function(){return{pw_show:!1,account_show:!1,headerList:[],esConfigList:[],isShow:!1,id:null,oper_types:[{l:"只读",v:1},{l:"读写",v:0}],treeProps:{label:"name"},dataList:[],formData:this.reset()}},computed:{},props:{},watch:{"formData.type":"initEsConfigList",isShow:function(t){t&&(this.pw_show=!1,this.account_show=!1)}},methods:{changePass:function(t){console.log(t)},showOtherSetting:function(t){return!!t},addHeaderRow:function(){this.headerList.push({name:"",value:""})},addEsRow:function(){this.esConfigList.push({index_name:"",time_field:""})},deleteRow:function(t,e){e.splice(t,1)},initEsConfigList:function(){console.log("initEsConfigList"),0==this.esConfigList.length&&this.esConfigList.push({index_name:"*",time_field:"@timestamp"})},reset:function(){return{headerList:[{name:"test",value:"234"}],config:{auth:"",method:"get"},id:"",name:"",user:"",pass:"",ip:"",port:"",db:"",url:"",db_type:"",con_type:"base",oper_type:1,db_desc:"",pool_min:1,pool_max:5,max_row:1e4,asyn_query:0,asyn_export:0,asyn_sql:0}},show:function(t){var e=this;if(this.id=t,!this.id)return this.isShow=!0,void(this.formData=this.reset());this.$api.db.info(this.id).then((function(t){t.config=JSON.parse(t.config||"{}"),t.config.headers&&Object(o["isArray"])(t.config.headers)&&(e.headerList=t.config.headers),t.config.eslist&&Object(o["isArray"])(t.config.eslist)&&(e.esConfigList=t.config.eslist),"es5"==t.type&&e.initEsConfigList(),t.con_type||(t.con_type="base"),e.formData=t,e.isShow=!0}))},hide:function(){this.isShow=!1},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);return e.config.headers=this.headerList,e.config.eslist=this.esConfigList,e.config=e.config?JSON.stringify(e.config):"",e.name?e.db_type?"tns"==e.con_type||e.ip?"tns"==e.con_type||e.port?(console.log("config:",e.config),void this.$api.db.save(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))):(this.$message({message:"端口不能为空",type:"warning"}),!1):(this.$message({message:"ip不能为空",type:"warning"}),!1):(this.$message({message:"数据源类型不能为空",type:"warning"}),!1):(this.$message({message:"名称不能为空",type:"warning"}),!1)}},components:{ElRow:i["a"]}},l=r,c=(a("ecdd"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"1e5caeb3",null);e["default"]=u.exports},c8e5:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tool-db-componet"},[a("el-select",{staticClass:"tool-type-select",attrs:{clearable:!!t.type,placeholder:t.filterDataList&&t.filterDataList.length>0?"筛选数据源类型":"无数据",title:"筛选数据源类型"},on:{change:t.onTypeChange,clear:t.onTypeClear},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[t.types&&t.types.length?a("el-option",{attrs:{label:"全部",value:null}}):t._e(),t._l(t.types,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],2),a("el-select",{ref:"select",staticClass:"tool-db-select",attrs:{filterable:"","popper-class":t.selectedValue?"tool-db-select2 tool-db-select-1":"tool-db-select2 tool-db-select-0",placeholder:t.filterDataList&&t.filterDataList.length>0?"请选择数据库实例":"无数据",title:t.selectedValue,"filter-method":t.filterDataMethod},on:{"visible-change":t.onVisibelChange},model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}},[t._l(t.filterDataList,(function(e){return a("el-option-group",{key:e.id,attrs:{label:e.name,name:e.name}},[t._l(e.children,(function(e){return t._l(e.children,(function(s){return a("el-option",{key:s.id,attrs:{label:s.label,value:s,disabled:!!s.err_msg},nativeOn:{click:function(a){!s.err_msg&&t.onChangeInstance(e,s)}}},[s.err_msg?[a("span",{staticStyle:{float:"left"},attrs:{title:s.err_msg}},[a("el-tag",{staticClass:"auth-tag tags-3"},[t._v(" 错误 ")])],1),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","padding-left":"10px"},attrs:{title:s.err_msg}},[t._v(t._s(e.name))])]:[a("span",{staticStyle:{float:"left"},attrs:{title:"数据库实例"}},[a("el-tag",{staticClass:"auth-tag",class:"tags-"+s.rw,attrs:{title:t.rws[s.rw]+"权限"}},[t._v(" "+t._s(t.rws[s.rw]||"空")+" ")]),a("span",{staticStyle:{"margin-left":"5px"},attrs:{title:"数据库："+s.label}},[t._v(" "+t._s(s.label)+" ")])],1),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","padding-left":"10px"},attrs:{title:"数据源"}},[t._v(t._s(e.name))])]],2)}))}))],2)})),a("div",{staticClass:"select-end"},[t._v("- 结束 -")])],2),a("el-tooltip",{attrs:{content:"刷新数据源"}},[a("el-button",{staticClass:"query-tool-item",staticStyle:{"padding-left":"10px"},attrs:{type:"text",size:"mini",loading:t.refreshLoading},nativeOn:{click:function(e){return t.refresh.apply(null,arguments)}}},[a("k-icon",{staticClass:"text-primary   sn-font active:opacity-75",attrs:{name:"icon-shuaxin1"}})],1)],1)],1)},n=[],o=a("1da1"),i=a("3835"),r=a("5530"),l=(a("96cf"),a("d81d"),a("d3b7"),a("ddb0"),a("99af"),a("4de4"),a("a9e3"),a("159b"),a("b0c0"),a("da6f")),c=a("2ef0"),u=a("2f62"),d={computed:Object(r["a"])({},Object(u["e"])(["runList","runActive","project","selecedDB"])),data:function(){return{refreshLoading:!1,rws:{1:"读",2:"读写",4:"管理"},isShow:!1,types:[],type:null,filterDataList:[],dataList:[],selectedInstance:null,selectedValue:"",selectedSource:null,values:[],cascaderProps:{label:"name",value:"id"}}},watch:{dataList:function(t){this.types=t?t.map((function(t){return t.id})):[]},project:function(t,e){console.log("[tool.db watch] project: ",t),t&&t.id!=e.id&&this.auto({time:Date.now()})},isShow:function(t){var e=this;t&&(this.values=[],this.$nextTick((function(){console.log("获取焦点"),e.$refs.select.focus()})))},selecedDB:function(t){console.log("[tool.db watch] selecedDB",t),t?(this.selectedSource=t.source,this.selectedInstance=t.instance,this.selectedValue="".concat(this.rws[t.instance.rw]," - ").concat(this.selectedInstance.label," - ").concat(t.source.label),this.type=t.source.db_type,0==this.runList.length&&(this.$message({message:"新建SQL编辑器",type:"success"}),this.onNewWindow())):(this.selectedSource=null,this.selectedInstance=null,this.selectedValue="",this.type=null)}},methods:{reset:function(){var t=this.getFilterDataList(null,null);this.filterDataList=t,this.type=null},onVisibelChange:function(t){t&&this.filterDataMethod(null)},onTypeChange:function(){},onTypeClear:function(){this.type=null},filterDataMethod:function(t){var e=this.getFilterDataList(this.type,t);this.filterDataList=e},getFilterDataList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=null;if(a=null===t?this.dataList:this.dataList.filter((function(e){return e.id.indexOf(t.toLowerCase())>=0})),null===e)return a;a=JSON.parse(JSON.stringify(a));var s=[],n={};for(var o in a){var i=a[o],r=[];for(var l in i.children){var c=i.children[l],u=[];for(var d in c.children){var p=c.children[d];(""==p.label||p.label.toLowerCase().indexOf(e.toLowerCase())>=0)&&(u.push(p),n[o]=!0)}r.push(c),c.children=u}n[o]&&(s.push(i),i.children=r)}return s},onNext:function(t){},selectItems:function(){var t=Object(i["a"])(this.values,3),e=t[0],a=t[1],s=t[2];if(!s)return[];var n=Object(c["find"])(this.dataList,{id:e}),o=Object(c["find"])(n&&n.children||[],{id:a}),r=Object(c["find"])(o&&o.children||[],{id:s});return[n,o,r]},refresh:function(){this.auto({force:!0})},auto:function(){var t=arguments,e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,n,o,i,r,c,u,d,p,f,m;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=t.length>0&&void 0!==t[0]?t[0]:{},e.refreshLoading=!0,console.log("[tool.db]#auto...",e.project),e.project&&e.project.id){a.next=6;break}return e.$store.commit("allRun",[]),a.abrupt("return");case 6:return n=s.force||s.refresh,a.next=9,e.$api.db.dbAll(e.project.id,n);case 9:if(o=a.sent,e.refreshLoading=!1,i=o,i[0]){a.next=18;break}return e.$store.commit("allRun",[]),e.dataList=i,e.filterDataList=i,e.$store.commit("dataBaseList",i),a.abrupt("return");case 18:if(i[0].children){a.next=24;break}return e.$store.commit("allRun",[]),e.dataList=i,e.filterDataList=i,e.$store.commit("dataBaseList",i),a.abrupt("return");case 24:if(i[0].children[0].children){a.next=30;break}return e.$store.commit("allRun",[]),e.dataList=i,e.filterDataList=i,e.$store.commit("dataBaseList",i),a.abrupt("return");case 30:return r=i&&i.length>0?i.id:0,c=i&&i.length>0&&i[0].children&&i[0].children.length>0?i[0].children[0].id:0,u=i&&i.length>0&&i[0].children&&i[0].children.length>0&&i[0].children[0].children&&i[0].children[0].children.length>0?i[0].children[0].children[0].id:0,e.values=[r,c,u],d=Number(window.localStorage.getItem("".concat(e.project.id,"_runActive"))||0),e.$store.commit("runActive",d),a.next=38,Object(l["b"])("runNames",{max:0});case 38:if(p=a.sent,f=[],!(p&&p.max>=1)){a.next=45;break}return a.next=43,Object(l["b"])("runList",[]);case 43:f=a.sent,f||(f=[]);case 45:f&&f.length>0?(m={},f.forEach((function(t){m[t.id]=1,m[t.id+t.name]=t})),i.forEach((function(t){t.children&&t.children.length>0&&t.children.forEach((function(t){m[t.db_id]&&t.children&&t.children.length>0&&t.children.forEach((function(t){m[t.db_id+t.label]&&(m[t.db_id+t.label].hasAsynExport=1==t.asyn_export,m[t.db_id+t.label].hasAsynQuery=1==t.asyn_query,m[t.db_id+t.label].hasAsynSql=1==t.asyn_sql,m[t.db_id+t.label].hasRw=2==t.rw)}))}))})),f.map((function(t){return m[t.id+t.name]&&(t=m[t.id+t.name]),t})),e.$store.commit("allRun",f)):e.$store.commit("allRun",[]),e.dataList=i,e.filterDataList=i,e.$store.commit("dataBaseList",i),s.refresh&&e.$message.success("刷新数据源列表");case 50:case"end":return a.stop()}}),a)})))()},onNewSQL:function(t,e){e&&(console.log("db, owner: ",t,e),this.isShow=!1,this.$store.commit("addRun",this.createRunConfig(t,e)),this.values=[],this.$bus.emit("new-sql-window"))},onChangeInstance:function(t,e){this.$store.commit("setSelectedDB",{source:t,instance:e});var a=this.runList[this.runActive];if(a){var s=this.createRunConfig(t,e);s.tabId=a.tabId,s.index=a.index,s.tabNo=a.tabNo?a.tabNo:1,console.log("run.tabId&tabNo: ",s.tabId,s.tabNo,this.runActive),console.log("before updateRun2 : ",s,this.runList),this.$store.commit("updateRun2",s),this.$bus.emit("on-selectdb-".concat(s.tabId),s),this.$bus.emit("index-result-change-tab_".concat(s.tabId),"result"),console.log("[tool.db methods] onChangeInstance 提交 on-selectdb-".concat(s.tabId," - ").concat(s.name),s),this.$bus.emit("".concat(s.tabId,"-card-db-refresh"),s)}else console.log("[tool.db methods] onChangeInstance() 当前run为空",this.runActive,this.runList)},createRunConfig:function(t,e){return console.log("in createRunConfig",t,e),{id:t.db_id,instance_id:e.id,db:t.name,name:e.label,auto_audit:t.auto_audit,dbType:t.db_type,script:"",rw:e.rw,owner:e.label,hasAsynExport:1==e.asyn_export,hasAsynQuery:1==e.asyn_query,hasAsynSql:1==e.asyn_sql,hasRw:2==e.rw}},onNewWindow:function(){this.selectedInstance?this.onNewSQL(this.selectedSource,this.selectedInstance):this.$message({message:"请选择数据库实例",type:"warning"})}},mounted:function(){this.auto()}},p=d,f=(a("9e3a"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},c9ff:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"导出SQL",visible:t.isShow,width:"450px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1),a("el-form-item",{attrs:{label:"导出条数"}},[a("el-select",{model:{value:t.formData.max_rows,callback:function(e){t.$set(t.formData,"max_rows",e)},expression:"formData.max_rows"}},t._l(t.rows,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)},n=[],o={data:function(){return{isShow:!1,notifys:["钉钉","微信","邮件"],rows:[10,2e3,3e3,5e3,1e5,2e5,5e5,1e6,5e6,2e7],tasktypes:[{l:"XLS",v:5}],formData:this.reset()}},props:{},watch:{},computed:{},methods:{reset:function(){return{mark:"",max_rows:2e3,notify:null,task_type:3,export:!0}},show:function(t){this.formData=this.reset(),this.cb=t,this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){this.cb(this.formData),this.hide()}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},caa3:function(t,e,a){},cb22:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.id?"修改SSH策略":"新增SSH策略",visible:t.isShow,width:"740px"},on:{close:t.onHide,"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.formDataRules,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"name",label:"名称"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{prop:"info",label:"备注"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1),a("el-form-item",{attrs:{label:"策略组"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.filterList,size:"mini"}},[a("el-table-column",{attrs:{label:"过滤规则"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{attrs:{size:"mini"},model:{value:s["command"],callback:function(e){t.$set(s,"command",e)},expression:"row['command']"}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:"提示"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{attrs:{size:"mini"},model:{value:s["msg"],callback:function(e){t.$set(s,"msg",e)},expression:"row['msg']"}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:"启用"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-switch",{attrs:{size:"mini","active-color":"#13ce66","inactive-color":"#ff4949","active-value":2,"inactive-value":4},model:{value:s["enable"],callback:function(e){t.$set(s,"enable",e)},expression:"row['enable']"}})]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.delFilter(e.$index,t.paramList)}}},[t._v(" 移除 ")])]}}])})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.addFilter}},[t._v("增加规则")]),a("el-button",{on:{click:t.onHide}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确定 ")])],1)],1)},n=[],o=(a("a434"),a("d3b7"),a("2ef0")),i={data:function(){return{id:0,isShow:!1,formData:{},filterList:[],formDataRules:{name:[{required:!0,message:"请输入策略名称"}]}}},props:{},watch:{},computed:{},methods:{reset:function(){return{id:0,name:"",formData:{},filterList:[]}},show:function(t){var e=this;this.reset(),t?this.$api.ssh.getFilter(t).then((function(a){e.id=t,e.formData=a,e.filterList=a.filters?a.filters:[],e.isShow=!0})):(this.id="",this.isShow=!0)},addFilter:function(){var t={command:"",msg:"禁用该命令",enable:2};this.filterList.push(t)},delFilter:function(t){this.filterList.splice(t,1)},onHide:function(){this.id=0,this.formData={},this.filterList=[],this.isShow=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=o["clone"](t.formData);t.filterList&&t.filterList.length>0?a.filters=JSON.stringify(t.filterList):a.filters="[]",t.$api.ssh.addFilter(a).then((function(e){t.isShow=!1,t.onSuccess("提交成功"),t.$emit("success")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})).finally((function(){t.loading=!1,t.onHide()}))}}))}},mounted:function(){},components:{}},r=i,l=(a("af6c"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},cb35:function(t,e,a){"use strict";a("7fe7")},cb68:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editor-container"},[a("pre",{staticClass:"editor monaco-lite-monaco-x2"})])}],o=a("5530"),i=a("2ef0"),r=a("2f62"),l={name:"monoco-lite",computed:Object(o["a"])({},Object(r["c"])("d2admin/theme",["activeSetting"])),data:function(){return{count:1,editor:null,defaultConfig:{language:"sql",theme:"vs",automaticLayout:!0,selectionHighlight:!0,wordWrap:"on",scrollbar:{useShadows:!1,verticalHasArrows:!1,horizontalHasArrows:!1,vertical:"hidden",horizontal:"hidden",verticalScrollbarSize:0,horizontalScrollbarSize:17,arrowSize:30}},cacheConfig:{}}},props:{sqlData:{type:String,default:function(){return""}},config:{type:Object,default:function(){return{}}}},watch:{sqlData:function(t){console.log("======= monaco lite ========="),t||(t=""),this.init(t)},config:function(t,e){this.editor&&!Object(i["isEqual"])(t,e)&&this.setConfig(t)}},methods:{setConfig:function(t){console.log("更细config.."),this.editor.updateOptions(t),this.init(this.sqlData)},refresh:function(t){this.init(t)},setCount:function(t){this.count=t},setSql:function(t){this.editor.setValue(t)},init:function(t){var e=this;if(this.editor)this.editor.setValue(t);else{var a=this.$el.getElementsByClassName("monaco-lite-monaco-x2")[0],s=Object(i["merge"])({},this.defaultConfig,this.config);this.activeSetting&&this.activeSetting.code&&(s.theme=this.activeSetting.code),s.value=t,this.editor=monaco.editor.create(a,s),this.editor.onDidChangeModelContent((function(){if(-1!=e.$store.state.MAX_LINE){var t=e.editor.getModel().getLineCount();t>e.$store.state.MAX_LINE?e.$store.commit("isMaxLine",e.$store.state.isMaxLine+1):e.$store.commit("isMaxLine",0)}e.count>=1&&e.$emit("change",e.editor.getValue()),e.count++}))}}},mounted:function(){this.init(this.sqlData)}},c=l,u=(a("6778"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"e6009824",null);e["default"]=d.exports},ccad:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"审计日志",visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide,"append-to-body":"",center:""},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.sqlAuditData,border:!0,height:"680"}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.sql))])]}}])}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.sql_no)+" ")]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"sql",label:"SQL语句"}}),a("el-table-column",{attrs:{prop:"level",width:"120",label:"审核/执行状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showLevelTagType(e.row.level)}},[t._v(" "+t._s(t.showLevel(e.row.level))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"result",width:"200",label:"审核/执行信息"}}),a("el-table-column",{attrs:{prop:"affected_rows",label:"扫描/影响行数",width:"120"}}),a("el-table-column",{attrs:{prop:"execute_time",width:"100",label:"执行耗时"}}),a("el-table-column",{attrs:{prop:"stage_status",width:"200",label:"当前阶段"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showStageStatus(e.row.stage_status))+" ")]}}])})],1),a("el-form",[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.hide()}}},[t._v("关闭")])],1)],1)],1)])},n=[],o=a("6ace"),i={data:function(){return{id:"",work:{name:"",sql:""},title:"",is_admin:!1,isShow:!1,sqlAuditData:[]}},props:{logData:Array},methods:{showStageStatus:function(t){return this.$api.work.showStageStatus(t)},showStage:function(t){return this.$api.work.showStage(t)},showLevel:function(t){return this.$api.work.showLevelStyle(t)},showLevelTagType:function(t){return this.$api.work.showLevelTagType(t)},show:function(t,e){var a=this;this.id=t,this.$api.work.sqlAuditList(this.id,-1,-1).then((function(t){a.sqlAuditData=t.list})),this.isShow=!0,this.is_admin=e},showStatus:function(t){return this.$api.work.showStatus(t)},onChangeExecTime:function(){this.$refs.editExecTimeDialog.show(this.formData)},showExecTime:function(t){return 1==t.exec_flag?"不限":2==t.exec_flag?o["a"].formatTime(t.exec_start)+" 至 "+o["a"].formatTime(t.exec_end):"未知"},init:function(){var t=this;this.id?this.$api.work.sqlAuditList(this.formData.id,-1,-1).then((function(e){t.sqlAuditData=e.list})):this.onError("出错了，审计编号")},hide:function(){this.isShow=!1,this.is_admin=!1,this.id="",this.sqlAuditData=[],this.work={name:""},this.is_admin||this.$emit("hide")}},mounted:function(){},components:{}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},ccb0:function(t,e,a){},ccf4:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"申请权限",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"申请组"}},[a("el-input",{attrs:{disabled:""},model:{value:t.role.name,callback:function(e){t.$set(t.role,"name",e)},expression:"role.name"}})],1),a("el-form-item",{attrs:{label:"申请理由",prop:"opt_mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.opt_mark,callback:function(e){t.$set(t.formData,"opt_mark",e)},expression:"formData.opt_mark"}})],1),a("el-form-item",{attrs:{label:"审核人",prop:"auditor"}},[a("k-select",{attrs:{url:"/api/apply/manager/list"},model:{value:t.formData.auditor,callback:function(e){t.$set(t.formData,"auditor",e)},expression:"formData.auditor"}})],1),a("el-form-item",{attrs:{label:"抄送",prop:"copy_to"}},[a("k-select",{attrs:{url:"/api/apply/manager/list",multiple:!0},model:{value:t.formData.copy_to,callback:function(e){t.$set(t.formData,"copy_to",e)},expression:"formData.copy_to"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{role:{},isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t){this.role=t,this.formData.source_id=t.id,this.formData.source_type="role",this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.formData;t.$api.apply.applyRole(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}}))}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},cd27:function(t,e,a){},cda8:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"work padding-x-24"},[a("k-search-table",{ref:"st",attrs:{url:"/api/work/list","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"工单状态:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.status,callback:function(e){t.$set(t.search,"status",e)},expression:"search.status"}},t._l(t.work_states,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"编号",prop:"id",width:"120"}}),a("el-table-column",{attrs:{label:"工单名称",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"类型",prop:"type",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{title:t.showWorkType(e.row.type)}},[t._v(t._s(t.showWorkType(e.row.type)))])]}}])}),a("el-table-column",{attrs:{label:"发起人",prop:"create_name"}}),a("el-table-column",{attrs:{label:"项目",prop:"project_name"}}),a("el-table-column",{attrs:{label:"工单状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.showTagType(e.row.status)}},[t._v(t._s(t.showStatus(e.row.status)))])]}}])}),a("el-table-column",{attrs:{label:"发起时间",prop:"created_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"目标数据源",prop:"db_name"}}),a("el-table-column",{attrs:{label:"目标数据库",prop:"owner"}}),a("el-table-column",{attrs:{label:"是否备份"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.back_up?a("span",[t._v("是")]):a("span",[t._v("否")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkDetail(e.row)}}},[t._v("详情 ")]),1==e.row.back_up&&6==e.row.status?a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return t.goWorkBackUp(e.row)}}},[t._v("备份 ")]):t._e()]}}])})],1)],2),a("dialog-detail",{ref:"detailDialog",on:{refresh:t.refresh}}),a("dialog-backup",{ref:"backupDialog"}),a("dialog-apply-info",{ref:"applyInfoDialog",on:{refresh:t.refresh}})],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("2f62")),r=a("9992"),l=a("cdac"),c=a("096f"),u={computed:Object(o["a"])({},Object(i["c"])(["showWorkType"])),data:function(){return{search2:{db_type:null},search:{db_type:null,status:-1},work_states:[{k:-1,v:"全部"},{k:0,v:"待审核"},{k:1,v:"审核通过"},{k:2,v:"审核不通过"},{k:3,v:"人工终止流程"},{k:4,v:"定时执行"},{k:5,v:"执行中"},{k:68,v:"执行成功"},{k:7,v:"执行失败"}]}},props:{},watch:{},methods:{showTagType:function(t){return this.$api.work.showTagType(t)},goWorkBackUp:function(t){this.$refs.backupDialog.show(t.id,!0)},goWorkDetail:function(t){this.$refs.detailDialog.show(t.id,!0)},showStatus:function(t){return this.$api.work.showStatus(t)},refresh:function(){this.$refs.st.search()},resetSearch:function(){console.log("========resetSearch========="),this.search={status:-1}},reload:function(){this.$refs.st.reload()},openApplyInfo:function(t){this.$refs.applyInfoDialog.show(t)},onSync:function(t){var e=this;2==t.con_state?this.$api.db.refresh(t.id).then((function(t){e.onSuccess(t),e.reload()})):this.onSuccess("请修复连接后再进行操作！")},onReset:function(t){var e=this;this.$api.db.reset(t.id).then((function(){e.onSuccess("重置成功"),e.reload()}),(function(t){}))},onDel:function(t){var e=this;this.$api.db.delete(t.id).then((function(){e.onSuccess("删除成功"),e.reload()}))}},components:{DialogApplyInfo:r["default"],DialogDetail:l["default"],DialogBackup:c["default"]},mounted:function(){}},d=u,p=(a("56fa"),a("2877")),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},cdac:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"work-detail-dialog",attrs:{visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide,"append-to-body":""},on:{"update:visible":function(e){t.isShow=e}}},[a("div",{staticClass:"work-detail-dialog-title",attrs:{slot:"title"},slot:"title"},[a("span",[t._v(" 工单详情 ")]),a("el-button",{attrs:{size:"mini",type:"primary",round:"",icon:"el-icon-refresh"},nativeOn:{click:function(e){return t.onRefresh.apply(null,arguments)}}},[t._v("刷新")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.workInfoLoading,expression:"workInfoLoading"}]},[a("div",{staticClass:"box-card margin-b-10"},[a("el-table",{staticClass:"el-card is-always-shadow",staticStyle:{width:"100%"},attrs:{data:t.workData,"highlight-current-row":!0,border:!0,"row-class-name":"success-row"}},[a("el-table-column",{attrs:{prop:"name",label:"工单名称"}}),a("el-table-column",{attrs:{prop:"create_name",label:"发起人"}}),a("el-table-column",{attrs:{label:"工单状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{"font-weight":"bold",color:"red"}},[t._v(" "+t._s(t.showStatus(e.row.status))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"project_name",label:"项目"}}),a("el-table-column",{attrs:{prop:"db_name",label:"数据源/数据库"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.db_name)+"/"+t._s(e.row.owner)+" ")]}}])}),a("el-table-column",{attrs:{width:"120",prop:"project_name",label:"类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.showWorkType(e.row.type))+" ")]}}])}),a("el-table-column",{attrs:{prop:"sql_audit_auth_str",label:"审批流程"}}),a("el-table-column",{attrs:{prop:"cur_audit_str",label:"当前审批组"}}),a("el-table-column",{attrs:{prop:"db_name",label:"发起时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])})],1)],1),a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":t.tabHandleClick},model:{value:t.tabActiveName,callback:function(e){t.tabActiveName=e},expression:"tabActiveName"}},[a("el-tab-pane",{staticClass:"tabs-detail",attrs:{name:"detail",label:"工单详情"}},[t.formData.id?a("div",[a("el-form",{ref:"form",attrs:{"label-position":"left",model:t.formData,"label-suffix":":",rules:t.formRule}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工单编号"}},[t._v(" "+t._s(t.formData.id)+" ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发起人"}},[t._v(" "+t._s(t.formData.create_name)+" ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"工单状态"}},[a("span",{staticStyle:{"font-weight":"bold",color:"red"}},[t._v(t._s(t.showStatus(t.formData.status)))])])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目"}},[t._v(" "+t._s(t.formData.project_name)+" ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据源/数据库"}},[t._v(" "+t._s(t.formData.db_name)+"/"+t._s(t.formData.owner)+" ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"类型"}},[t._v(" "+t._s(t.showWorkType(t.formData.type))+" ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"目标数据库类型"}},[t._v(" "+t._s(t.formData.db_type)+" ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"是否备份"}},[1==t.formData.back_up?a("span",[t._v("是")]):a("span",[t._v("否")])])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"可执行时间范围"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.showExecTime(t.formData)))])],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审批流程"}},[t._v(" "+t._s(t.formData.sql_audit_auth_str)+" ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"当前审批组"}},[t._v(" "+t._s(t.formData.cur_audit_str)+" ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发起时间"}},[t._v(" "+t._s(t._f("dateTime")(t.formData.created_at))+" ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"最后更新时间"}},[t._v(" "+t._s(t._f("dateTime")(t.formData.updated_at))+" ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",[a("el-form-item",{attrs:{label:"工单描述"}},[t.formData.mark?a("el-input",{staticClass:"work-description",attrs:{type:"textarea",rows:4,readonly:!0,placeholder:"请输入内容"},model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}}):a("span",[t._v("无")])],1)],1)],1)],1)],1):t._e()]),a("el-tab-pane",{attrs:{name:"sql",label:"执行脚本",lazy:!0}},[t.sqlVisiable?a("div",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  执行脚本 ")]):a("el-badge",{staticClass:"item",attrs:{slot:"label",value:"查看"},slot:"label"},[a("i",{staticClass:"sn-font"},[t._v("")]),t._v("  执行脚本 ")]),t.showSql?a("work-sql",{ref:"workSql",attrs:{formData:t.formData}}):t._e()],1),a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:t.sqlAuditLoading,expression:"sqlAuditLoading"}],attrs:{name:"audit",label:"审计/执行日志"}},[a("sql-audit-log",{ref:"sqlAuditLog",attrs:{logData:t.sqlAuditData}}),a("el-pagination",{attrs:{"current-page":t.auditLogPages.pageNo,"page-sizes":[10,20,30,50],"page-size":t.auditLogPages.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.auditLogPages.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-tab-pane",{attrs:{name:"aciton",label:"审批/操作日志"}},[a("audit-log",{ref:"auditLog",attrs:{logData:t.logData}})],1)],1),a("el-card",{staticClass:"box-card action margin-top-10"},[a("el-form",{ref:"form2",attrs:{model:t.formData,"label-width":"80px"}},[0==t.formData.status||1==t.formData.status?a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",placeholder:"填写审核备注/终止原因"},model:{value:t.formData.cancel_remark,callback:function(e){t.$set(t.formData,"cancel_remark",e)},expression:"formData.cancel_remark"}})],1):t._e(),a("el-form-item",[t.is_admin&&0==t.formData.status?a("el-button",{attrs:{type:"primary",plain:""},on:{click:t.onChangeExecTime}},[t._v(" 执行时间变更 ")]):t._e(),t.is_admin&&0==t.formData.status?a("el-button",{attrs:{type:"success",plain:""},on:{click:t.onOk}},[t._v(" 审核通过 ")]):t._e(),1==t.formData.status?a("el-button",{attrs:{type:"danger",plain:""},on:{click:function(e){return t.onExec(5)}}},[t._v("立即执行")]):t._e(),1==t.formData.status&&1==t.formData.work_manual?a("k-btn-tip",{attrs:{tip:"确定已经手工执行成功？"},on:{click:function(e){return t.onExec(8)}}},[a("el-button",{staticStyle:{width:"100%"},attrs:{size:"medium",type:"primary"}},[t._v("手动执行")])],1):t._e(),0==t.formData.status||1==t.formData.status?a("el-button",{attrs:{type:"warning",plain:""},on:{click:t.onCancel}},[t._v(" 终止流程 ")]):t._e()],1)],1)],1),a("dialog-edit-exec-time",{ref:"editExecTimeDialog",on:{refresh:t.init}}),a("dialog-exec-scheduler",{ref:"execSchedulerDialog",on:{refresh:t.init}})],1)])},n=[],o=a("5530"),i=(a("ac1f"),a("d3b7"),a("2f62")),r=a("5c96"),l=a("2ef0"),c=a("6ace"),u=a("9672"),d=a("39e7"),p=a("e649"),f=a("344a"),m=a("4683"),h={components:{AuditLog:u["default"],WorkSql:p["default"],SqlAuditLog:d["default"],DialogEditExecTime:m["default"],DialogExecScheduler:f["default"]},computed:Object(o["a"])({},Object(i["c"])(["showWorkType"])),data:function(){return{from:null,workInfoLoading:!1,tabActiveName:"detail",sqlVisiable:!1,sqlAuditLoading:!1,auditLogPages:{pageNo:1,pageSize:10,total:0},id:"",showSql:!1,is_admin:!1,isShow:!1,workData:[],sqlAuditData:[],logData:[],logData2:[],disabled:!0,config:{lang:"sql"},formData:{cancel_remark:"",id:"",source_type:"none",source_id:"none",sql:"",has_auth:!1,can_review:!1},formRule:{mark:[{required:!1,message:"请输入描述"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},methods:{onRefresh:function(){this.show(this.id,!0)},tabHandleClick:function(){"sql"==this.tabActiveName?this.sqlVisiable=!0:"audit"==this.tabActiveName&&"执行中"==this.showStatus(this.formData.status)||"action"==this.tabActiveName&&this.showStatus(this.formData.status)},handleSizeChange:function(t){this.auditLogPages.pageSize=t,this.sqlAuditList(),console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){this.auditLogPages.pageNo=t,this.sqlAuditList(),console.log("当前页: ".concat(t))},goWorkBackUp:function(){this.$refs.backupDialog.show(this.id)},show:function(t,e,a){var s=this;this.id=t,this.from=a,this.$nextTick((function(){s.init(),s.isShow=!0,s.is_admin=e}))},showType:function(t){return 1==t?"DML":2==t?"DDL":"未知类型"},showStatus:function(t){return this.$api.work.showStatus(t)},onExec:function(t){var e=this,a=r["Loading"].service({fullscreen:!0,background:"transparent"});this.$api.work.exec(this.formData.id,t).then((function(t){a.close(),e.onSuccess("执行成功"),e.init(!0)}),(function(t){a.close();var s="参数错误！";"301"!=t.result&&(s=t.data),e.onError(s),e.init(!0)}))},onOk:function(){this.onSubmit("ok")},onFail:function(){this.onSubmit("fail")},onExecScheduler:function(){this.$refs.execSchedulerDialog.show(this.formData)},onChangeExecTime:function(){this.$refs.editExecTimeDialog.show(this.formData)},showExecTime:function(t){return 1==t.exec_flag?"不限":2==t.exec_flag?c["a"].formatTime(t.exec_start)+" 至 "+c["a"].formatTime(t.exec_end):"未知"},init:function(t){var e=this;this.id&&(this.workInfoLoading=!0,this.$api.work.info(this.id).then((function(t){e.formData=t,e.workData=[t],e.showSql=!0,e.refreshLog()})).finally((function(){setTimeout((function(){e.workInfoLoading=!1}),400)})),t&&this.$emit("refresh"))},hide:function(){this.from=null,this.tabActiveName="detail",this.sqlVisiable=!1,this.isShow=!1,this.is_admin=!1,this.id="",this.formData={sql:""},this.showSql=!1,this.workData=[]},refreshLog:function(){var t=this;this.$api.work.logList(this.formData.id,-1,-1).then((function(e){t.logData=e.list,t.logData&&t.logData.length>0?t.logData2=[t.logData[0]]:t.logData2=[{opt_info:"无"}]})),this.sqlAuditList()},sqlAuditList:function(){var t=this;this.sqlAuditLoading=!0,this.$api.work.sqlAuditList(this.formData.id,this.auditLogPages.pageNo-1,this.auditLogPages.pageSize).then((function(e){t.auditLogPages=Object(o["a"])(Object(o["a"])({},t.auditLogPages),{},{total:e.count}),t.sqlAuditData=e.list})).finally((function(){setTimeout((function(){t.sqlAuditLoading=!1}),200)}))},onCancel:function(){var t=this,e=this.formData;if(e.cancel_remark){var a=1;this.is_admin&&(a=2),this.$api.work.cancel({id:e.id,cancel_remark:e.cancel_remark,flag:a}).then((function(){t.onSuccess("取消成功"),t.init(!0)}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}else this.onError("请输入终止原因")},onSubmit:function(t){var e=this,a=arguments,s=r["Loading"].service({fullscreen:!0,background:"transparent"}),n=Object(l["clone"])(this.formData);if("ok"==t)n.status=1;else if("fail"==t)n.status=2;else{if("cancel"!=t)return void this.onError("非法的审核结果");n.status=3}this.$api.work.audit(n).then((function(){e.onSuccess("操作成功"),e.init(!0),s.close()})).catch((function(t){console.error("[dialog.detail.vue]#onSubmit",a,t)})).finally((function(){s.close()}))}},mounted:function(){}},b=h,_=(a("424c"),a("4f4e"),a("2877")),g=Object(_["a"])(b,s,n,!1,null,null,null);e["default"]=g.exports},cead:function(t,e,a){},ceeb:function(t,e,a){},cf60:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.backupLoading,expression:"backupLoading"}],staticClass:"component-policy"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.onBackup(1)}}},[t._v(" 本地备份 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.onBackup(2)}}},[t._v(" 远程备份 ")]),a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("设置 ")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.getList}},[t._v(" 刷新 ")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{stripe:"",border:"","row-key":"id",data:t.tableData}},[a("el-table-column",{attrs:{prop:"created_at",label:"备份时间"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("dateTime")(a.created_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"file_name",label:"文件名"}}),a("el-table-column",{attrs:{prop:"file_size",label:"文件大小"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.file_size/1e3)+"kb ")]}}])}),a("el-table-column",{attrs:{prop:"back_up_state",label:"备份结果"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[0==s.back_up_state?a("el-tag",[t._v("允许")]):1==s.back_up_state?a("el-tag",{attrs:{type:"success"}},[t._v("成功")]):2==s.back_up_state?a("el-tooltip",{attrs:{content:s.error_msg,placement:"bottom",effect:"light"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(" 失败 ")])],1):a("el-tag",{attrs:{type:"danger"}},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{prop:"back_up_type",label:"备份方案"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[1==s.back_up_type?a("el-tag",[t._v("本地备份")]):2==s.back_up_type?a("el-tag",[t._v("远程备份")]):a("el-tag",{attrs:{type:"danger"}},[t._v("未知")])]}}])}),a("el-table-column",{attrs:{prop:"restore_time",label:"恢复时间",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.format(a.restore_time))+" ")]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-link",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.restoreHandle(s)}}},[t._v("恢复备份")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-link",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteHandle(s)}}},[t._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:t.dialogVisible,width:"40%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" FTP远程备份设置 ")]),a("div",[a("el-form",{ref:"ftp_form",staticStyle:{"padding-left":"20px","padding-right":"20px"},attrs:{model:t.form,"label-width":"80px",rules:t.rules}},[a("el-form-item",{attrs:{label:"IP地址",prop:"ftp_addr"}},[a("el-input",{attrs:{placeholder:"IP地址或者域名"},model:{value:t.form.ftp_addr,callback:function(e){t.$set(t.form,"ftp_addr",e)},expression:"form.ftp_addr"}})],1),a("el-form-item",{attrs:{label:"端口号",prop:"ftp_port"}},[a("el-input",{attrs:{placeholder:"端口号,默认21"},model:{value:t.form.ftp_port,callback:function(e){t.$set(t.form,"ftp_port",e)},expression:"form.ftp_port"}})],1),a("el-form-item",{attrs:{label:"账号",prop:"ftp_user"}},[a("el-input",{attrs:{placeholder:"账号名"},model:{value:t.form.ftp_user,callback:function(e){t.$set(t.form,"ftp_user",e)},expression:"form.ftp_user"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"ftp_pwd"}},[a("el-input",{attrs:{placeholder:"密码","show-password":"","auto-complete":"new-password"},model:{value:t.form.ftp_pwd,callback:function(e){t.$set(t.form,"ftp_pwd",e)},expression:"form.ftp_pwd"}})],1),a("el-form-item",{attrs:{label:"上传目录",prop:"ftp_path"}},[a("el-input",{attrs:{placeholder:"示例/dir"},model:{value:t.form.ftp_path,callback:function(e){t.$set(t.form,"ftp_path",e)},expression:"form.ftp_path"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateBackUp}},[t._v("保存配置")])],1)])],1)},n=[],o=(a("d3b7"),a("c1df")),i=a.n(o),r={props:{setting:Object,default:function(){return{}}},watch:{setting:"resetForm"},computed:{format:function(){return function(t){return i()(t).format("YYYY-MM-DD HH:mm:ss")}}},data:function(){return{tableLoading:!1,backupLoading:!1,tableData:[],dialogVisible:!1,form:{back_up_mode:1,ftp_addr:"",ftp_port:21,ftp_user:"",ftp_pwd:""},states:[{k:0,v:"全部"},{k:1,v:"成功"},{k:2,v:"失败"}],search:{back_up_state:0,type:0,dateRange:[i()().startOf("d").toDate(),i()().endOf("d").toDate()]},rules:{ftp_addr:[{required:!0,message:"请输入地址"}],ftp_port:{required:!0,message:"请输入端口号",trigger:"blur"},ftp_user:{required:!0,message:"请输入账号",trigger:"blur"},ftp_pwd:{required:!0,message:"请输入密码",trigger:"blur"},ftp_path:{required:!0,message:"请输入服务端路径",trigger:"blur"}}}},mounted:function(){this.getList()},methods:{updateBackUp:function(){var t=this;this.$refs.ftp_form.validate((function(e){e&&t.$api.setting.updateBackUpConfig(t.form).then((function(e){t.$message({type:"success",message:"保存成功!"}),t.$emit("refresh"),t.dialogVisible=!1}))}))},resetForm:function(){this.setting&&this.setting.backup_conf?this.form=this.setting.backup_conf:this.form={back_up_mode:1,ftp_port:21,ftp_addr:"",ftp_user:"",ftp_pwd:""}},getList:function(){var t=this;this.tableLoading=!0,this.$api.setting.backupList({page_no:-1,page_size:-1}).then((function(e){t.tableData=e.list})).finally((function(){t.tableLoading=!1}))},deleteHandle:function(t){var e=this;console.log("删除行：",t.id),this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$api.setting.backupDel(t.id).then((function(t){console.log("删除成功：",t),e.$message({type:"success",message:"删除成功!"}),e.getList()}))}))},restoreHandle:function(t){var e=this;this.$confirm("确定恢复当前备份?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.backupLoading=!0,e.$api.setting.restore_backup(t.id).then((function(){e.backupLoading=!1,e.$message({type:"success",message:"恢复成功!"}),e.getList()})).catch((function(t){e.getList(),e.backupLoading=!1}))}))},onBackup:function(t){var e=this;this.backupLoading=!0,this.$api.setting.backup({back_up_type:t}).then((function(t){console.log("备份成功：",t),e.$message({type:"success",message:"备份成功!"}),e.getList(),e.backupLoading=!1})).catch((function(t){e.getList(),e.backupLoading=!1}))}}},l=r,c=(a("f535"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"26b26a94",null);e["default"]=u.exports},cf8f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-mysql-key-cache"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/mysql/status","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:60},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"缓存"}},[a("el-table-column",{attrs:{label:"key_buffer",prop:"key_buffer_size"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("kb")(e.row.key_buffer_size,"m")))]}}])}),a("el-table-column",{attrs:{label:"sort_buffer",prop:"sort_buffer_size"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("kb")(e.row.sort_buffer_size)))]}}])}),a("el-table-column",{attrs:{label:"join_buffer",prop:"join_buffer_size"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("kb")(e.row.join_buffer_size)))]}}])})],1),a("el-table-column",{attrs:{label:"key_blocks"}},[a("el-table-column",{attrs:{label:"unused",prop:"key_blocks_unused"}}),a("el-table-column",{attrs:{label:"used",prop:"key_blocks_used"}}),a("el-table-column",{attrs:{label:"not_flushed",prop:"key_blocks_not_flushed"}})],1),a("el-table-column",{attrs:{label:"rate"}},[a("el-table-column",{attrs:{label:"key_blocks_used",prop:"key_blocks_used_rate"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("per")(e.row.key_blocks_used_rate)))]}}])}),a("el-table-column",{attrs:{label:"key_buffer_read",prop:"key_buffer_read_rate"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("per")(e.row.key_buffer_read_rate)))]}}])}),a("el-table-column",{attrs:{label:"key_buffer_write",prop:"key_buffer_write_rate"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("per")(e.row.key_buffer_write_rate)))]}}])})],1)],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{}}},computed:{},props:{},watch:{},methods:{onData:function(t){t&&t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("b4c7"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},cfcd:function(t,e,a){},cfd2:function(t,e,a){},d001:function(t,e,a){},d024:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"收藏",visible:t.isShow,"custom-class":"dialog-favorite",width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"SQL"}},[a("el-input",{attrs:{type:"textarea",autosize:{maxRow:10}},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)},n=[],o=a("5530"),i=a("2f62"),r=a("365c"),l={data:function(){return{isShow:!1,formData:{},treeData:[],treeProps:{label:"name"}}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user","sys"])),methods:{show:function(t){this.isShow=!0,this.formData=Object(o["a"])({},t)},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this,e=this.formData;this.sys.encrypt_sql&&(e.content=r["default"].util.aesEncrypted(e.content)),this.$api.favorite.upd(e).then((function(){t.onSuccess("更新成功"),t.hide(),t.$emit("refresh")}))}},mounted:function(){},components:{}},c=l,u=(a("8537"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},d046:function(t,e,a){"use strict";a.d(e,"b",(function(){return jt}));var s=a("2909"),n=(a("99af"),a("5530")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"layout-header-aside d2-layout-header-aside-group",class:{grayMode:t.grayActive},style:t.styleLayoutMainGroup},[a("div",{staticClass:"d2-layout-header-aside-mask"}),a("div",{staticClass:"d2-layout-header-aside-content",attrs:{flex:"dir:top"}},[a("div",{staticClass:"d2-theme-header",style:{opacity:this.searchActive?.5:1},attrs:{"flex-box":"0",flex:""}},[a("router-link",{staticClass:"logo-group",class:{"logo-group-collapse":t.asideCollapse,"logo-transition":t.asideTransition},attrs:{to:"/","flex-box":"0"}},[t.asideCollapse?a("img",{staticClass:"aside-collapse",attrs:{src:t.$baseUrl+"image/theme/"+t.themeActiveSetting.name+"/logo/icon-only.png"}}):a("img",{staticClass:"un-aside-collapse h-3/5",attrs:{src:t.$baseUrl+"image/theme/"+t.themeActiveSetting.name+"/logo/all.png"}})]),a("div",{staticClass:"flex",staticStyle:{"padding-left":"50px"},attrs:{"flex-box":"1"}},[a("d2-menu-header")],1),a("div",{staticClass:"d2-header-right",attrs:{"flex-box":"0"}},[a("d2-header-search",{on:{click:t.handleSearchClick}}),t.isDev?a("d2-header-log"):t._e(),a("el-divider",{attrs:{direction:"vertical"}}),a("d2-header-size"),a("d2-header-notice"),a("d2-header-user")],1)],1),a("div",{staticClass:"d2-theme-container",attrs:{"flex-box":"1",flex:""}},[a("div",{staticClass:"d2-theme-container-main",attrs:{"flex-box":"1",flex:""}},[a("transition",{attrs:{name:"fade-scale"}},[t.searchActive?a("div",{staticClass:"d2-theme-container-main-layer",attrs:{flex:""}},[a("d2-panel-search",{ref:"panelSearch",on:{close:t.searchPanelClose}})],1):t._e()]),a("transition",{attrs:{name:"fade-scale"}},[t.searchActive?t._e():a("div",{staticClass:"d2-theme-container-main-layer",attrs:{flex:"dir:top"}},[a("div",{staticClass:"d2-theme-container-main-header",attrs:{"flex-box":"0"}},[a("d2-tabs",{attrs:{lock:t.isLockTabs}})],1),a("div",{staticClass:"d2-theme-container-main-body",attrs:{"flex-box":"1"}},[a("transition",{attrs:{name:t.transitionActive&&!t.isProjectPage?"fade-transverse":""}},[a("keep-alive",{attrs:{include:t.keepAlive}},[a("router-view",{key:t.routerViewKey})],1)],1)],1)])])],1)])])])},i=[],r=(a("b0c0"),a("1da1")),l=(a("96cf"),a("caad"),a("2532"),a("a434"),a("d81d"),a("2ef0")),c=a("2f62"),u=a("b55f"),d=a("8f54");function p(t,e,a){var s=null;return s=e.icon?t("i",{class:"fa fa-".concat(e.icon)}):e.iconSvg?t("d2-icon-svg",{attrs:{name:e.iconSvg}}):e.iconfont?t("k-icon",{attrs:{icon:"".concat(e.iconfont)}}):t("i",{class:"fa fa-file-o"}),t("el-menu-item",{class:a||"",key:e.path,attrs:{index:e.path}},[s,t("span",{slot:"title"},[e.title||"未命名菜单"])])}function f(t,e,a){var s=this,n=null;return n=e.icon?t("i",{slot:"title",class:"fa fa-".concat(e.icon)}):e.iconSvg?t("d2-icon-svg",{slot:"title",attrs:{name:e.iconSvg}}):e.iconfont?t("k-icon",{slot:"title",attrs:{icon:"".concat(e.iconfont)}}):t("i",{slot:"title",class:"fa fa-folder-o"}),"group"===e.type?t("el-menu-item-group",{key:e.path,attrs:{index:e.path}},[t("span",{slot:"title"},[e.title||"未命名菜单"]),e.children.map((function(e){return m.call(s,t,e,a)}))]):t("el-submenu",{class:a||"",key:e.path,attrs:{index:e.path}},[n,t("span",{slot:"title"},[e.title||"未命名菜单"]),e.children.map((function(e){return m.call(s,t,e,a)}))])}function m(t,e,a){return void 0===e.children?p.call(this,t,e,a):f.call(this,t,e,a)}var h=a("830e");function b(t,e){for(var a=e.length-1;a>=0;a--){var s=e[a];s.role&&(s.role.includes(t)?s.children&&b(t,s.children):e.splice(a,1))}return e}var _={name:"d2-layout-header-aside-menu-header",mixins:[u["a"]],render:function(t){var e=this;return t("div",{attrs:{flex:"cross:center"},class:{"d2-theme-header-menu":!0,"is-scrollable":this.isScroll},ref:"page"},[t("div",{ref:"content",class:"d2-theme-header-menu__content",attrs:{"flex-box":"1",flex:!0}},[t("div",{class:"d2-theme-header-menu__scroll",attrs:{"flex-box":"0"},style:{transform:"translateX(".concat(this.currentTranslateX,"px)")},ref:"scroll"},[t("el-menu",{attrs:{"popper-clas":"d2-theme-header-custom",mode:"horizontal",defaultActive:this.active},on:{select:this.handleMenuSelect}},[this.header.map((function(a){return m.call(e,t,a,"d2-theme-header-custom-submenu")}))])])]),this.isScroll?[t("div",{class:"d2-theme-header-menu__prev",attrs:{flex:"main:center cross:center","flex-box":"0"},on:{click:function(){return e.scroll("left")}}},[t("i",{class:"el-icon-arrow-left"})]),t("div",{class:"d2-theme-header-menu__next",attrs:{flex:"main:center cross:center","flex-box":"0"},on:{click:function(){return e.scroll("right")}}},[t("i",{class:"el-icon-arrow-right"})])]:[]])},computed:Object(n["a"])(Object(n["a"])({},Object(c["e"])("d2admin/menu",["header"])),Object(c["e"])(["dashboard_project","user","myProjectList"])),data:function(){return{active:"",isScroll:!1,scrollWidth:0,contentWidth:0,currentTranslateX:0,throttledCheckScroll:null}},watch:{"$route.matched":{handler:function(t){this.active=t[t.length-1].path},immediate:!0},dashboard_project:function(t){this.initMenuSide(Object(l["isEmpty"])(t)?[]:[t]),this.resetHeaderMenus()}},created:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("myProjectList");case 2:return e.next=4,t.$store.dispatch("projectAllList");case 4:t.initMenuSide(Object(l["isEmpty"])(t.dashboard_project)?[]:[t.dashboard_project]),t.resetHeaderMenus();case 6:case"end":return e.stop()}}),e)})))()},methods:{initMenuSide:function(t){var e=[];if(t&&t.length>0){var a=Object(l["cloneDeep"])(h["a"]);delete a.children,e.push(a)}var s=null;if(s=d["b"],e.length){var n=s.shift();s.unshift(e[0]),s.unshift(n)}this.$store.commit("d2admin/menu/headerSet",s||[]),this.$store.commit("d2admin/search/init",s||[])},resetHeaderMenus:function(t){var e=t||this.user.role||0;if(!e)return window.$log.error("[app.vue]#resetHeaderMenus 用户.role为空",arguments),!1;var a=Object(l["cloneDeep"])(this.header),s=b(e,a);this.$store.commit("d2admin/menu/headerSet",s),this.$store.commit("d2admin/search/init",s)},scroll:function(t){"left"===t?this.currentTranslateX=0:2*this.contentWidth-this.currentTranslateX<=this.scrollWidth?this.currentTranslateX-=this.contentWidth:this.currentTranslateX=this.contentWidth-this.scrollWidth},checkScroll:function(){var t=this,e=this.$refs.content.clientWidth,a=this.$refs.scroll.clientWidth;this.isScroll&&(this.contentWidth-this.scrollWidth===this.currentTranslateX&&(this.currentTranslateX=e-a,this.currentTranslateX>0&&(this.currentTranslateX=0)),this.contentWidth=e,this.scrollWidth=a,e>a&&(this.isScroll=!1)),!this.isScroll&&e<a&&(this.isScroll=!0,this.$nextTick((function(){e=t.$refs.content.clientWidth,a=t.$refs.scroll.clientWidth,t.contentWidth=e,t.scrollWidth=a,t.currentTranslateX=0})))}},mounted:function(){this.checkScroll(),this.throttledCheckScroll=Object(l["throttle"])(this.checkScroll,300),window.addEventListener("resize",this.throttledCheckScroll)},beforeDestroy:function(){window.removeEventListener("resize",this.throttledCheckScroll)}},g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d2-multiple-page-control-group",attrs:{flex:""}},[a("div",{staticClass:"d2-multiple-page-control-content",attrs:{"flex-box":"1"}},[a("div",{staticClass:"d2-multiple-page-control-content-inner"},[a("d2-contextmenu",{attrs:{visible:t.contextmenuFlag,x:t.contentmenuX,y:t.contentmenuY,size:{width:115,height:0}},on:{"update:visible":function(e){t.contextmenuFlag=e}}},[a("d2-contextmenu-list",{attrs:{menulist:"/index"===t.tagName?t.contextmenuListIndex:t.contextmenuList},on:{rowClick:t.contextmenuClick}})],1),a("el-tabs",{staticClass:"d2-multiple-page-control d2-multiple-page-sort",attrs:{value:t.currentTab,type:t.getTabsType},on:{"tab-click":t.handleClick,"tab-remove":t.handleTabRemove},nativeOn:{contextmenu:function(e){return t.handleContextmenu.apply(null,arguments)}}},t._l(t.opened,(function(e){return a("el-tab-pane",{key:e.fullPath,attrs:{disabled:t.lock,name:e.fullPath,closable:t.isTabClosable(e)}},[a("span",{staticClass:"control-tabs-span",class:"control-tabs-span-"+e.name,staticStyle:{width:"100%"},attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(t.getTabName(e))+" ")])])})),1)],1)]),a("div",{staticClass:"d2-multiple-page-control-btn",attrs:{"flex-box":"0"}},[a("el-dropdown",{attrs:{size:"default","split-button":""},on:{click:t.closeAll,command:function(e){return t.handleControlItemClick(e)}}},[a("d2-icon",{attrs:{name:"times-circle"}}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"left"}},[a("d2-icon",{staticClass:"d2-mr-10",attrs:{name:"arrow-left"}}),t._v(" 关闭左侧 ")],1),a("el-dropdown-item",{attrs:{command:"right"}},[a("d2-icon",{staticClass:"d2-mr-10",attrs:{name:"arrow-right"}}),t._v(" 关闭右侧 ")],1),a("el-dropdown-item",{attrs:{command:"other"}},[a("d2-icon",{staticClass:"d2-mr-10",attrs:{name:"times"}}),t._v(" 关闭其它 ")],1),a("el-dropdown-item",{attrs:{command:"all"}},[a("d2-icon",{staticClass:"d2-mr-10",attrs:{name:"times-circle"}}),t._v(" 全部关闭 ")],1)],1)],1)],1)])},v=[],y=(a("d3b7"),a("3ca3"),a("ddb0"),a("fb6a"),a("7db09"),a("aa47")),w={components:{D2Contextmenu:function(){return a.e("chunk-5897952c").then(a.bind(null,"362c"))},D2ContextmenuList:function(){return a.e("chunk-2f53076e").then(a.bind(null,"609e"))}},props:{lock:{type:Boolean,default:function(){return!1}}},data:function(){return{contextmenuFlag:!1,contentmenuX:0,contentmenuY:0,contextmenuListIndex:[{icon:"times-circle",title:"关闭全部",value:"all"}],contextmenuList:[{icon:"refresh",title:"刷新",value:"refresh"},{icon:"arrow-left",title:"关闭左侧",value:"left"},{icon:"arrow-right",title:"关闭右侧",value:"right"},{icon:"times",title:"关闭其它",value:"other"},{icon:"times-circle",title:"关闭全部",value:"all"}],tagName:"/index"}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(c["e"])("d2admin/page",["opened","current"])),Object(c["e"])("d2admin/theme",["activeName"])),Object(c["e"])(["myProjectList"])),{},{getTabsType:function(){return"card"},currentTab:function(){return this.current},getTabName:function(){return function(t){return t.meta.title||"未命名"}}}),methods:Object(n["a"])(Object(n["a"])({},Object(c["b"])("d2admin/page",["close","closeLeft","closeRight","closeOther","closeAll","openedSort"])),{},{isTabClosable:function(t){return"index"!==t.name},handleContextmenu:function(t){var e=t.target,a=!1;e.className.indexOf("el-tabs__item")>-1?a=!0:e.parentNode.className.indexOf("el-tabs__item")>-1&&(e=e.parentNode,a=!0),a&&(t.preventDefault(),t.stopPropagation(),this.contentmenuX=t.clientX,this.contentmenuY=t.clientY,this.tagName=e.getAttribute("aria-controls").slice(5),this.contextmenuFlag=!0)},contextmenuClick:function(t){this.handleControlItemClick(t,this.tagName)},handleControlItemClick:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&(this.contextmenuFlag=!1);var a={pageSelect:e};switch(t){case"refresh":this.$router.push({name:"refresh"});break;case"left":this.closeLeft(a);break;case"right":this.closeRight(a);break;case"other":this.closeOther(a);break;case"all":this.closeAll();break;default:this.$message.error("无效的操作");break}},handleClick:function(t,e){var a=this.opened.find((function(e){return e.fullPath===t.name}));if(a){var s=a.name,n=a.params,o=a.query;this.$router.push({name:s,params:n,query:o})}},handleTabRemove:function(t){this.close({tagName:t})}}),mounted:function(){var t=this,e=document.querySelectorAll(".d2-multiple-page-sort .el-tabs__nav")[0];y["a"].create(e,{filter:".el-tabs__active-bar",direction:"horizontal",onEnd:function(e){var a=e.oldIndex,s=e.newIndex;a!=s?(0==s&&(window.$log.dev("数据补偿"),a--),a!=s?(window.$log.dev("evt: ",e),t.openedSort({oldIndex:a,newIndex:s})):window.$log.dev("拖拽无操作")):window.$log.dev("拖拽无操作")}})}},S=w,E=(a("6fd9"),a("2877")),k=Object(E["a"])(S,g,v,!1,null,null,null),x=k.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-button",{staticClass:"d2-mr btn-text can-hover",staticStyle:{color:"#909399"},attrs:{type:"text"},on:{click:t.handleClick}},[a("k-icon",{attrs:{icon:"icon-ziyuan"}})],1)},C=[],O={methods:{handleClick:function(){this.$emit("click")}}},D=O,A=Object(E["a"])(D,T,C,!1,null,null,null),L=A.exports,R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dropdown",{attrs:{placement:"bottom",size:"small"},on:{command:t.handleChange}},[a("el-button",{staticClass:"d2-mr btn-text can-hover",staticStyle:{color:"#909399"},attrs:{type:"text"}},[a("k-icon",{staticStyle:{"font-size":"16px"},attrs:{icon:"icon-ziti"}})],1),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.options,(function(e){return a("el-dropdown-item",{key:e.value,attrs:{command:e.value}},[a("d2-icon",{staticClass:"d2-mr-5",attrs:{name:t.iconName(e.value)}}),t._v(t._s(e.label)+" ")],1)})),1)],1)},I=[],j={name:"d2-header-size",data:function(){return{options:[{label:"小",value:"12px"},{label:"默认（推荐）",value:"13px"},{label:"中",value:"14px"},{label:"大",value:"16px"}]}},computed:Object(n["a"])({},Object(c["e"])("d2admin/size",["value"])),methods:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(c["d"])({pageKeepAliveClean:"d2admin/page/keepAliveClean"})),Object(c["b"])({sizeSet:"d2admin/size/set"})),{},{handleChange:function(t){this.sizeSet(t),this.$notify({title:"提示",dangerouslyUseHTMLString:!0,message:"已更新页面内 <b>组件</b> 的 <b>默认尺寸</b>",type:"success"})},iconName:function(t){return t===this.value?"dot-circle-o":"circle-o"}})},N=j,P=Object(E["a"])(N,R,I,!1,null,null,null),$=P.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dropdown",{ref:"dropdown",staticClass:"header-notice",attrs:{placement:"bottom",size:"small"},on:{"visible-change":t.onVisibleChange}},[a("el-button",{staticClass:"d2-mr btn-text can-hover",staticStyle:{color:"#909399"},attrs:{type:"text"}},[a("el-badge",{staticClass:"item",attrs:{value:t.statData.total}},[a("k-icon",{staticStyle:{"font-size":"16px"},attrs:{icon:"icon-tongzhi"}})],1)],1),a("el-dropdown-menu",{staticClass:"notice-tabs-parent",attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"h-full",on:{"tab-click":t.onTabClick},model:{value:t.tabActiveValue,callback:function(e){t.tabActiveValue=e},expression:"tabActiveValue"}},t._l(t.tabs,(function(e,s){return a("el-tab-pane",{key:s,attrs:{label:e.label,name:e.msgType}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("el-badge",{staticClass:"item",attrs:{value:t.getBadgeValue(e.statkey)}},[t._v(" "+t._s(e.label)+" ")])],1)])})),1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.msgListLoading,expression:"msgListLoading"}],staticClass:"content"},[a("div",{staticClass:"flex-1  header-msg-list min-max overflow-x-auto",class:{"flex items-center justify-center":!t.getBadgeValue(t.currentTab.statkey)}},[a("msg-list",{ref:"msgListRef",attrs:{config:t.msgListConfig},on:{paged:t.onPaged}})],1),a("div",{staticClass:"tools flex justify-end items-center px-5",class:{"justify-between ":t.statData[t.currentTab.statkey]},staticStyle:{height:"30px","border-top":"1px solid #fdfdfd"}},[t.statData[t.currentTab.statkey]?a("span",{staticClass:"cursor-pointer text-gray-200 hover:text-gray-50 active:opacity-75",on:{click:t.onReadAll}},[t._v(" 当前标记为已读 ")]):t._e(),a("span",{staticClass:"cursor-pointer text-gray-200 hover:text-gray-50 active:opacity-75",on:{click:function(e){return t.onViewAll(t.currentTab)}}},[t._v(" 全部查看 ")])])])],1)],1)},U=[],q=(a("4de4"),a("18b0")),F=a("3de1"),V={name:"d2-header-notice",components:{MsgList:q["a"]},computed:{msgListConfig:function(){return{mod:"header",lazy:!1,read_state:1,open_page:!1,msg_type:this.currentTab.msgType}},getBadgeValue:function(){var t=this;return function(e){return t.statData[e]}}},data:function(){return{msgListLoading:!1,loading:!1,dropdownVisible:!1,noticeTimer:null,tabActiveValue:"1",currentTab:{label:"系统消息",msgType:"1",statkey:"sys_msg_count",path:"/personal/notice"},tabs:[{label:"系统消息",msgType:"1",statkey:"sys_msg_count",path:"/personal/notice"},{label:"私信",msgType:"2",statkey:"msg_count",path:"/personal/notice/personal"}],statData:{total:null,sys_msg_count:null,msg_count:null},faviconMsgPath:"/favicon-msg.ico",faviconPath:"/favicon.ico"}},methods:{onPaged:function(){this.msgListLoading=!1},onTabClick:function(t){this.msgListLoading=!0,this.currentTab=this.tabs.filter((function(e){return t.name==e.msgType}))[0]},onVisibleChange:function(t){var e=this;this.dropdownVisible=t,t?(this.getNoticeState(),this.statData.total&&"1"==this.tabActiveValue&&(this.statData.sys_msg_count?this.tabActiveValue="1":this.statData.msg_count&&(this.tabActiveValue="2")),this.currentTab=this.tabs.filter((function(t){return e.tabActiveValue==t.msgType}))[0],this.$refs.msgListRef?this.$refs.msgListRef.refresh(this.msgListConfig):console.error("[header-notice]#onVisibleChange this.$refs.msgListRef undefined")):this.loading=!1},onReadAll:function(){var t=this;this.$refs.msgListRef.readAll().then((function(){t.onVisibleChange(!0)}))},onViewAll:function(t){this.$refs.dropdown.hide(),this.$router.push(t.path)},getNoticeState:function(){var t=this;this.$api.my.myMsgState().then((function(e){var a=e.sys_msg_count+e.msg_count||null;t.statData={total:a,sys_msg_count:e.sys_msg_count||null,msg_count:e.msg_count||null},a?Object(F["a"])(t.faviconMsgPath):Object(F["a"])(t.faviconPath)}))}},mounted:function(){var t=this;this.getNoticeState(),this.$bus.off("header-notice-refresh"),this.$bus.on("header-notice-refresh",(function(){t.getNoticeState(),t.dropdownVisible&&t.onVisibleChange(!0)})),window.clearInterval(this.noticeTimer),this.noticeTimer=setInterval((function(){console.log("定时查询..."),t.getNoticeState()}),6e4)},beforeMount:function(){window.clearInterval(this.noticeTimer),this.noticeTimer=null}},z=V,B=(a("ebfe"),Object(E["a"])(z,M,U,!1,null,"7480b630",null)),H=B.exports,Y=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-menu",{attrs:{mode:"horizontal"}},[a("el-submenu",{staticStyle:{float:"right"},attrs:{"popper-class":"avatar-menus",index:"2"}},[a("template",{slot:"title"},[a("el-avatar",{staticClass:"border border-gray-50",staticStyle:{height:"25px",width:"25px","line-height":"25px"},attrs:{src:t.user.user_avatar}},[t._v(" "+t._s(t.userName)+" ")])],1),t._l(t.list,(function(e,s){return["divider"==e.type?a("el-divider",{key:s,staticClass:"m-1"}):e.children?s!==t.list.length-2?a("el-submenu",{key:s+"2",attrs:{"popper-class":"avatar-menus-sub",index:e.key}},[a("template",{slot:"title"},[e.iconSvg?a("d2-icon-svg",{attrs:{name:e.iconSvg}}):e.iconfont?a("k-icon",{attrs:{icon:e.iconfont}}):e.icon?a("d2-icon",{attrs:{name:e.icon}}):t._e(),t._v(" "+t._s(e.title)+" ")],1),t._l(e.children,(function(s,n){return a("el-menu-item",{key:n,attrs:{index:s.key},on:{click:function(e){return t.handleSelect(s)}}},[e.path&&0==e.path.indexOf("http")?a("a",{staticClass:"w-full  block",attrs:{href:e.path,target:e.target||"_self"}},[s.iconSvg?a("d2-icon-svg",{attrs:{name:s.iconSvg}}):s.iconfont?a("k-icon",{attrs:{icon:s.iconfont}}):s.icon?a("d2-icon",{attrs:{name:s.icon}}):t._e(),t._v(" "+t._s(s.title)+" "),s.active?a("d2-icon",{attrs:{name:"check"}}):t._e()],1):a("span",[s.iconSvg?a("d2-icon-svg",{attrs:{name:s.iconSvg}}):s.iconfont?a("k-icon",{attrs:{icon:s.iconfont}}):s.icon?a("d2-icon",{attrs:{name:s.icon}}):t._e(),t._v(" "+t._s(s.title)+" "),s.name==t.activeName?a("d2-icon",{attrs:{name:"check"}}):t._e()],1)])}))],2):t._e():a("el-menu-item",{key:s+"1",attrs:{index:e.key},on:{click:function(a){return t.handleSelect(e)}}},[e.path&&0==e.path.indexOf("http")?a("a",{staticClass:"w-full  block",attrs:{href:e.path,target:e.target||"_self"}},[e.iconSvg?a("d2-icon-svg",{attrs:{name:e.iconSvg}}):e.iconfont?a("k-icon",{attrs:{icon:e.iconfont}}):e.icon?a("d2-icon",{attrs:{name:e.icon}}):t._e(),t._v(" "+t._s(e.title)+" ")],1):a("span",[e.iconSvg?a("d2-icon-svg",{attrs:{name:e.iconSvg}}):e.iconfont?a("k-icon",{attrs:{icon:e.iconfont}}):e.icon?a("d2-icon",{attrs:{name:e.icon}}):t._e(),t._v(" "+t._s(e.title)+" ")],1)])]}))],2)],1)},G=[],W=(a("159b"),a("dcf2")),K={computed:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(c["e"])("d2admin/user",["info"])),Object(c["e"])("d2admin/theme",["activeName"])),Object(c["e"])(["user"])),{},{userName:function(){var t=this.user.user_name||this.user.name;return t?t.charAt(0):"未登录"}}),data:function(){var t=W["a"].children;return t.forEach((function(t){t.key=t.name})),{list:[{key:"home",iconfont:"icon-shouye",title:"首页",path:"/"},{type:"divider"},{key:"personal",iconfont:"icon-dfdfdfdfdf",title:"个人中心",path:"/personal",divided:!0},{key:"personal-notice",iconfont:"icon-tongzhi",title:"消息通知",path:"/personal/notice",divided:!0},{type:"divider"},{key:"logoff",iconfont:"icon-tuichu2",title:"退出登录"}]}},methods:Object(n["a"])(Object(n["a"])({},Object(c["b"])("d2admin/account",["logout"])),{},{handleSelect:function(t){"logoff"!==t.key?t.path&&0==t.path.indexOf("http")?window.open(t.path,t.target):(t.path&&this.$router.push({path:t.path}),console.log(t)):this.logout({confirm:!0})},logOff:function(){this.logout({confirm:!0})}})},X=K,Q=(a("e547"),Object(E["a"])(X,Y,G,!1,null,null,null)),J=Q.exports,Z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tooltip",{attrs:{effect:"dark",content:t.tooltipContent,placement:"bottom"}},[a("el-button",{staticClass:"d2-ml-0 d2-mr btn-text can-hover",staticStyle:{color:"#909399"},attrs:{type:"text"},on:{click:t.handleClick}},[t.logLength>0?a("el-badge",{attrs:{max:99,value:t.logLengthError,"is-dot":0===t.logLengthError}},[a("k-icon",{attrs:{icon:"icon-bug1"}})],1):a("k-icon",{attrs:{icon:"icon-bug1"}})],1)],1)},tt=[],et={computed:Object(n["a"])(Object(n["a"])({},Object(c["c"])("d2admin",{logLength:"log/length",logLengthError:"log/lengthError"})),{},{tooltipContent:function(){return 0===this.logLength?"没有日志或异常":"".concat(this.logLength," 条日志").concat(this.logLengthError>0?" | 包含 ".concat(this.logLengthError," 个异常"):"")}}),methods:Object(n["a"])(Object(n["a"])({},Object(c["d"])("d2admin/log",["clean"])),{},{handleClick:function(){this.$router.push({name:"log"})}})},at=et,st=Object(E["a"])(at,Z,tt,!1,null,null,null),nt=st.exports,ot=(a("ac1f"),a("841c"),a("9b6a")),it={components:{"d2-panel-search":function(){return Promise.all([a.e("chunk-index"),a.e("chunk-24ac1c61")]).then(a.bind(null,"48aa"))}},mounted:function(){var t=this;Object(ot["a"])(this.searchHotkey.open,(function(e){e.preventDefault(),t.searchPanelOpen()})),Object(ot["a"])(this.searchHotkey.close,(function(e){e.preventDefault(),t.searchPanelClose()}))},beforeDestroy:function(){ot["a"].unbind(this.searchHotkey.open),ot["a"].unbind(this.searchHotkey.close)},computed:Object(n["a"])({},Object(c["e"])("d2admin",{searchActive:function(t){return t.search.active},searchHotkey:function(t){return t.search.hotkey}})),methods:Object(n["a"])(Object(n["a"])({},Object(c["d"])({searchToggle:"d2admin/search/toggle",searchSet:"d2admin/search/set"})),{},{handleSearchClick:function(){var t=this;this.searchToggle(),this.searchActive&&setTimeout((function(){t.$refs.panelSearch&&t.$refs.panelSearch.focus()}),500)},searchPanelOpen:function(){var t=this;this.searchActive||(this.searchSet(!0),setTimeout((function(){t.$refs.panelSearch&&t.$refs.panelSearch.focus()}),500))},searchPanelClose:function(){this.searchActive&&this.searchSet(!1)}})},rt={name:"d2-layout-header-aside",mixins:[it],components:{d2MenuHeader:_,d2Tabs:x,d2HeaderSearch:L,d2HeaderSize:$,d2HeaderNotice:H,d2HeaderUser:J,d2HeaderLog:nt},data:function(){return{asideWidth:"180px",asideWidthCollapse:"65px"}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(c["e"])(["forcePwd","forceTfa"])),{},{isLockTabs:function(){return!(!this.forcePwd&&!this.forceTfa)},isDev:function(){return!1}},Object(c["e"])("d2admin",{keepAlive:function(t){return t.page.keepAlive},grayActive:function(t){return t.gray.active},transitionActive:function(t){return t.transition.active},asideCollapse:function(t){return t.menu.asideCollapse},asideTransition:function(t){return t.menu.asideTransition}})),Object(c["c"])("d2admin",{themeActiveSetting:"theme/activeSetting"})),{},{isProjectPage:function(){return Object(l["startsWith"])(this.$route.name,"project-")},routerViewKey:function(){var t=this.$route.meta["__stamp-".concat(this.$route.name)]||"",e="".concat(t?"__stamp-".concat(t,"-"):"").concat(this.$route.name,"-").concat(this.$route.params.id);return e},styleLayoutMainGroup:function(){return this.themeActiveSetting.backgroundImage?{backgroundImage:"url('".concat(this.$baseUrl).concat(this.themeActiveSetting.backgroundImage,"')")}:{}}}),methods:Object(n["a"])(Object(n["a"])({},Object(c["b"])("d2admin/menu",["asideCollapseToggle"])),{},{refreshSys:function(){var t=this;this.$api.sys.config().then((function(e){t.$store.commit("sys",e)}))},handleToggleAside:function(){this.asideCollapseToggle()}}),created:function(){this.refreshSys()},mounted:function(){}},lt=rt,ct=(a("2a32"),Object(E["a"])(lt,o,i,!1,null,null,null)),ut=ct.exports,dt=ut,pt=a("e36f"),ft={auth:!0},mt={path:"",name:"personal",meta:ft,redirect:{name:"personal-index"},component:dt,children:[{path:"",name:"personal-index",component:pt("personal/index"),redirect:{name:"personal-info"},meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"个人中心"}),children:[{path:"/personal",name:"personal-info",component:pt("personal/info"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"个人中心",alias:"账户信息"})},{path:"/personal/password",name:"personal-password",component:pt("personal/password"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"个人中心",alias:"更新密码"})},{path:"/personal/security",name:"personal-security",component:pt("personal/security"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"个人中心",alias:"账户安全"})}]},{path:"/personal",name:"personal-notice-index",component:pt("personal/notice/index"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"消息通知"}),redirect:{name:"personal-system-notice"},children:[{path:"/personal/notice",name:"personal-notice-system-notice-list",component:pt("personal/notice/system-notice-list"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"消息通知",alias:"系统消息"})},{path:"/personal/notice/personal",name:"personal-notice-personal-notice-list",component:pt("personal/notice/personal-notice-list.vue"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"消息通知",alias:"私信"})},{path:"/personal/notice/personal/:id",name:"personal-notice-personal-notice",component:pt("personal/notice/personal-notice.vue"),meta:Object(n["a"])(Object(n["a"])({},ft),{},{title:"消息通知",alias:"张三"})}]}]},ht=a("e36f"),bt={auth:!0},_t={path:"",name:"setting",meta:bt,redirect:{name:"setting-index"},component:dt,children:[{path:"/setting",name:"setting-index",component:ht("system/setting/font"),meta:Object(n["a"])(Object(n["a"])({},bt),{},{title:"个人中心"})}]},gt=a("e36f"),vt={auth:!0},yt=[{path:"/mgt",name:"mgt",meta:vt,redirect:{name:"mgt-database"},component:dt,children:[{path:"/mgt/monitor",name:"mgt-monitor-system",component:gt("mgt/monitor/system"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"监控"})},{path:"/mgt/dashboard",name:"mgt-dashboard",component:gt("system/index/components/system.page.vue"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"统计"})},{path:"/mgt/audit-setting",name:"mgt-audit-setting",component:gt("mgt/audit-setting/index.vue"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"审计设置"})},{path:"/mgt/database",name:"mgt-database",component:gt("mgt/database/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"数据源"})},{path:"/mgt/project",name:"mgt-project",component:gt("mgt/project/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"项目管理"})},{path:"/mgt/account",name:"mgt-account",component:gt("mgt/account"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"用户管理"})},{path:"/mgt/ssh",name:"mgt-ssh-index",component:gt("mgt/ssh/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"主机列表"})},{path:"/mgt/ssh/strategy",name:"mgt-ssh-strategy",component:gt("mgt/ssh_strategy/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"主机策略"})},{path:"/mgt/ssh/log",name:"mgt-ssh-log",component:gt("mgt/ssh_log/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"主机日志"})},{path:"strategy",name:"mgt-strategy",component:gt("mgt/strategy/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"策略管理"})},{path:"/mgt/act",name:"mgt-act-index",component:gt("mgt/act/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"审计日志"})},{path:"/mgt/act/log",name:"mgt-act-operat-log",component:gt("mgt/act/operat-log"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"操作日志"})},{path:"/mgt/act/report",name:"mgt-report",component:gt("mgt/report/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"统计报表"})}]},{path:"/mgt/setting",name:"mgt-setting",meta:vt,redirect:{name:"mgt-setting-index"},component:dt,children:[{path:"/mgt/setting",name:"mgt-setting-index",component:gt("mgt/setting/index"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"系统重启"})},{path:"/mgt/setting/update",name:"mgt-setting-update",component:gt("mgt/setting/update"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{cache:!0,title:"软件升级"})},{path:"/mgt/setting/func",name:"mgt-setting-func",component:gt("mgt/setting/func"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"功能设置"})},{path:"/mgt/setting/policy",name:"mgt-setting-policy",component:gt("mgt/setting/policy"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"访问规则"})},{path:"/mgt/setting/notice",name:"mgt-setting-notice",component:gt("mgt/setting/notice"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"通知设置"})},{path:"/mgt/setting/login",name:"mgt-setting-login",component:gt("mgt/setting/login"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"登录设置"})},{path:"/mgt/setting/backup",name:"mgt-setting-bcakup",component:gt("mgt/setting/backup"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"系统备份"})},{path:"/mgt/setting/license",name:"mgt-setting-license",component:gt("mgt/setting/license"),meta:Object(n["a"])(Object(n["a"])({},vt),{},{title:"许可证"})}]}],wt=a("4360"),St=a("5c96"),Et=a("60fe"),kt=a("e36f"),xt={auth:!0,project:!0,cache:!1},Tt={path:"/project",name:"project",meta:xt,redirect:function(){var t=window.localStorage.getItem("token");if(!t)return"/project";var e=Object(l["get"])(wt["a"].state,"dashboard_project.id",null);if(!e){var a=Object(l["get"])(wt["a"].state,"myProjectList",[]);if(0==a.length)return Object(St["Notification"])({title:"undefined default value",message:"未定义默认项目",type:"error",duration:2e3,position:"top-right",offset:100}),"/";e=a[0].id}return"/project/".concat(e,"/dashboard")},component:dt,children:[{path:"/project/:id",name:Et["c"],meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"项目信息"}),component:kt("project/index"),redirect:{name:"".concat(Et["f"],"dashboard")},children:[{path:"/project/:id/dashboard",name:"".concat(Et["f"],"dashboard"),component:kt("project/dashboard"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"工作台"})},{path:"/project/:id/post",name:"".concat(Et["f"],"post"),component:kt("project/post"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"公告"})},{path:"/project/:id/datasource",name:"".concat(Et["f"],"datasource"),component:kt("project/datasource"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"数据源"})},{path:"/project/:id/role",name:"".concat(Et["f"],"role"),component:kt("project/role"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{cache:!0,title:"我的项目",alias:"角色"})},{path:"/project/:id/member",name:"".concat(Et["f"],"member"),component:kt("project/member"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{cache:!1,title:"我的项目",alias:"成员"})},{path:"/project/:id/work",name:"".concat(Et["f"],"work"),component:kt("project/work"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"工单"})},{path:"/project/:id/log",name:"".concat(Et["f"],"log"),component:kt("project/log"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"日志"})},{path:"/project/:id/notice",name:"".concat(Et["f"],"notice"),component:kt("project/notice"),meta:Object(n["a"])(Object(n["a"])({},xt),{},{title:"我的项目",alias:"通知"})}]}]},Ct=a("993f"),Ot={auth:!1,requiresAuth:!1,title:"登录"},Dt=[{path:"/login",name:"login",component:function(t){switch("shuan"){case"focus":return t(Ct("login/focus"));default:return t(Ct("login/new-login"))}},meta:Ot},{path:"/cas/:ticket",component:function(t){return t(Ct("login/cas"))},meta:Ot},{path:"/oauth2",component:function(t){return t(Ct("login/oauth2"))},meta:Ot}],At=a("e36f"),Lt=[{path:"/",redirect:{name:"index"},component:dt,children:[{path:"/",name:"index",meta:{title:"首页",auth:!0},component:At("system/index/index")},{path:"/query",name:"query",component:At("project/query/index"),meta:{auth:!0,cache:!0,title:"数据查询"}},{path:"log",name:"log",meta:{title:"前端日志",auth:!0},component:At("system/log")},{path:"refresh",name:"refresh",hidden:!0,component:At("system/function/refresh")},{path:"redirect/:route*",name:"redirect",hidden:!0,component:At("system/function/redirect")}]},mt,_t].concat(Object(s["a"])(yt),[Tt]),Rt=[].concat(Object(s["a"])(Dt),[{path:"/reg-license",name:"reg-license",component:At("login/reg.license"),meta:{auth:!1,title:"许可证"}}]),It=[{path:"*",name:"404",component:At("system/error/404")}],jt=Lt;e["a"]=[].concat(Object(s["a"])(Lt),Object(s["a"])(Rt),It)},d096:function(t,e,a){},d0d3:function(t,e,a){"use strict";a("4ddc")},d0e2:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-new-work",attrs:{title:"提交工单",visible:t.isShow,fullscreen:"",width:"100%","before-close":t.hide},on:{"update:visible":function(e){t.isShow=e},opened:t.onOpened,close:t.onClose}},[a("new-work",{ref:"newWokRef",on:{submit:t.onSubmit}})],1)},n=[],o=a("1da1"),i=(a("96cf"),a("a9c4")),r={components:{NewWork:i["default"]},data:function(){return{isShow:!1,workPageData:null,tempData:{},tempAu:null}},methods:{onSubmit:function(t){console.log("提交工单结果：",t),t&&(this.hide(),this.$emit("action","submit"))},show:function(t,e){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.$api.db.dbAll(t.project.id,!1,!0);case 2:n=s.sent,t.dataBaseList=n,a.isShow=!0,a.tempData=t,a.tempAu=e;case 7:case"end":return s.stop()}}),s)})))()},onOpened:function(){var t=this;this.$nextTick((function(){t.$refs.newWokRef.init(t.tempData,t.tempAu)}))},onClose:function(){this.$emit("action","close")},hide:function(){this.$refs.newWokRef.hide(),this.workPageData=null,this.isShow=!1,this.tempData={}}}},l=r,c=(a("264c"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},d18d:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return h}));var s=a("2909"),n=a("1da1"),o=a("d4ec"),i=a("bee2"),r=a("ade3"),l=(a("96cf"),a("99af"),a("ac1f"),a("5319"),a("1276"),a("d81d"),a("b0c0"),a("498a"),a("365c")),c=a("4360"),u=a("e31c"),d=a("8ea9"),p=a("232e"),f={"表":d["a"].CompletionItemKind.Class,"列":d["a"].CompletionItemKind.Property},m={},h=function(){function t(e){Object(o["a"])(this,t),Object(r["a"])(this,"data",void 0),Object(r["a"])(this,"dbSuggest",void 0),Object(r["a"])(this,"tables",void 0),Object(r["a"])(this,"columns",void 0),this.data=e,this.dbSuggest=new p["default"](this.data.databaseLanguage)}return Object(i["a"])(t,[{key:"registerCompletionItemProvider",value:function(t){if(this.data&&this.data.databaseLanguage){var e=this,a="".concat(this.data.tabId,"_").concat(this.data.databaseLanguage);Object.prototype.hasOwnProperty.call(m,a)&&m[a].dispose();var s=this.data,o=d["a"].registerCompletionItemProvider(this.data.databaseLanguage,{provideCompletionItems:function(){var a=Object(n["a"])(regeneratorRuntime.mark((function a(n,o){var i,r,l,c,d,p,f,m,h,b,_,g,v,y,w;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.getModel()!==n){a.next=22;break}return i=o.lineNumber,r=o.column,l=n.getFullModelRange(),c=n.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:i,endColumn:r}).replace(/\/\*(.|\n)*\*\//g,"\n"),d=n.getValueInRange({startLineNumber:i,startColumn:r,endLineNumber:l.endLineNumber,endColumn:l.endColumn>100?100:l.endColumn}).replace(/^\s*--.*/gm,"\n").replace(/\/\*(.|\n)*\*\//g,"\n"),p="",f="",m=c.split(/\n{2,}|\r{2,}|(\r\n){2,}|;/gm),h=e.getEndText(m),b=u["a"].parserComments(h),console.log("解析SQL：",b),p=h.replace(/^\s*--.*/gm,""),_=d.split(/\n{2,}|\r{2,}|(\r\n){2,}|;/gm),f=e.getStartText(_),g=p+" "+f,console.info("自动提示获取的sql: ",g),v=n.getWordUntilPosition(o),y={startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:v.startColumn,endColumn:v.endColumn},w=[],a.next=21,e.autoKeys(s,w,g,p,y,b);case 21:return a.abrupt("return",{suggestions:w});case 22:case"end":return a.stop()}}),a)})));function o(t,e){return a.apply(this,arguments)}return o}(),triggerCharacters:["."]});m[a]=o}else console.warn("[service.auto.db.js] registerCompletionItemProvider() databaseLanguage数据错误：",this.data)}},{key:"autoKeys",value:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,a,n,o,i){var r,u,d,p,f,m,h,b,_,g,v,y,w,S,E,k=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=k.length>5&&void 0!==k[5]?k[5]:null,u=e.owner,r&&r.src&&r.db&&(u=r.db),d=n.split(/\s+|,|;/),p=this.isMatch2(/^([^\.]+)\.$/,o),!p){t.next=20;break}if(f=p[1],m=null,this.tables&&this.tables.indexOf(f)>-1?m=f:(h=d.indexOf(f),h>0&&(m=d[h-1])),!m){t.next=18;break}return console.log("查询字段...参数：",e),b={id:e.id,project:c["a"].state.project.id,object_type:"table",node_type:"column",owner:u,table:m},t.next=14,l["default"].db.table.tableSubNode(b);case 14:return _=t.sent,g=_.List.map((function(t){return{id:t.name,meta:t.node_type,name:t.name,score:100,value:t.name}})),this._convert2Suggestions(a,g,"列",i),t.abrupt("return");case 18:t.next=28;break;case 20:return console.log("查询表...this.data"),v={id:e.id,project:c["a"].state.project.id,object_type:"table",node_type:"table",owner:u,db_type:e.dbType,page_size:500,page_no:0},t.next=24,l["default"].db.schema.schemaSubNode(v);case 24:y=t.sent,w=y.List.map((function(t){return{id:t.name,meta:t.node_type,name:t.name,score:100,value:t.name}})),this._convert2Suggestions(a,w,"表",i),this.setTables(w);case 28:return t.next=30,this.dbSuggest.get();case 30:for(E in S=t.sent,S)S[E].range=i;a.push.apply(a,Object(s["a"])(S));case 33:case"end":return t.stop()}}),t,this)})));function e(e,a,s,n,o){return t.apply(this,arguments)}return e}()},{key:"_convert2Suggestions",value:function(t,e,a,s){var n=f[a];if(e&&e.length>0)for(var o=0;o<e.length;o++){var i=e[o];t.push({label:i.name,kind:n,insertText:i.value,range:s,detail:a})}}},{key:"setTables",value:function(t){for(var e=[],a=0;a<t.length;a++)e.push(t[a].value);this.tables=e}},{key:"isMatch2",value:function(t,e){var a=this.toExp2(e);a=a.split(/,|\(/).pop();var s=t.exec(a);return s}},{key:"toExp2",value:function(t){var e=/\s([^\s]+)$/.exec(t);return e?e[1]:""}},{key:"getStartText",value:function(t){for(var e=0;e<t.length;e++){if(void 0==t[e])return"";if(""!=t[e])return t[e].trim()}return""}},{key:"getEndText",value:function(t){for(var e=t.length-1;e>=0;e--){if(void 0==t[e])return"";if(""!=t[e])return t[e].trim()}return""}},{key:"isMatch",value:function(t,e,a){var s=this.toExp(e,a),n=t.exec(s);return n}},{key:"toExp",value:function(t,e){var a=t.getLine(e.row).substring(0,e.column),s=/\s([^\s]+)$/.exec(a);return s?s[1]:""}}]),t}()},d23f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("k-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{head:"数据源/数据库/数据集"}},[a("span",[a("el-input",{attrs:{size:"small",placeholder:"输入关键字进行过滤数据库",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),a("template",{slot:"tools"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),a("div",{staticClass:"flex justify-between",staticStyle:{"margin-left":"10px"}},[a("div",{staticClass:"left"}),a("div",{staticClass:"right all pointer-active",attrs:{title:"批量设置"},on:{click:t.openBatchDialog}},[t._v(" 批量设置 ")])]),a("div",{staticClass:"role-instance-list"},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.instanceListLoading,expression:"instanceListLoading"}],ref:"instanceTreeRef",attrs:{"show-checkbox":"",data:t.sourceList,"expand-on-click-node":!1,"filter-node-method":t.filterNode,props:{label:"name",children:"subs"}},on:{"node-click":t.onClickNew},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return a("div",{staticClass:"flex justify-between w-full truncate"},[a("div",{staticClass:"truncate ..."},[a("span",{staticClass:"pointer-default",class:{"auth-read":1==n.perm.rw,"auth-write":2==n.perm.rw,"auth-disable":3==n.perm.rw,"auth-manage":4==n.perm.rw},attrs:{title:n.name}},[1==s.level?[n.err_msg?a("el-tooltip",{attrs:{content:n.err_msg,placement:"top"}},[a("span",{staticClass:"text-red",class:{"auth-disable":n.disabled}},[t._v(" "+t._s(t.showRw(n.perm.rw))+" - "+t._s(n.name)+" ")])]):a("span",[t._v(" "+t._s(t.showRw(n.perm.rw))+" - "+t._s(n.name)+" ")])]:[t._v(" "+t._s(n.name)+" ")]],2)]),1!=s.level?a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==n.perm.rw},attrs:{title:"读权限"},on:{click:function(e){return t.onAuthOwner(n,1)}}},[t._v("读")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-write":2==n.perm.rw},attrs:{title:"写权限"},on:{click:function(e){return t.onAuthOwner(n,2)}}},[t._v("写")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-manage":4==n.perm.rw},attrs:{title:"管理权限"},on:{click:function(e){return t.onAuthOwner(n,4)}}},[t._v("管")]),a("i",{staticClass:"sn-font pointer-active mr-2",class:{"auth-disable":3==n.perm.rw},attrs:{title:"禁用权限"},on:{click:function(e){return t.onAuthOwner(n,3)}}},[t._v("禁")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==n.perm.asyn_query},attrs:{title:"异步查询权限"},on:{click:function(e){return t.onAuthOwnerAsync(n,"aq")}}},[t._v("")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==n.perm.asyn_export},attrs:{title:"数据导出/异步导出权限"},on:{click:function(e){return t.onAuthOwnerAsync(n,"ae")}}},[t._v("")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==n.perm.asyn_sql},attrs:{title:"SQL导出权限"},on:{click:function(e){return t.onAuthOwnerAsync(n,"as")}}},[t._v("")])]):t._e()])}}])})],1),a("dialog-batchauth",{ref:"dialogBatchauthRef",attrs:{"confirm-loading":!0},on:{confirm:t.onBatchConfirm}})],2)},n=[],o=(a("4de4"),a("159b"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2ef0")),i=a("aa90"),r={components:{"dialog-batchauth":i["default"]},props:["project_id","project"],data:function(){return{activeId:null,activeIndex:-1,batchSource:{},selectedNodeList:[],dbloading:!1,instanceListLoading:!1,loading:!1,cur_name:"",filterText:"",sourceList:[],sources:{},databases:{},role:{},treeProps:{id:"id",label:"label",isLeaf:"leaf"}}},watch:{filterText:function(t){this.$refs.instanceTreeRef.filter(t)}},mounted:function(){this.activeIndex=-1},methods:{openBatchDialog:function(){var t=this.$refs.instanceTreeRef.getCheckedNodes(!0,!0);if(console.log(t),0==t.length)return this.$message({message:"请勾选相应数据源下的数据库",type:"warning"}),!1;var e={perm:{rw:t[0].perm.rw,asyn_export:t[0].perm.asyn_export,asyn_query:t[0].perm.asyn_query,asyn_sql:t[0].perm.asyn_sql,audit_work:t[0].perm.audit_work}};this.$refs.dialogBatchauthRef.show(t,e),this.$refs.dialogBatchauthRef.setHeaders({title:"设置权限",targetText:"数据源/数据库/数据集"})},onBatchConfirm:function(t){var e=this;console.log("[instance.list.vue] 批量设置数据库权限 - 参数：",t);var a=this.$refs.instanceTreeRef.getCheckedNodes(!0,!0),s=[];a.forEach((function(a){s.push(e.addPermission2(a.perm.dbId,"*",a.name,-1==t.perm.rw?a.perm.rw:t.perm.rw,-1==t.perm.asyn_query?a.perm.asyn_query:t.perm.asyn_query,-1==t.perm.asyn_export?a.perm.asyn_export:t.perm.asyn_export,-1==t.perm.asyn_sql?a.perm.asyn_sql:t.perm.asyn_sql,""))})),Promise.all(s).then((function(e){console.log("批量设置结果：",e);for(var s=0;s<a.length;s++)-1!=t.perm.rw&&(a[s].perm.rw=t.perm.rw),-1!=t.perm.asyn_export&&(a[s].perm.asyn_export=t.perm.asyn_export),-1!=t.perm.asyn_query&&(a[s].perm.asyn_query=t.perm.asyn_query),-1!=t.perm.asyn_sql&&(a[s].perm.asyn_sql=t.perm.asyn_sql)})).catch((function(t){console.log("批量设置结果：error",t)})).finally((function(){e.$refs.dialogBatchauthRef.hide(),e.$emit("refresh-next","owner")}))},addPermission2:function(t){var e=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,i={roleId:this.role.id,dbId:t,tname:"*",towner:e,rw:a,aq:s,ae:n,as:o,type:"",project:this.project_id};return this.$api.permission.addPermission(i)},doRefresh:function(t){t?(this.role=t,this.refresh()):(this.role={},this.activeId=null,this.databases={},this.checkedDatas={})},filterNode:function(t,e){var a=Object(o["trim"])(t);return!a||-1!==e.name.toLowerCase().indexOf(a.toLowerCase())},showRw:function(t){return 1==t?"只读":2==t?"读写":4==t?"管理":3==t?"禁用":"未知"},refresh:function(){var t=this;console.log("[instance.list methods] refresh..."),this.instanceListLoading=!0,this.role&&this.role.id?this.$api.permission.allInstanceNew(this.project.id,this.role.id).then((function(e){e&&e.forEach((function(t){t.disabled=!!t.err_msg})),t.sourceList=e})).finally((function(){t.instanceListLoading=!1})):(this.sourceList=[],this.activeId=null,this.databases={},this.checkedDatas={},this.instanceListLoading=!1)},onClickNew:function(t,e,a){2==e.level?this.$emit("owner",t):(this.$emit("owner",{}),console.warn("[instance.list]#onClickNew(): ",t,e,a))},onAuthOwnerAsync:function(t,e){var a=this,s=0;3!=t.perm.rw?("aw"==e&&(1==t.perm.audit_work?t.perm.audit_work=0:t.perm.audit_work=1,s=t.perm.audit_work),"ae"==e&&(1==t.perm.asyn_export?t.perm.asyn_export=0:t.perm.asyn_export=1,s=t.perm.asyn_export),"aq"==e&&(1==t.perm.asyn_query?t.perm.asyn_query=0:t.perm.asyn_query=1,s=t.perm.asyn_query),"as"==e&&(1==t.perm.asyn_sql?t.perm.asyn_sql=0:t.perm.asyn_sql=1,s=t.perm.asyn_sql),this.$api.permission.addAsyncPermission(this.role.id,t.perm.dbId,t.name,"*",t.perm.rw,e,s,this.project_id).then((function(e){var s="操作成功";a.onSuccess(s),t.perm.rw&&-1!=t.perm.rw?(t.ae=e.asyn_export,t.aq=e.asyn_query,t.as=e.asyn_sql,t.aw=e.audit_work,t.perm.asyn_export=e.asyn_export,t.perm.asyn_query=e.asyn_query,t.perm.asyn_sql=e.asyn_sql,t.perm.audit_work=e.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0,t.perm.asyn_export=0,t.perm.asyn_query=0,t.perm.asyn_sql=0,t.perm.audit_work=0),a.$emit("db",3==t.perm.rw||-1==t.perm.rw?{}:t)})).finally((function(){a.$emit("refresh-next","owner")}))):this.onError("当前数据被禁止")},onAuthOwner:function(t,e){var a=this;this.$api.permission.addOwner(this.role.id,t.perm.dbId,t.name,e,this.project_id).then((function(s){var n="操作成功";3==e?n="设置禁用成功":1==e?n="设置只读成功":2==e?n="设置读写成功":-1==e&&(n="取消设置成功"),a.onSuccess(n),t.perm.rw&&-1!=t.perm.rw?(t.ae=s.asyn_export,t.aq=s.asyn_query,t.as=s.asyn_sql,t.aw=s.autit_work,t.perm.asyn_export=s.asyn_export,t.perm.asyn_query=s.asyn_query,t.perm.asyn_sql=s.asyn_sql,t.perm.autit_work=s.autit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0,t.perm.asyn_export=0,t.perm.asyn_query=0,t.perm.asyn_sql=0,t.perm.autit_work=0),t.perm.rw=e,a.$emit("db",3==e?{}:t),a.$emit("refresh-next","owner")}))},onAuthDBChk:function(t){var e=this;t.chk=!t.chk,this.loading=!0,this.$api.permission.addDBChild(this.role.id,t.id,t.chk,this.project_id).then((function(a){console.log("db.rw:",t.rw," db.asyn_export:",t.asyn_export,"  db.asyn_query:",t.asyn_query);var s="";s=t.chk?"批量禁用成功":"批量取消禁用成功",e.onSuccess(s),t&&t.children&&t.children.forEach((function(e){console.log("owner.rw:",e.rw,"   db.rw:",t.rw),t.chk?e.rw=3:e.rw=t.rw})),e.loading=!1})).catch((function(){e.loading=!1}))},onAuthDB:function(t,e){var a=this;console.log("db.rw:",t.rw,"   rw:",e),t.rw==e&&(e=-1),1!=t.operType||2!=e&&4!=e?2!=t.operType||4!=e?(t.rw=e,this.$api.permission.addDB(this.role.id,t.id,t.rw,this.project_id).then((function(s){t.rw&&-1!=t.rw?(t.ae=s.asyn_export,t.aq=s.asyn_query,t.as=s.asyn_sql,t.aw=s.audit_work):(t.ae=0,t.aq=0,t.as=0,t.aw=0),console.log("db.rw:",t.rw," db.asyn_export:",t.asyn_export,"  db.asyn_query:",t.asyn_query);var n="操作成功";3==e?n="设置禁用成功":1==e?n="设置只读成功":2==e?n="设置读写成功":4==e?n="设置管理成功":-1==e&&(n="取消设置成功"),a.onSuccess(n),t&&t.children&&t.children.forEach((function(e){console.log("owner.rw:",e.rw,"   db.rw:",t.rw),3!=t.rw&&-1!=t.rw||(e.real_rw=""),1==t.rw||3==t.rw||-1==t.rw?e.rw=t.rw:e.rw=e.real_rw||t.rw,e.ae=t.ae,e.aq=t.aq,e.as=t.as,e.aw=t.aw}))}))):this.onError("该数据源仅支持读写操作！"):this.onError("该数据源仅支持只读操作！")}}},l=r,c=(a("6501"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},d2ec:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("setting-warning",{attrs:{form:t.form}}),a("setting-notify",{attrs:{form:t.form}})],1)},n=[],o=a("4183"),i=a("2ab5"),r={components:{SettingNotify:o["default"],SettingWarning:i["default"]},data:function(){return{form:{}}},methods:{getSetting:function(t){var e=this;"inception"==t?this.$api.setting.getInception().then((function(t){e.form2=t})):this.$api.setting.get().then((function(t){e.setting=t,e.form=t}))}},mounted:function(){var t=this;this.$nextTick((function(){t.getSetting()}))}},l=r,c=(a("fd3f"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},d3ac:function(t,e,a){"use strict";a("f6ed")},d3db:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-single",use:"d2-single-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-single"><path d="M135.7 172.4l7.2 672.8c0 19.7 16.1 35.8 35.8 35.8l673.8 6.4c19.8 0 35.8-16 35.8-35.8l-7.2-672.8c0-19.7-16.1-35.8-35.8-35.8l-673.8-6.4c-19.7 0-35.8 16-35.8 35.8zM845.3 71.5c59.4 0 107.5 48 107.5 107.3l7.2 672.8c0 59.2-48.1 107.3-107.5 107.3l-673.8-6.4c-59.4 0-107.5-48-107.5-107.3L64 172.4c0-59.2 48.1-107.3 107.5-107.3l673.8 6.4z" p-id="23568" /></symbol>'});i.a.add(r);e["default"]=r},d3ee:function(t,e,a){"use strict";a("4245")},d4d8:function(t,e,a){"use strict";a("a092")},d562:function(t,e,a){"use strict";a("586b")},d588:function(t,e,a){"use strict";a("2c62")},d708:function(t,e,a){"use strict";a.d(e,"b",(function(){return n}));var s={hotkey:{search:{open:"s",close:"esc"}},menu:{asideCollapse:!1,asideTransition:!0},page:{opened:[{name:"index",fullPath:"/",meta:{title:"首页",auth:!1}}]},search:{enable:!0},theme:{list:[{title:"Linght",name:"sqldev",code:"vs",wmcolor:"#d6d5d741",preview:"image/theme/sqldev/preview@2x.png"},{key:"theme-sqldev-dark",title:"Dark",name:"sqldev-dark",code:"vs-dark",wmcolor:"#f0c1c114",preview:"image/theme/tomorrow-night-blue/preview@2x.png"}]},transition:{active:!0}};e["a"]=s;var n=s.theme.list},d70f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("el-row",{attrs:{gutter:8}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"sys-setting"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("重启")])]),a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"160px",size:"mini"}},[a("el-form-item",{attrs:{label:"启动时间"}},[a("span",[t._v(t._s(t.showTime(1e3*t.form.start_time)))])]),a("el-form-item",[a("k-btn-tip",{attrs:{tip:"确定要重启系统吗？"},on:{click:t.onReboot}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-refresh-right"}},[t._v("重新启动")])],1)],1)],1)],1)],1)])],1)],1)},n=[],o=(a("b0c0"),a("c1df")),i=a.n(o),r={data:function(){return{setting:{},inter:null,run_str:"",size:"small",activeName:"first",form:{sql_mode:!0,license:""},form2:{}}},methods:{showTime:function(t){return console.log("expire:",t),i()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},diffTime:function(){var t="NaN";if(this.form.start_time){var e=i()().diff(i()(1e3*this.form.start_time));console.log("ms:",e);var a=i.a.duration(e),s=Math.floor(a.asHours()),n=i.a.utc(e).format("mm"),o=i.a.utc(e).format("ss");t="",a>0&&(t=a+"天"),s>0&&(t+=s+"小时"),t+=n+"分钟",t+=o+"秒",console.log("d:",a,"  h:",s," m:",n," s:",o)}this.run_str=t},checkLicense:function(){var t=this;this.$api.setting.updateLicense(this.form).then((function(){t.onSuccess("更新成功"),t.getSetting()}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},handleClick:function(t,e){this.getSetting(t.name)},onReboot:function(){var t=this;this.$api.setting.reboot().then((function(){t.onSuccess("请求成功，正在重启中")})).catch((function(){t.onError("操作势必啊")}))},onSubmit:function(){var t=this;this.$api.setting.updateSetting(this.form).then((function(){t.onSuccess("提交成功")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))},getSetting:function(t){var e=this;"inception"==t?this.$api.setting.getInception().then((function(t){e.form2=t})):this.$api.setting.get().then((function(t){e.setting=t,e.form=t}))},round:function(t){return Math.round(100*t)/100},init:function(){}},mounted:function(){var t=this;this.$nextTick((function(){t.getSetting(),t.init()}))},destroyed:function(){clearTimeout(this.inter)}},l=r,c=(a("7481"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},d75b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"component-policy"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v(" 新增访问规则 ")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.getList}},[t._v(" 刷新 ")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{stripe:"",border:"","row-key":"id",data:t.tableData}},[a("el-table-column",{attrs:{prop:"cidr",label:"来源",width:"280"}}),a("el-table-column",{attrs:{prop:"pass",label:"策略",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.pass?a("el-tag",{attrs:{type:"success"}},[t._v("允许")]):a("el-tag",{attrs:{type:"danger"}},[t._v("拒绝")])]}}])}),a("el-table-column",{attrs:{prop:"mark",label:"备注"}}),a("el-table-column",{attrs:{prop:"updatedAt",label:"修改时间",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.format(a.updatedAt))+" ")]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-link",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.editHandle(s)}}},[t._v("编辑")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-link",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteHandle(s)}}},[t._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" 新增访问规则 "),a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 来源支持以下格式："),a("br"),t._v(" 单个IP: 192.168.0.1"),a("br"),t._v(" CIDR: 192.168.1.0/24"),a("br"),a("br"),t._v(" 策略："),a("br"),t._v(" 允许：白名单策略"),a("br"),t._v(" 拒绝：黑名单策略 ")]),a("i",{staticClass:"el-icon-info",staticStyle:{color:"#F50000"}})])],1),t._l(t.forms,(function(e,s){return[a("el-form",{key:s,ref:s,refInFor:!0,staticClass:"demo-form-inline",attrs:{inline:!0,rules:t.rules,model:e}},[a("el-form-item",{attrs:{prop:"cidr"}},[a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 来源支持以下格式："),a("br"),t._v(" 单个IP: 192.168.0.1"),a("br"),t._v(" CIDR: 192.168.1.0/24 ")]),a("el-input",{attrs:{placeholder:"来源"},model:{value:e.cidr,callback:function(a){t.$set(e,"cidr",a)},expression:"form.cidr"}})],1)],1),a("el-form-item",{attrs:{prop:"pass"}},[a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 策略："),a("br"),t._v(" 允许：白名单策略"),a("br"),t._v(" 拒绝：黑名单策略 ")]),a("el-select",{attrs:{placeholder:"策略"},model:{value:e.pass,callback:function(a){t.$set(e,"pass",a)},expression:"form.pass"}},[a("el-option",{attrs:{label:"允许",value:!0}}),a("el-option",{attrs:{label:"拒绝",value:!1}})],1)],1)],1),a("el-form-item",{attrs:{prop:"mark"}},[a("el-input",{attrs:{placeholder:"备注"},model:{value:e.mark,callback:function(a){t.$set(e,"mark",a)},expression:"form.mark"}})],1),"form0"!=s?a("el-form-item",[a("el-link",{attrs:{type:"danger"},on:{click:function(e){return t.removeLine(s)}}},[t._v("删除")])],1):t._e()],1)]})),"add"==t.actionType?a("div",{staticClass:"add-form"},[a("el-link",{attrs:{type:"success"},on:{click:t.addForm}},[t._v(" +新增一行 ")])],1):t._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],2)],1)},n=[],o=a("5530"),i=(a("a434"),a("d3b7"),a("159b"),a("3ca3"),a("ddb0"),a("b64b"),a("c1df")),r=a.n(i),l=a("aa47"),c={computed:{format:function(){return function(t){return r()(t).format("YYYY-MM-DD HH:mm:ss")}}},data:function(){return{tableLoading:!1,actionType:"add",tableData:[],dialogVisible:!1,forms:{form0:this.resetForm()},rules:{cidr:{required:!0,message:"请输入来源",trigger:"blur"},pass:{required:!0,message:"请选择策略",trigger:"change"}}}},mounted:function(){this.rowDrop(),this.getList()},methods:{rowDrop:function(){var t=document.querySelector(".el-table__body-wrapper tbody"),e=this;l["a"].create(t,{onEnd:function(t){var a=t.newIndex,s=t.oldIndex,n=e.tableData.splice(s,1)[0];e.tableData.splice(a,0,n),e.updatePolicyIndex()}})},resetForm:function(){return{cidr:"",policy_index:99,pass:null,mark:""}},getList:function(){var t=this;this.tableLoading=!0,this.$api.setting.get().then((function(e){e.policy_list&&e.policy_list.length>=0?t.tableData=e.policy_list:t.tableData=[]})).finally((function(){t.tableLoading=!1}))},deleteHandle:function(t){var e=this;console.log("删除行：",t.id),this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$api.post("/api/system/setting/policy/del",{id:t.id}).then((function(t){console.log("删除成功：",t),e.$message({type:"success",message:"删除成功!"}),e.getList()}))}))},editHandle:function(t){this.actionType="edit",this.dialogVisible=!0,this.forms={form0:Object(o["a"])({},t)},console.log("编辑行：",t.id)},updatePolicyIndex:function(){var t=this,e=[];this.tableData.forEach((function(a,s){var n=Object(o["a"])(Object(o["a"])({},a),{},{policy_index:s+1}),i=t.$api.post("/api/system/setting/policy/add",n);e.push(i)})),Promise.all(e).then((function(){t.$notify({title:"成功",message:"更新成功",type:"success"})})).catch((function(e){t.$notify({title:"更新失败",message:JSON.stringify(e.data||e),type:"error"})})).finally((function(){t.getList()}))},onSubmit:function(){var t=this,e=[],a=function(a){var s=new Promise((function(e,s){(t.$refs[a][0]||t.$refs[a]).validate((function(t){t?e():s(a)}))}));e.push(s)};for(var s in this.forms)a(s);Promise.all(e).then((function(){var e=[],a=0==t.tableData.length?1:t.tableData[t.tableData.length-1].policy_index;for(var s in t.forms){var n=t.forms[s];n.id||(n.policy_index=++a);var o=t.$api.post("/api/system/setting/policy/add",n);e.push(o)}Promise.all(e).then((function(){t.handleClose(),t.getList(),t.$notify({title:"成功",message:"保存成功",type:"success"})})).catch((function(e){t.$notify({title:"保存错误",message:JSON.stringify(e.data||e),type:"error"}),console.error("保存错误：",e)}))})).catch((function(e){t.$notify({title:"参数验证错误",message:e,type:"error"}),console.error("form 验证未通过：",e)}))},handleClose:function(){this.actionType="add",this.forms={form0:this.resetForm()},this.dialogVisible=!1},addForm:function(){var t="form"+Object.keys(this.forms).length,e={};e["".concat(t)]=this.resetForm(),this.forms=Object(o["a"])(Object(o["a"])({},this.forms),e)},removeLine:function(t){this.$delete(this.forms,t)}}},u=c,d=(a("cb35"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,"0804cde6",null);e["default"]=p.exports},d7dc:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"dialog-error-pages",attrs:{title:"SQL错误",visible:t.isShow,"append-to-body":!0,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("monaco-lite",{ref:"monacoLite",staticClass:"error-sql",on:{change:t.monacoListChangeHandler}}),a("el-divider"),a("div",[a("span",[t._v("错误信息：")]),a("span",{staticClass:"error"},[t._v(t._s(t.spend))])]),a("el-input",{staticClass:"table-scrollbar",attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:t.params.error,callback:function(e){t.$set(t.params,"error",e)},expression:"params.error"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.onClick("exec")}}},[t._v("确 定")])],1)],1)},n=[],o=a("5530"),i=(a("b680"),a("cb68")),r={name:"dialog-error",components:{MonacoLite:i["default"]},data:function(){return{isShow:!1,params:{sql:"",error:"",spend:0},spend:"0毫秒"}},methods:{onClick:function(t){"exec"==t&&(this.$emit("action",this.sql),this.isShow=!1)},monacoListChangeHandler:function(){console.log("修改了")},show:function(t){var e=this;this.isShow=!0,this.$nextTick((function(){e.params=Object(o["a"])({},t),t.spend>1e3?e.spend="耗时 ".concat((t.spend/1e3).toFixed(2)," 秒"):e.spend="耗时 ".concat(t.spend," 毫秒"),e.$refs.monacoLite.setSql(t.sql||"-- SQL生成错误")}))}}},l=r,c=(a("b5a4"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},d7f3:function(t,e,a){},d814:function(t,e,a){"use strict";a("8f9d")},d91e:function(t,e,a){"use strict";a("dd85")},d999:function(t,e,a){},d9e8:function(t,e,a){"use strict";a("93ba")},da46:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:t.id?"修改工单":"新增工单",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"工单名称"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"工单类型"}},[a("el-select",{attrs:{placeholder:"请选择类型",clearable:!0,disabled:!!t.formData.id},model:{value:t.formData.db_type,callback:function(e){t.$set(t.formData,"db_type",e)},expression:"formData.db_type"}},[a("el-option",{attrs:{label:"Oracle",value:"oracle"}}),a("el-option",{attrs:{label:"MySql",value:"mysql"}}),a("el-option",{attrs:{label:"MsSql",value:"mssql"}}),a("el-option",{attrs:{label:"MongoDb",value:"mongodb"}})],1)],1),"oracle"==t.formData.db_type?a("el-form-item",{attrs:{label:"连接类型"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-radio-group",{model:{value:t.formData.con_type,callback:function(e){t.$set(t.formData,"con_type",e)},expression:"formData.con_type"}},[a("el-radio",{attrs:{label:"base"}},[t._v("基本")]),a("el-radio",{attrs:{label:"tns"}},[t._v("TNS")])],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"连接"}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:"tns"==t.formData.con_type,expression:"formData.con_type=='tns'"}],staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{placement:"top",content:"TNS服务名称"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"服务名"},model:{value:t.formData.db,callback:function(e){t.$set(t.formData,"db",e)},expression:"formData.db"}})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"tns"!=t.formData.con_type,expression:"formData.con_type!='tns'"}],staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:10}},[a("el-tooltip",{attrs:{placement:"top",content:"IP地址"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"IP"},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-tooltip",{attrs:{placement:"top",content:"端口号"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"端口"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",e)},expression:"formData.port"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-tooltip",{attrs:{placement:"top",content:"数据库"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"库"},model:{value:t.formData.db,callback:function(e){t.$set(t.formData,"db",e)},expression:"formData.db"}})],1)],1)],1),a("el-row",{attrs:{gutter:4}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{attrs:{placement:"top",content:"用户名"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"用户名",type:t.account_show?"text":"password"},model:{value:t.formData.user,callback:function(e){t.$set(t.formData,"user",e)},expression:"formData.user"}},[a("template",{slot:"append"},[t.account_show?t._e():a("el-button",{staticClass:"sn-font ",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示账户"},on:{click:function(e){t.account_show=!t.account_show}}},[t._v(" ")]),t.account_show?a("el-button",{staticClass:"sn-font ",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示账户"},on:{click:function(e){t.account_show=!t.account_show}}},[t._v(" ")]):t._e()],1)],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-tooltip",{attrs:{placement:"top",content:"密码"}},[a("el-input",{attrs:{type:t.pw_show?"text":"password","auto-complete":"off",placeholder:"密码"},model:{value:t.formData.pass,callback:function(e){t.$set(t.formData,"pass",e)},expression:"formData.pass"}},[a("template",{slot:"append"},[t.pw_show?t._e():a("el-button",{staticClass:"sn-font ",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示密码"},on:{click:function(e){t.pw_show=!t.pw_show}}},[t._v(" ")]),t.pw_show?a("el-button",{staticClass:"sn-font ",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示密码"},on:{click:function(e){t.pw_show=!t.pw_show}}},[t._v(" ")]):t._e()],1)],2)],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"权限"}},[a("el-row",{attrs:{gutter:4}},[a("el-col",{attrs:{span:6}},[t._v(" 是否只读: "),a("el-tooltip",{attrs:{placement:"top",content:"是否只读"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":2},model:{value:t.formData.oper_type,callback:function(e){t.$set(t.formData,"oper_type",e)},expression:"formData.oper_type"}},[t._v("> ")])],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许异步: "),a("el-tooltip",{attrs:{placement:"top",content:"允许异步查询"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_query,callback:function(e){t.$set(t.formData,"asyn_query",e)},expression:"formData.asyn_query"}})],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许导出文件: "),a("el-tooltip",{attrs:{placement:"top",content:"允许导出文件"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_export,callback:function(e){t.$set(t.formData,"asyn_export",e)},expression:"formData.asyn_export"}})],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许导出SQL: "),a("el-tooltip",{attrs:{placement:"top",content:"允许导出SQL"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_sql,callback:function(e){t.$set(t.formData,"asyn_sql",e)},expression:"formData.asyn_sql"}})],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"连接数"}},[a("el-tooltip",{attrs:{placement:"top",content:"最小连接数"}},[a("el-input-number",{model:{value:t.formData.pool_min,callback:function(e){t.$set(t.formData,"pool_min",e)},expression:"formData.pool_min"}})],1),a("el-tooltip",{attrs:{placement:"top",content:"最大连接数"}},[a("el-input-number",{model:{value:t.formData.pool_max,callback:function(e){t.$set(t.formData,"pool_max",e)},expression:"formData.pool_max"}})],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"查询最大笔数"}},[a("el-input-number",{model:{value:t.formData.max_row,callback:function(e){t.$set(t.formData,"max_row",e)},expression:"formData.max_row"}})],1):t._e(),"es5"==t.formData.db_type?a("el-form-item",{attrs:{label:"详细设定"}},[t.formData.config?a("el-row",{attrs:{gutter:4}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.esConfigList}},[a("el-table-column",{attrs:{label:"Index name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row,n=e.$index;return[a("el-input",{attrs:{placeholder:"索引名称,不带后缀,示例 logstash  *代表全局配置",disabled:0==n},model:{value:s["index_name"],callback:function(e){t.$set(s,"index_name",e)},expression:"row['index_name']"}})]}}],null,!1,2141746515)}),a("el-table-column",{attrs:{prop:"tfn",label:"Time field name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{attrs:{placeholder:"Time field name,默认@timestamp"},model:{value:s["time_field"],callback:function(e){t.$set(s,"time_field",e)},expression:"row['time_field']"}})]}}],null,!1,1664101124)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.esConfigList)}}},[t._v("移除 ")]):t._e()]}}],null,!1,3801071846)})],1),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addEsRow()}}},[t._v("添加")])],1):t._e()],1):t._e(),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.db_desc,callback:function(e){t.$set(t.formData,"db_desc",e)},expression:"formData.db_desc"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=(a("a434"),a("b0c0"),a("2ef0")),i=a("2e0b"),r=a("1f82"),l={data:function(){return{pw_show:!1,account_show:!1,headerList:[],esConfigList:[],isShow:!1,id:null,oper_types:[{l:"只读",v:1},{l:"读写",v:0}],treeProps:{label:"name"},dataList:[],formData:this.reset()}},computed:{},props:{},watch:{"formData.type":"initEsConfigList",isShow:function(t){t&&(this.pw_show=!1,this.account_show=!1)}},methods:{changePass:function(t){console.log(t)},showOtherSetting:function(t){return!!t},addHeaderRow:function(){this.headerList.push({name:"",value:""})},addEsRow:function(){this.esConfigList.push({index_name:"",time_field:""})},deleteRow:function(t,e){e.splice(t,1)},initEsConfigList:function(){console.log("initEsConfigList"),0==this.esConfigList.length&&this.esConfigList.push({index_name:"*",time_field:"@timestamp"})},reset:function(){return{headerList:[{name:"test",value:"234"}],config:{auth:"",method:"get"},id:"",name:"",user:"",pass:"",ip:"",port:"",db:"",url:"",db_type:"",con_type:"base",oper_type:1,db_desc:"",pool_min:1,pool_max:5,max_row:1e4,asyn_query:0,asyn_export:0,asyn_sql:0}},show:function(t){var e=this;if(this.id=t,!this.id)return this.isShow=!0,void(this.formData=this.reset());this.$api.db.info(this.id).then((function(t){t.config=JSON.parse(t.config||"{}"),t.config.headers&&Object(o["isArray"])(t.config.headers)&&(e.headerList=t.config.headers),t.config.eslist&&Object(o["isArray"])(t.config.eslist)&&(e.esConfigList=t.config.eslist),"es5"==t.type&&e.initEsConfigList(),t.con_type||(t.con_type="base"),e.formData=t,e.isShow=!0}))},hide:function(){this.isShow=!1},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);return e.config.headers=this.headerList,e.config.eslist=this.esConfigList,e.config=e.config?JSON.stringify(e.config):"",e.name?e.db_type?"tns"==e.con_type||e.ip?"tns"==e.con_type||e.port?(console.log("config:",e.config),void this.$api.db.save(e).then((function(e){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))):(this.$message({message:"端口不能为空",type:"warning"}),!1):(this.$message({message:"ip不能为空",type:"warning"}),!1):(this.$message({message:"数据源类型不能为空",type:"warning"}),!1):(this.$message({message:"名称不能为空",type:"warning"}),!1)}},components:{ElCol:r["a"],ElRow:i["a"]},mounted:function(){}},c=l,u=(a("c228"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"c9917260",null);e["default"]=d.exports},da49:function(t,e,a){},da6f:function(t,e,a){"use strict";a.d(e,"a",(function(){return l})),a.d(e,"f",(function(){return c})),a.d(e,"d",(function(){return u})),a.d(e,"h",(function(){return d})),a.d(e,"b",(function(){return p})),a.d(e,"c",(function(){return f})),a.d(e,"e",(function(){return m})),a.d(e,"g",(function(){return h}));a("caad"),a("d3b7");var s=a("a002"),n=["runner","historyList","runList","runNames"],o=["runner","select_db_instance","runActive","runList","historyList"],i=function(t){return n.indexOf(t)>=0},r=function(t){if(o.includes(t)){var e={};try{var a=window.localStorage.getItem("project");e=JSON.parse(a)}catch(s){console.error(s),e={}}e&&e.id&&(t=e.id+"_"+t)}return t},l=function(t,e){t=r(t);try{var a=window.localStorage.getItem(t);return a?JSON.parse(a):e}catch(s){return e}},c=function(t,e){t=r(t),window.localStorage.setItem(t,JSON.stringify(e))},u=function(t,e){t=r(t);var a=window.localStorage.getItem(t);return a||e},d=function(t,e){t=r(t),window.localStorage.setItem(t,e)},p=function(t,e){var a=i(t);if(a)return new Promise((function(a,n){var o=r(t);s["getItem"](o).then((function(n){return n||(n=l(t,e),s["setItem"](o,n)),a(n)})).catch((function(t){return n(t)}))}))},f=function(t,e){return new Promise((function(a,n){var o=r(t);s["getItem"](o).then((function(t){return a(null===t?e:t)})).catch((function(t){return n(t)}))}))},m=function(t){var e=r(t);s["removeItem"](e).then((function(){console.log("删除成功!")})).catch((function(t){console.error(t)}))},h=function(t,e){var a=r(t);return new Promise((function(t,n){s["setItem"](a,e).then((function(e){return t(e)})).catch((function(t){return n(t)}))}))}},da6fe:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"220px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"[项目]发起人"}},[t._v(" ["+t._s(t.formData.project_name)+"] "+t._s(t.formData.create_name)+" ")]),a("el-form-item",{attrs:{label:"工单名称"}},[t._v(" "+t._s(t.formData.name)+" ")]),a("el-form-item",{attrs:{label:"执行时间"}},[t._v(" "+t._s(t.formData.create_name)+" ")]),a("el-form-item",{attrs:{label:"数据库类型"}},[t._v(" "+t._s(t.formData.db_type)+" ")]),a("el-form-item",{attrs:{label:"数据源/数据库"}},[t._v(" "+t._s(t.formData.db_name)+"/"+t._s(t.formData.owner)+" ")]),a("el-form-item",{attrs:{label:"执行脚本"}},[a("el-input",{attrs:{type:"textarea",readonly:"",placeholder:"请输入执行的脚本"},model:{value:t.formData.sql,callback:function(e){t.$set(t.formData,"sql",e)},expression:"formData.sql"}})],1),a("el-form-item",{attrs:{label:"工单备注"}},[t.formData.mark?a("span",[t._v(t._s(t.formData.mark))]):a("span",[t._v("无")])])],1)],1)},n=[],o={data:function(){var t=this.$route.params.id;return{id:t,workData:[],disabled:!0,config:{lang:"sql"},formData:{cancel_remark:"",id:t,source_type:"none",source_id:"none",sql:""},formRule:{mark:[{required:!1,message:"请输入描述"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},props:{},watch:{},computed:{},methods:{back:function(){this.$router.go(-1)},init:function(){var t=this;this.$api.work.info(this.id).then((function(e){t.formData=e,t.workData=[e]}))},onCancel:function(){var t=this.formData;t.cancel_remark||this.onError("请输入终止原因")},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.formData;t.$api.work.add(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}}))}},mounted:function(){this.init()},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},db2c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-bottom":"50px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.logData,border:!0}},[a("el-table-column",{attrs:{prop:"opt_desc",label:"操作",width:"180"}}),a("el-table-column",{attrs:{prop:"create_name",label:"操作人",width:"300"}}),a("el-table-column",{attrs:{prop:"opt_ip",label:"操作IP",width:"330"}}),a("el-table-column",{attrs:{prop:"db_name",label:"操作时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])}),a("el-table-column",{attrs:{prop:"opt_info",label:"操作信息"}})],1)],1)},n=[],o={data:function(){return{}},props:{logData:Array},watch:{},computed:{},methods:{},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},db37:function(t,e,a){},dc74:function(t,e,a){},dcb1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:t.formData.id?"修改项目":"新建项目",visible:t.isShow,width:"800px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-suffix":":","label-width":"200px"}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{maxlength:"16",min:"3",placeholder:"请输入项目名称"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"是否公开"}},[a("el-tooltip",{attrs:{placement:"top",content:"公开项目，未加入的用户可以申请加入"}},[a("el-switch",{attrs:{size:"mini","active-value":2,"inactive-value":1},model:{value:t.formData.public_state,callback:function(e){t.$set(t.formData,"public_state",e)},expression:"formData.public_state"}})],1)],1),a("el-form-item",{attrs:{label:"webhook"}},[a("el-col",{attrs:{span:6}},[a("el-select",{attrs:{placeholder:"类型"},model:{value:t.formData.web_hook_type,callback:function(e){t.$set(t.formData,"web_hook_type",e)},expression:"formData.web_hook_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{placeholder:"地址"},model:{value:t.formData.web_hook,callback:function(e){t.$set(t.formData,"web_hook",e)},expression:"formData.web_hook"}})],1)],1),a("el-form-item",{attrs:{label:"有效期"}},[a("el-checkbox",{model:{value:t.expire_flag,callback:function(e){t.expire_flag=e},expression:"expire_flag"}},[t._v("永久")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.expire_flag,expression:"!expire_flag"}],attrs:{label:"到期时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"选择到期时间"},model:{value:t.expire_time,callback:function(e){t.expire_time=e},expression:"expire_time"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("b0c0"),a("c1df")),r=a.n(i),l=a("2f62"),c=a("5c96"),u={data:function(){return{types:[{value:"wx",label:"企业微信"},{value:"dd",label:"钉钉"}],isShow:!1,expire_flag:!0,expire_time:null,projects:[],formData:{roles:[],public_state:2,sql_audit_auth:"",info:"",web_hook_type:"wx"},sys_roles:[{l:"系统管理员",v:1},{l:"审计管理员",v:2},{l:"策略管理员",v:3},{l:"用户",v:4}]}},props:{},watch:{},computed:Object(o["a"])({},Object(l["e"])(["user"])),methods:{showTime:function(t){return r()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},reset:function(){return{state:0,roles:[],public_state:2,roles_str:"",web_hook_type:"wx"}},show:function(t){var e=this;this.id=t?t.id:null,this.id?(this.$api.project.info(t.id).then((function(t){t.roles||(t.roles=[]),e.formData=t,e.formData.web_hook_type||(e.formData.web_hook_type="wx"),-1==t.expire?e.expire_flag=!0:(e.expire_flag=!1,e.expire_time=e.showTime(t.expire)),e.isShow=!0})),this.$api.project.all().then((function(t){e.formData=e.reset(),e.projects=t}))):this.isShow=!0},hide:function(t){this.isShow=!1},onSubmit:function(){var t=this;if(this.formData.roles_str=this.formData.roles.join(","),!this.formData.name)return this.$message({message:"项目名称不能为空",type:"warning"}),!1;if(this.expire_flag)this.formData.expire=-1;else{if(!this.expire_time)return void c["Message"].error({title:"提示",message:"请输入失效时间。",type:"error",duration:2e3});this.formData.expire=this.expire_time.getTime()}this.$api.project.edit(this.formData).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},dcb4:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"异步查询",visible:t.isShow},on:{open:t.onOpen,opened:t.onOpened,closed:t.onClosed,"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{"label-width":"120px"}},[a("monaco-lite",{ref:"monacoLiteRef",staticClass:"exec-sql",staticStyle:{height:"200px"},attrs:{config:{readOnly:!0}}}),a("el-form-item",{attrs:{label:"查询标题"}},[a("el-input",{ref:"asyncTitle",model:{value:t.formData.mark,callback:function(e){t.$set(t.formData,"mark",e)},expression:"formData.mark"}})],1),a("el-form-item",{attrs:{label:"查询条数"}},[a("el-select",{model:{value:t.formData.max_rows,callback:function(e){t.$set(t.formData,"max_rows",e)},expression:"formData.max_rows"}},t._l(t.rows,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)},n=[],o=a("cb68"),i={components:{"monaco-lite":o["default"]},data:function(){return{isShow:!1,notifys:["钉钉","微信","邮件"],rows:[10,2e3,3e3,5e3,1e4,5e4],formData:this.reset()}},methods:{reset:function(){return{mark:"",max_rows:2e3,notify:null,async:!0}},show:function(t,e){this.params=e||{},this.formData=this.reset(),this.cb=t,this.isShow=!0},onOpened:function(){this.$refs.monacoLiteRef.setSql(this.params.sql||"-- 未获取到SQL")},onClosed:function(){this.$refs.monacoLiteRef.setSql("")},onOpen:function(){var t=this;this.$nextTick((function(){t.$refs.asyncTitle.focus()}))},hide:function(t){this.isShow=!1},onSubmit:function(){this.cb(this.formData),this.hide()}}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},dcf2:function(t,e,a){"use strict";var s=a("60fe");e["a"]={path:"/personal",title:"个人中心",iconfont:"icon-dfdfdfdfdf",role:s["i"],children:[{role:s["i"],path:"/personal",title:"个人资料",iconfont:"icon-dfdfdfdfdf"},{role:s["i"],path:"/personal/notice",title:"消息通知",iconfont:"icon-tongzhi"}]}},dd1f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-project-user",attrs:{title:t.project.name+"-[用户管理]",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:!1,url:"/api/project/user/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"用户名",prop:"name",size:"mini"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id",width:"80"}}),a("el-table-column",{attrs:{label:"用户名",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" "),1==e.row.is_create?a("el-tag",{attrs:{type:"warning"}},[t._v("创建人")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"姓名",prop:"user_name"}}),a("el-table-column",{attrs:{label:"开启项目管理权限"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-switch",{attrs:{title:t.getOpenProjectRoleTitle(s),value:s.project_role,disabled:t.disabledSwitch(s),"active-value":1,"inactive-value":2,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(e){return t.onChangeProjectRoleSwitch(e,s)}}})]}}])}),a("el-table-column",{attrs:{label:"项目角色",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.row._rid_,callback:function(a){t.$set(e.row,"_rid_",a)},expression:"r.row._rid_"}},t._l(t.roleList,(function(t){return a("el-option",{key:t.id,staticStyle:{width:"100%"},attrs:{label:t.name,value:t.id}})})),1):e.row.role_name?a("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.row.role_name))]):t._e()]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?a("el-button",{attrs:{type:"warning",size:"mini",plain:"",disabled:2==t.user.role&&t.user.role>=e.row.role&&t.user.id!=e.row.id},on:{click:function(a){return t.onAdd(e.row.id,e.row._rid_||0)}}},[t._v("添加 ")]):t._e(),0!=e.row.project?a("el-button",{attrs:{type:"danger",size:"mini",plain:"",disabled:1==e.row.is_create},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("d3b7"),a("2f62")),r={data:function(){return{ids:"",project:{},roleList:{},isShow:!1,search:{},rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}]}},props:{},watch:{},computed:Object(o["a"])(Object(o["a"])({},Object(i["e"])(["user"])),{},{disabledSwitch:function(){return function(t){return 1==t.is_create||0==t.project_role}},getOpenProjectRoleTitle:function(){return function(t){return 0==t.project_role?"用户未加入当前项目，请点击“添加”按钮":1==t.project_role?"点击去除项目权限":"点击添加项目权限"}}}),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},onRoleChange:function(t,e){e._rid_=t||0},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.id=this.project.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.project=t,this.search.id=t.id,this.isShow=!0,this.roleList=[],this.getAllRoles(t.id).then((function(){e.$nextTick((function(){e.refresh()}))}))},getAllRoles:function(t){var e=this;return new Promise((function(a,s){e.$api.role.all(1,t).then((function(t){return e.roleList=t,a()})).catch((function(t){return s(t)}))}))},hide:function(t){this.isShow=!1,this.roleList=[]},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onChangeProjectRoleSwitch:function(t,e){this.onProjectRole(e.id,t)},onProjectRole:function(t,e){var a=this;this.$api.project.user_upd(this.project,t,e).then((function(){a.onSuccess(1==e?"开启成功":"关闭成功"),a.refresh()}))},onAdd:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.$api.project.relation(this.project,t,a||0).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.project.kick(this.project.id,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=(a("7add"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},dd85:function(t,e,a){},dd95:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-home",use:"d2-home-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-home"><path d="M581.256852 902.487505 319.374376 902.487505c-83.856873 0-152.074557-68.217684-152.074557-152.074557L167.299819 555.360554l-67.092048 0c-14.58723 0-27.650757-9.018398-32.8205-22.659069-5.163603-13.640672-1.353834-29.057803 9.567913-38.720883l412.19183-364.639814c13.274328-11.743462 33.220612-11.743462 46.49494 0l412.18569 364.639814c10.934027 9.664104 14.736633 25.080212 9.573029 38.720883-5.174859 13.639648-18.23327 22.659069-32.821523 22.659069l-67.091024 0 0 195.051371c0 52.594869-26.596751 100.731192-71.149457 128.770805-16.403598 10.343579-38.052664 5.392824-48.391127-11.007705-10.327206-16.403598-5.392824-38.069037 11.012821-48.397267 24.001647-15.109116 38.33919-41.039695 38.33919-69.365834L787.299555 520.265244c0-19.379373 15.709797-35.093263 35.094286-35.093263l9.549493 0L512.393461 202.481597 192.843588 485.171981l9.550517 0c19.379373 0 35.093263 15.712867 35.093263 35.093263l0 230.146681c0 45.152363 36.739762 81.885985 81.885985 81.885985l261.881452 0c19.385513 0 35.094286 15.712867 35.094286 35.095309C616.350115 886.773615 600.642364 902.487505 581.256852 902.487505z" p-id="7447" /><path d="M580.743152 902.487505c-19.386536 0-35.093263-15.712867-35.093263-35.093263 0-19.381419 15.706727-35.095309 35.093263-35.095309 12.897751 0 23.39585-10.492982 23.39585-23.396873L604.139002 639.213333c0-12.903891-10.499122-23.396873-23.39585-23.396873L444.044794 615.81646c-12.897751 0-23.396873 10.492982-23.396873 23.396873l0 109.167329c0 19.379373-15.706727 35.093263-35.093263 35.093263-19.386536 0-35.094286-15.712867-35.094286-35.093263L350.460372 639.213333c0-51.602262 41.983183-93.584422 93.585445-93.584422l136.698359 0c51.601238 0 93.584422 41.98216 93.584422 93.584422l0 169.688727C674.327574 860.505345 632.343367 902.487505 580.743152 902.487505z" p-id="7448" /></symbol>'});i.a.add(r);e["default"]=r},ddbc:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"employee padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{data:t.dataList,url:"/api/project/user/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"账号",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"姓名",prop:"user_name"}},[a("el-input",{model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{model:{value:t.search.email,callback:function(e){t.$set(t.search,"email",e)},expression:"search.email"}})],1)],1),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id"}}),a("el-table-column",{attrs:{label:"登录名",prop:"name"}}),a("el-table-column",{attrs:{label:"姓名",prop:"user_name"}}),a("el-table-column",{attrs:{label:"邮箱",prop:"email"}}),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-success"},[t._v("正常")]):0==e.row.state?a("span",{staticClass:"text-error"},[t._v("冻结")]):t._e()]}}])}),a("el-table-column",{attrs:{label:"管理权限"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.project_role?a("span",[a("el-tag",{attrs:{type:"warning"}},[t._v(" 有 ")])],1):2==e.row.project_role?a("span",[a("el-tag",{attrs:{type:"info"}},[t._v("无")])],1):a("span")]}}])}),t.project_home.is_manager?a("el-table-column",{attrs:{label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.role_name?a("el-tag",{attrs:{type:"success"}},[t._v(t._s(e.row.role_name))]):a("span",{attrs:{type:"info"}})]}}],null,!1,449444796)}):t._e(),t.project_home.is_manager?a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.project_home.is_manager?a("k-btn-tip",{directives:[{name:"business",rawName:"v-business"}],attrs:{tip:"确定要把【"+e.row.name+"】用户移除项目吗?"},on:{click:function(a){return t.onRemove(e.row.id)}}},[a("el-button",{attrs:{size:"mini",type:"danger",disabled:t.user.id==e.row.id}},[t._v("移除 ")])],1):t._e()]}}],null,!1,3593456725)}):t._e()],1)],2)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r=a("c1df"),l=a.n(r),c=a("5c96"),u={computed:Object(o["a"])({},Object(i["e"])(["user","project_home"])),data:function(){return{formData:{name:""},id:this.$route.params.id,cp:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMPANY,no_role:!1,search:{id:this.$route.params.id,rel_type:1},dataList:[],roles:[],projects:[],sys_roles:[{k:"",v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:3,v:"管理员"},{k:4,v:"普通用户"}],sources:[{k:"",v:"全部"},{k:"focus",v:"焦点"},{k:"system_add",v:"后台添加"}],role_states:[{k:"0",v:"全部"},{k:"1",v:"已分配"},{k:"2",v:"未分配"}]}},methods:{onRemove:function(t){var e=this;this.$api.project.kick(this.id,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},init:function(){},showRoleNames:function(t){return t&&t.length>0&&""!=t[0]?t.join(","):"无"},resetSearch:function(){console.log("========resetSearch========="),this.search={}},showTime:function(t){return l()(new Date(t)).format("YYYY-MM-DD HH:mm:ss")},onReset:function(t){var e=this;this.$api.post("/api/user/reset",{id:t.id}).then((function(t){e.onSuccess(t),e.refresh("操作成功")}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},refresh:function(){this.$refs.st.search()},onNew:function(){this.$refs.dialogEdit.show()},onShowAuth:function(t){this.$refs.dialogAuth.show(t)},onEdit:function(t){this.$refs.dialogEdit.show(t)},onState:function(t,e){var a=this;this.$api.user.state(t.id,e).then((function(){a.onSuccess("操作成功"),a.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))},onDel:function(t){var e=this;this.$api.user.delete(t.id).then((function(){e.onSuccess("操作成功"),e.refresh()}),(function(t){c["Message"].error({title:"请求",message:t&&t.data?t.data:t,type:"error",duration:2e3})}))}},mounted:function(){console.log("dashboard_project: ",this.dashboard_project)}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},de77:function(t,e,a){"use strict";a("3ea1")},df50:function(t,e,a){"use strict";a("8b20")},df8f:function(t,e,a){},dfa3:function(t,e,a){},e0e2:function(t,e,a){"use strict";a("cfd2")},e10f:function(t,e,a){"use strict";a("138a")},e13a:function(t,e,a){"use strict";a("3c60")},e18d:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"page",attrs:{type:"ghost"}},[a("div",{staticClass:"system-page-dashboard apps"},[a("el-row",{staticClass:"base-info-section",attrs:{type:"flex",gutter:20,justify:"space-between"}},[a("el-col",{attrs:{span:4,offset:0}},[a("div",{staticClass:"icon"},[a("i",{staticClass:"sn-font project"},[t._v("")])]),a("div",[a("h4",[t._v("项目数")]),a("span",{staticClass:"count"},[t._v(t._s(t.baseStat.project_count))])])]),a("el-col",{attrs:{span:4,offset:0}},[a("div",{staticClass:"icon"},[a("i",{staticClass:"sn-font db"},[t._v("")])]),a("div",[a("h4",[t._v("数据源")]),a("span",{staticClass:"count"},[t._v(t._s(t.baseStat.db_count))])])]),a("el-col",{attrs:{span:4,offset:0}},[a("div",{staticClass:"icon"},[a("i",{staticClass:"sn-font user"},[t._v("")])]),a("div",[a("h4",[t._v("用户数")]),a("span",{staticClass:"count"},[t._v(t._s(t.baseStat.user_count))])])]),a("el-col",{attrs:{span:4,offset:0}},[a("div",{staticClass:"icon"},[a("i",{staticClass:"sn-font execute"},[t._v("")])]),a("div",[a("h4",[t._v("执行次数")]),a("span",{staticClass:"count"},[t._v(t._s(t.baseStat.project_count))])])]),a("el-col",{attrs:{span:4,offset:0}},[a("div",{staticClass:"icon"},[a("i",{staticClass:"sn-font execute-error"},[t._v("")])]),a("div",[a("h4",[t._v("执行失败")]),a("span",{staticClass:"count"},[t._v(t._s(t.baseStat.project_count))])])])],1),a("el-row",{staticClass:"flex",staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{staticClass:"h-auto",attrs:{span:8}},[a("monitor")],1),a("el-col",{attrs:{span:8}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 数据源类型 ")])]),a("div",[a("ve-ring",{attrs:{height:"350px",settings:{radius:120,offsetY:200},data:t.dbTypeStat,title:t.dbTypeTitle}})],1)])],1),a("el-col",{attrs:{span:8}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("一周访问量")])]),a("div",[a("ve-line",t._b({attrs:{data:t.logTimeStat,title:t.logTimeTitle}},"ve-line",t.pubSetting1,!1))],1)])],1)],1),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v(" 其他统计 "),a("el-date-picker",{staticStyle:{float:"right","margin-bottom":"5px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.$constant.pickOptions},on:{change:t.queryToday},model:{value:t.query.todayRange,callback:function(e){t.$set(t.query,"todayRange",e)},expression:"query.todayRange"}})],1)]),a("div",[a("el-row",{attrs:{gutter:0}},[a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-bar",t._b({attrs:{data:t.dbStat,"legend-visible":!1,settings:t.dbStatSettings,title:t.dbTitle}},"ve-bar",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-pie",t._b({attrs:{colors:["#45D5B0","#F56C6C"],settings:{radius:80},data:t.logStat,"legend-visible":!1,title:t.logTitle}},"ve-pie",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-pie",t._b({attrs:{settings:{radius:80},data:t.typeStat,"legend-visible":!1,title:t.typeTitle}},"ve-pie",t.pubSetting,!1))],1),a("el-col",{staticClass:"chart",attrs:{xs:24,sm:12,md:12,lg:6,xl:6}},[a("ve-bar",t._b({attrs:{data:t.userStat,"legend-visible":!1,settings:t.appStatSettings,title:t.userTitle}},"ve-bar",t.pubSetting,!1))],1)],1)],1)])],1)],1)])},n=[],o=a("b85c"),i=a("5530"),r=(a("b0c0"),a("5743")),l=a("2f62"),c=a("4865"),u=a("2819"),d={components:{VeLine:u["VeLine"],Monitor:c["default"],VeBar:u["VeBar"],VePie:u["VePie"],VeRing:u["VeRing"]},computed:Object(i["a"])({},Object(l["e"])(["user","project"])),data:function(){return{baseStat:{},isCommunity:!1,projectList:[],query:{start:"",end:"",start2:"",end2:"",todayRange:[]},stat:{db_count:0,app_count:0,user_count:0,today_count:0,fail_count:0},dbTypeStat:{columns:["类型","数量"],rows:[]},dbTypeTitle:{text:""},typeTitle:{text:"当日执行类型统计",default:10},logTimeTitle:{text:""},logStat:{columns:["类型","数量"],rows:[]},logTitle:{text:"当日失败率统计"},logTimeStat:{columns:["时间","访问量"],rows:[]},dbStat:{columns:["数据源","访问量"],rows:[]},dbTitle:{text:"当日数据库使用量"},dbStatSettings:{dataOrder:{label:"访问量",order:"desc"}},exportStat:{columns:["应用","访问量"],rows:[]},appTitle:{text:"当日数据导出量"},userStat:{columns:["用户名","访问量"],rows:[]},typeStat:{columns:["操作","数量"],rows:[]},userTitle:{text:"当日用户访问量"},appStatSettings:{dataOrder:{label:"访问量",order:"desc"}},pubSetting1:{height:"350px",width:"100%"},pubSetting:{height:"400px",width:"100%"},chartData1:{columns:["数据源","次数"],rows:[{"次数":1393,"数据源":"查询库"},{"次数":3530,"数据源":"用户中心"},{"次数":2923,"数据源":"订单库"},{"次数":1723,"数据源":"淘宝api"},{"次数":3792,"数据源":"日志"},{"次数":4593,"数据源":"eslog"}]},chartData:{columns:["日期","访问用户","下单用户","下单率"],rows:[{"日期":"1/1","访问用户":1393,"下单用户":1093,"下单率":.32},{"日期":"1/2","访问用户":3530,"下单用户":3230,"下单率":.26},{"日期":"1/3","访问用户":2923,"下单用户":2623,"下单率":.76},{"日期":"1/4","访问用户":1723,"下单用户":1423,"下单率":.49},{"日期":"1/5","访问用户":3792,"下单用户":3492,"下单率":.323},{"日期":"1/6","访问用户":4593,"下单用户":4293,"下单率":.78}]}}},mounted:function(){var t=this;this.queryBase();var e=r["a"].timeRange("now/d to now/d");this.query.todayRange=e,this.queryToday(),e&&e.length>1&&(this.query.start=r["a"].utc2date(e[0]),this.query.end=r["a"].utc2date(e[1]));var a=r["a"].timeRange("now-7d to now");a&&a.length>1&&(this.query.start2=r["a"].utc2date(a[0]),this.query.end2=r["a"].utc2date(a[1])),this.$nextTick((function(){t.init()}))},methods:{queryToday:function(){var t=this;if(this.query.todayRange&&this.query.todayRange.length>1){var e=r["a"].utc2date(this.query.todayRange[0]),a=r["a"].utc2date(this.query.todayRange[1]);this.$api.post("/api/sys/stat",{type:"log_stat",start:e,end:a}).then((function(e){if(e&&0==e.length)t.logStat.rows=[{"类型":"空","数量":0}];else{var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"类型":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.logStat.rows=s}})),this.$api.post("/api/sys/stat",{type:"db_stat_list",start:e,end:a}).then((function(e){if(e&&0==e.length)t.dbStat.rows=[{"数据源":"空","访问量":0}];else{var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"数据源":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.dbStat.rows=s}})),this.$api.post("/api/sys/stat",{type:"type_stat",start:e,end:a}).then((function(e){if(e&&0==e.length)t.typeStat.rows=[{"操作":"空","数量":0}];else{var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"操作":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.typeStat.rows=s}})),this.$api.post("/api/sys/stat",{type:"user_stat_list",start:e,end:a}).then((function(e){if(e&&0==e.length)t.userStat.rows=[{"用户名":"空","访问量":0}];else{var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"用户名":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.userStat.rows=s}}))}},queryBase:function(){var t=this;this.$api.post("/api/sys/stat",{type:"base_stat",start:"",end:""}).then((function(e){t.baseStat=e||{}})),this.$api.post("/api/sys/stat",{type:"db_type_stat",start:this.query.start,end:this.query.end}).then((function(e){var a,s=[],n=Object(o["a"])(e);try{for(n.s();!(a=n.n()).done;){var i=a.value;s.push({"类型":i.name,"数量":i.hits})}}catch(r){n.e(r)}finally{n.f()}t.dbTypeStat.rows=s}))},getTagType:function(t){return t?"success":"info"},goProjectHome:function(t){this.$router.push({path:"/project_home?id="+t.id})},init:function(){var t=this;this.$api.project.publicList().then((function(e){t.projectList=e})),this.$api.post("/api/user/stat",{type:"total_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.today_count=e.hits})),this.$api.post("/api/user/stat",{type:"total_fail_stat",start:this.query.start,end:this.query.end}).then((function(e){t.stat.fail_count=e.hits})),this.$api.post("/api/user/stat",{type:"log_time_stat",start:this.query.start2,end:this.query.end2}).then((function(e){var a=[];if(e&&0==e.length)a.push({"时间":"今天","访问量":0});else{var s,n=Object(o["a"])(e);try{for(n.s();!(s=n.n()).done;){var i=s.value;a.push({"时间":i.name,"访问量":i.hits})}}catch(r){n.e(r)}finally{n.f()}}t.logTimeStat.rows=a}))}}},p=d,f=(a("e9d4"),a("2877")),m=Object(f["a"])(p,s,n,!1,null,null,null);e["default"]=m.exports},e266:function(t,e,a){"use strict";a("a1fe")},e29a:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"relative"},[a("div",{staticClass:"container mx-auto px-4"},[a("div",{staticClass:"flex flex-col items-center justify-between"},[t._m(0),a("el-button",{staticClass:"d2-mt",on:{click:function(e){return t.goto("/")}}},[t._v(" 返回首页 ")])],1)])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"w-full h-full sm:w-2/3 sm:h-2/3 mx-auto"},[a("object",{attrs:{data:"/static/svg/404-2.svg",type:"image/svg+xml"}})])}],o=(a("ac1f"),a("5319"),{methods:{goto:function(t){this.$router.replace({path:t})}}}),i=o,r=(a("4d627"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"bdbb3732",null);e["default"]=l.exports},e2c8:function(t,e,a){"use strict";a("3d8c")},e2cb:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("div",{staticClass:"component-policy"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v(" 新增访问规则 ")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.getList}},[t._v(" 刷新 ")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{stripe:"",border:"","row-key":"id",data:t.tableData}},[a("el-table-column",{attrs:{prop:"cidr",label:"来源",width:"280"}}),a("el-table-column",{attrs:{prop:"pass",label:"策略",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.pass?a("el-tag",{attrs:{type:"success"}},[t._v("允许")]):a("el-tag",{attrs:{type:"danger"}},[t._v("拒绝")])]}}])}),a("el-table-column",{attrs:{prop:"mark",label:"备注"}}),a("el-table-column",{attrs:{prop:"updatedAt",label:"修改时间",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.format(a.updatedAt))+" ")]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-link",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.editHandle(s)}}},[t._v("编辑")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-link",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteHandle(s)}}},[t._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v(" 新增访问规则 "),a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 来源支持以下格式："),a("br"),t._v(" 单个IP: 192.168.0.1"),a("br"),t._v(" CIDR: 192.168.1.0/24"),a("br"),a("br"),t._v(" 策略："),a("br"),t._v(" 允许：白名单策略"),a("br"),t._v(" 拒绝：黑名单策略 ")]),a("i",{staticClass:"el-icon-info",staticStyle:{color:"#F50000"}})])],1),t._l(t.forms,(function(e,s){return[a("el-form",{key:s,ref:s,refInFor:!0,staticClass:"demo-form-inline",attrs:{inline:!0,rules:t.rules,model:e}},[a("el-form-item",{attrs:{prop:"cidr"}},[a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 来源支持以下格式："),a("br"),t._v(" 单个IP: 192.168.0.1"),a("br"),t._v(" CIDR: 192.168.1.0/24 ")]),a("el-input",{attrs:{placeholder:"来源"},model:{value:e.cidr,callback:function(a){t.$set(e,"cidr",a)},expression:"form.cidr"}})],1)],1),a("el-form-item",{attrs:{prop:"pass"}},[a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(" 策略："),a("br"),t._v(" 允许：白名单策略"),a("br"),t._v(" 拒绝：黑名单策略 ")]),a("el-select",{attrs:{placeholder:"策略"},model:{value:e.pass,callback:function(a){t.$set(e,"pass",a)},expression:"form.pass"}},[a("el-option",{attrs:{label:"允许",value:!0}}),a("el-option",{attrs:{label:"拒绝",value:!1}})],1)],1)],1),a("el-form-item",{attrs:{prop:"mark"}},[a("el-input",{attrs:{placeholder:"备注"},model:{value:e.mark,callback:function(a){t.$set(e,"mark",a)},expression:"form.mark"}})],1),"form0"!=s?a("el-form-item",[a("el-link",{attrs:{type:"danger"},on:{click:function(e){return t.removeLine(s)}}},[t._v("删除")])],1):t._e()],1)]})),"add"==t.actionType?a("div",{staticClass:"add-form"},[a("el-link",{attrs:{type:"success"},on:{click:t.addForm}},[t._v(" +新增一行 ")])],1):t._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],2)],1)])},n=[],o=a("5530"),i=(a("a434"),a("d3b7"),a("159b"),a("3ca3"),a("ddb0"),a("b64b"),a("c1df")),r=a.n(i),l=a("aa47"),c={computed:{format:function(){return function(t){return r()(t).format("YYYY-MM-DD HH:mm:ss")}}},data:function(){return{tableLoading:!1,actionType:"add",tableData:[],dialogVisible:!1,forms:{form0:this.resetForm()},rules:{cidr:{required:!0,message:"请输入来源",trigger:"blur"},pass:{required:!0,message:"请选择策略",trigger:"change"}}}},mounted:function(){this.rowDrop(),this.getList()},methods:{rowDrop:function(){var t=document.querySelector(".el-table__body-wrapper tbody"),e=this;l["a"].create(t,{onEnd:function(t){var a=t.newIndex,s=t.oldIndex,n=e.tableData.splice(s,1)[0];e.tableData.splice(a,0,n),e.updatePolicyIndex()}})},resetForm:function(){return{cidr:"",policy_index:99,pass:null,mark:""}},getList:function(){var t=this;this.tableLoading=!0,this.$api.setting.get().then((function(e){e.policy_list&&e.policy_list.length>=0?t.tableData=e.policy_list:t.tableData=[]})).finally((function(){t.tableLoading=!1}))},deleteHandle:function(t){var e=this;console.log("删除行：",t.id),this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$api.post("/api/system/setting/policy/del",{id:t.id}).then((function(t){console.log("删除成功：",t),e.$message({type:"success",message:"删除成功!"}),e.getList()}))}))},editHandle:function(t){this.actionType="edit",this.dialogVisible=!0,this.forms={form0:Object(o["a"])({},t)},console.log("编辑行：",t.id)},updatePolicyIndex:function(){var t=this,e=[];this.tableData.forEach((function(a,s){var n=Object(o["a"])(Object(o["a"])({},a),{},{policy_index:s+1}),i=t.$api.post("/api/system/setting/policy/add",n);e.push(i)})),Promise.all(e).then((function(){t.$notify({title:"成功",message:"更新成功",type:"success"})})).catch((function(e){t.$notify({title:"更新失败",message:JSON.stringify(e.data||e),type:"error"})})).finally((function(){t.getList()}))},onSubmit:function(){var t=this,e=[],a=function(a){var s=new Promise((function(e,s){(t.$refs[a][0]||t.$refs[a]).validate((function(t){t?e():s(a)}))}));e.push(s)};for(var s in this.forms)a(s);Promise.all(e).then((function(){var e=[],a=0==t.tableData.length?1:t.tableData[t.tableData.length-1].policy_index;for(var s in t.forms){var n=t.forms[s];n.id||(n.policy_index=++a);var o=t.$api.post("/api/system/setting/policy/add",n);e.push(o)}Promise.all(e).then((function(){t.handleClose(),t.getList(),t.$notify({title:"成功",message:"保存成功",type:"success"})})).catch((function(e){t.$notify({title:"保存错误",message:JSON.stringify(e.data||e),type:"error"}),console.error("保存错误：",e)}))})).catch((function(e){t.$notify({title:"参数验证错误",message:e,type:"error"}),console.error("form 验证未通过：",e)}))},handleClose:function(){this.actionType="add",this.forms={form0:this.resetForm()},this.dialogVisible=!1},addForm:function(){var t="form"+Object.keys(this.forms).length,e={};e["".concat(t)]=this.resetForm(),this.forms=Object(o["a"])(Object(o["a"])({},this.forms),e)},removeLine:function(t){this.$delete(this.forms,t)}}},u=c,d=(a("b58b"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,"738130c2",null);e["default"]=p.exports},e2d62:function(t,e,a){},e31c:function(t,e,a){"use strict";var s=a("b85c"),n=(a("ac1f"),a("1276"),a("466d"),a("caad"),a("5319"),a("498a"),a("b64b"),a("99af"),a("a15b"),a("8a79"),a("b0c0"),a("d81d"),["ssl","key","and"]);function o(t){var e="";if(!t)return e;if(1===t.length)return"tt";var a=t.split("_");if(!a)return e;if(a.length>1){var o,i=Object(s["a"])(a);try{for(i.s();!(o=i.n()).done;){var r=o.value;e+=r.substr(0,1)}}catch(p){i.e(p)}finally{i.f()}}else if(1===a.length){t=t[0].toUpperCase()+t.substr(1,t.length);var l,c=t.match(/([A-Z]+)/g),u=Object(s["a"])(c);try{for(u.s();!(l=u.n()).done;){var d=l.value;e+=d[0]}}catch(p){u.e(p)}finally{u.f()}}return e=e.toLowerCase(),n.includes(e)?"".concat(e,"1"):e}var i={string_1:"GET key",string_redis_get:"GET key",string_2:"DEL key",string_3:"SET key value EX seconds",string_4:"SET key value EX seconds",hash_1:'HSCAN key 0 match "*" count 100',hash_redis_get:'HSCAN key 0 match "*" count 100',hash_2:"HDEL key field",hash_3:"HSET key field value",hash_4:"HSET key field value",set_1:'SSCAN key 0 match "*" count 100',set_redis_get:'SSCAN key 0 match "*" count 100',set_2:"DEL key",set_3:"SADD key member",set_4:"SADD key member",zset_1:"ZRANGE key 0 100 WITHSCORES",zset_redis_get:"ZRANGE key 0 100 WITHSCORES",zset_2:"ZREM key member",zset_3:"ZADD key score member",zset_4:"ZADD key score member",list_1:"LRANGE key 0 100",list_redis_get:"LRANGE key 0 100",list_2:"DEL key",list_3:"LPUSH key value",list_4:"LPUSH key value",stream_1:"XREVRANGE key end start COUNT 100",stream_redis_get:"XREVRANGE key end start COUNT 100",stream_2:"DEL key",stream_3:"XADD key ID field value",stream_4:"XADD key ID field value"},r=/\s*--\s*mode=(.*?),/,l=/^\s*--\s*(mode|src|work_id|work_name|db|db_type)=.*,+.*(\r|\n)+/gm,c=/^\s*--\s*((mode|src|id|name|db|db_type)=.*,+.*?)(\r|\n)/gm,u=function(t){return t.trim().replace(l,"")},d=function(t){var e=/^\s*--\s*(mode|src|work_id|work_name|db|db_type)=.*,+.*(\r|\n)+/gm,a=e.exec(t.trim()),s=!!(a&&a.length>0)&&a[0];return s},p=function(t){var e=c.exec(t);c.lastIndex=0;var a=!!(e&&e.length>1)&&e[1];if(!a)return!1;var s=a.trim().split(","),n={};for(var o in s){var i=s[o],r=i.split("=");r&&2===r.length&&(n[r[0]]=r[1])}return Object.keys(n).length>0&&n},f=function(t){var e=r.exec(t);return!!(e&&e.length>0)&&e[1]},m=function(t,e,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update";if("insert"===s){var n=[],o=[];for(var i in e)if("<nil>"!==e[i]&&"NULL"!==e[i]){n.push(i);var r=e[i];r=String(r).replace(/'/g,"\\'").replace(/"/g,'\\"'),o.push("'".concat(r,"'"))}return"INSERT INTO ".concat(t," (").concat(n.join(","),") VALUES (").concat(o.join(","),");")}if("delete"===s){var l=[];for(var c in a)if("<nil>"===a[c]||"NULL"===a[c])l.push("".concat(c," is NULL"));else{var u=a[c];u=String(u).replace(/'/g,"\\'").replace(/"/g,'\\"'),l.push("".concat(c," = '").concat(u,"'"))}var d="DELETE FROM ".concat(t," where ").concat(l.join(" AND "),";");return d}var p=[];for(var f in e)if("<nil>"===e[f]||"NULL"===e[f])p.push("".concat(f," = null"));else{var m=e[f];m=String(m).replace(/'/g,"\\'").replace(/"/g,'\\"'),p.push("".concat(f," = '").concat(m,"'"))}var h=[];for(var b in a){var _=a[b];"<nil>"===_||"NULL"===_?h.push("".concat(b," is NULL")):(_=String(_).replace(/'/g,"\\'").replace(/"/g,'\\"'),h.push("".concat(b," = '").concat(_,"'")))}var g="UPDATE ".concat(t," SET ").concat(p.join(" , ")," where ").concat(h.join(" AND "),";");return g},h=function(t,e,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"update",n=[];for(var o in e){var i=m(t,e[o],a[o],s);n.push(i)}return n},b=function(t){if(t){var e=t.sql;if(void 0===e&&(e=_(t)),!t.comment||!1==={"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0}["soft-route"])return"\n"+e+"\n";t.mode||(t.mode="标准"),e=e.trim().replace(l,""),e=e.endsWith(";")?e:e+";";var a=[];return a.push("\n"),a.push("-- "),a.push("mode=".concat(t.mode,",")),a.push(t.id?"id=".concat(t.id,","):""),a.push(t.name?"name=".concat(t.name,","):""),a.push("src=".concat(t.src||t.sourceName,",")),a.push("db=".concat(t.db||t.dbName,",")),a.push(t.db_type||t.dbType?"db_type=".concat(t.db_type||t.dbType):""),a.push("\n"),a.join("")+e+"\n"}console.error("[db.js generate] 参数错误 : ",t)},_=function(t){if(t&&t.dbType&&t.name&&t.type&&t.command){var e="";if("redis"===t.dbType){var a="".concat(t.type,"_").concat(t.command),s=i[a];s&&(e=s.replace("key",'"'.concat(t.name,'"')))}else{t.columns&&0!==t.columns.length||(t.columns=["*"]);var n=[],r=o(t.name),l=", ".concat(r,".");switch(t.command){case"select_count":case 9:n=["select \n\tcount(1)","from \n\t".concat(t.name," ")];break;case"export_table":case 8:n=["select \n\t".concat(r,".").concat(t.columns.join(l)," "),"from \n\t".concat(t.name," ").concat(r," ")];break;case"select_table":case 1:n=["select \n\t".concat(r,".").concat(t.columns.join(l)," "),"from \n\t".concat(t.name," ").concat(r," ")];break;case"select_table_*":n=["select \n\t* ","from \n\t".concat(t.name," ").concat(r," ")];break;case"delete_table":case 2:n=["delete from ".concat(t.name," "),"where","\t1=2\t"];break;case 3:n=["update ".concat(t.name," set"),"\t".concat(t.columns.map((function(t){return"".concat(t," = :").concat(t)})).join(", \n\t")),"where","\t1=2\t"];break;case 4:n=["insert into ".concat(t.name),"\t(".concat(t.columns.join(", "),")"),"values","\t(:".concat(t.columns.join(", :"),")")];break;case 7:n=["select","\tcount(1)","from","\t".concat(t.name)];break;case 71:n=["select","\t*","from","\t".concat(t.name)];break}e=n.join("\n")}return e}console.error("[db.js generateSQL] 参数错误 - [dbType, name, type, command]",t)},g={getSoftRoute:d,removeSoftRoute:u,parserComments:p,getMode:f,generate:b,generateSQL:_,generateEffects:h,generateEffectRow:m};e["a"]=g},e34f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.pro.name+"/数据源管理",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:"onSelect",url:"/api/project/db/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"数据源类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:""==t.ids},on:{click:t.onBatchAdd}},[t._v("批量添加")]),a("el-button",{attrs:{type:"danger",size:"mini",disabled:""==t.ids},on:{click:t.onBatchRemove}},[t._v("批量移除")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源",prop:"name",width:"280"}}),t.db&&"all"==t.db?a("el-table-column",{attrs:{label:"类型",prop:"db_type"}}):t._e(),a("el-table-column",{attrs:{label:"启用",width:"50px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("span",{staticClass:"text-info"},[t._v(" 是 ")]):a("span",{staticClass:"text-warn"},[t._v(" 否 ")])]}}])}),a("el-table-column",{attrs:{label:"连接状态",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.state?a("div",[3==e.row.con_state?a("el-tooltip",{attrs:{content:e.row.err_msg,placement:"bottom",effect:"light"}},[a("span",{staticClass:"text-warn"},[t._v("连接失败")])]):2==e.row.con_state?a("span",{staticClass:"text-success"},[t._v("已连接")]):1==e.row.con_state?a("span",{staticClass:"text-info"},[t._v("连接中")]):a("span",{staticClass:"text-info"},[t._v("未连接")])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"读写",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.oper_type?a("span",{staticClass:"text-success"},[t._v("只读")]):a("span",{staticClass:"text-error"},[t._v("读写")])]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dateTime")(e.row.created_at)))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?a("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(a){return t.onAdd(e.row.id)}}},[t._v("添加 ")]):t._e(),0!=e.row.project?a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=a("2909"),r=(a("99af"),a("a15b"),a("ac1f"),a("841c"),a("2f62")),l={data:function(){return{db:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).DB,pro:{},ids:"",isShow:!1,search:{db_types:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],db_types:[{label:"全部",value:""}].concat(Object(i["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]))}},props:{},watch:{},computed:Object(o["a"])({},Object(r["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.project=this.pro.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.pro=t,this.search.project=t.id,this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this;this.$api.project.relationDB(this.pro,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.project.kickDB(this.pro,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},c=l,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},e36f:function(t,e,a){a("d3b7"),a("3ca3"),a("ddb0"),t.exports=function(t){return function(){return a("9dac")("./"+t)}}},e3b9:function(t,e,a){"use strict";a("01d2")},e531:function(t,e,a){},e547:function(t,e,a){"use strict";a("d001")},e649:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editor-container"},[a("pre",{staticClass:"editor monaco-editor work-sql-monaco-x1",staticStyle:{"min-height":"200px"}}),a("span",{staticStyle:{float:"right","fonst-size":".8rem",color:"red"}},[t._v("这里可拖动大小↑")])])}],o={data:function(){return{editor:null}},props:{formData:{}},watch:{formData:function(t){t&&(console.log("==============22222========================="),this.init(t.sql))}},computed:{},methods:{refresh:function(t){this.init(t)},init:function(t){if(this.editor)this.editor.setValue(t);else{var e=this.$el.getElementsByClassName("work-sql-monaco-x1")[0];this.editor=monaco.editor.create(e,{value:t,language:"sql",theme:"vs",automaticLayout:!0,selectionHighlight:!0,wordWrap:"on",readOnly:!0,scrollbar:{useShadows:!1,verticalHasArrows:!0,horizontalHasArrows:!0,vertical:"hidden",horizontal:"hidden",verticalScrollbarSize:0,horizontalScrollbarSize:17,arrowSize:30}})}}},mounted:function(){console.log("mounted:"),this.init(this.formData.sql)},components:{}},i=o,r=(a("7a3b"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,"51733768",null);e["default"]=l.exports},e7a8:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{"custom-class":"database-edit",title:t.id?"修改数据源":"新增数据源",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{model:t.formData,"label-width":"180px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{attrs:{placeholder:"请选择类型",clearable:!0,disabled:!!t.formData.id},on:{change:t.dbTypeChange},model:{value:t.formData.db_type,callback:function(e){t.$set(t.formData,"db_type",e)},expression:"formData.db_type"}},[t._l(t.dbs,(function(t,e){return[a("el-option",{key:e,attrs:{label:t.label,value:t.value}})]}))],2)],1),t.formData.id?t._e():a("el-form-item",{attrs:{label:"绑定项目"}},[a("el-select",{attrs:{placeholder:"请选择项目",multiple:"",clearable:!0},model:{value:t.formData.projects,callback:function(e){t.$set(t.formData,"projects",e)},expression:"formData.projects"}},t._l(t.projects,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),"oracle"==t.formData.db_type?a("el-form-item",{attrs:{label:"连接类型"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-radio-group",{model:{value:t.formData.con_type,callback:function(e){t.$set(t.formData,"con_type",e)},expression:"formData.con_type"}},[a("el-radio",{attrs:{label:"base"}},[t._v("基本")]),a("el-radio",{attrs:{label:"tns"}},[t._v("TNS")])],1)],1)],1)],1):t._e(),"mongodb"==t.formData.db_type?a("el-form-item",{attrs:{label:"连接类型"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-radio-group",{model:{value:t.formData.con_type,callback:function(e){t.$set(t.formData,"con_type",e)},expression:"formData.con_type"}},[a("el-radio",{attrs:{label:"base"}},[t._v("基本")]),a("el-radio",{attrs:{label:"uri"}},[t._v("URI")])],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"连接"}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:"tns"==t.formData.con_type,expression:"formData.con_type=='tns'"}],staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{placement:"top",content:"TNS服务名称"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"服务名"},model:{value:t.formData.db,callback:function(e){t.$set(t.formData,"db",e)},expression:"formData.db"}})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"tns"!=t.formData.con_type&&"uri"!=t.formData.con_type,expression:"formData.con_type!='tns'&&formData.con_type!='uri'"}],staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:10}},[a("el-tooltip",{attrs:{placement:"top",content:"IP地址"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"IP"},model:{value:t.formData.ip,callback:function(e){t.$set(t.formData,"ip",e)},expression:"formData.ip"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-tooltip",{attrs:{placement:"top",content:"端口号"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"端口"},model:{value:t.formData.port,callback:function(e){t.$set(t.formData,"port",e)},expression:"formData.port"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-tooltip",{attrs:{placement:"top",content:"数据库"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"库"},model:{value:t.formData.db,callback:function(e){t.$set(t.formData,"db",e)},expression:"formData.db"}})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"uri"==t.formData.con_type,expression:"formData.con_type=='uri'"}],staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{placement:"top",content:"数据库连接字符串,例如:mongodb://localhost"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"mongodb://localhost:27017",rows:"2",type:"textarea"},model:{value:t.formData.url,callback:function(e){t.$set(t.formData,"url",e)},expression:"formData.url"}})],1)],1)],1),a("el-row",{attrs:{gutter:4}},[a("el-col",{attrs:{span:12}},[a("el-tooltip",{attrs:{placement:"top",content:"用户名"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"用户名",type:t.account_show?"text":"password"},model:{value:t.formData.user,callback:function(e){t.$set(t.formData,"user",e)},expression:"formData.user"}},[a("template",{slot:"append"},[t.account_show?t._e():a("el-button",{staticClass:"sn-font",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示账户"},on:{click:function(e){t.account_show=!t.account_show}}},[t._v(" ")]),t.account_show?a("el-button",{staticClass:"sn-font",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示账户"},on:{click:function(e){t.account_show=!t.account_show}}},[t._v(" ")]):t._e()],1)],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-tooltip",{attrs:{placement:"top",content:"密码"}},[a("el-input",{attrs:{type:t.pw_show?"text":"password","auto-complete":"new-password",placeholder:"密码"},model:{value:t.formData.pass,callback:function(e){t.$set(t.formData,"pass",e)},expression:"formData.pass"}},[a("template",{slot:"append"},[t.pw_show?t._e():a("el-button",{staticClass:"sn-font",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示密码"},on:{click:function(e){t.pw_show=!t.pw_show}}},[t._v(" ")]),t.pw_show?a("el-button",{staticClass:"sn-font",staticStyle:{cursor:"pointer"},attrs:{type:"primary",title:"显示密码"},on:{click:function(e){t.pw_show=!t.pw_show}}},[t._v(" ")]):t._e()],1)],2)],1)],1)],1)],1):t._e(),"mongodb"==t.formData.db_type?a("el-form-item",{attrs:{label:"Auth Mechanism"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:12}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.auth_mechanism,callback:function(e){t.$set(t.formData,"auth_mechanism",e)},expression:"formData.auth_mechanism"}},t._l(t.mechanisms,(function(t){return a("el-option",{key:t.v,attrs:{label:t.l,value:t.v}})})),1)],1)],1)],1):t._e(),"mysql"==t.formData.db_type?a("el-form-item",{attrs:{label:"字符集"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:6}},[a("el-tooltip",{attrs:{placement:"top",content:"默认utf8mb4,utf8"}},[a("el-input",{model:{value:t.formData.char_set,callback:function(e){t.$set(t.formData,"char_set",e)},expression:"formData.char_set"}})],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"权限"}},[a("el-row",{attrs:{gutter:4}},[a("el-col",{attrs:{span:6}},[t._v(" 读/写/管 "),a("el-tooltip",{attrs:{placement:"top",content:"读/写/管"}},[a("el-select",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:t.formData.oper_type,callback:function(e){t.$set(t.formData,"oper_type",e)},expression:"formData.oper_type"}},[a("el-option",{attrs:{label:"只读",value:1}}),a("el-option",{attrs:{label:"读写",value:2}}),a("el-option",{attrs:{label:"管理",value:4}})],1)],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许异步: "),a("el-tooltip",{attrs:{placement:"top",content:"允许异步查询"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_query,callback:function(e){t.$set(t.formData,"asyn_query",e)},expression:"formData.asyn_query"}})],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许导出文件: "),a("el-tooltip",{attrs:{placement:"top",content:"允许导出文件"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_export,callback:function(e){t.$set(t.formData,"asyn_export",e)},expression:"formData.asyn_export"}})],1)],1),a("el-col",{attrs:{span:6}},[t._v(" 允许导出SQL: "),a("el-tooltip",{attrs:{placement:"top",content:"允许导出SQL"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.asyn_sql,callback:function(e){t.$set(t.formData,"asyn_sql",e)},expression:"formData.asyn_sql"}})],1)],1)],1)],1):t._e(),"mysql"==t.formData.db_type?a("el-form-item",{attrs:{label:"审核"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[t._v(" 开启自动审核: "),a("el-tooltip",{attrs:{placement:"top",content:"开启自动审核"}},[a("el-switch",{attrs:{size:"mini","active-value":1,"inactive-value":0},model:{value:t.formData.auto_audit,callback:function(e){t.$set(t.formData,"auto_audit",e)},expression:"formData.auto_audit"}})],1)],1)],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"连接数"}},[a("el-tooltip",{attrs:{placement:"top",content:"最小连接数"}},[a("el-input-number",{model:{value:t.formData.pool_min,callback:function(e){t.$set(t.formData,"pool_min",e)},expression:"formData.pool_min"}})],1),a("el-tooltip",{attrs:{placement:"top",content:"最大连接数"}},[a("el-input-number",{model:{value:t.formData.pool_max,callback:function(e){t.$set(t.formData,"pool_max",e)},expression:"formData.pool_max"}})],1)],1):t._e(),t.showOtherSetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"最大查询数量"}},[a("el-tooltip",{attrs:{placement:"top",content:"查询/导出能返回的最大数据行数"}},[a("el-input-number",{model:{value:t.formData.max_row,callback:function(e){t.$set(t.formData,"max_row",e)},expression:"formData.max_row"}})],1)],1):t._e(),t.showPageQuerySetting(t.formData.db_type)?a("el-form-item",{attrs:{label:"查询分页模式"}},[a("el-row",{staticClass:"connect",attrs:{gutter:4}},[a("el-col",{attrs:{span:24}},[a("el-tooltip",{attrs:{placement:"top",content:"查询/导出能返回的最大数据行数"}},[a("el-radio-group",{model:{value:t.formData.page_query,callback:function(e){t.$set(t.formData,"page_query",e)},expression:"formData.page_query"}},[a("el-radio",{attrs:{label:1}},[t._v("语句分页")]),a("el-radio",{attrs:{label:2}},[t._v("游标分页")])],1)],1)],1)],1)],1):t._e(),"es5"==t.formData.db_type?a("el-form-item",{attrs:{label:"详细设定"}},[t.formData.config?a("el-row",{attrs:{gutter:4}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.esConfigList}},[a("el-table-column",{attrs:{label:"Index name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row,n=e.$index;return[a("el-input",{attrs:{placeholder:"索引名称,不带后缀,示例 logstash  *代表全局配置",disabled:0==n},model:{value:s["index_name"],callback:function(e){t.$set(s,"index_name",e)},expression:"row['index_name']"}})]}}],null,!1,2141746515)}),a("el-table-column",{attrs:{prop:"tfn",label:"Time field name"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-input",{attrs:{placeholder:"Time field name,默认@timestamp"},model:{value:s["time_field"],callback:function(e){t.$set(s,"time_field",e)},expression:"row['time_field']"}})]}}],null,!1,1664101124)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0!=e.$index?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.esConfigList)}}},[t._v("移除 ")]):t._e()]}}],null,!1,3801071846)})],1),a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return t.addEsRow()}}},[t._v("添加")])],1):t._e()],1):t._e(),t.id?a("el-form-item",{attrs:{label:"项目"}},[t._v(" "+t._s(t.formData.project_names)+" ")]):t._e(),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.db_desc,callback:function(e){t.$set(t.formData,"db_desc",e)},expression:"formData.db_desc"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"info",disabled:t.loading},on:{click:t.onTest}},[t._v("测试连接")]),a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"success",disabled:t.loading},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1)],1)},n=[],o=(a("4de4"),a("a434"),a("b0c0"),a("d3b7"),a("a15b"),a("2ef0")),i=a("2e0b"),r=a("1f82"),l={props:{projects:Array,default:function(){return[]}},data:function(){return{loading:!1,db:Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).DB,dbs:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],pw_show:!1,account_show:!1,headerList:[],esConfigList:[],isShow:!1,id:null,mechanisms:[{l:"SCRAM-SHA-1",v:"SCRAM-SHA-1"},{l:"SCRAM-SHA-256",v:"SCRAM-SHA-256"},{l:"MONGODB-CR",v:"MONGODB-CR"}],oper_types:[{l:"只读",v:1},{l:"读写",v:2},{l:"管理",v:4}],treeProps:{label:"name"},dataList:[],formData:this.reset()}},computed:{},watch:{"formData.user":function(t,e){console.log("v1:",t," v2:",e)},"formData.type":"initEsConfigList",isShow:function(t){this.loading=!1,t&&(this.pw_show=!1,this.account_show=!1)}},methods:{dbTypeChange:function(t){var e=this.dbs.filter((function(e){return e.value==t}));this.formData.port=e[0].port,this.formData.auth_mechanism="mongodb"==t?this.mechanisms[0].v:"",console.log("选择数据源类型：",t)},changePass:function(t){console.log(t)},showOtherSetting:function(t){return!!t},showPageQuerySetting:function(t){return!(!t||"mysql"!=t&&"oracle"!=t&&"mycat"!=t&&"postgres"!=t)},addHeaderRow:function(){this.headerList.push({name:"",value:""})},addEsRow:function(){this.esConfigList.push({index_name:"",time_field:""})},deleteRow:function(t,e){e.splice(t,1)},initEsConfigList:function(){console.log("initEsConfigList"),0==this.esConfigList.length&&this.esConfigList.push({index_name:"*",time_field:"@timestamp"})},reset:function(){return{headerList:[{name:"",value:""}],config:{auth:"",method:"get"},auth_mechanism:"",roles:[],role_names:[],project_names:[],roles_str:"",id:"",name:"",user:"",pass:"",ip:"",port:"",db:"",url:"",db_type:"",page_query:1,con_type:"base",oper_type:2,db_desc:"",pool_min:1,pool_max:5,max_row:1e5,asyn_query:1,asyn_export:1,asyn_sql:1,heartbeat:1}},show:function(t){var e=this;if(this.id=t,!this.id)return this.isShow=!0,void(this.formData=this.reset());this.$api.db.info(this.id).then((function(t){if(console.log("user1:",t.user,e.formData.user),t.config)try{t.config=JSON.parse(t.config||"{}"),t.config.headers&&Object(o["isArray"])(t.config.headers)&&(e.headerList=t.config.headers)}catch(a){console.log("parser config err:",a),t.config={}}finally{console.log("finally ----")}console.log("user2:",t,e.formData),t.config.auth_mechanism&&(t.auth_mechanism=t.config.auth_mechanism),console.log("user22:",t,e.formData),console.log("config:",t.config),t.config.eslist&&Object(o["isArray"])(t.config.eslist)&&(e.esConfigList=t.config.eslist),"es5"==t.type&&e.initEsConfigList(),t.con_type||(t.con_type="base"),console.log("user3:",t,e.formData),e.formData=t,console.log("user4:",t.user,e.formData.user),e.isShow=!0,console.log("user5:",t,e.formData)}))},hide:function(){this.formData=this.reset(),this.isShow=!1},onTest:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);return e.config={},e.config.headers=this.headerList,e.config.eslist=this.esConfigList,e.config.auth_mechanism=e.auth_mechanism,e.config=e.config?JSON.stringify(e.config):"",e.name?e.db_type?"tns"==e.con_type||e.ip?"tns"==e.con_type||e.port?(this.loading=!0,void this.$api.db.test(e).then((function(){t.onSuccess("连接可用")})).finally((function(){t.loading=!1}))):(this.$message({message:"端口不能为空",type:"warning"}),!1):(this.$message({message:"ip不能为空",type:"warning"}),!1):(this.$message({message:"数据源类型不能为空",type:"warning"}),!1):(this.$message({message:"名称不能为空",type:"warning"}),!1)},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.formData);return e.projects&&e.projects instanceof Array&&(e.projects=e.projects.join(",")),e.config={},e.config.headers=this.headerList,e.config.eslist=this.esConfigList,e.config.auth_mechanism=e.auth_mechanism,e.config=e.config?JSON.stringify(e.config):"",e.name?e.db_type?"tns"==e.con_type||e.ip?"tns"==e.con_type||e.port?(e.roles&&(e.roles_str=e.roles.join(",")),console.log("config:",e.config),this.loading=!0,void this.$api.db.save(e).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)})).finally((function(){t.loading=!1}))):(this.$message({message:"端口不能为空",type:"warning"}),!1):(this.$message({message:"ip不能为空",type:"warning"}),!1):(this.$message({message:"数据源类型不能为空",type:"warning"}),!1):(this.$message({message:"名称不能为空",type:"warning"}),!1)}},components:{ElCol:r["a"],ElRow:i["a"]},mounted:function(){}},c=l,u=(a("d3ac"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,"3bd0fc9a",null);e["default"]=d.exports},e7e2:function(t,e,a){"use strict";a.r(e);var s=a("1da1"),n=(a("96cf"),a("5c96")),o=a("c276"),i=a("a18c");e["default"]={namespaced:!0,actions:{logout:function(t){var e=t.commit,a=t.dispatch,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=r.confirm,c=void 0!==l&&l;function u(){return d.apply(this,arguments)}function d(){return d=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window.localStorage.removeItem("token"),o["a"].cookies.remove("uuid"),t.next=4,a("d2admin/user/set",{},{root:!0});case 4:i["a"].push({name:"login"});case 5:case"end":return t.stop()}}),t)}))),d.apply(this,arguments)}c?(e("d2admin/gray/set",!0,{root:!0}),n["MessageBox"].confirm("确定要退出当前账户吗","退出登录",{type:"warning"}).then((function(){e("d2admin/gray/set",!1,{root:!0}),u()})).catch((function(){e("d2admin/gray/set",!1,{root:!0})}))):u()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.dispatch,e.next=3,a("d2admin/user/load",null,{root:!0});case 3:return e.next=5,a("d2admin/theme/load",null,{root:!0});case 5:return e.next=7,a("d2admin/transition/load",null,{root:!0});case 7:return e.next=9,a("d2admin/page/openedLoad",null,{root:!0});case 9:return e.next=11,a("d2admin/menu/asideLoad",null,{root:!0});case 11:return e.next=13,a("d2admin/size/load",null,{root:!0});case 13:return e.next=15,a("d2admin/color/load",null,{root:!0});case 15:case"end":return e.stop()}}),e)})))()}}}},e802:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"加入项目",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"项目"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.formData.source_id,callback:function(e){t.$set(t.formData,"source_id",e)},expression:"formData.source_id"}},t._l(t.projectList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,disabled:t.in_flag>0}})})),1)],1),a("el-form-item",{attrs:{label:"申请理由",prop:"opt_mark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入申请理由"},model:{value:t.formData.opt_mark,callback:function(e){t.$set(t.formData,"opt_mark",e)},expression:"formData.opt_mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},n=[],o={data:function(){return{project_id:0,isShow:!1,projectList:[],managerList:[],formData:{source_id:"",auditor:"",opt_mark:"",source_type:"project"},formRule:{project_id:[{required:!0,message:"请选择项目"}]}}},props:{},watch:{"formData.source_id":function(t){this.formData.auditor=t}},computed:{},methods:{show:function(t){var e=this;this.formData={source_id:"",auditor:"",opt_mark:"",source_type:"project"},t&&(this.formData.source_id=t,this.formData.auditor=t),this.$api.my.myApplyProjectList().then((function(t){e.projectList=t})),this.isShow=!0},hide:function(){this.formData={source_id:"",auditor:"",opt_mark:"",source_type:"project"},this.projectList=[],this.isShow=!1},loadManagerList:function(t){var e=this;t?this.$api.project.managerList(t).then((function(t){e.managerList=t})):this.managerList=[]},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.formData;t.$api.apply.applyAdd(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}}))}},mounted:function(){},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},e862:function(t,e,a){},e8626:function(t){t.exports=JSON.parse('{"_element":"zh-TW","_name":"繁體中文","page":{"demo":{"playground":{"locales":{"text":"D2Admin 是一個完全 開源免費 的企業中後台產品前端集成方案，使用最新的前端技術棧，已經做好大部分項目前期準備工作，並且帶有大量示例代碼，助力管理系統敏捷開發。"}}}}}')},e9d4:function(t,e,a){"use strict";a("bf56")},ea3a:function(t,e,a){"use strict";a("000e")},ea6f:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"body"},[t.isChrome?t._e():a("el-alert",{attrs:{title:"本产品标准运行环境为Chrome 48.0.2564 及以上版本，请使用Chrome浏览器进行访问，以便获得最佳体验。",type:"warning"}}),a("el-form",{attrs:{model:t.formData}})],1)])},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("b0c0"),a("2f62")),l={data:function(){var t=this.$route.query;return{isChrome:!1,path:"",mode:"normal",back_url:t.url,oauth2_url:"",oauth2_logo:"",oauth2_name:"",oauth2_display_name:"",activeName:"focus",setting:{},oatuh2:{},url:"",formData:{focus_pwd:"",focus_code:"",name:"",pwd:"",captcha:"",captcha_id:"",code:""}}},computed:Object(i["a"])({},Object(r["e"])(["user"])),methods:{enterSubmit:function(){"focus"===this.activeName?this.onFocusSubmit():this.onSubmit()},getCaptcha:function(){var t=this;this.$api.get("/api/captcha").then((function(e){var a=e.id,s=e.img;t.formData.captcha=s,t.formData.captcha_id=a}))},checkBrowser:function(){var t=navigator.userAgent,e=t.indexOf("Opera")>-1;return e?"Opera":t.indexOf("Firefox")>-1?"FF":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!e?"IE":void 0},goCasLogin:function(){this.url&&(window.location.href=this.url)},onFocusSubmit:function(){var t=this;this.formData.name?this.formData.focus_pwd?this.formData.focus_code?this.$api.post("/api/focus/login",{name:this.formData.name,pwd:this.formData.focus_pwd,code:this.formData.focus_code}).then((function(e){var a=e.token,s=e.user;t.$store.commit("user",s),window.localStorage.setItem("name",t.formData.name),window.localStorage.setItem("token",a),window.localStorage.setItem("user",JSON.stringify(s)),t.$router.push("/")})):this.onError("动态码不能为空！"):this.onError("密码不能为空！"):this.onError("账号不能为空！")},onSubmit:function(){var t=this;this.formData.name?this.formData.pwd?this.formData.code?this.$api.post("/api/login",this.formData).then((function(e){var a=e.token,s=e.user;t.$store.commit("user",s),window.localStorage.setItem("name",t.formData.name),window.localStorage.setItem("token",a),window.localStorage.setItem("user",JSON.stringify(s)),s.pw_score<2?(t.onError("你的密码过于简单，登录后请修改密码！"),setTimeout((function(){t.$router.push("/my/pwd"),window.localStorage.setItem("forcePwd",1)}),2e3)):t.$router.push("/")}),(function(){t.getCaptcha()})):this.onError("验证码不能为空！"):this.onError("密码不能为空！"):this.onError("账号不能为空！")},onInit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n,o,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.post("/api/setting",{});case 2:a=e.sent,window.localStorage.setItem("setting",t.mode),s=a.oauth2_url,n=a.oauth2_logo,o=a.oauth2_name,i=a.oauth2_display_name,t.$store.commit("sysSetting",a),t.mode="focus",window.localStorage.setItem("oauth_mode",t.mode),r=window.localStorage.getItem("name"),r&&(t.formData.name=r),s&&(t.oauth2_url=s,window.localStorage.setItem("oauth2_url",s),window.location.href=t.oauth2_url),n&&(t.oauth2_logo=n),o&&(t.oauth2_name=o),t.oauth2_display_name=i;case 14:case"end":return e.stop()}}),e)})))()},handleLoginOAuth2:function(){window.location.href=this.oauth2_url}},mounted:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return"Chrome"==t.checkBrowser()&&(t.isChrome=!0),e.next=3,t.onInit();case 3:t.getCaptcha();case 4:case"end":return e.stop()}}),e)})))()}},c=l,u=(a("59bb"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},eadd:function(t,e,a){},eaf8:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tabs",{staticClass:"table-info",attrs:{type:"border-card",lazy:"true"},on:{"tab-click":t.getTableInfo},model:{value:t.cur_name,callback:function(e){t.cur_name=e},expression:"cur_name"}},[a("el-tab-pane",{attrs:{label:"字段定义",name:"struct"}},[a("el-table",{attrs:{size:"mini",data:t.data.struct}},t._l(t.struct,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),t.data.indexs?a("el-tab-pane",{attrs:{label:"索引",name:"indexs"}},[a("el-table",{attrs:{size:"mini",data:t.data.indexs}},t._l(t.indexs,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1):t._e(),!t.data.triggers||"mysql"!=t.params.dbType&&"oracle"!=t.params.dbType&&"postgres"!=t.params.dbType?t._e():a("el-tab-pane",{attrs:{label:"触发器",name:"triggers"}},[a("el-table",{attrs:{size:"mini",data:t.data.triggers}},t._l(t.triggers,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),!t.data.constraints||"mysql"!=t.params.dbType&&"oracle"!=t.params.dbType&&"postgres"!=t.params.dbType?t._e():a("el-tab-pane",{attrs:{label:"约束",name:"constraints"}},[a("el-table",{attrs:{size:"mini",data:t.data.constraints}},t._l(t.constraints,(function(t,e,s){return a("el-table-column",{key:s,attrs:{label:e,prop:e}})})),1)],1),a("el-tab-pane",{attrs:{label:"建表语句",name:"info"}},[a("pre",{domProps:{innerHTML:t._s(t.table)}})]),"mysql"==t.params.dbType?a("el-tab-pane",{attrs:{label:"表信息",name:"tableInfo"}},[a("pre",{domProps:{innerHTML:t._s(t.data.tableInfo[0])}})]):t._e()],1)},n=[],o=a("5530"),i=(a("b0c0"),{name:"table-info",data:function(){return{data:{constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]},params:{iid:null,dbName:null,dbType:null,tableName:null,tableType:null},cur_name:"struct"}},computed:{table:function(){return this.data.info&&this.data.info.data?this.data.info.data:this.data.info?this.data.info["Create Table"]:""},struct:function(){return this.head("struct")},indexs:function(){return this.head("indexs")},triggers:function(){return this.head("triggers")},constraints:function(){return this.head("constraints")},tableInfo:function(){return this.head("tableInfo")}},methods:{init:function(t){this.params=Object(o["a"])({},t),this.getTableInfo({name:this.cur_name})},head:function(t){var e=this.data[t];return e&&e.length>0?e[0]:{}},hide:function(){this.cur_name="struct",this.data={constraints:[{}],indexs:[{}],triggers:[{}],info:null,struct:[{}],tableInfo:[{}]}},getTableInfo:function(t,e){this.load(t.name)},load:function(t){var e=this,a={id:this.params.iid,dbType:this.params.dbType};this.$api.table.info(a,this.params.dbName,this.params.tableName,t,this.params.tableType).then((function(a){e.$set(e.data,t,a)}))}}}),r=i,l=(a("910a"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"b9ac417c",null);e["default"]=c.exports},eb03:function(t,e,a){},ebfe:function(t,e,a){"use strict";a("944a")},ec39:function(t,e,a){var s={"./add.svg":"c2e4","./alarm.svg":"a619","./camera.svg":"630f","./d2-admin-text.svg":"ae5c","./d2-admin.svg":"bb12","./dashboard.svg":"7208","./datasource.svg":"a780","./help.svg":"43c4","./history.svg":"9cd8","./home.svg":"dd95","./like.svg":"18c4","./log.svg":"25ce","./logoff.svg":"900e","./love.svg":"22dc","./member.svg":"35ef","./message.svg":"6f6e","./multiple.svg":"574a","./my.svg":"eeb0","./notice.svg":"7cf9","./project-menber.svg":"8857","./query.svg":"4f17","./search.svg":"5cdc","./setting-password.svg":"8e92","./setting-security.svg":"bd95","./share.svg":"7b94","./single.svg":"d3db","./sqldev-admin-text.svg":"5ca5","./star.svg":"ad22","./theme.svg":"6616","./user.svg":"aa61","./work.svg":"b4f2"};function n(t){var e=o(t);return a(e)}function o(t){if(!a.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}n.keys=function(){return Object.keys(s)},n.resolve=o,t.exports=n,n.id="ec39"},ecdd:function(t,e,a){"use strict";a("9a1d")},ecf2:function(t,e,a){},ed41:function(t,e,a){"use strict";a("f94e")},edc8:function(t,e,a){"use strict";a("24da")},edd4:function(t){t.exports=JSON.parse('{"_element":"en","_name":"English","page":{"demo":{"playground":{"locales":{"text":"D2Admin is a fully open source and free enterprise back-end product front-end integration solution, using the latest front-end technology stack, has prepared most of the project preparations, and with a lot of sample code to help the management system agile development."}}}}}')},ee0c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"220px","label-suffix":":",rules:t.formRule}},[a("el-form-item",{attrs:{label:"[项目]发起人"}},[t._v(" ["+t._s(t.formData.project_name)+"] "+t._s(t.formData.create_name)+" ")]),a("el-form-item",{attrs:{label:"工单名称"}},[t._v(" "+t._s(t.formData.name)+" ")]),a("el-form-item",{attrs:{label:"执行时间"}},[t._v(" "+t._s(t.formData.create_name)+" ")]),a("el-form-item",{attrs:{label:"数据库类型"}},[t._v(" "+t._s(t.formData.db_type)+" ")]),a("el-form-item",{attrs:{label:"数据源/数据库"}},[t._v(" "+t._s(t.formData.db_name)+"/"+t._s(t.formData.owner)+" ")]),a("el-form-item",{attrs:{label:"执行脚本"}},[a("el-input",{attrs:{type:"textarea",readonly:"",placeholder:"请输入执行的脚本"},model:{value:t.formData.sql,callback:function(e){t.$set(t.formData,"sql",e)},expression:"formData.sql"}})],1),a("el-form-item",{attrs:{label:"工单备注"}},[t.formData.mark?a("span",[t._v(t._s(t.formData.mark))]):a("span",[t._v("无")])])],1)],1)},n=[],o={data:function(){var t=this.$route.params.id;return{id:t,workData:[],disabled:!0,config:{lang:"sql"},formData:{cancel_remark:"",id:t,source_type:"none",source_id:"none",sql:""},formRule:{mark:[{required:!1,message:"请输入描述"}],audit_id:[{required:!0,message:"请选择审批人"}]},roleList:[]}},props:{},watch:{},computed:{},methods:{back:function(){this.$router.go(-1)},init:function(){var t=this;this.$api.work.info(this.id).then((function(e){t.formData=e,t.workData=[e]}))},onCancel:function(){var t=this.formData;t.cancel_remark||this.onError("请输入终止原因")},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a=t.formData;t.$api.work.add(a).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}}))}},mounted:function(){this.init()},components:{}},i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},ee5b:function(t,e,a){},ee7d:function(t,e,a){"use strict";a("e862")},eeb0:function(t,e,a){"use strict";a.r(e);var s=a("e017"),n=a.n(s),o=a("21a1"),i=a.n(o),r=new n.a({id:"d2-my",use:"d2-my-usage",viewBox:"0 0 1024 1024",content:'<symbol class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" id="d2-my"><path d="M716.8 115c0.1 15.5 0.5 33 0.9 51.6 1 43.7 2 93.2 0.2 137-2.5 60.2-9.4 82.4-13.4 90.3l-0.9 1.8-0.7 1.9c-14.6 38.5-41.3 71.2-77.2 94.6-34.7 22.6-76.5 35.1-117.7 35.1-29 0-56.8-5.9-82.5-17.7-27.7-12.6-52.1-31.5-72.6-56.3l-0.7-0.9-0.8-0.8c-11.3-12.2-26-39.7-33.2-73.5-5.7-27.2-8.8-68.4 9.3-110 18.7-43 56.3-77.7 111.8-103.2 68.1-31.1 161.3-47.9 277.5-49.9m23-40.2c-570.2 0-484.7 332-417.7 404.1 50.8 61.2 118.8 88.5 185.9 88.5 98.9 0 195.8-59.1 232.3-155.6 31.1-62.6 12.5-271.3 17.2-336.9-5.9 0-11.9-0.1-17.7-0.1zM399.6 969.2c-22.2 0-43.5-0.2-63.7-0.6-97.8-2.2-125.9-10.3-139.4-18-31.1-14.6-55.8-38-71.3-67.6-14.4-27.5-20.6-59.3-17.7-91.9 3-34.6 15.8-67.1 37-93.9 22.4-28.5 53.1-48.7 88.8-58.6 7.2-3.4 19.7-5.7 49.3-7.4 22.2-1.3 52.1-2.2 91.1-2.6 70.8-0.8 157.5-0.1 227.2 0.5 61.1 0.5 113.8 1 126.1 0.1l1.2-0.1 1.2 0.1c50 2.3 93.8 17.9 126.6 45.2 8.5 7.1 9.7 19.7 2.6 28.2s-19.7 9.7-28.2 2.6c-26.2-21.8-60.5-33.9-101.8-35.9-15.4 0.9-63 0.5-128.1 0-66.7-0.6-149.7-1.3-218.5-0.6-99.4 1-124.8 4.5-131.2 6.2l-1.4 1-3.6 1c-54.8 14.4-93.5 60.8-98.5 118-3.6 41.5 12 94.8 66.8 120.1l1 0.5 1 0.6c5.2 3.2 27.4 10.7 120.6 12.9 63.7 1.5 140.4 0.1 214.6-1.1 76.4-1.3 148.6-2.6 192.5-0.3 85.3 2.9 128.3-53.1 133.2-109.8 0.9-11 10.6-19.2 21.6-18.2 11 0.9 19.2 10.6 18.2 21.6-3.5 40.7-21.2 77.6-49.8 104-31.9 29.4-75 44-124.8 42.3h-0.3c-42.5-2.2-114.1-1-190 0.3-51 0.5-103.5 1.4-152.3 1.4zM249.9 674.8z" p-id="10627" /></symbol>'});i.a.add(r);e["default"]=r},eebe:function(t,e,a){"use strict";a("ecf2")},ef00:function(t,e,a){"use strict";a("820a")},ef64:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("ORACLE")])]),a("div",{staticClass:"text item"},[t.configForm?a("el-form",{staticClass:"el-row",attrs:{model:t.otherForm,"label-width":"280px",size:"mini",disabled:!t.edit}},[a("div",[t._v("支持中ing")])]):t._e()],1)]),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("MYSQL")])]),a("div",{staticClass:"text item"},[t.configForm?a("el-form",{ref:"configForm",staticClass:"el-row",attrs:{model:t.configForm,"label-width":"280px",size:"mini",disabled:!t.edit}},[a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许删除数据库"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_drop_database,callback:function(e){t.$set(t.configForm,"enable_drop_database",e)},expression:"configForm.enable_drop_database"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许删除表"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_drop_table,callback:function(e){t.$set(t.configForm,"enable_drop_table",e)},expression:"configForm.enable_drop_table"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许指定表和库设置字符集"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_set_charset,callback:function(e){t.$set(t.configForm,"enable_set_charset",e)},expression:"configForm.enable_set_charset"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许指定表和库设置排序"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_set_collation,callback:function(e){t.$set(t.configForm,"enable_set_collation",e)},expression:"configForm.enable_set_collation"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许指定存储引擎"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_set_engine,callback:function(e){t.$set(t.configForm,"enable_set_engine",e)},expression:"configForm.enable_set_engine"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查列设置字符集"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_column_charset,callback:function(e){t.$set(t.configForm,"enable_column_charset",e)},expression:"configForm.enable_column_charset"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查表注释"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_table_comment,callback:function(e){t.$set(t.configForm,"check_table_comment",e)},expression:"configForm.check_table_comment"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查列注释"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_column_comment,callback:function(e){t.$set(t.configForm,"check_column_comment",e)},expression:"configForm.check_column_comment"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查关键字"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_identifer_keyword,callback:function(e){t.$set(t.configForm,"enable_identifer_keyword",e)},expression:"configForm.enable_identifer_keyword"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"禁止建表无主键"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_primary_key,callback:function(e){t.$set(t.configForm,"check_primary_key",e)},expression:"configForm.check_primary_key"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"主键必须是INT"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_pk_columns_only_int,callback:function(e){t.$set(t.configForm,"enable_pk_columns_only_int",e)},expression:"configForm.enable_pk_columns_only_int"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"自增列必须是int/bigint"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_autoincrement_datatype,callback:function(e){t.$set(t.configForm,"check_autoincrement_datatype",e)},expression:"configForm.check_autoincrement_datatype"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"建表自增列的值是否为1"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_autoincrement_init_value,callback:function(e){t.$set(t.configForm,"check_autoincrement_init_value",e)},expression:"configForm.check_autoincrement_init_value"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"建表自增列名必须是ID"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_autoincrement_name,callback:function(e){t.$set(t.configForm,"check_autoincrement_name",e)},expression:"configForm.check_autoincrement_name"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"自增列必须是无符号型"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_autoincrement_unsigned,callback:function(e){t.$set(t.configForm,"enable_autoincrement_unsigned",e)},expression:"configForm.enable_autoincrement_unsigned"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查新建或修改的列是否有默认值"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_column_default_value,callback:function(e){t.$set(t.configForm,"check_column_default_value",e)},expression:"configForm.check_column_default_value"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查列顺序的变更"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_column_position_change,callback:function(e){t.$set(t.configForm,"check_column_position_change",e)},expression:"configForm.check_column_position_change"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查列字段类型的变更"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_column_type_change,callback:function(e){t.$set(t.configForm,"check_column_type_change",e)},expression:"configForm.check_column_type_change"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查current_timestamp数量"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_timestamp_count,callback:function(e){t.$set(t.configForm,"check_timestamp_count",e)},expression:"configForm.check_timestamp_count"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查timestamp类型默认值"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_timestamp_default,callback:function(e){t.$set(t.configForm,"check_timestamp_default",e)},expression:"configForm.check_timestamp_default"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"标识符必须是大写"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_identifier_upper,callback:function(e){t.$set(t.configForm,"check_identifier_upper",e)},expression:"configForm.check_identifier_upper"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持外键"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_foreign_key,callback:function(e){t.$set(t.configForm,"enable_foreign_key",e)},expression:"configForm.enable_foreign_key"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持json类型字段"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_json_type,callback:function(e){t.$set(t.configForm,"enable_json_type",e)},expression:"configForm.enable_json_type"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"DML语句禁用LIMIT"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_dml_limit,callback:function(e){t.$set(t.configForm,"check_dml_limit",e)},expression:"configForm.check_dml_limit"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"DML语句禁用OrderBy"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_dml_orderby,callback:function(e){t.$set(t.configForm,"check_dml_orderby",e)},expression:"configForm.check_dml_orderby"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查DML语句where条件"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_dml_where,callback:function(e){t.$set(t.configForm,"check_dml_where",e)},expression:"configForm.check_dml_where"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持change column语法"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_change_column,callback:function(e){t.$set(t.configForm,"enable_change_column",e)},expression:"configForm.enable_change_column"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"where条件禁止隐式类型转换"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_implicit_type_conversion,callback:function(e){t.$set(t.configForm,"check_implicit_type_conversion",e)},expression:"configForm.check_implicit_type_conversion"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查插入语句存在列名"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_insert_field,callback:function(e){t.$set(t.configForm,"check_insert_field",e)},expression:"configForm.check_insert_field"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查插入语句中的列链表的存在性"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.check_insert_field,callback:function(e){t.$set(t.configForm,"check_insert_field",e)},expression:"configForm.check_insert_field"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许blob/text/json类型置为not nul"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_blob_not_null,callback:function(e){t.$set(t.configForm,"enable_blob_not_null",e)},expression:"configForm.enable_blob_not_null"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"检查是不是支持BLOB字段"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_blob_type,callback:function(e){t.$set(t.configForm,"enable_blob_type",e)},expression:"configForm.enable_blob_type"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持enum,set,bit数据类型"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_enum_set_bit,callback:function(e){t.$set(t.configForm,"enable_enum_set_bit",e)},expression:"configForm.enable_enum_set_bit"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"启用最小化回滚"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_minimal_rollback,callback:function(e){t.$set(t.configForm,"enable_minimal_rollback",e)},expression:"configForm.enable_minimal_rollback"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许列为NULL"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_nullable,callback:function(e){t.$set(t.configForm,"enable_nullable",e)},expression:"configForm.enable_nullable"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许空索引名"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_null_index_name,callback:function(e){t.$set(t.configForm,"enable_null_index_name",e)},expression:"configForm.enable_null_index_name"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"禁止order by rand"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_orderby_rand,callback:function(e){t.$set(t.configForm,"enable_orderby_rand",e)},expression:"configForm.enable_orderby_rand"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持分区表"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_partition_table,callback:function(e){t.$set(t.configForm,"enable_partition_table",e)},expression:"configForm.enable_partition_table"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许select *"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_select_star,callback:function(e){t.$set(t.configForm,"enable_select_star",e)},expression:"configForm.enable_select_star"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"支持时间为0值"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_zero_date,callback:function(e){t.$set(t.configForm,"enable_zero_date",e)},expression:"configForm.enable_zero_date"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"允许timestamp类型字段"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.enable_timestamp_type,callback:function(e){t.$set(t.configForm,"enable_timestamp_type",e)},expression:"configForm.enable_timestamp_type"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"指定列必须加索引"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.configForm.columns_must_have_index,callback:function(e){t.$set(t.configForm,"columns_must_have_index",e)},expression:"configForm.columns_must_have_index"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"最大数据包大小.默认4194304"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_allowed_packet,callback:function(e){t.$set(t.configForm,"max_allowed_packet",e)},expression:"configForm.max_allowed_packet"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"最大char长度"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_char_length,callback:function(e){t.$set(t.configForm,"max_char_length",e)},expression:"configForm.max_char_length"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"DDL最大影响行数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_ddl_affect_rows,callback:function(e){t.$set(t.configForm,"max_ddl_affect_rows",e)},expression:"configForm.max_ddl_affect_rows"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"insert最大行数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_insert_rows,callback:function(e){t.$set(t.configForm,"max_insert_rows",e)},expression:"configForm.max_insert_rows"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"update/delete最大行数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_update_rows,callback:function(e){t.$set(t.configForm,"max_update_rows",e)},expression:"configForm.max_update_rows"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"单个索引可指定的列数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_key_parts,callback:function(e){t.$set(t.configForm,"max_key_parts",e)},expression:"configForm.max_key_parts"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"单表最大索引数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_keys,callback:function(e){t.$set(t.configForm,"max_keys",e)},expression:"configForm.max_keys"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"主键最多列数"}},[a("el-input-number",{attrs:{size:"mini"},model:{value:t.configForm.max_primary_key_parts,callback:function(e){t.$set(t.configForm,"max_primary_key_parts",e)},expression:"configForm.max_primary_key_parts"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"合并同个表的alert语句"}},[a("el-switch",{attrs:{size:"mini"},model:{value:t.configForm.merge_alter_table,callback:function(e){t.$set(t.configForm,"merge_alter_table",e)},expression:"configForm.merge_alter_table"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"建表必须加的列"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.configForm.must_have_columns,callback:function(e){t.$set(t.configForm,"must_have_columns",e)},expression:"configForm.must_have_columns"}})],1),a("el-form-item",{staticClass:"el-col-6",attrs:{label:"表名前缀"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.configForm.table_prefix,callback:function(e){t.$set(t.configForm,"table_prefix",e)},expression:"configForm.table_prefix"}})],1),a("el-form-item",{staticClass:"el-col-12",attrs:{label:"支持的引擎"}},[a("el-tooltip",{staticClass:"item",attrs:{content:"支持的存储引擎,多个引擎用逗号分割",placement:"top-start"}},[a("el-input",{attrs:{size:"mini"},model:{value:t.configForm.support_engine,callback:function(e){t.$set(t.configForm,"support_engine",e)},expression:"configForm.support_engine"}})],1)],1)],1):t._e()],1)]),a("el-card",{staticClass:"box-card"},[a("el-form",[t.edit?a("el-form-item",{staticClass:"el-col-24"},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1):t._e()],1)],1)],1)},n=[],o={data:function(){return{real_id:0,filterText:""}},computed:{},props:{configForm:{},otherForm:{},edit:{type:Boolean,default:function(){return!1}}},watch:{},methods:{onSubmit:function(){this.$emit("submit",this.configForm,this.otherForm)}},components:{},mounted:function(){}},i=o,r=(a("fcc9"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},f09c:function(t,e,a){},f13c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vlist-item-template item",class:{"item-selected":t.selectedItemLabel==t.source.name}},[a("div",{staticClass:"left"},[a("el-checkbox",{staticClass:"check-box",attrs:{value:t.isSelected},on:{change:t.checkboxChangeHandle}}),a("span",{staticClass:"source-label pointer-default",class:[t.clazz],attrs:{title:t.source.name},on:{click:t.onItemClick}},[t._v(t._s(t.source.name))])],1),a("div",{staticClass:"right"},[a("i",{staticClass:"sn-font pointer-active",class:{"auth-read":1==t.source.perm.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",1)}}},[t._v(" 读 ")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-write":2==t.source.perm.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",2)}}},[t._v("写")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-manage":4==t.source.perm.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",4)}}},[t._v("管")]),a("i",{staticClass:"sn-font pointer-active",class:{"auth-disable":3==t.source.perm.rw},on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth",3)}}},[t._v("禁")]),a("span",{staticClass:"mr-2"}),[a("i",{staticClass:"sn-font pointer-active",class:[t.getAuth2("asyn_query")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","asyn_query")}}},[t._v("")]),a("i",{staticClass:"sn-font pointer-active",class:[t.getAuth2("asyn_export")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","asyn_export")}}},[t._v("")]),a("i",{staticClass:"sn-font",class:[t.getAuth2("asyn_sql")],on:{click:function(e){return e.stopPropagation(),t.authClickHandle("auth2","asyn_sql")}}},[t._v("")])]],2)])},n=[],o=(a("b0c0"),a("2ef0")),i=a("2708"),r={name:"vlist-template",mixins:[i["a"]],props:{selectedItemLabel:{},selectedNodeList:{type:Array,default:function(){return[]}},source:{type:Object,default:function(){return{}}}},computed:{getAuth2:function(){var t=this;return function(e){return 1==t.source.perm[e]?"auth-read":""}},isSelected:function(){var t=!1;for(var e in this.selectedNodeList){var a=this.selectedNodeList[e];if(a.name==this.source.name){t=!0;break}}return t},clazz:function(){return this.getAuth()},isShowRw:function(){var t=this;return function(e){var a=Object(o["get"])(t.source,"parentNode.perm.rw");return 4==a||a==e||3===a&&3==e||2==a&&e<=2}},isShowAsyn:function(){var t=this;return function(e){var a=Object(o["get"])(t.source,"parentNode.perm.".concat(e));return!!a}}},data:function(){return{nodeData:this.source}},methods:{authClickHandle:function(t,e){if("auth"==t)this.dispatch("role-table-list","vnode-change",{type:"change-auth",source:this.source,auth:{key:"rw",value:e}});else if("auth2"==t){var a=1==this.source.perm[e]?0:1;this.dispatch("role-table-list","vnode-change",{type:"change-auth2",source:this.source,auth:{key:e,value:a}})}},getAuth:function(){var t="";switch(this.source.perm.rw){case 1:t="auth-read";break;case 2:t="auth-write";break;case 3:t="auth-disable";break;case 4:t="auth-manage";break}return t},checkboxChangeHandle:function(t){this.dispatch("role-table-list","vnode-change",{type:"checked-item",source:this.source,e:t})},onItemClick:function(){this.dispatch("role-table-list","vnode-change",{type:"selected-line",source:this.source})}}},l=r,c=(a("883b"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,"97b01610",null);e["default"]=u.exports},f17c:function(t,e,a){"use strict";a.r(e);a("ac1f"),a("5319"),a("d81d"),a("99af"),a("a15b");function s(t,e){return t?e.replace("$$$",t):""}e["default"]={mysql:{table:{Field:{type:"input"},Type:{type:"select",item:[{group:"数值类型",values:["TINYINT","SMALLINT","MEDIUMINT","INT","BIGINT","FLOAT","DOUBLE","DECIMAL"].map((function(t){return t.toLocaleLowerCase()}))},{group:"日期和时间类型",values:["DATE","TIME","YEAR","DATETIME","TIMESTAMP"].map((function(t){return t.toLocaleLowerCase()}))},{group:"字符串类型",values:["CHAR","VARCHAR","TINYBLOB","TINYTEXT","BLOB","TEXT","MEDIUMBLOB","MEDIUMTEXT","LONGBLOB","LONGTEXT"].map((function(t){return t.toLocaleLowerCase()}))}]},Length:{type:"input"},Default:{type:"input"},Comment:{type:"input"}},index:{non_unique:{type:"select",item:["0","1"]},index_name:{type:"input"},column_name:{multi:!0,type:"field"}},changeField:function(t,e){return e.origin.Field?"ALTER TABLE ".concat(t," CHANGE ").concat(e.origin.Field," ").concat(e.Field," ").concat(e.Type).concat(s(e.Length.replace(",0",""),"($$$)")," ").concat(s(e.Default,"DEFAULT $$$")," ").concat(s(e.Comment,"COMMENT '$$$'")):"ALTER TABLE ".concat(t," ADD ").concat(e.Field," ").concat(e.Type).concat(s(e.Length.replace(",0",""),"($$$)")," ").concat(s(e.Default,"DEFAULT $$$")," ").concat(s(e.Comment,"COMMENT '$$$'"))},dropField:function(t,e){return"ALTER TABLE ".concat(t," DROP ").concat(e.Field)},addIndex:function(t,e){return"ALTER TABLE ".concat(t," ADD ").concat("1"==e.non_unique?"UNIQUE":""," INDEX `").concat(e.index_name,"` (").concat(e.column_name.join?e.column_name.join(","):e.column_name,")")},dropIndex:function(t,e){return"ALTER TABLE ".concat(t," DROP INDEX `").concat(e.index_name,"`")}},oracle:{table:{FIELD:{type:"input"},TYPE:{type:"select",item:[{group:"数值类型",values:["TINYINT","SMALLINT","MEDIUMINT","INT","BIGINT","FLOAT","DOUBLE","DECIMAL"].map((function(t){return t.toLocaleLowerCase()}))},{group:"日期和时间类型",values:["DATE","TIME","YEAR","DATETIME","TIMESTAMP"].map((function(t){return t.toLocaleLowerCase()}))},{group:"字符串类型",values:["CHAR","VARCHAR","TINYBLOB","TINYTEXT","BLOB","TEXT","MEDIUMBLOB","MEDIUMTEXT","LONGBLOB","LONGTEXT"].map((function(t){return t.toLocaleLowerCase()}))}]},LEN:{type:"input"},DATA_DEFAULT:{type:"input"},COMMENTS:{type:"input"},NULLABLE:{type:"select",item:["Y","N"]}},index:{UNIQUENESS:{type:"select",item:["0","1"]},INDEX_NAME:{type:"input"},COLUMN_NAME:{multi:!0,type:"field"}},changeField:function(t,e){var a=[];return e.origin.FIELD?(e.origin.FIELD!=e.FIELD&&a.push("ALTER TABLE ".concat(t," RENAME ").concat(e.origin.FIELD," to ").concat(e.FIELD)),a.push("ALTER TABLE ".concat(t," MODIFY ").concat(e.FIELD," ").concat(e.TYPE).concat(s(e.LEN.replace(",0",""),"($$$)")," ").concat(s(e.DATA_DEFAULT,"DEFAULT '$$$'")," ").concat("Y"==e.NULLABLE?"NULL":"NOT NULL"))):a.push("ALTER TABLE ".concat(t," ADD ").concat(e.FIELD," ").concat(e.TYPE).concat(s(e.LEN.replace(",0",""),"($$$)")," ").concat(s(e.DATA_DEFAULT,"DEFAULT '$$$'")," ").concat("Y"==e.NULLABLE?"NULL":"NOT NULL")),e.origin.COMMENTS!=e.COMMENTS&&a.push("COMMENT ON COLUMN ".concat(t,".").concat(e.FIELD," IS '").concat(e.COMMENTS,"'")),a.join(";")},dropField:function(t,e){return"ALTER TABLE ".concat(t," DROP column ").concat(e.Field)},addIndex:function(t,e){return"CREATE INDEX ".concat("1"==e.UNIQUENESS?"UNIQUE":"","  ").concat(e.INDEX_NAME," on ").concat(t,"(").concat(e.COLUMN_NAME.join?e.COLUMN_NAME.join(","):e.COLUMN_NAME,")")},dropIndex:function(t,e){return"DROP INDEX ".concat(e.INDEX_NAME)}}}},f19a:function(t,e,a){"use strict";a.r(e);var s=a("2b80"),n=a.n(s);e["default"]={namespaced:!0,state:{data:{}},mutations:{get:function(t){t.data=(new n.a).getResult()}}}},f271:function(t,e,a){"use strict";a.r(e);a("ac1f"),a("5319");e["default"]={beforeRouteEnter:function(t,e,a){a((function(t){return t.$router.replace(JSON.parse(e.params.route))}))},render:function(t){return t()}}},f306:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"monitor-mysql-process"},[a("k-search-table",{ref:"st",attrs:{url:"/api/monitor/mysql/process","search-data":t.search,page:!1},on:{data:t.onData}},[a("template",{slot:"searchs"}),a("template",{slot:"buttons"},[a("k-time-refresh",{attrs:{time:5},on:{refresh:t.refresh}}),a("span",{staticStyle:{float:"right","font-size":"14px"}},[t._v("最后更新时间: "+t._s(t._f("dateTime")(t.lastTime)))])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源"}},[a("el-table-column",{attrs:{label:"名称",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{label:"主机",prop:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.host)+":"+t._s(e.row.port))]}}])})],1),a("el-table-column",{attrs:{label:"线程",prop:"pid"}}),a("el-table-column",{attrs:{label:"用户",prop:"puser"}}),a("el-table-column",{attrs:{label:"客户端",prop:"phost"}}),a("el-table-column",{attrs:{label:"数据库",prop:"pdb"}}),a("el-table-column",{attrs:{label:"命令",prop:"pcommand"}}),a("el-table-column",{attrs:{label:"耗时",prop:"pcommand"}}),a("el-table-column",{attrs:{label:"状态",prop:"pstatus"}}),a("el-table-column",{attrs:{label:"描述",prop:"pinfo"}})],1)],2)],1)},n=[],o=(a("ac1f"),a("841c"),{data:function(){return{lastTime:null,search:{dateRange:[]}}},computed:{},props:{},watch:{},methods:{onData:function(t){t&&t[0]?this.lastTime=t[0].update_at:this.lastTime=null},refresh:function(){this.$refs.st.search()}},components:{}}),i=o,r=(a("28c3"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},f331:function(t,e,a){},f3b6:function(t,e,a){"use strict";a("b1b9")},f535:function(t,e,a){"use strict";a("3282")},f61f:function(t,e,a){},f633:function(t,e,a){},f6aa:function(t,e,a){},f6be:function(t,e,a){"use strict";a("7af4")},f6ed:function(t,e,a){},f73c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mask"},[a("k-search-table",{ref:"st",attrs:{title:"脱敏模板列表",url:"/api/rule/page","search-data":t.search}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{prop:"dataType",label:"模板类型"}},[a("k-select",{attrs:{url:"",placeholder:"请选择模板类型"},model:{value:t.search.dataType,callback:function(e){t.$set(t.search,"dataType",e)},expression:"search.dataType"}})],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("新建规则")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"name",label:"名称"}}),a("el-table-column",{attrs:{prop:"rule_type",label:"规则分类"}}),a("el-table-column",{attrs:{prop:"rule_level",label:"规则等级"}}),a("el-table-column",{attrs:{prop:"info",label:"规则描述"}}),a("el-table-column",{attrs:{prop:"source",label:"来源"}}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.onEdit(e.row.id)}}},[t._v("编辑 ")]),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】规则吗?"},on:{click:function(a){return t.onDel(e.row.id)}}},[a("el-button",{attrs:{size:"mini",type:"danger"}},[t._v("删除")])],1)]}}])})],1)],2),a("dialog-edit",{ref:"ruleDialog",on:{success:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("1607")),i={data:function(){return{search:{}}},props:{},watch:{},computed:{},methods:{onNew:function(){this.$refs.ruleDialog.show()},onEdit:function(t){this.$refs.ruleDialog.show(t)},refresh:function(){this.$refs.st.search()},onDel:function(t){var e=this;this.$api.post("/api/rule/del",{id:t}).then((function(){e.refresh()}))},onDels:function(){var t=this.$refs.st.selectValues;t&&t.length>0&&this.onDel(t)}},mounted:function(){},components:{DialogEdit:o["default"]}},r=i,l=(a("b168"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},f79b:function(t,e,a){},f7a1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("el-header",{staticClass:"query-tool"},[a("div",{staticClass:"query-tool-left"},[a("tool-db",{ref:"toolDbRef"})],1),a("div",{staticClass:"query-tool-center"},[a("div",{staticClass:"flex items-center"},[a("el-tooltip",{attrs:{content:"新建SQL编辑器"}},[a("el-button",{staticClass:"query-tool-item",staticStyle:{"padding-left":"10px"},attrs:{type:"text",size:"mini"},nativeOn:{click:function(e){return t.onNewWindow.apply(null,arguments)}}},[a("i",{staticClass:"text-primary sn-font"},[t._v("")])])],1),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{staticClass:"execute-sql",class:{"text-primary":!t.queryDisable},attrs:{text:"执行",icon:"&#xe62d;",disabled:t.queryDisable},on:{click:t.onRun}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{class:{"text-error":t.service.loading},attrs:{text:"中断执行",icon:"&#xe64c;",disabled:!t.service.loading},on:{click:t.onStop}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{class:{"text-primary":!t.queryDisable},attrs:{text:"创建工单",icon:"&#xe6bd;",disabled:t.queryDisable},on:{click:t.addNewWork}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{class:{"text-primary":!t.queryDisable},attrs:{text:"执行计划",icon:"&#xe627;",disabled:t.queryDisable},on:{click:t.onExplain}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{class:{"text-primary":t.hasRunner&&t.hasAsync},attrs:{text:"异步查询",icon:"&#xe747;",disabled:!t.hasRunner||!t.hasAsync},on:{click:t.onAsync}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{class:{"text-primary":t.hasRunner&&t.hasExport},attrs:{text:"异步导出",icon:"&#xe62f;",disabled:!t.hasRunner||!t.hasExport},on:{click:t.onExport}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{staticClass:"sn-font text-primary",attrs:{text:"格式化",icon:"&#xe6d1;"},on:{click:t.onFormatter}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool-favorite"),a("el-divider",{attrs:{direction:"vertical"}}),a("el-dropdown",{attrs:{placement:"bottom"},on:{command:t.loadFile}},[a("i",{staticClass:"sn-font text-primary cursor-pointer hover-8"},[t._v("  ")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"utf8",title:"可以打开utf*"}},[t._v("打开文件 - 编码utf-8")]),a("el-dropdown-item",{attrs:{command:"gbk",title:"可以打开gb*"}},[t._v("打开文件 - 编码gbk")]),a("el-dropdown-item",{attrs:{command:"gb2312",divided:""}},[t._v("打开文件 - 编码gb2312")]),a("el-dropdown-item",{attrs:{command:"gb18030"}},[t._v("打开文件 - 编码gb18030")]),a("el-dropdown-item",{attrs:{command:"utf16",divided:""}},[t._v("打开文件 - 编码utf16")]),a("el-dropdown-item",{attrs:{command:"utf32"}},[t._v("打开文件 - 编码utf32")])],1)],1),a("el-divider",{attrs:{direction:"vertical"}}),a("tool",{staticClass:"sn-font text-primary",attrs:{text:"保存到本地",icon:"&#xe615;"},on:{click:t.onSaveLocal}}),a("el-divider",{attrs:{direction:"vertical"}}),a("tool-setting",{staticClass:"sn-font  text-primary tool-settings"})],1)]),a("div",{staticClass:"query-tool-right"},[a("i",{staticClass:"text-primary el-icon-caret-bottom"}),a("project-card",{attrs:{title:"切换项目"},on:{selProject:t.selProject}})],1)])],1),a("dialog-work",{ref:"dialogWork"}),a("dialog-new-work",{ref:"dialogNewWork"}),a("dialog-exec",{ref:"dialogExec",on:{runExec:t.onRunExec}}),a("dialog-work-list",{ref:"dialogWorkList"}),a("div",{attrs:{hidden:""}},[a("input",{ref:"openFile",staticClass:"file",attrs:{id:"sql-upload",name:"sql-upload",accept:".sql",type:"file"},on:{change:t.getFile}})])],1)},n=[],o=a("1da1"),i=a("5530"),r=(a("96cf"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("2ca0"),a("ac1f"),a("1276"),a("5319"),a("da6f")),l=a("96fa"),c=a("2f62"),u=a("a463"),d=a("9c01"),p=a("7638"),f=a("c8e5"),m=a("c1df"),h=a.n(m),b=a("435c"),_=a("4db0"),g=a("d0e2"),v=a("4706"),y={components:{Tool:u["default"],ToolFavorite:d["default"],ToolDb:f["default"],DialogWork:_["default"],DialogNewWork:g["default"],DialogWorkList:b["default"],ToolSetting:p["default"],DialogExec:v["default"]},data:function(){return{day:this.getDay(),openFileEncode:"utf8"}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["e"])(["selecedDB","dataBaseList","isMaxLine","user","project","runner","db","owner","sys","exportCount","service"])),Object(c["c"])(["run"])),{},{queryDisable:function(){var t=!this.hasRunner||(!this.service.data||this.service.loading);return t},hasRunner:function(){return Boolean(this.service)},hasAsync:function(){return this.service&&this.service.data?this.sys.asyn_query&&this.service.data.hasAsynQuery:this.sys.asyn_query},hasExport:function(){return this.service.data?this.sys.asyn_export&&this.service.data.hasAsynExport:this.sys.asyn_export}}),methods:{onNewWindow:function(){this.$refs.toolDbRef.onNewWindow()},selProject:function(t){this.$refs&&this.$refs.toolDbRef&&this.$refs.toolDbRef.reset(),this.$store.commit("project",t)},addContent:function(t){this.service.setSQL(t,!0)},loadFile:function(t){console.log("打开文件：",t),this.openFileEncode=t,this.$refs.openFile.click()},getFile:function(t){if(window.FileReader){var e=t.target.files[0],a=e.size;if(a>1048576)this.$message({showClose:!0,type:"error",message:"打开失败，文件过大！（max=1M）"});else if(-1!=e.name.indexOf(".sql")){var s=new FileReader,n=this;s.onload=function(){n.addContent(this.result),t.target.value=""},s.readAsText(e,this.openFileEncode)}else this.$message.error("不支持该类型的文件上传")}},getDay:function(){var t=h()(new Date).format("YYYY-MM-DD");return t},showWorks:function(){console.log("show works;"),this.$refs.dialogWorkList.show()},onExplain:function(){delete this.service.data.async,this.service.onReset(),this.service.explain=!0,this.service.onRun(!1)},onWork:function(t,e){var a={data:t,project:this.project,dataBaseList:this.dataBaseList,selecedDB:this.selecedDB};console.log("wokr: ",arguments),this.$refs.dialogNewWork.show(a,e)},addNewWork:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t.service.getSelectSQL(),s=Object(i["a"])(Object(i["a"])({},t.service.data),{},{script:a}),n={data:s,project:t.project,dataBaseList:t.dataBaseList,selecedDB:t.selecedDB},t.$refs.dialogNewWork.show(n);case 4:case"end":return e.stop()}}),e)})))()},addWorkNewPage:function(){var t=Date.now(),e=this.service.getSQL();Object(r["g"])("work-sql-".concat(t),{data:Object(i["a"])(Object(i["a"])({},this.service.data),{},{script:e}),project:this.project,dataBaseList:this.dataBaseList,selecedDB:this.selecedDB});var a=this.$router.resolve({path:"/query/new-work",query:{time:t}});window.open(a.href,"_blank")},onExec:function(t,e,a){this.$refs.dialogExec.show(t,e,a)},onAudit2:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return delete t.service.data.async,t.service.encrypt_sql=t.sys.encrypt_sql,t.service.onReset(),a=null,e.prev=4,e.next=7,t.service.onAudit();case 7:a=e.sent,e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log("top/index onAudit2==========   e:",e.t0),a=e.t0;case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,null,[[4,10]])})))()},onReusltRunsql:function(t){this.onRun({single_script:t.sql})},onRun:function(){var t=arguments,e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var s,n,o,r,l,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.length>0&&void 0!==t[0]?t[0]:{},console.log("runParams: ",s),e.service.clean(!0),delete e.service.data.async,e.service.encrypt_sql=e.sys.encrypt_sql,n={id:e.run.id,db_id:e.run.id,owner:e.run.owner,db:e.run.db,dbType:e.run.dbType},e.service.assignData(n),e.run&&e.$bus.emit("index-result-change-tab_".concat(e.run.tabId),"result"),o=null,a.prev=9,a.next=12,e.service.onCheckAudit(s);case 12:o=a.sent,a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](9),console.log("top/index onRun ==========   e:",a.t0),o=a.t0;case 19:o.error?(e.service.body={},e.service.head=[],e.service.affected_rows=0,e.service.result=!1,e.service.resultText="执行错误:"+o.error):(r=s.single_script||e.service.getSQL(),l=Object(i["a"])(Object(i["a"])({},e.service.data),{},{script:r}),c=o?o.atk:"",console.info("[top/index.vue mothods] onRun() : ",o),o.audit_work?e.$confirm("此操作必须通过工单执行，是否继续?","提示",{confirmButtonText:"提交工单",cancelButtonText:"取消",type:"warning"}).then((function(){e.onWork(l,o)})):"DQL"==o.type||"标准"==o.mode||"在线查询-工单"==o.mode?e.service.onRunNormal(!1,c,s):"快照查询-工单"==o.mode||"查询-异步"==o.mode?(u={async:o.id},e.service.onRunAsyncData(!1,c,u)):e.onExec(l,o,s));case 20:case"end":return a.stop()}}),a,null,[[9,15]])})))()},onRunExec:function(t){var e=t.au,a=t.params;console.log("top/index onRunExec(): ",e);var s=e?e.atk:"";this.service.onRunNormal(!1,s,a)},onAudit:function(){delete this.service.data.async,this.service.encrypt_sql=this.sys.encrypt_sql,this.service.onReset(),this.service.onAudit()},onStop:function(){this.service.onStop()},onAsync:function(){var t=this,e={async:!0,iid:this.run.id,sql:this.service.getSQL(),project:this.project.id,encrypt_flag:this.service.encrypt_flag,owner:this.run.owner,db_type:this.run.dbType,dbType:this.run.dbType,token:null};Object(l["a"])(e).then((function(a){var s=a.data;s.async=!0;var n=Object(i["a"])(Object(i["a"])({},t.service.data),{},{script:e.sql});s.audit_work?t.$confirm("此操作必须通过工单执行，是否继续?","提示",{confirmButtonText:"提交工单",cancelButtonText:"取消",type:"warning"}).then((function(){t.onWork(n,s)})):(t.service.encrypt_sql=t.sys.encrypt_sql,t.service.onAsync(null,s),console.log("xxx"))}))},onExport:function(){var t=this,e={export:!0,iid:this.run.id,sql:this.service.getSQL(),project:this.project.id,encrypt_flag:this.service.encrypt_flag,owner:this.run.owner,db_type:this.run.dbType,dbType:this.run.dbType,token:null};Object(l["a"])(e).then((function(a){var s=a.data;s.export=!0;var n=Object(i["a"])(Object(i["a"])({},t.service.data),{},{script:e.sql});s.audit_work?t.$confirm("此操作必须通过工单执行，是否继续?","提示",{confirmButtonText:"提交工单",cancelButtonText:"取消",type:"warning"}).then((function(){t.onWork(n,s)})):(t.service.encrypt_sql=t.sys.encrypt_sql,t.service.onExport({}))}))},onExportResult:function(){this.service.onExportResult()},onFormatter:function(){this.service.onFormatter()},onSaveLocal:function(){var t=this;this.$prompt("保存到本地 - 请输入文件名称").then((function(e){var a=e.value,s=t.service.getSQL();return console.log("value:",a," sql:",s),a?s?{sql:s,name:a}:"e:收藏脚本不能为空！":"e:名称不能为空！"})).then((function(e){if(e&&e.sql&&e.name){var a=new Blob([e.sql],{type:"application/octet-stream"}),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download="".concat(e.name,".sql"),n.click(),window.URL.revokeObjectURL(a)}else e&&e.startsWith("e:")?t.onError(e.split(":")[1]):t.onError("保存失败！")}))},onFavorite:function(){this.service.onFavorite()},onJumpManger:function(){this.$router.replace("/project_home")}},mounted:function(){var t=this;this.$bus.off(),this.$bus.on("switch-project",(function(e){t.$refs&&t.$refs.toolDbRef&&t.$refs.toolDbRef.reset()})),this.$bus.off("exec-sql-format"),this.$bus.on("exec-sql-format",this.onFormatter),this.$bus.off("saveToLocalFile"),this.$bus.on("saveToLocalFile",this.onSaveLocal),this.$bus.off("index-result-run"),this.$bus.on("index-result-run",this.onReusltRunsql),this.$bus.off("tools-run"),this.$bus.on("tools-run",this.onRun),this.$bus.off("add-new-work"),this.$bus.on("add-new-work",(function(){t.addNewWork()}))}},w=y,S=(a("a7b5"),a("2877")),E=Object(S["a"])(w,s,n,!1,null,"23b914c9",null);e["default"]=E.exports},f88b:function(t,e,a){},f8be:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{directives:[{name:"loading",rawName:"v-loading",value:t.running,expression:"running"}],attrs:{type:"ghost","element-loading-text":"操作中，请勿关闭当前页面，若120秒还未完成，请刷新页面重新执行"}},[a("el-card",{staticClass:"box-card mb-9"},[a("h2",{staticClass:" text-3xl text-center"},[t._v("当前版本："+t._s(t.sysSetting.version))])]),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"",accept:".gz","auto-upload":!1,"on-remove":t.handleRemove,"on-change":t.handleChange,limit:t.limit,"file-list":t.uploadFileList}},[a("el-button",{attrs:{slot:"trigger",size:"small",disabled:t.uploadFileList.length==t.limit,type:"primary"},slot:"trigger"},[t._v("选取文件")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{disabled:0==t.uploadFileList.length,size:"small",type:"success"},on:{click:t.submitUpload}},[t._v("上传应用")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("文件名格式：sqldev-${version}.update.tar.gz（如：sqldev-3.0.1.update.tar.gz）的文件，且不超过500M")])],1),a("br"),a("el-button",{attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.getTableList}},[t._v("刷新")]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLaoding,expression:"tableLaoding"}],staticStyle:{width:"100%"},attrs:{data:t.tableData}},[a("el-table-column",{attrs:{prop:"version",label:"版本",width:"180"}}),a("el-table-column",{attrs:{prop:"download",label:"本地升级包"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[s.download?a("el-tag",{attrs:{size:"small",type:"success"}},[t._v(" 已下载 ")]):a("el-tag",{attrs:{type:"info",size:"small"}},[t._v("未下载")])]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"下载时间",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t._f("dateTime")(a.created_at)))]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-link",{attrs:{disabled:s.download,type:"primary"},on:{click:function(e){return t.downloadClick(s)}}},[t._v("下载升级包")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-popconfirm",{attrs:{title:"确认升级为"+s.version+"吗？"},on:{confirm:function(e){return t.applayClick(s)}}},[a("el-link",{attrs:{slot:"reference",disabled:t.isCurrentVersion(s.version)||!s.download||s.cur_version,title:s.download?"点击应用":"请先下载后再应用",type:"primary"},slot:"reference"},[t._v("应用升级包")])],1),a("el-divider",{attrs:{direction:"vertical"}}),a("el-popconfirm",{attrs:{iconColor:"red",title:"确认删除"+s.version+"吗？"},on:{confirm:function(e){return t.deleteClick(s)}}},[a("el-link",{attrs:{slot:"reference",disabled:t.isCurrentVersion(s.version)||!s.download||s.cur_version,type:"danger"},slot:"reference"},[t._v("删除升级包")])],1)]}}])})],1)],1)},n=[],o=a("5530"),i=(a("d3b7"),a("b0c0"),a("4ad9")),r={versions:function(){return i["a"].get("api/system/update/versions")},delete:function(t){return i["a"].post("/api/system/update/del",{version:t})},download:function(t){return i["a"].post("/api/system/update/download",{version:t})},applay:function(t){return i["a"].post("/api/system/update/exec",{version:t})},upload:function(t){return i["a"].upload("/api/system/update/upload",{update_file:t.raw})}},l=a("2ef0"),c=a("2f62"),u={name:"mgt-setting-update",computed:Object(o["a"])(Object(o["a"])({},Object(c["e"])(["sysSetting"])),{},{isCurrentVersion:function(){var t=this;return function(e){return t.sysSetting.version==="v"+e}}}),data:function(){return{uploadFileList:[],file:null,limit:1,running:!1,tableData:null,tableLaoding:!1}},mounted:function(){console.log("-------- update"),this.getTableList()},methods:{getSetting:function(){var t=this;return new Promise((function(e,a){t.$api.post("/api/setting",{}).then((function(a){return t.$store.commit("sysSetting",a),t.$store.commit("d2admin/releases/versionShow",a),e()})).catch((function(t){return a(t)}))}))},getTableList:function(){var t=this;this.tableLaoding=!0,r.versions().then((function(e){t.tableData=e||[]})).finally((function(){t.tableLaoding=!1}))},downloadClick:function(t){var e=this;this.running=!0,r.download(t.version).then((function(t){e.$message.success("下载成功")})).finally((function(){e.getTableList(),e.running=!1}))},applayClick:function(t){var e=this;this.running=!0;var a=this.sysSetting.version;console.log("升级前：",a),r.applay(t.version).then((function(t){e.$message.success("升级成功")})).finally((function(){e.getTableList(),e.running=!1,e.getSetting().then((function(){console.log("升级完成：",a,e.sysSetting.version),a!=e.sysSetting.version&&e.$message.success("升级成功")}))}))},deleteClick:function(t){var e=this;r.delete(t.version).then((function(t){e.$message.success("删除成功")})).finally((function(){e.getTableList()}))},handleChange:function(t){this.uploadFileList=[];var e="application/x-gzip"===(t.type||t.raw.type),a=t.size/1024/1024<=500,s=Object(l["startsWith"])(t.name,"sqldev-")&&Object(l["endsWith"])(t.name,".tar.gz");e?a?s?this.uploadFileList.push(t):this.$message.error("上传文件名只能是sqldev-${version}.update.tar.gz格式!"):this.$message.error("上传文件大小不能超过 500MB!"):this.$message.error("上传文件只能是.tar.gz压缩格式!")},handleRemove:function(t,e){this.uploadFileList=[],console.log(t,e)},submitUpload:function(){var t=this;this.running=!0,r.upload(this.uploadFileList[0]).then((function(e){console.log("上传结果：",e),e.data&&"ok"==e.data.data?t.$message.success("上传成功！"):t.$message.error("失败：".concat(e.data.msg))})).finally((function(){t.running=!1,t.getTableList()}))}}},d=u,p=a("2877"),f=Object(p["a"])(d,s,n,!1,null,null,null);e["default"]=f.exports},f8c5:function(t,e,a){},f928:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{"custom-class":"database-edit",title:"敏感资产扫描",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{attrs:{model:t.db,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"数据源"}},[t._v(" "+t._s(t.db.name)+" ")]),a("el-form-item",{attrs:{label:"扫描状态"}},[t._v(" "+t._s(t.db.sddp_state)+" ")]),a("el-form-item",{attrs:{label:"数据采集数"}},[a("el-tooltip",{attrs:{placement:"top",content:"每张表的数据采集条数"}},[a("el-select",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:t.db.sddp_fetch_size,callback:function(e){t.$set(t.db,"sddp_fetch_size",e)},expression:"db.sddp_fetch_size"}},[a("el-option",{attrs:{label:"10条",value:10}}),a("el-option",{attrs:{label:"50条",value:50}}),a("el-option",{attrs:{label:"100条",value:100}}),a("el-option",{attrs:{label:"200条",value:200}})],1)],1)],1),a("el-form-item",{attrs:{label:"识别采样展示数"}},[a("el-tooltip",{attrs:{placement:"top",content:"扫描结束后对命中字段样本展示的条数"}},[a("el-select",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:t.db.sddp_show_size,callback:function(e){t.$set(t.db,"sddp_show_size",e)},expression:"db.sddp_show_size"}},[a("el-option",{attrs:{label:"0条",value:0}}),a("el-option",{attrs:{label:"10条",value:10}}),a("el-option",{attrs:{label:"20条",value:20}})],1)],1)],1),a("el-form-item",{attrs:{label:"上次扫描时间"}},[t._v(" "+t._s(t._f("dateTime")(t.db.sddp_start_time))+" ")])],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("开始扫描")])],1)],1)],1)},n=[],o=a("2ef0"),i={data:function(){return{db:{},isShow:!1,id:null,oper_types:[{l:"只读",v:1},{l:"读写",v:0}],formData:this.reset()}},computed:{},props:{},watch:{},methods:{reset:function(){return{config:{auth:"",method:"get"},id:"",db_type:"",show_size:0,fetch_size:200}},changePass:function(){},show:function(t){this.id=t.id,this.db=t,this.isShow=!0},hide:function(){this.isShow=!1,this.db={}},onStart:function(){},onSubmit:function(){var t=this,e=Object(o["cloneDeep"])(this.db);if(e.sddp_fetch_size<1)return this.$message({message:"数据采集数必须大于零",type:"warning"}),!1;console.log("config:",e.config),this.$api.db.startSDDP(e).then((function(e){t.onSuccess("扫描任务启动成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}},components:{}},r=i,l=(a("2766"),a("2877")),c=Object(l["a"])(r,s,n,!1,null,"c89bb3c6",null);e["default"]=c.exports},f940:function(t,e,a){"use strict";a("947f")},f94e:function(t,e,a){},f983:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-project-db",attrs:{title:t.pro.name+"/数据源管理",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{select:!1,url:"/api/project/db/page","search-data":t.search,manual:!0},on:{select:t.onSelect,reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1),a("el-form-item",{attrs:{label:"数据源类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.db_type,callback:function(e){t.$set(t.search,"db_type",e)},expression:"search.db_type"}},t._l(t.db_types,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{attrs:{label:"关联状态"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:!0,size:"mini"},model:{value:t.search.rel_type,callback:function(e){t.$set(t.search,"rel_type",e)},expression:"search.rel_type"}},t._l(t.rel_types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1)],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"数据源",prop:"name"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" [ "+t._s(a.db_type)+" ] "+t._s(a.name)+" ")]}}])}),a("el-table-column",{attrs:{label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?a("el-select",{attrs:{multiple:!0,clearable:"",placeholder:"请选择"},model:{value:e.row._rids_,callback:function(a){t.$set(e.row,"_rids_",a)},expression:"r.row._rids_"}},t._l(t.roleList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1):t._l(e.row.role_names,(function(e,s){return a("el-tag",{key:s,staticStyle:{"margin-right":"5px"},attrs:{type:"success"}},[t._v(" "+t._s(e)+" ")])}))]}}])}),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.project?a("el-button",{attrs:{type:"warning",size:"mini",plain:""},on:{click:function(a){return t.onAdd(e.row.id,e.row._rids_||[])}}},[t._v("添加 ")]):t._e(),0!=e.row.project?a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return t.onRemove(e.row.id)}}},[t._v("移除 ")]):t._e()]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=a("2909"),r=(a("99af"),a("a15b"),a("ac1f"),a("841c"),a("d3b7"),a("2f62")),l={data:function(){return{pro:{},roleList:[],ids:"",isShow:!1,search:{db_types:null},con_states:[{k:"0",v:"全部"},{k:"1",v:"连接中"},{k:"2",v:"连接成功"},{k:"3",v:"连接失败"}],rel_types:[{k:"",v:"全部"},{k:"1",v:"已关联"},{k:"2",v:"未关联"}],db_types:[{label:"全部",value:""}].concat(Object(i["a"])([{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]))}},props:{},watch:{},computed:Object(o["a"])({},Object(r["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.project=this.pro.id},refresh:function(){this.$refs.st.search(),this.$emit("refresh")},show:function(t){var e=this;this.pro=t,this.search.project=t.id,this.isShow=!0,this.roleList=[],this.getAllRoles(t.id).then((function(){e.$nextTick((function(){e.refresh()}))}))},getAllRoles:function(t){var e=this;return new Promise((function(a,s){e.$api.role.all(1,t).then((function(t){return e.roleList=t,a()})).catch((function(t){return s(t)}))}))},hide:function(t){this.isShow=!1,this.roleList=[]},onBatchAdd:function(){""!=this.ids&&this.onAdd(this.ids)},onBatchRemove:function(){""!=this.ids&&this.onRemove(this.ids)},onAdd:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.$api.project.relationDB(this.pro,t,a.join(",")).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.project.kickDB(this.pro,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},c=l,u=(a("8ded"),a("2877")),d=Object(u["a"])(c,s,n,!1,null,null,null);e["default"]=d.exports},f9ab:function(t,e,a){},f9b1:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"dialog-diff",attrs:{title:"数据对比",visible:t.isShow},on:{"update:visible":function(e){t.isShow=e}}},[a("template",{slot:"title"},[a("span",[t._v("数据对比")]),a("el-checkbox",{staticStyle:{"padding-left":"64px","font-size":"12px"},model:{value:t.onlyDiff,callback:function(e){t.onlyDiff=e},expression:"onlyDiff"}},[t._v("只显示不同")])],1),a("el-form",{attrs:{size:"mini","label-position":"top"}},[t._l(t.dataList,(function(e,s){return[!t.onlyDiff||e.diff?a("el-form-item",{key:s,attrs:{label:e.label}},[a("el-row",{attrs:{type:"flex",gutter:10}},t._l(e.values,(function(t,s){return a("el-col",{key:s},[a("el-input",{class:{"text-error":e.diff},attrs:{readonly:"",value:t}})],1)})),1)],1):t._e()]}))],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("取消")]),a("el-button",{attrs:{type:"success"},on:{click:t.hide}},[t._v("保存")])],1)],2)},n=[],o=(a("159b"),a("d3b7"),a("ddb0"),{data:function(){return{isShow:!1,onlyDiff:!1,dataList:[]}},props:{},watch:{},computed:{},methods:{show:function(t){this.onlyDiff=!1;var e=t[0],a=[],s=function(s){var n={label:s,values:[],diff:!1};t.forEach((function(t){t[s]!=e[s]&&(n.diff=!0),n.values.push(t[s])})),a.push(n)};for(var n in e)s(n);this.dataList=a,console.log(this.dataList),this.isShow=!0},hide:function(){this.isShow=!1},onSubmit:function(){}},mounted:function(){},components:{}}),i=o,r=(a("b02d"),a("2877")),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},fa4d:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:"审核信息",visible:t.isShow,width:"600px"},on:{"update:visible":function(e){t.isShow=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,"label-width":"120px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"申请人",prop:"opt_user"}},[t._v(" "+t._s(t.formData.opt_user_name)+" ")]),"role"==t.formData.source_type?a("el-form-item",{attrs:{label:"申请资源"}},[t._v(" "+t._s(t.formData.source_name)+"(权限组) ")]):t._e(),a("el-form-item",{attrs:{label:"申请说明",prop:"opt_mark"}},[t._v(" "+t._s(t.formData.opt_mark)+" ")]),a("el-form-item",{attrs:{label:"审核人",prop:"copy_to"}},[t._v(" "+t._s(t.formData.auditor_name)+" ")]),a("el-form-item",{attrs:{label:"审核抄送",prop:"copy_to"}},[t._v(" "+t._s(""==t.copyTo?"无":t.copyTo)+" ")]),a("el-alert",{attrs:{title:"说明：权限组申请审核后会自动关联，其他的需要人工处理。",type:"info"}}),a("el-form-item",{attrs:{label:"审核结果",prop:"status"}},[t.readonly?a("span",[t._v(" "+t._s(t.showStatus())+" ")]):a("el-radio-group",{model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[a("el-radio",{attrs:{label:2}},[t._v("通过")]),a("el-radio",{attrs:{label:3}},[t._v("不通过")])],1)],1),a("el-form-item",{attrs:{label:"审核说明",prop:"auditor_mark"}},[t.readonly?a("span",[t._v(" "+t._s(t.formData.auditor_mark)+" ")]):a("el-input",{attrs:{type:"textarea",placeholder:"请输入审核说明"},model:{value:t.formData.auditor_mark,callback:function(e){t.$set(t.formData,"auditor_mark",e)},expression:"formData.auditor_mark"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.readonly&&1!=t.formData.status,expression:"readonly&&formData.status!=1"}],attrs:{label:"审核时间",prop:"auditor_mark"}},[a("span",[t._v(" "+t._s(t._f("dateTime")(t.formData.auditor_time))+" ")])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.readonly,expression:"!readonly"}],attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("提交")])],1)],1)],1)},n=[],o=(a("a15b"),{data:function(){return{status:2,role:{},readonly:!1,copyTo:"",isShow:!1,formData:{},formRule:{opt_mark:[{required:!0,message:"请输入申请理由"}]}}},props:{},watch:{},computed:{},methods:{show:function(t,e){if(this.apply=t,this.formData=t,this.readonly=e||!1,t.copy_to&&t.copy_to.length>0){for(var a=[],s=0;s<t.copy_to.length;s++)a.push(t.copy_to[s].copy_to_name);this.copyTo=a.join(" ")}this.isShow=!0},hide:function(t){this.isShow=!1,this.readonly=!1,this.formData={}},showStatus:function(){var t="未知状态";return this.formData&&(2==this.formData.status?t="已通过":3==this.formData.status?t="未通过":1==this.formData.status?t="审核中":4==this.formData.status&&(t="已撤销")),t},onSubmit:function(){var t=this,e=this.formData;e.status=this.status,this.$api.apply.auditExec(e).then((function(){t.onSuccess("提交成功"),t.hide(),t.$emit("refresh")}),(function(e){var a="参数错误！";"301"!=e.result&&(a=e.data),t.onError(a)}))}},mounted:function(){},components:{}}),i=o,r=a("2877"),l=Object(r["a"])(i,s,n,!1,null,null,null);e["default"]=l.exports},fa69:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{staticClass:"act_log padding-x-24",attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{title:"操作日志列表",url:"/api/act/log/page","search-data":t.searchAdvance},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"时间范围:"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"],"picker-options":t.$constant.pickOptions},model:{value:t.search.dateRange,callback:function(e){t.$set(t.search,"dateRange",e)},expression:"search.dateRange"}})],1),a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{clearable:!0},model:{value:t.search.opt_type,callback:function(e){t.$set(t.search,"opt_type",e)},expression:"search.opt_type"}},t._l(t.types,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1),a("el-form-item",{attrs:{prop:"opt_user",label:"操作人"}},[a("el-input",{attrs:{placeholder:"请选择操作人",clearable:""},model:{value:t.search.user_name,callback:function(e){t.$set(t.search,"user_name",e)},expression:"search.user_name"}})],1),a("el-form-item",{attrs:{prop:"opt_desc",label:"详情"}},[a("el-input",{attrs:{placeholder:"操作详情，支持模糊查询",clearable:""},model:{value:t.search.opt_desc,callback:function(e){t.$set(t.search,"opt_desc",e)},expression:"search.opt_desc"}})],1),a("el-form-item",{attrs:{prop:"opt_ip",label:"ip"}},[a("el-input",{attrs:{placeholder:"请输入ip",clearable:""},model:{value:t.search.opt_ip,callback:function(e){t.$set(t.search,"opt_ip",e)},expression:"search.opt_ip"}})],1),1==t.user.role?a("el-form-item",{attrs:{prop:"role",label:"用户角色"}},[a("el-select",{model:{value:t.search.role,callback:function(e){t.$set(t.search,"role",e)},expression:"search.role"}},t._l(t.roles,(function(t){return a("el-option",{key:t.k,attrs:{label:t.v,value:t.k}})})),1)],1):t._e()],1),a("template",{slot:"buttons"}),a("template",{slot:"columns"},[a("el-table-column",{attrs:{prop:"opt_desc",type:"expand",label:"展开"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.opt_desc)+" ")]}}])}),a("el-table-column",{attrs:{label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.createdAt))+" ")]}}])}),a("el-table-column",{attrs:{prop:"user_name",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opt_ip",label:"操作人ip"}}),a("el-table-column",{attrs:{prop:"opt_type",label:"操作类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.toType(e.row.opt_type))+" ")]}}])}),a("el-table-column",{attrs:{prop:"opt_desc",width:"400","show-overflow-tooltip":!0,label:"详细描述"}}),a("el-table-column",{attrs:{prop:"result",label:"结果"}})],1)],2)],1)},n=[],o=a("5530"),i=(a("ac1f"),a("841c"),a("99af"),a("2f62")),r=a("c1df"),l=a.n(r),c={data:function(){return{search:{role:0,opt_type:0,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]},types:[{k:0,v:"全部"},{k:1,v:"登录"},{k:2,v:"登出"},{k:3,v:"下载"},{k:4,v:"管理"},{k:5,v:"自动作业"}],roles:[{k:0,v:"全部"},{k:1,v:"超级管理员"},{k:2,v:"管理员"},{k:4,v:"普通用户"}]}},props:{},watch:{},computed:Object(o["a"])({searchAdvance:function(){var t=Object(o["a"])({},this.search);return t.dateRange&&(t.start=l()(t.dateRange[0]).format("YYYY-MM-DD HH:mm:ss"),t.end=l()(t.dateRange[1]).format("YYYY-MM-DD HH:mm:ss"),delete t.dateRange),t}},Object(i["e"])(["user"])),methods:{resetSearch:function(){this.search={role:0,dateRange:[l()().startOf("d").toDate(),l()().endOf("d").toDate()]}},toType:function(t){return 1==t?"登录账户":2==t?"登出账户":3==t?"下载导出":4==t?"管理操作":5==t?"自动作业":"其他"},refresh:function(){this.$refs.st.search()},onDel:function(t){var e=this;this.$api.post("/act/log/delete",{ids:[].concat(t)}).then((function(){e.refresh()}))},onDels:function(){var t=this.$refs.st.selectValues;t&&t.length>0&&this.onDel(t)}},mounted:function(){},components:{}},u=c,d=(a("7844"),a("2877")),p=Object(d["a"])(u,s,n,!1,null,null,null);e["default"]=p.exports},faad:function(t,e,a){},fabe:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{ref:"personalNoticeListRef",staticClass:"personal-notice-list-page py-5",attrs:{type:"ghost"}},[a("div",{staticClass:"tools mb-4"},[a("el-button",{staticClass:"ignore active:opacity-80",attrs:{icon:"el-icon-refresh-right",size:"small"},nativeOn:{click:function(e){return t.onRefresh.apply(null,arguments)}}},[t._v(" 刷新 ")]),a("el-button",{staticClass:"ignore active:opacity-80",attrs:{size:"small",type:"primary"},nativeOn:{click:function(e){return t.onRead.apply(null,arguments)}}},[t._v(" 标记当前已读 ")])],1),a("msg-list",{ref:"msgListRef",attrs:{config:{msg_type:2,avatar:!0}},on:{paged:t.onPaged}})],1)},n=[],o=(a("d3b7"),a("18b0")),i={name:"personal-notice-personal-notice-list",components:{MsgList:o["a"]},methods:{onPaged:function(){this.$refs.personalNoticeListRef.scrollToTop()},onRead:function(){var t=this;this.$refs.msgListRef.readAll().finally((function(){t.$refs.msgListRef.refresh()}))},onRefresh:function(){this.$refs.msgListRef.refresh()}}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},fad0:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return i}));var s=a("d4ec"),n=a("bee2"),o=a("ade3"),i=(a("159b"),a("ac1f"),a("5319"),function(){function t(){Object(s["a"])(this,t),Object(o["a"])(this,"conditions",[]),Object(o["a"])(this,"express",/:([^\s,]+)(,|\s+|\b)/g)}return Object(n["a"])(t,[{key:"repair",value:function(t){return this.conditions.forEach((function(e){t=t.replace(e.exp,"'".concat(e.value,"'"))})),console.log(t),t}},{key:"exec",value:function(t){var e=0,a=null;this.conditions=[];while(1){if(a=this.express.exec(t),e++,e>100)return void this.error(t);this.execOne(a)}}},{key:"execOne",value:function(t){this.conditions.push({key:t[1],value:"",exp:":".concat(t[1]),type:1,config:{}})}},{key:"error",value:function(t){console.error("SQL解析出错了 ==> ",t)}}]),t}())},fb1d:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-new-terminal"},[a("div",{ref:"terminal",staticClass:"felix-xterm"})])},n=[],o=(a("b0c0"),a("99af"),a("2ef0")),i=a("fcf3"),r=a("47d0"),l=a("27ae"),c=a("d1f9"),u=a("408b"),d=(a("f9ab"),a("4ad9")),p=new r["FitAddon"],f=new u["WebLinksAddon"],m=new c["SearchAddon"],h=o["debounce"]((function(){console.log("resize: onWindowResize"),p.fit()}),200),b=function(t,e){var a=function(t){console.log("resize: ",t),e.send(JSON.stringify({type:"resize",rows:t.rows,cols:t.cols}))};t.onResize(a),e.addEventListener("close",(function(){console.log("term: ",t)}))},_=function(t,e,a,s){t.write("\r\nWelcome to SqlDEV Web Ssh Terminal\n\r\n"),t.socket=e;var n=null,o=function(e){s&&s>0?n?n+=e.data:(n=e.data,setTimeout((function(){t.write(n)}),s)):t.write(e.data)},i=function(t){e.send(JSON.stringify({type:"cmd",cmd:l["Base64"].encode(t)}))};e.onmessage=o,a&&t.onData(i);var r=setInterval((function(){e.send(JSON.stringify({type:"heartbeat",data:""}))}),2e4);e.addEventListener("close",(function(){e.removeEventListener("message",o),delete t.socket,clearInterval(r)}))},g={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompTerm",data:function(){return{m:{},id:0,isFullScreen:!1,searchKey:"",isShow:!1,ws:null,term:null,fitAddon:null,thisV:this.visible,disable:!1}},watch:{visible:function(t){this.v=t}},computed:{termTitle:function(){return this.m?"@".concat(this.m.name):""},wsUrl:function(){var t=localStorage.getItem("token");return"".concat(d["a"].wsBase(),"/api/ws/ssh/").concat(this.id,"?cols=").concat(this.term.cols,"&rows=").concat(this.term.rows,"&access_token=").concat(t)}},created:function(){var t=this.$route.query;this.m=t,this.id=t.id,document.title=t.name+" - "+Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).NAME+" "+Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).VERSION+" - "+Object({NODE_ENV:"production",VUE_APP_BUILD_MODE:"production",VUE_APP_SCOURCE_LINK:"false",VUE_APP_PUBLIC_PATH:"/",VUE_APP_PORT:"3301",VUE_APP_TITLE:"SQLDEV",VUE_APP_REPO:"https://github.com/shuaninfo/sqldev",VUE_APP_I18N_LOCALE:"zh-chs",VUE_APP_I18N_FALLBACK_LOCALE:"en",VUE_APP_THEME:"sqldev",VUE_APP_THEME_CODE:"vs",VUE_APP_ELEMENT_COLOR:"#4CA2A4",VUE_APP_API:"",VUE_APP_PRODUCT_TYPE:"COMMERCIAL",VUE_APP_SUPPORT_DB:"oracle,mysql,mssql,mongodb,postgres,mycat,redis,doris",VUE_APP_COMPANY_CODE:"shuan",VUE_APP_COMPANY_NAME:"南京树安信息技术有限公司",VUE_APP_COMPANY_WEBSITE:"http://www.shuaninfo.com/",VUE_APP_PRODUCT_NAME:"SQLDEV",VUE_APP_PRODUCT_INTRODUCTION:"企业数据安全治理工具",VUE_APP_PRODUCT_DESCRIPSTION:"SQLDEV是集数据访问、数据脱敏、权限管控、操作审计为一体的数据安全治理工具。",VUE_APP_PRODUCT_FAVICON:"/favicon.ico",VUE_APP_PRODUCT_FAVICON_MSG:"/favicon-msg.ico",VUE_APP_PRODUCT_LOGIN_LOGO:"/image/logo-white.png",VUE_APP_PRODUCT_LOGO:"/image/logo.png",VUE_APP_PRODUCT_SLOGAN:"/image/slogan.png",VUE_APP_VERSION:"3.4.0",VUE_APP_BUILD_TIME:"2021-10-27 14:44:47",BASE_URL:"/",LOGIN_BGS:[{imagePath:"/static/login/bg-0.webp",text:"时间，天天得到的都是二十四小时，可是一天的时间给勤勉的人带来聪明和气力，给懒散的人只留下一片悔恨。"},{imagePath:"/static/login/bg-1.webp",text:"享受每一天，不恐惧衰老，不害怕改变和失望，无论多少岁，都可以时尚，都可以保持天真之心，都有得到幸福的机会，只要你不放弃。"},{imagePath:"/static/login/bg-2.webp",text:"莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。"},{imagePath:"/static/login/bg-3.webp",text:"三更灯火五更鸡，正是男儿读书时，黑发不知勤学早，白发方悔读书迟。"},{imagePath:"/static/login/bg-4.webp",text:"人生来就是孤独的，不要奢望能够依靠谁，哪怕是至亲至爱。越是喧嚣处，往往更孤独。人生无处不修行，能在孤独中心静如水，才能在纷扰里安然无恙。"},{imagePath:"/static/login/bg-5.webp",text:"在薄情的世界里，每个人都来去匆匆，没有谁会永远陪伴在你身边，没有人会时刻对你关怀备至，体贴入微，倒不如学会好好爱自己，不辜负余生。"},{imagePath:"/static/login/bg-6.webp",text:"世上唯一不能复制的是时间，唯一不能重演的是人生，唯一不劳而获的是年龄，该怎么走，过什么样的生活，全凭自己的选择和努力。人生很贵，千万不要浪费！"},{imagePath:"/static/login/bg-7.webp",text:"做一个人生的观光客吧，说到底只要与人为善，以德服人，离是非远点，靠家人近点，便有了心安，有了惬意。"}],datasources:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}],WORKSPACE:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}},AUTH:{"soft-route":!0,"dev-onbeforeunload":!0,"prod-onbeforeunload":!0},VUE_APP_DATABASE_LIST:[{label:"Oracle",value:"oracle",type:"db",port:1521},{label:"MySql",value:"mysql",type:"db",port:3306},{label:"MsSql",value:"mssql",type:"db",port:1433},{label:"MongoDB",value:"mongodb",type:"db",port:27017},{label:"PostgreSql",value:"postgres",type:"db",port:5432},{label:"Mycat",value:"mycat",type:"ds",port:3306},{label:"Redis",value:"redis",type:"db",port:6379},{label:"doris",value:"doris",type:"db",port:6379}]}).COMPANY},mounted:function(){this.doOpened()},methods:{reset:function(){this.ws=null,this.term=null},doLink:function(t,e){"click"===t.type&&window.open(e)},doClose:function(){if(window.removeEventListener("resize",h),this.ws&&this.ws.close(),this.term){var t="您的 ".concat(this.m.name," 连接配置无法连接，请关闭当前页面，并检查连接配置信息");this.term.writeln("[1;31m".concat(t)),this.term.setOption("disableStdin",!0)}this.m={},this.id=0,this.isShow=!1},doOpened:function(){var t=this;this.term=new i["Terminal"]({fontSize:12,rows:60,convertEol:!0,cursorBlink:!0,cursorStyle:"underline",bellStyle:"sound"}),this.term.loadAddon(p),this.term.loadAddon(f),this.term.loadAddon(m),this.term.open(this.$refs.terminal),p.fit(),this.term.focus(),window.addEventListener("resize",h),console.log("this.wsUrl:",this.wsUrl),this.ws=new WebSocket(this.wsUrl),this.ws.onerror=function(e){console.log("onerror event: ",e),t.$message.error("登陆失败,请检查你的配置")},this.ws.onclose=function(e){console.log("ws close:",e),1005!==e.code&&(t.$notify.error({title:"code ".concat(e.code),message:e.reason}),t.doClose())},_(this.term,this.ws,!0,-1),b(this.term,this.ws)}}},v=g,y=(a("a766"),a("2877")),w=Object(y["a"])(v,s,n,!1,null,"485c078f",null);e["default"]=w.exports},fb22:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sql-query-card-db"},[a("div",{staticClass:"flex justify-center db-view",staticStyle:{padding:"5px 10px"}},[a("el-link",{on:{click:function(e){return t.onClickDatabase(t.currentRun)}}},[a("k-icon",{staticClass:"db-icon bg-green-500",staticStyle:{"margin-right":"6px"},attrs:{icon:"icon-shujuyuan1"}}),a("span",{staticStyle:{"font-weight":"normal"}},[t._v(" "+t._s(t.currentRun.name)+" ")])],1)],1),a("k-query-cardx",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"queryCardx",attrs:{head:"数据信息",dbId:t.currentRun.id,clearable:!0,db_type:t.currentRun.dbType,"is-filter":!0,"tab-id":t.tabId},on:{sel:t.selItem,refresh:t.refreshHandle},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("div",{staticClass:"keyword-info uni-table-list-view"},[t._v(" 列表数："+t._s(t.filterDataList.length)+"/"+t._s(t.pages.total)+" ")]),t.filterDataList&&t.filterDataList.length>0?a("virtual-list",{ref:"vlist",staticClass:"vlist",attrs:{"data-key":"name","estimate-size":t.itemHeight,keeps:t.vlistKeeps,"data-sources":t.filterDataList,"data-component":t.itemTempalte,"extra-props":{has_child_group:t.has_child_group,selectedItemKey:t.selectedItemKey,selectedRootKey:t.selectedRootKey,currentRun:t.currentRun,project:t.project,schemaGroupType:t.schemaGroupType,hasAsynSql:t.hasAsynSql}},on:{tobottom:t.onScrollToBottom}},[a("div",{staticClass:"loading-spinner no-user-select",attrs:{slot:"footer"},slot:"footer"},[t._v("结束")])]):a("div",{ref:"vlist",staticClass:"empty"},[t._v(" 空数据 ")])],1),a("vue-context-menu",{ref:"rightMenu",staticClass:"right-menu",attrs:{target:t.contextMenuTarget,show:t.contextMenuVisible},on:{"update:show":t.onRightHandle}},[t._l(t.menusList,(function(e,s){return a("a",{key:s,staticClass:"menu-item",attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.menuClickHandle(e.value)}}},[t._v(" "+t._s(e.label)+" ")])})),a("a",{staticClass:"menu-item",attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.menuClickHandle("copy_name")}}},[t._v(" 复制名称 ")]),a("a",{staticClass:"menu-item",attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.menuClickHandle("refresh")}}},[t._v(" 刷新 ")])],2),a("dialog-table",{ref:"tableDialog"}),a("dialog-redis-info",{ref:"redisInfoDialog"}),a("dialog-table-edit",{ref:"tableDialogEditRef"}),a("dialog-sql-export",{ref:"exportSqlDialog"})],1)},n=[],o=a("5530"),i=(a("4de4"),a("498a"),a("b0c0"),a("99af"),a("d3b7"),a("159b"),a("ac1f"),a("1276"),a("a434"),a("a15b"),a("2ef0")),r=a("2f62"),l=a("092b"),c=a("bda3"),u=a("8f44"),d=a("c9ff"),p=a("596b"),f=a("e31c"),m=a("163b"),h=a("89c1"),b=a.n(h),_=a("43d3"),g=a("ac9c"),v=a("0f1c"),y={name:"card-db",components:{DialogTable:l["default"],DialogSqlExport:d["default"],DialogTableEdit:u["default"],DialogRedisInfo:c["default"],"virtual-list":b.a,"vue-context-menu":v["component"]},data:function(){return{contextMenuList:{TABLE_LIST:{MENUS:{table:[{label:"select *",value:"select_table_*"},{label:"表定义",value:"table_definition"}],redis:[{label:"GET KEY",value:"redis_get"},{label:"SET KEY",value:"redis_set"}]},MENU_LIST:[{label:"COUNT",value:7},{label:"SELECT *",value:71},{label:"表定义",value:6},{label:"导出SQL",value:8}]}}.TABLE_LIST.MENUS,loading:!1,schemaGroupType:"table",treeProps:{label:"label",isLeaf:"leaf"},filter:"",itemTempalte:_["default"],itemHeight:24,selectedItem:{},selectedItemKey:"",selectedRootKey:"",vlistFooterVisible:!1,vlistFooterText:"loading...",nodeList:[],has_child_group:!1,pages:{no:0,size:500,cursor:0,nodeLength:0,total:0},contextMenuTarget:null,contextMenuVisible:!1}},inject:["db","owner","dataIndex"],computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(r["e"])(["selecedDB","runner","sys","project","runList","runActive","vlistKeeps"])),Object(r["c"])(["run","context"])),{},{menusList:function(){return"redis"==this.currentRun.dbType?this.contextMenuList.redis:this.contextMenuList[this.selectedItem.node_type]||[]},currentRun:function(){var t=this;console.log("[card.db computed] currentRun:",this.tabId,this.db);var e=this.runList.filter((function(e){return e.tabId==t.tabId}));return e.length>0?e[0]:{}},filterDataList:function(){var t=this,e=Object(i["filter"])(this.nodeList,(function(t){return t.perm&&3!=t.perm.rw}));return""==this.filter.trim()?e:Object(i["filter"])(e,(function(e){return-1!=e.name.toUpperCase().indexOf(t.filter.toUpperCase())}))}}),props:{db:{},owner:{},hasAsynSql:{type:Boolean,default:!1},tabId:{}},methods:{onClickDatabase:function(t){var e=Object(o["a"])(Object(o["a"])({},t),{},{db_name:t.db,project:this.project.id,_params:{db_type:t.dbType,id:t.id,node_type:"owner",object_type:"owner",type:"owner",owner:t.owner,project:this.project.id,path:"".concat(t.id,"/").concat(t.owner)},_uniKey:"".concat(this.project.id,"_").concat(t.id,"_").concat(t.owner)});this.onSelectedItem({source:e})},onSelectedItem:function(t){var e=t.source,a=t.type,s=t.e,n=(t.root,t.rootUniKey);this.$bus.emit("selected-tree-node",{source:e}),this.selectedItem=e,this.selectedItemKey=e._uniKey,this.selectedRootKey=n;var o="table"==e.node_type||"view"==e.node_type,r="redis"==Object(i["get"])(e,"_params.db_type")&&"key"==Object(i["get"])(e,"_params.node_type");"dbleft"==a&&(o||r)?r?this.menuClickHandle("redis_get"):this.menuClickHandle("select_table"):"custom-right"==a&&this.$refs.rightMenu.contextMenuHandler(s)},onScrollToBottom:function(){if(this.vlistFooterVisible)console.info("[card.db methods] onScrollToBottom() 防止多次查询");else{if(!this.pages.cursor)return console.log("结束：",this.pages.cursor),this.vlistFooterVisible=!0,void(this.vlistFooterText="结束");this.pages.no=this.pages.cursor,console.log("[card.db methods] onScrollToBottom：",this.pages),this.onChangeDB(null,!1)}},onRightHandle:function(t){this.contextMenuVisible=t},onClickDefineInRoot:function(t){console.log("点击了item: ",t),this.otherProp="otherProp "+Math.random()},showTableDialog:function(t){this.$refs.tableDialog.show(t,this.db.dbType)},selItem:function(t){console.log("[card.db.vue]#seleItem()",t);var e=this.context.service.getConfig("itemType");e!=t.sub_node_type&&this.context.service.setConfig({itemType:t.sub_node_type}),this.schemaGroupType=t.sub_node_type,this.onChangeDB(null,!0)},refreshHandle:function(){this.pages={no:0,size:500,cursor:0,nodeLength:0,total:0},this.onChangeDB({f:!0},!0)},resetSelectedNodeInfoItem:function(){this.$bus.emit("selected-tree-node",{source:{}}),this.selectedItem={},this.selectedItemKey="",this.selectedRootKey=""},exportSql:function(t){var e=this;this.$refs.exportSqlDialog.show((function(a){a.single_script=t,e.context.service.onRunAsync(a).then((function(t){t.error?e.$message.error(t.error):e.$bus.emit("runExport")}))}))},vlistToTop:function(){this.$refs.vlist&&this.$refs.vlist.scrollToIndex&&this.$refs.vlist.scrollToIndex(0)},vlistReset:function(){this.$refs.vlist&&this.$refs.vlist.reset&&this.$refs.vlist.reset()},generateAndInsertSql:function(t,e){var a=this;if("select_table_*"==e)return new Promise((function(e,s){var n="select * from ".concat(t);return a.context.service.insertSQL(n,{clean:!1}),e(n)}));var s=this.runList[this.runActive],n={id:s.id,project:this.project.id,object_type:"table",node_type:"column",owner:s.owner,table:t};return new Promise((function(o,i){a.$api.db.table.tableSubNode(n).then((function(n){var i=[];n&&n.List&&n.List.forEach((function(t){i.push(t.name)}));var r={columns:i,command:e,name:t,type:a.schemaGroupType,dbType:s.dbType,dbName:s.name,rw:s.rw,comment:!1};if("redis"==s.dbType){var l=t.split(":");l.length>0?(r.type=l[0],l=l.splice(1,l.length-1),r.name=l.join(":")):(r.type="string",r.name=t)}a.selecedDB&&a.selecedDB.source&&(r.sourceName=a.selecedDB.source.label),console.log("config: ",r);var c=f["a"].generate(r);return a.context.service.insertSQL(c,{clean:!1}),o(c)}))}))},onChangeDB:function(t,e){var a=this;this.resetSelectedNodeInfoItem();var s={id:this.currentRun.id,name:this.currentRun.name,dbType:this.currentRun.dbType,type:this.schemaGroupType,project:this.project.id,page_size:this.pages.size,page_no:this.pages.no};Boolean(t)&&m["a"].has(t,["f","id","type","name","project"])&&(console.log("[card.db methods] onChangeDB 自带config参数：",t),s=Object.assign(s,t)),this.loading=!0,(e||s.f)&&(this.nodeList=[]),this.$api.db.schema.schemaSubNode({id:s.id,owner:s.name,type:s.type,project:s.project,object_type:s.type,node_type:s.type,db_type:s.dbType,page_size:s.page_size,page_no:s.page_no,f:s.f||!1}).then((function(t){t?(a.has_child_group=t.has_child_group,e||s.f?(a.vlistReset(),a.nodeList=t.List||[]):a.nodeList=a.nodeList.concat(t.List||[])):a.nodeList=[],a.pages.cursor=t.has_cursor,a.pages.total=t.total,a.pages.nodeLength=a.nodeList.length})).finally((function(){a.loading=!1,a.vlistFooterVisible=!1,a.setMenus()}))},menuClickHandle:function(t){var e=this.selectedItem.name;switch(this.contextMenuVisible=!1,t){case"copy_name":if("redis"==this.currentRun.dbType){var a=e.split(":");e=a.length>1?a[1]:a[0]}var s=Object(p["a"])(e);return s?this.$message.success("复制成功"):this.$message.error("复制失败"),void(this.contextMenuVisible=!1);case"refresh":return this.refreshHandle(),void(this.contextMenuVisible=!1);case"select_table":return void this.generateAndInsertSql(e,t);case"select_table_*":return void this.generateAndInsertSql(e,t);case"add_table":return;case 6:case"table_definition":return"redis"==this.currentRun.dbType?this.$refs.redisInfoDialog.show(e):this.$refs.tableDialog.show(e,this.currentRun.dbType,this.schemaGroupType);case 61:case"design_table":return!1;case"rename":return;case"drop_table":return;case"delete_table":return;case"truncate_table":return;case"redis_get":return void this.generateAndInsertSql(e,t);case"redis_set":return void this.generateAndInsertSql(e,t);default:return!1}},setMenus:function(){this.$refs.vlist&&this.$refs.vlist.$el&&(this.contextMenuTarget=this.$refs.vlist.$el)}},created:function(){var t=this;this.$on("selected-item",(function(e){var a=e.source,s=e.type,n=e.e,o=e.root,i=e.rootUniKey;a._params&&!a._params.object_type&&(a._params.object_type=t.schemaGroupType),t.onSelectedItem({source:a,type:s,e:n,root:o,rootUniKey:i})})),this.$bus.off("".concat(this.tabId,"-card-db-refresh")),this.$bus.on("".concat(this.tabId,"-card-db-refresh"),(function(e){var a={id:e.id,name:e.name};"redis"==e.dbType?t.schemaGroupType="key":"key"==t.schemaGroupType&&(t.schemaGroupType="table"),t.$refs.queryCardx.refreshTypes(a.id),t.onChangeDB(a,!0)}))},mounted:function(){var t=this,e=Object(g["a"])(this.$refs.vlist,this.itemHeight);e&&this.$store.commit("updateVlistKeeps",e);var a=this.runList.filter((function(e){return t.tabId==e.tabId}));console.log("card.db mounted: ",this.owner.name,this.tabId,this.dataIndex,a),a.length&&"redis"==a[0].dbType?this.schemaGroupType="key":"key"==this.schemaGroupType&&(this.schemaGroupType="table"),this.onChangeDB(null,!0)},beforeDestroy:function(){this.$bus.off("".concat(this.tabId,".card.db.refresh"))}},w=y,S=(a("ee7d"),a("81c8"),a("2877")),E=Object(S["a"])(w,s,n,!1,null,null,null);e["default"]=E.exports},fb78:function(t,e,a){},fca0:function(t,e,a){"use strict";a("cd27")},fcbd:function(t,e,a){"use strict";a("da49")},fcc9:function(t,e,a){"use strict";a("15b2")},fd1d:function(t,e,a){"use strict";a("ff6f")},fd3f:function(t,e,a){"use strict";a("940d")},fda1:function(t,e,a){"use strict";a.r(e);var s=a("1da1");a("96cf");e["default"]={namespaced:!0,state:{info:{}},actions:{set:function(t,e){return Object(s["a"])(regeneratorRuntime.mark((function a(){var s,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=t.state,n=t.dispatch,s.info=e,a.next=4,n("d2admin/db/set",{dbName:"sys",path:"user.info",value:e,user:!0},{root:!0});case 4:case"end":return a.stop()}}),a)})))()},load:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.state,s=t.dispatch,e.next=3,s("d2admin/db/get",{dbName:"sys",path:"user.info",defaultValue:{},user:!0},{root:!0});case 3:a.info=e.sent;case 4:case"end":return e.stop()}}),e)})))()}}}},feca:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",{attrs:{type:"ghost"}},[a("k-search-table",{ref:"st",attrs:{url:"/api/ssh/filter/page","search-data":t.search},on:{reset:t.resetSearch}},[a("template",{slot:"searchs"},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}})],1)],1),a("template",{slot:"buttons"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onNew}},[t._v("添加SSH策略")])],1),a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"id",prop:"id"}}),a("el-table-column",{attrs:{label:"策略名称",prop:"name"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),a("el-table-column",{attrs:{prop:"add_user",label:"添加人"}}),a("el-table-column",{attrs:{prop:"created_at",label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("dateTime")(e.row.created_at))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{title:"edit ssh connection configuration",type:"warning",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return t.onEdit(e.row.id)}}}),a("k-btn-tip",{attrs:{tip:"确定要删除【"+e.row.name+"】SSH策略吗?"},on:{click:function(a){return t.onDel(e.row.id)}}},[a("el-button",{attrs:{title:"删除SSH策略",type:"danger",size:"mini",icon:"el-icon-delete-solid"}})],1)]}}])})],1)],2),a("dialog-edit",{ref:"sshDialog",on:{success:t.refresh}})],1)},n=[],o=(a("ac1f"),a("841c"),a("cb22")),i={components:{DialogEdit:o["default"]},name:"ViewSsh",props:["ID","name","user"],data:function(){return{search:{name:"",state:""},termVisible:!1,selectedRow:{},dialogInfoVisible:!1,formLabelWidth:"120px",dialogFormVisible:!1,total:0,page:1,size:10,tableData:[],q:"",form:{},info:{}}},mounted:function(){},created:function(){},methods:{onNew:function(){this.$refs.sshDialog.show()},onEdit:function(t){this.$refs.sshDialog.show(t)},onDel:function(t){var e=this;this.$api.ssh.delFilter(t).then((function(){e.refresh()}))},resetSearch:function(){console.log("========resetSearch========="),this.search={}},refresh:function(){this.$refs.st.search()},doClose:function(t){this.termVisible=t}}},r=i,l=a("2877"),c=Object(l["a"])(r,s,n,!1,null,null,null);e["default"]=c.exports},fefb:function(t,e,a){},ff34:function(t,e,a){},ff42:function(t,e,a){"use strict";a("6b4e")},ff60:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("99af");var s=a("4360"),n=function(){var t=s["a"].state.user.id;return"".concat(Date.now()).concat(t)}},ff6f:function(t,e,a){},ff83:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"权限组["+t.role.name+"]的申请记录",visible:t.isShow,width:"950px"},on:{"update:visible":function(e){t.isShow=e}}},[a("k-search-table",{ref:"st",attrs:{url:"/api/apply/list","search-data":t.search,manual:!0},on:{reset:t.resetSearch}},[a("template",{slot:"columns"},[a("el-table-column",{attrs:{label:"申请时间",prop:"created_at"}}),a("el-table-column",{attrs:{label:"申请理由",prop:"opt_mark"}}),a("el-table-column",{attrs:{label:"审核人",prop:"user_name"}}),a("el-table-column",{attrs:{label:"审核状态",prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?a("span",[t._v(" 审核中 ")]):2==e.row.status?a("span",{staticClass:"text-success"},[t._v("审核通过")]):3==e.row.status?a("span",{staticClass:"text-warning"},[t._v(" 不通过,原因:"+t._s(e.row.auditor_mark)+" ")]):4==e.row.status?a("span",{staticClass:"text-info"},[t._v("撤销申请")]):a("span",{staticClass:"text-info"},[t._v("未知")])]}}])})],1)],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.hide}},[t._v("关闭")])],1)],1)},n=[],o=a("5530"),i=(a("a15b"),a("ac1f"),a("841c"),a("2f62")),r={data:function(){return{ids:"",role:{},isShow:!1,search:{source_type:"role"}}},props:{},watch:{},computed:Object(o["a"])({},Object(i["e"])(["user"])),methods:{onSelect:function(t){console.log("onSelect val:",t);for(var e=[],a=0;a<t.length;a++)e.push(t[a].id);console.log("ids:",e.join(",")),this.ids=e.join(",")},resetSearch:function(){console.log("========resetSearch========="),this.search={},this.search.role_id=this.role.id},refresh:function(){this.$refs.st.search()},show:function(t){var e=this;this.role=t,this.search.source_id=t.id,this.search.source_type="role",this.isShow=!0,this.$nextTick((function(){e.refresh()}))},hide:function(t){this.isShow=!1},onAdd:function(t){var e=this;this.$api.role.relation(this.role,t).then((function(){e.onSuccess("添加成功"),e.refresh()}))},onRemove:function(t){var e=this;this.$api.role.kick(this.role,t).then((function(){e.onSuccess("移除成功"),e.refresh()}))},onSubmit:function(){}},mounted:function(){},components:{}},l=r,c=a("2877"),u=Object(c["a"])(l,s,n,!1,null,null,null);e["default"]=u.exports},ff86:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-about-action"},[t._v(" 设计表等 ")])},n=[],o=a("2877"),i={},r=Object(o["a"])(i,s,n,!1,null,null,null);e["default"]=r.exports},ffa8:function(t,e,a){"use strict";a("a704")},ffde:function(t,e,a){"use strict";a("991a")}},[[0,"manifest","chunk-index","chunk-element","chunk-vue","chunk-vendor"]]]);